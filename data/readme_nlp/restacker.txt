restack immut stack julia immut object contain heap alloc object stack alloc sometim use view degrad perform substanti restack provid api immut object restack immut object immut object stack avoid perform pitfal tend happen object cross inlin function call boundari depth stackoverflow answer tim holi discuss discours julialang julia exampl consid simpl comput kernel noinlin function inbound eachindex raw array perform view array julia use benchmarktool julia randn julia benchmark zero benchmarktool trial memori estim byte alloc estim minimum time median time mean time maximum time sampl eval sampl julia benchmark view zero view benchmarktool trial memori estim byte alloc estim minimum time median time mean time maximum time sampl eval sampl restack ing destin array fix use restack noinlin function restack inbound eachindex call function view fast raw vector version julia benchmark view zero view benchmarktool trial memori estim byte alloc estim minimum time median time mean time maximum time sampl eval sampl notic slight increas memori consumpt restack creat object stack exampl benchmark directori consid immut type struct abc abc restack abc equival abc abc restack abc restack abc restack abc mutabl object array restack return input restack ident function restack notic tripl equal mean restack chang behavior program benefit run time perform sacrif memori consumpt slight compil time note experiment function restack unsaf restack construct mutabl struct unsaf break ident break assumpt code reli final hood restack struct type direct invok express skip evalu user defin constructor minim run time overhead