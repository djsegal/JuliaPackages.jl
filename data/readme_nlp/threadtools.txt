threadtool packag implement util use thread julia util provid spawnatmost spawn thread carri loop tmap arg tmap nthread int arg tmap arg tmap nthread int arg thread map option argument nthread limit thread parallel tmap tmap fall regular map julia access thread withlock abstractlock execut function call lock unlock lock unlock throw except withlock lock call lock unlock express macro unlock lock express throw except tool limit thread use thread disk overload tri access thread time exampl use threadtool julia spinlock julia time julia spawnatmost parallel thread avil withlock protect access array use lock push time time println sleep julia round diff time digit element array float julia tmap threadid thread version map element array int julia time tmap time sleep argument limit thread julia round diff time digit element array float julia julia thread protect access use lock expect withlock julia true julia julia thread protect access nondeterminist result julia fals julia julia thread withlock lock mechan come macro julia true benchmark benchmark machin physic core follow function benchmark function fib return return fib fib light workload fib time workload fill factori time map return belaps map fib workload belaps tmap fib workload belaps tmap fib workload plot time xlabel thread ylabel time hline label task ylim inf conclus light load overhead consid kissthread advanc approach heavi workload fib time workload fill factori time map return belaps map fib workload belaps tmap fib workload belaps tmap fib workload plot time xlabel thread ylabel time hline label task ylim inf conclus tmap effect comput load heavi