expectationstubs package exists help testing stubs help patch mocks code mockingjl stubs created using expectationstubs suitable patching mockingjl stubs ideal dependency injection functions set consider purpose package stub simplified function returns fixed value fixed input expectation stubs arrange act assert style unit testing arrange setup expectations stubbed code called return act call function tested hit stubbed methods assert test stubs tiggered expected validating belief key functions check docstrings repl stub foo declares stub called foo expect foointeger sets expectation foo called integer exact value return foo real checks foo called exact value type real usecount foo real except returns times called allexpectationsusedfoo checks expectation declared foo returns bool example usage function checks status pipe pressure takes response normally calling function called email function checkstatus pressure itsbadcallback email pressure itsbadcallback philexamplecom darn phil gonna blow return false true testing function phil s emails replace itsbadcallback mock write little closure testing code closure set variable check variable called pretty bit adhock enter expectationstubsjl using base test using expectationstubs testset check pipe begin stub fakeemail expect fakeemail philexamplecom abstractstring return check happens ok test checkstatus fakeemail true test fakeemail philexamplecom email phil ok test checkstatus fakeemail false test fakeemail philexamplecom