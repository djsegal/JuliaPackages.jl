unityper unityper main capability compactify structures static single inheritance instance abstract type aa base kwdef struct a aa commonfield int bool true int base kwdef struct b aa commonfield int int float complex im isbits base kwdef struct c aa commonfield int float bool false float complexreal im isbits base kwdef struct d aa commonfield int hi isbits compactified compactify begin abstract struct commonfield int struct bool true int struct int float complex im isbits struct float bool false float complexreal im isbits struct hi isbits note concrete types conceptual unityper compactifies types single type hence check concrete types ones unityper compactified macro foo xs eachindex xs inbounds xs inbounds xs compactified begin code equivalent goo xs eachindex xs inbounds xs inbounds xs isa a d isa b a isa c b isa d a error benchmark implementations using random rng random mersennetwister gs map rand rng a b c d rng random mersennetwister xs map rand rng using benchmarktools btime foo xs btime goo gs laptop benchmark result julia btime foo xs s allocations bytes julia btime goo gs s allocations kib mind goo function optimal sense explicitly checks subtypes aa unityper x speed ordinary julia code close optim