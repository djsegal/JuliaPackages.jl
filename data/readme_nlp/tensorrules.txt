tensorrulesjl tensorrulesjl provides macro type nablatab enable automatic differentiation ad libraries zygotejl diffractorjl tensor tensoropt macros tensoroperationsjl tensorrulesjl chainrulescorejl define custom adjoints ad libraries supports chainrulescorejl julia using tensoroperations tensorrules zygote julia function foo define function einstein summation df sum a b c tensor return julia randn randn randn julia gradient foo try obtain gradient foo zygote error intrinsic compiled called stacktrace julia function foo tensor return julia gradient foo strategy tensorrulesjl similar tensorgradjl converts functions contains tensor tensoropt macro detects tensor tensoropt expressions function definition convert inlined functions define custom adjoint rules generated functions example following definition function foo tensoropt conj sin tensor return converted code equivalent function foo foo sin foo return inline foo x x x x x tensoropt conj x x x x x inline foo x x tensor x x function rrule typeof foo x x x x x foo x x x x x px px px px px projectto x projectto x projectto x projectto x projectto x function foopullback f fnx f x x x x x tensoropt conj f x x fnxadd f x x x x x tensoropt conj f x x fnx f x x x x x tensoropt conj conj x conj f x fnxadd f x x x x x tensoropt conj conj x conj f x fnx f x x x x x tensoropt conj conj x x conj f fnxadd f x x x x x tensoropt conj conj x x conj f fnx f x x x x x tensoropt conj conj f x fnx f x x x x x tensoropt conj x conj f fnxadd f x x x x x tensoropt conj x conj f x inplaceablethunk thunk px fnx f x x x x x fnxadd f x x x x x x inplaceablethunk thunk px fnx f x x x x x fnxadd f x x x x x x inplaceablethunk thunk px fnx f x x x x x fnxadd f x x x x x x thunk fnx f x x x x x x inplaceablethunk thunk px fnx f x x x x x fnxadd f x x x x x return notangent x x x x x return foopullback function rrule typeof foo x x using thunk inplaceablethunk properly adjoints evaluated unsupported features capture macro defined macrotoolsjl parse expr limitation capture macro index notations based typedvcat typedhcat unsupported please style designations contraction based ord ncon style unsupported please tensoropt specify costs bonds zygotejl support inplace operations tensor expression please instead todo support tensor block tensor begin support differentiation applying rrule frule recursively support inplaceablethunk