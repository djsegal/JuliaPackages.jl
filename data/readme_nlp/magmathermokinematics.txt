magmathermokinemat understand magmat system evolv rock record interpret wide rang earth scientist easi versatil packag simul thermal evolut magmat system consist kinemat emplac dike axisymmetr geometri account parallel cpu gpu finit differ discret employ energi equat combin semi lagrangian advect tracer track thermal evolut emplac magma dike emplac kinemat host rock shift accommod space intrud dike sill use analyt model penni shape crack elast media cool crystal latent heat effect account thermal evolut tracer simul zircon age distribut exampl script simul scenario content line exampl line exampl depend instal line exampl simpl exampl simul emplac dike crust period shown code simul includ visual line key shown load requir packag view function maincod model paramet width height densiti heat capac rock magma thermal conduct host rock magma latent heat geot geotherm gradient center dike width thick dike intrus temperatur injectioninterv kyr inject dike kyr maxtim kyr maximum simul time kyr ran ran size domain random dike rang angl diketyp elasticdik type inject elasticdik squaredik resolut grid cell direct grid size rock thermal diffus min stabl timestep requir explicit int floor maxtim requir timestep ntr dike tracer insert dike initi numer paramet array set model geometri initi structur dike dike type diketyp refer dike thick radius geot initi linear temperatur profil phi dphi solidfract phi comput solid fractio prepar visualis time dike inj injectvol time vec melt time zero zero time loop floor time injectioninterv dike inj add dike dike inj floor time injectioninterv track inject cen rand ran ran random vari center dike cen angl rand rand orient near vertic depth els angl rand rand orient near vertic shallow depth dike dike dike center cen angl angl rand specifi dike random locat angl fix size tracer vol injectdik tracer grid dike ntr dike add dike move hostrock injectvol vol track inject volum println ad dike total inject magma volum round injectvol digit rate round injectvol time digit phi dphi solidfract phi comput solid fraction phi rock phi magma thermal conduct perform diffus step parallel diffus step tnew rho dphi parallel size tnew set later boundari condit flux free tnew geot tnew bottom top temperatur constant tracer updatetrac tracer grid tnew phi updat info tracer tnew tnew updat temperatur time time track evolv time melt time sum phi melt fraction crust time vec time vector time println timestep round time kyr kyr mod visualis phi melt phi heatmap aspect ratio xlim ylim lajolla clim xlabel width ylabel depth titl round time kyr digit kyr dpi fontsiz colorbar titl temperatur heatmap phi melt aspect ratio xlim ylim nuuk clim xlabel width dpi fontsiz colorbar titl melt fraction plot layout frame anim gif anim exampl gif fps creat gif anim return time vec melt time main function time vec melt time maincod start main code plot time vec kyr melt time xlabel time kyr ylabel fraction crust molten label none png time melt exampl creat plot main routin injectdik insert dike dimens orient domain diffus step comput thermal diffus variabl thermal conduct latent heat account code exampl download line exampl minor chang code requir movi exampl comput laptop main chang compar exampl use magmathermokinemat diffus use parallelstencil finitediffer use writevtk initi init parallel stencil thread float initi parallel stencil view function maincod model paramet width length height center dike coordin width thick dike resolut grid size array initi set model geometri initi structur coordin array crd collect iter product generat coordin coordin vector crd crd crd transfer coord array grid grid prepar vtk paraview output isdir viz fals mkdir viz loadpath viz pvd paraview collect exampl time loop floor time injectioninterv dike inj add dike cen rand ran ran ran random vari center dike cen angl rand rand rand dike depth els angl rand rand rand sill shallow depth dike dike dike center cen angl angl rand specifi dike random locat angl fix size perform diffus step parallel diffus step vark tnew rho dphi parallel size size tnew set later boundari condit flux free parallel size size tnew set later boundari condit flux free tnew geot tnew bottom top temperatur constant mod visualis phi melt phi vtkfile vtk grid viz int vector vector vector vtkfile temperatur vtkfile meltfract phi melt outfil vtk save vtkfile pvd time kyr vtkfile vtk save pvd return tracer grid main function maincod start main code result script rang vtk file visual softwar paraview code exampl download paraview statefil reproduc movi avail depend reli parallelstencil energi solver structarray generat aray tracer structur random random generat paramet simplifi set paramet specifi dike properti interpol interpol properti temperatur fix grid tracer staticarray speed depend instal automat instal magmathermokinemat plot employ plot writevtk exampl generat vtr pvd file visual paraview add packag anyway use instal instal julia usual manner add test packag julia pkg add pkg add pkg test magmathermokinemat parallelstencil regist julia packag instal test suit run perform test compar result analyt solut advect diffus encount run exampl creat plot instal packag julia pkg add plot pkg add writevtk download code current directori start julia includ exampl final instal packag previous system updat version julia pkg updat magmathermokinemat depend