magmathermokinematicsjl understanding magmatic systems wide range earth scientists easy versatile package simulates thermal evolution magmatic systems following intrusion dikes sills d d axisymmetric d geometries account parallel cpu gpu finite difference discretization employed energy equation combined semilagrangian advection tracers track thermal evolution emplaced magma dikes emplaced kinematically host rock shifted accommodate space intruding dikessills including using analytical models pennyshaped cracks elastic media cooling crystallizing latent heat effects account thermal evolution tracers simulate zircon age distributions example scripts simulate scenarios contents lines d example lines d example dependencies installation lines d example simple example simulates emplacement dikes crust period shown code simulate including visualization lines key shown using magmathermokinematics const usegpu false usegpu environment gpu float initialize parallel stencil d else environment cpu float initialize parallel stencil d using magmathermokinematics diffusiond load calling environment using plots views function maincoded nxnz grid creategrid size nxnz extent e e grid domain size num numericparams verbose false nonlinear solver options set material parameters matparam setmaterialparams name rock phase density constantdensity kg heatcapacity constantheatcapacity cp kg conductivity constantconductivity watt latentheat constantlatentheat ql e kg melting meltingparamcaricchi geot e geothermal gradient km win hin e e width thickness dike tin intrusion temperature injectioninterval kyr inject dike kyrs maxtime kyr maximum simulation time kyrs hran wran grid size domain randomly dikes range angles diketype elasticdike type injected elasticdikesquaredike thermal diffusivity dt minimum grid stable timestep required explicit fd nt floor intmaxtime dt required timesteps ntrdike tracers inserted dike array initializations arrays createarrays dict nx nz tk titold rho cp tnew hr hl kc ddt nx nz qx kx nx nz qz kz cpu buffers tnewcpu matrix float undef grid phimeltcpu similar tnewcpu usegpu phases cuda ones intgrid else phases ones intgrid parallel nx nz gridarray arrays arrays grid coordd grid coordd tracers structarray tracer undef initialize tracers dike dike win hintype diketype tin reference dike thicknessradius arrays arrays geot initial linear temperature profile preparation visualisation env gkswstype nul isdir vizdout false mkdir vizdout loadpath vizdout anim animation loadpathstring time dikeinj injectvol timevecmelttime zeros nt zeros nt nt time loop floor time injectioninterval dikeinj add dike dikeinj floor time injectioninterval track injected cen grid max grid min rand e wranhran randomly vary center dike cen e anglerand rand orientation nearvertical depth else anglerand rand orientation nearvertical shallower depth dike dike dike center cenangle anglerand specify dike random locationangle fixed size tnewcpu array arrays tracers tnewcpu vol injectdike tracers tnewcpu grid coordd dike ntrdike add dike move hostrocks arrays data array tnewcpu injectvol vol track injected volume println added dike total injected magma volume round injectvol kmdigits km rate round injectvol timedigits m nonlineardiffusionstepd arrays matparam phases grid dt num perform nonlinear diffusion step copyarraysgpucpu tnewcpu phimeltcpu arrays tnew arrays copy arrays cpu update properties updatetracerst tracers grid coordd tnewcpu phimeltcpu update info tracers parallel assign arrays arrays tnew parallel assign arrays tnew arrays update temperature time time dt track evolved time melttime sum arrays prod grid melt fraction crust timevec time vector time println timestep round time kyr kyrs mod visualisation grid coordd grid coordd p heatmap e e array arrays aspectratio xlims e e ylims e e lajolla clims xlabel width km ylabel depth km title round time kyr digits kyrs dpi fontsize colorbartitle temperature p heatmap e e array arrays aspectratio xlims e e ylims e e nuuk clims xlabel width km dpi fontsize colorbartitle melt fraction plot p p layout frame anim gif anim exampledgif fps create gif animation return timevec melttime main function timevecmelttime maincoded start main code plot timevec kyr melttime xlabel time kyrs ylabel fraction crust molten label none png timevsmeltexampled create plot main routines injectdike inserts dike dimensions orientation domain nonlineardiffusionstepd computes thermal diffusion variable thermal conductivity latent heat account multicore processor chances code advantage start julia multiple threads linux macos julia threads check threads using julia threads nthreads start simulation julia include exampledjl provided directory file check pwd happen machine nvidia graphics card build code run substantially faster changing flag const usegpu true code example downloaded lines d example d d minor changes code required movie example computed laptop d code using magmathermokinematics const usegpu false usegpu environment gpu float initialize parallel stencil d else environment cpu float initialize parallel stencil d using magmathermokinematics diffusiond using plots using writevtk views function maincoded nxnynz grid creategrid size nxnynz extent e e e grid domain size num numericparams verbose false nonlinear solver options set material parameters matparam setmaterialparams name rock phase density constantdensity kg heatcapacity constantheatcapacity cp kg conductivity constantconductivity watt latentheat constantlatentheat ql e kg melting meltingparamcaricchi geot e geothermal gradient km win hin e e width thickness dike tin intrusion temperature injectioninterval kyr inject dike kyrs maxtime kyr maximum simulation time kyrs hran wran grid grid size domain randomly dikes range angles diketype elasticdike type injected elasticdikesquaredike thermal diffusivity dt minimum grid stable timestep required explicit fd nt floor intmaxtime dt required timesteps ntrdike tracers inserted dike array initializations arrays createarrays dict nx ny nz tk titold rho cp tnew hr hl kc ddt nx nynz qx kx nx ny nz qy ky nx ny nz qz kz cpu buffers tnewcpu zeros float grid phimeltcpu similar tnewcpu usegpu phases cuda ones intgrid else phases ones intgrid parallel nx ny nz gridarray arrays arrays arrays grid coordd grid coordd grid coordd tracers structarray tracer undef initialize tracers dike dike win hintype diketype tin reference dike thicknessradius arrays arrays geot initial linear temperature profile preparation vtkparaview output isdir vizdout false mkdir vizdout loadpath vizdout pvd paraviewcollection exampled time dikeinj injectvol timevecmelttime zeros nt zeros nt nt time loop floor time injectioninterval dikeinj add dike dikeinj floor time injectioninterval track injected cen grid max grid min rand e wranwranhran randomly vary center dike cen e anglerand rand rand dikes depth else anglerand rand rand sills shallower depth dike dike dike center cenangle anglerand specify dike random locationangle fixed size tnewcpu array arrays tracers tnewcpu vol injectdike tracers tnewcpu grid coordd dike ntrdike add dike move hostrocks arrays data array tnewcpu injectvol vol track injected volume println added dike total injected magma volume round injectvol kmdigits km rate round injectvol timedigits m nonlineardiffusionstepd arrays matparam phases grid dt num perform nonlinear diffusion step copyarraysgpucpu tnewcpu phimeltcpu arrays tnew arrays copy arrays cpu update properties updatetracerst tracers grid coordd tnewcpu phimeltcpu update info tracers parallel assign arrays arrays tnew parallel assign arrays tnew arrays update temperature time time dt track evolved time melttime sum arrays prod grid melt fraction crust timevec time vector time println timestep round time kyr kyrs mod visualisation grid coordd grid coordd grid coordd vtkfile vtkgrid vizdoutexd int e vector e vector e vector e vtk file vtkfile temperature array arrays vtkfile meltfraction array arrays store fields file outfiles vtksave vtkfile pvdtime kyr vtkfile save file update pvd file vtksave pvd return timevec melttime tracers grid arrays main function timevec melttime tracers grid arrays maincoded start main code result script range vtk files visualized d software paraview code example downloaded paraview statefile reproduce movie available dependencies rely parallelstenciljl energy solver geoparamsjl define material properties nonlinear conductivity melting etc structarraysjl generate aray tracer structures randomjl random generation parametersjl simplify setting parameters specifying dike properties interpolationsjl interpolate properties temperature fixed grid tracers staticarraysjl speed dependencies installed automatically install magmathermokinematicsjl plotsjl employed plotting writevtkjl d example generate vtrpvd files visualized paraview add packages anyways useful installation installing julia usual manner add test package julia pkg add magmathermokinematics pkg test magmathermokinematics dependecies parallelstenciljl installed automatically testing suite run performs tests compares results analytical solutions advectiondiffusion encounter run examples create plots install packages julia pkg add plots pkg add makie pkg add writevtk download codes current directory start julia includeexampledjl finally installed package previously system update version julia pkg update magmathermokinematics running benchmark scenarios comparing magmathermokinematicsjl versus codes previously geneva gregor weber luca caricchi ucla oscar lovera research run julia includeexamplesexampledzassyjl ongoing development magmatic systems software magma project funded european research council include thermal diffusion solvers kinematically emplaced dikes mechanical multiphysics solvers compute stress deformation rate system example follow modular reusable software approach various software componentys defined external package reusable packages ultimately easier write software apply natural example geoparamsjl package material properties density heat capacity thermal conductivity defined packages magmathermokinematicsjl advantage approach material properties defined subsequently range software packages look magmathermokinematics currently example test software infrastructure result functionality internals code expected change regular basis related thermalkinematic codes ones time various degrees sophistication recent effort julia similar described aware source code packages currently openly available binary format makes straightforward understand actually inside codes existing code d advantage gpus dufek bergantz lower crustal magma genesis preservation stochastic framework evaluation basaltcrust interaction journal petrology annen blundy sparks genesis intermediate silicic magmas deep crustal hot zones journal petrology caricchi annen blundy simpson pinel frequency magnitude volcanic eruptions controlled magma injection buoyancy nature geoscience tierney schmitt lovera de silva voluminous plutonism period volcanic quiescence revealed thermochemical modeling zircon geology melnik utkin bindeman magma chamber formation dike accretion crustal melting d thermocompositional model emphasis eruptions implication zircon records geophys res solid earth preprint avail