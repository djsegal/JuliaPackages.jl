mill multipl instanc learn librari mill librari build top flux aim prototyp flexibl multi instanc learn model describ multipl instanc learn mil prototyp machin learn input sampl vector matrix fix dimens sequenc mil sampl set vector matric mean matter featur mil sequenc pevni somol propos simpl solv mil neural network network consist linear layer mean maximum oper sandwich nonlinear denot layer neural network output calcul author extend univers approxim theorem mil multipl instanc learn musk musk dataset classic field public class name littl walk solv use mill librari exampl shown exampl musk contain julia environ run start import librari julia use fileio jld statist mill flux julia use flux throttl epoch julia use mill reflectinmodel julia use base iter repeat load dataset file fold mill data structur follow function musk jld contain matrix featur fmat sampl call bag mil terminolog instanc column fmat belong final label instanc bagnod structur hold featur matrix rang column bag final bagnod concaten catob subset use getindex julia fmat load musk jld fmat matrix instanc column sampl julia bagid load musk jld bagid tie instanc bag julia bagnod arraynod fmat bagid creat bagdataset julia load musk jld load label julia map maximum bag creat label bag julia flux onehotbatch hot encod data manual creat model bagmodel design implement basic multi instanc learn model describ simpl model instanc pass singl layer neuron input dimens tanh linear mean max aggreg function simultan max mean layer neuron tanh nonlinear follow output linear layer neuron output dimens julia model bagmodel arraymodel dens flux tanh model level flow segmentedmeanmax aggreg arraymodel chain dens flux tanh dens model level bag bagmodel segmentedmean segmentedmax arraymodel chain dens tanh dens arraymodel dens tanh loss function standard cross entropi julia loss flux logitcrossentropi model data final code resembl exampl flux librari julia evalcb loss julia opt flux adam julia epoch flux train loss param model repeat opt throttl evalcb info epoch loss info epoch loss info epoch loss info epoch loss info epoch loss info epoch loss info epoch loss info epoch loss info epoch loss info epoch loss leav data valid calcul error train data surpris low mean mapslic argmax model data dim complic model main advantag mill librari allow arbitrarili nest cross product bagmodel describ theorem start demonstr nest mil outer mil model contain sampl sampl contain bag inner mil instanc sampl contain inner bag total instanc final third sampl contain inner bag instanc julia bagnod bagnod arraynod randn bagnod bag bagnod bag arraynod creat model manual musk julia bagmodel bagmodel arraymodel dens flux relu segmentedmeanmax arraymodel dens flux relu segmentedmeanmax arraymodel chain dens flux relu dens bagmodel segmentedmean segmentedmax arraymodel chain dens relu dens bagmodel segmentedmean segmentedmax arraymodel dens relu arraymodel dens relu appli model julia arraynod construct model process prone error function reflectinmodel tri automat keep track dimens accept paramet sampl use function exampl creat model julia reflectinmodel bagmodel segmentedmean arraymodel dens bagmodel segmentedmean arraymodel dens arraymodel dens control topolog reflectinmodel accept addit paramet paramet function return layer set layer input dimens third function function return aggreg function bagmodel julia reflectinmodel dens relu segmentedmeanmax bagmodel segmentedmean segmentedmax arraymodel dens relu bagmodel segmentedmean segmentedmax arraymodel dens relu arraymodel dens relu test model julia data array float complic model mention dataset contain cartesian product mil normal mil quick demo julia bagnod productnod bagnod arraynod randn arraynod randn bagnod bagnod arraynod randn arraynod randn bagnod bag productnod bagnod bag arraynod bagnod bag arraynod creat model automat despit sub optim julia reflectinmodel dens relu segmentedmeanmax bagmodel segmentedmean segmentedmax arraymodel dens relu productmodel arraymodel dens relu bagmodel segmentedmean segmentedmax arraymodel dens relu arraymodel dens relu bagmodel segmentedmean segmentedmax arraymodel dens relu arraymodel dens relu hierarch util mill hierarchicalutil bring lot addit featur instanc print truncat version model call julia printtre trunc inf bagmodel segmentedmean segmentedmax arraymodel dens relu productmodel arraymodel dens relu bagmodel segmentedmean segmentedmax arraymodel dens relu arraymodel dens relu arraymodel dens relu bagmodel segmentedmean segmentedmax arraymodel dens relu bagmodel segmentedmean segmentedmax arraymodel dens relu arraymodel dens relu arraymodel dens relu calll trav true enabl conveni travers function string index julia printtre trunc inf trav true bagmodel segmentedmean segmentedmax arraymodel dens relu productmodel arraymodel dens relu bagmodel segmentedmean segmentedmax arraymodel dens relu arraymodel dens relu arraymodel dens relu bagmodel segmentedmean segmentedmax arraymodel dens relu bagmodel segmentedmean segmentedmax arraymodel dens relu arraymodel dens relu arraymodel dens relu node model tree swift access handi inspect model paramet simpli delet replac insert node tree instanc construct adversari sampl tree node access index travers code julia bagmodel segmentedmean segmentedmax arraymodel dens relu arraymodel dens relu follow approach result julia true function provid hierarchicalutil julia nnode julia nleaf julia nodeiter collect element array abstractmillmodel bagmodel productmodel bagmodel arraymodel arraymodel bagmodel bagmodel arraymodel arraymodel julia leafiter collect element array arraymodel dens typeof relu array float array float arraymodel arraymodel arraymodel arraymodel julia typeiter bagmodel collect element array bagmodel aggreg arraymodel dens typeof relu array float array float abstractmillmodel bagmodel bagmodel bagmodel bagmodel default aggreg valu version mill miss data replac miss bag default constant valu learn valu automat repres miss valu librari current support repres bag miss valu repres miss data use miss bagnod miss empti vector bagnod zero shelf librari support approach transpar differ main getindex switch mill emptyismiss fals default fals demonstr differ julia bagnod arraynod rand bagnod bag arraynod julia mill emptyismiss fals julia data arraynod julia mill emptyismiss true true julia data miss advantag approach default type nice compil zygot advantag latter compact nicer refer discrimin model multi instanc tree structur tom pevn petr somol use neural network formal solv multipl instanc tom pevn petr somol approxim capabl neural network set probabl measur tree structur data tom pevn vojt kova solv multipl instanc axi parallel rectangl dietterich thoma richard lathrop tom lozano rez