polyester note polyesterbatch moves arrays threads stridearrayscoreptrarray means batch slices create view default start julia checkbounds debugging polyesterjl provides low overhead threading primary api batch threadsthreads available threads governed threads julianumthreads reported threadsnthreads look simple benchmark using polyester linearalgebra benchmarkhistograms single threaded function axpyserial inbounds eachindex muladd thread core default threads pinned function axpypercore batch core eachindex muladd thread thread function axpyperthread batch thread eachindex muladd set minimum batch size function axpyminbatch batch minbatch eachindex muladd benchmark threadsthreads function axpyatthread threads threads eachindex inbounds muladd rand rand benchmark axpyserial eps benchmark axpy eps benchmark axpyatthread eps benchmark axpypercore eps benchmark axpyperthread eps benchmark axpyminbatch eps versioninfo elements simply muladd loop afford overhead threads blas threadsthreads slow computations elements afford polyester giving x speedup cores julia benchmark axpyserial eps samples evals sample memory estimate bytes allocs estimate ns counts min s gc mean s gc median s gc max s gc julia benchmark axpy eps samples evals sample memory estimate bytes allocs estimate ns counts min s gc mean s gc median s gc max s gc julia benchmark axpyatthread eps samples evals sample memory estimate kib allocs estimate ns counts min s gc mean s gc median s gc max s gc julia benchmark axpypercore eps samples evals sample memory estimate bytes allocs estimate ns counts min ns gc mean ns gc median ns gc max s gc julia benchmark axpyperthread eps samples evals sample memory estimate bytes allocs estimate ns counts min ns gc mean ns gc median ns gc max s gc julia benchmark axpyminbatch eps samples evals sample memory estimate bytes allocs estimate ns counts min ns gc mean ns gc median ns gc max s gc julia versioninfo julia version dev commit aafff utc platform info os linux x redhat linux cpu th gen intel core tm i g ghz wordsize libm libopenlibm llvm libllvm orcjit tigerlake environment julianumthreads minbatch argument choose minimum iterations thread minbatch means ll numberloopiterations threads setting minbatch means iterations batch threads iterations ll control pace ramps threads using threads iterations faster serial version using threads core slightly faster thread matches serial julia rand rand julia benchmark axpyserial eps samples evals sample memory estimate bytes allocs estimate ns counts min ns gc mean ns gc median ns gc max ns gc julia benchmark axpyminbatch eps samples evals sample memory estimate bytes allocs estimate ns counts min ns gc mean ns gc median ns gc max ns gc julia benchmark axpypercore eps samples evals sample memory estimate bytes allocs estimate ns counts min ns gc mean ns gc median ns gc max ns gc julia benchmark axpyperthread eps samples evals sample memory estimate bytes allocs estimate ns counts min ns gc mean ns gc median ns gc max s gc seeing substantial improvement threads vectors length expect improvement vectors length try minbatch ensure using threads vectos length performance respect size tends lot discontinuities julia function axpyminbatch batch minbatch eachindex muladd axpyminbatch generic function method julia rand rand julia benchmark axpyserial eps samples evals sample memory estimate bytes allocs estimate ns counts min ns gc mean ns gc median ns gc max ns gc julia benchmark axpyminbatch eps samples evals sample memory estimate bytes allocs estimate ns counts min ns gc mean ns gc median ns gc max ns gc julia benchmark axpyminbatch eps samples evals sample memory estimate bytes allocs estimate ns counts min ns gc mean ns gc median ns gc max ns gc reducing length vectors x speedup serial version minbatch using single thread able match performance minbatch choice particular function particular cpu note batch defaults using thread physical core instead thread cpu thread loopvectorizationjl currently thread physical core switching threads incurs overhead docstring batch batch julia repl discussion local thread storage define local storage thread providing vector containing local storages julia batch threadlocal rand println index thread threads threadid local storage threadlocal threadlocal println threadlocal index thread local storage index thread local storage index thread local storage index thread local storage index thread local storage index thread local storage index thread local storage index thread local storage index thread local storage index thread local storage optionally type specified threadlocal storage julia batch threadlocal rand float println threadlocal float disabling polyester threads running repetitions polyestermultithreaded function embarrassingly parallel repeatedly executes polyestermultithreaded function beneficial disable polyester inner multithreaded loop multithread outer level basethreads disablepolyesterthreads context manager expandable section examples benchmarks call disablepolyesterthreads thread happen avoid overhead disablepolyesterthreads threads instead following unnecessarily slow manner threads disablepolyesterthreads unnecessary overhead benchmarks nested multithreading polyester inner repeated times rand rand size btime inner ms allocations bytes btime innerpolyester ms allocations bytes btime innerthread ms allocations kib btime sequentialsequential ms allocations bytes btime sequentialpolyester ms allocations bytes btime sequentialthread ms allocations kib btime threadsofpolyester ms allocations kib following purposefully suboptimal disable threads btime threadsofpolyesterinnerdisable ms allocations kib following disable threads disable call happening outer scope btime polyester disablepolyesterthreads threadsofpolyester ms allocations kib btime threadsofsequential ms allocations kib btime threadsofthread ms allocations kib inner repeated times rand rand size btime inner s allocations bytes btime innerpolyester s allocations bytes btime innerthread s allocations kib btime sequentialsequential ms allocations bytes btime sequentialpolyester ms allocations bytes btime sequentialthread ms allocations mib btime threadsofpolyester ms allocations kib following purposefully suboptimal disable threads btime threadsofpolyesterinnerdisable ms allocations kib following disable threads disable call happening outer scope btime polyester disablepolyesterthreads threadsofpolyester s allocations kib btime threadsofsequential ms allocations kib btime threadsofthread ms allocations mib tested functions implemented using tturbo suboptimal implementations serve test polystervsbase thread scheduling function inner axes sin function innerpolyester batch axes sin function innerthread threads axes sin function sequentialsequential axes inner function sequentialpolyester axes innerpolyester function sequentialthread axes innerthread function threadsofpolyester threads axes innerpolyester function threadsofpolyesterinnerdisable xxx bad disable polyester threads causes unnecessary overhead threads thread benchmarks threads axes polyester disablepolyesterthreads innerpolyester function threadsofthread threads axes innerthread function threadsofthread threads axes innerthread function threadsofsequential threads axes inner benchmarks executed julia version dev commit eaaa utc platform info os linux xlinuxgnu cpu amd ryzen eightcore processor wordsize libm libopenlibm llvm libllvm orcjit znver threads virtual cores environment juliaeditor code julianumthread