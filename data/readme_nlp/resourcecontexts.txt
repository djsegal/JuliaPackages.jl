resourcecontext resourcecontext experiment julia packag compos resourc manag block resourc object cleanup code run final exampl file handl temporari file directori background task current handl block macro call defin context function function abstractcontext argument associ resourc context packag provid context base overrid base function mktemp mktempdir run lock redirect stdout stderr stdin context macro associ context current code block pass context function invok context block exit cleanup code associ context run defer macro defer arbitrari cleanup express current context exampl mang resourc block file read line close function context readlin tmp txt creat temporari file ensur clean afterward context function path mktemp write content flush info mktemp output path ispath path isopen read path string acquir pair lock releas opposit function reentrantlock reentrantlock context begin lock lock info lock section islock islock info outsid lock section islock islock start ten extern process wait finish continu context begin run sleep rand function pass resourc caller function call foo arg pass current context argument foo current context arg call foo defin use context automat defer resourc cleanup caller use defer exampl return bare ptr temporari buffer function raw buffer len buf vector uint undef len defer preserv buf pointer buf context begin len ptr raw buffer len buf preserv regardless call unsaf store ptr xff defer zero secret buffer caller function creat secret buf base secretbuff write buf rand uint super secret seek buf defer base shred buf buf context begin buf creat secret info secret byte read buf buf shred interop block base resourc manag avail enter function steal insid block avail context block repl function resourc func function arg info set resourc fake resourc fake resourc arg info tear resourc normal usag resourc func info resourc readi safe access resourc repl enter resourc func interop final base resourc manag special function detach context cleanup detach context cleanup current context block associ final instead lexic resourc manag dynam resourc manag exampl creat temporari directori file return directori name string clean directori dir final dir context begin dir mktempdir write joinpath dir file txt content write joinpath dir file txt content resourcecontext detach context cleanup dir design standard solut julian resourc manag block sever ergonom disadvantag extrem inconveni repl intermedi resourc enter context block creat high nest code resourc visual confus excess nest lead deep stack trace custom cleanup code separ resourc creation final block ergonom factor mean peopl prefer scope form argu suffer sever disadantag resourc leak final peopl forget guard resourc cleanup tri final final run restrict environ error occur outsid origin context resourc creat make unstructur error handl imposs propag error natur function return object resourc aliv hold refer return object hold refer resourc bad implement reduc compos combin desir return type arbitrari resourc multipl return object resourc unnatur forc user unpack return valu solut packag macro proxi propos postfix syntax add idea user abl forget prevent introduc context call convent resourc creation function current abstractcontext pass argument context macro creat context lexic scope macro syntact sugar call current context resourc creation function abl compos desir object return type arbitrari resourc preserv compos block form reject conflat return object resourc break familiar api standard file handl return filenam stream interfac resourc cleanup languag integr look languag featur replac postfix propos defer keyword special behavior ignor return valu similar code run insid final sens valu return defer particular observ frequent lead introduct temporari variabl simpli transfer result express occur prior defer line context implicit function boundari global block potenti scope function get correct tricki design exampl loop construct introduc implicit context user disabl particular use exampl function creat secret buf base secretbuff write buf rand uint super secret seek buf defer base shred buf buf creat secret info secret byte read buf buf shred concern definit creat secret hide call convent explicit annot pass context transpar syntax exist macro annot nospeci attach metadata function argument exampl function creat secret passcontext ctx abstractcontext buf base secretbuff write buf rand uint super secret seek buf defer base shred buf refer resourc cleanup defer syntax postfix syntax close default cleanup macro proxi syntax benefit drawback syntax ergonom compos benefit final discuss length previous prototyp defer similar macro base syntax structur concurr cancel close relat view async task type resourc task nursuri context