<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><h1 dir="auto"><a id="user-content-deferredacceptance" class="anchor" aria-hidden="true" href="#deferredacceptance"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>DeferredAcceptance</h1>
<p dir="auto">… is an efficient Julia implementation of several school-choice algorithms, including the famous deferred acceptance (DA) algorithm in discrete and nonatomic forms, top trading cycles (TTC), and a number of popular tiebreaking methods.</p>
<p dir="auto">The author’s homepage is <a href="https://www.maxkapur.com/" rel="nofollow">maxkapur.com</a>.</p>
<h2 dir="auto"><a id="user-content-usage" class="anchor" aria-hidden="true" href="#usage"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Usage</h2>
<p dir="auto">First, install the DeferredAcceptance package. You can do this from the Julia REPL by pressing <code>]</code> to enter package mode, then running <code>add DeferredAcceptance</code>.</p>
<p dir="auto">Input some preference orders. The <code>2</code> in cell <code>(3, 4)</code> means that student <code>4</code> has named school <code>3</code> as her <code>2</code>nd choice. Similar data for the schools.</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="using DeferredAcceptance

students = [3 3 4 3 4 3 3 3 3 4;
            4 4 3 4 3 4 4 4 4 3;
            2 1 2 2 2 1 2 2 2 2;
            1 2 1 1 1 2 1 1 1 1]

schools = [1 5 7 5;
           1 1 1 1;
           5 1 1 1;
           5 1 1 1;
           10 9 7 8;
           1 5 4 5;
           5 1 4 1;
           8 5 7 8;
           8 9 7 8;
           1 5 4 5]

capacities = [3, 2, 2, 3]"><pre><span class="pl-k">using</span> DeferredAcceptance

students <span class="pl-k">=</span> [<span class="pl-c1">3</span> <span class="pl-c1">3</span> <span class="pl-c1">4</span> <span class="pl-c1">3</span> <span class="pl-c1">4</span> <span class="pl-c1">3</span> <span class="pl-c1">3</span> <span class="pl-c1">3</span> <span class="pl-c1">3</span> <span class="pl-c1">4</span>;
            <span class="pl-c1">4</span> <span class="pl-c1">4</span> <span class="pl-c1">3</span> <span class="pl-c1">4</span> <span class="pl-c1">3</span> <span class="pl-c1">4</span> <span class="pl-c1">4</span> <span class="pl-c1">4</span> <span class="pl-c1">4</span> <span class="pl-c1">3</span>;
            <span class="pl-c1">2</span> <span class="pl-c1">1</span> <span class="pl-c1">2</span> <span class="pl-c1">2</span> <span class="pl-c1">2</span> <span class="pl-c1">1</span> <span class="pl-c1">2</span> <span class="pl-c1">2</span> <span class="pl-c1">2</span> <span class="pl-c1">2</span>;
            <span class="pl-c1">1</span> <span class="pl-c1">2</span> <span class="pl-c1">1</span> <span class="pl-c1">1</span> <span class="pl-c1">1</span> <span class="pl-c1">2</span> <span class="pl-c1">1</span> <span class="pl-c1">1</span> <span class="pl-c1">1</span> <span class="pl-c1">1</span>]

schools <span class="pl-k">=</span> [<span class="pl-c1">1</span> <span class="pl-c1">5</span> <span class="pl-c1">7</span> <span class="pl-c1">5</span>;
           <span class="pl-c1">1</span> <span class="pl-c1">1</span> <span class="pl-c1">1</span> <span class="pl-c1">1</span>;
           <span class="pl-c1">5</span> <span class="pl-c1">1</span> <span class="pl-c1">1</span> <span class="pl-c1">1</span>;
           <span class="pl-c1">5</span> <span class="pl-c1">1</span> <span class="pl-c1">1</span> <span class="pl-c1">1</span>;
           <span class="pl-c1">10</span> <span class="pl-c1">9</span> <span class="pl-c1">7</span> <span class="pl-c1">8</span>;
           <span class="pl-c1">1</span> <span class="pl-c1">5</span> <span class="pl-c1">4</span> <span class="pl-c1">5</span>;
           <span class="pl-c1">5</span> <span class="pl-c1">1</span> <span class="pl-c1">4</span> <span class="pl-c1">1</span>;
           <span class="pl-c1">8</span> <span class="pl-c1">5</span> <span class="pl-c1">7</span> <span class="pl-c1">8</span>;
           <span class="pl-c1">8</span> <span class="pl-c1">9</span> <span class="pl-c1">7</span> <span class="pl-c1">8</span>;
           <span class="pl-c1">1</span> <span class="pl-c1">5</span> <span class="pl-c1">4</span> <span class="pl-c1">5</span>]

capacities <span class="pl-k">=</span> [<span class="pl-c1">3</span>, <span class="pl-c1">2</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>]</pre></div>
<p dir="auto">Break ties and run the DA algorithm.</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="schools_tiebroken = singletiebreaking(schools)
assn, ranks = deferredacceptance(students, schools_tiebroken, capacities)
println(assn)
# [1, 3, 4, 4, 2, 3, 4, 1, 1, 2]"><pre>schools_tiebroken <span class="pl-k">=</span> <span class="pl-c1">singletiebreaking</span>(schools)
assn, ranks <span class="pl-k">=</span> <span class="pl-c1">deferredacceptance</span>(students, schools_tiebroken, capacities)
<span class="pl-c1">println</span>(assn)
<span class="pl-c"><span class="pl-c">#</span> [1, 3, 4, 4, 2, 3, 4, 1, 1, 2]</span></pre></div>
<p dir="auto">See <code>examples/Tutorial.jl</code> for a more verbose introduction.</p>
<h2 dir="auto"><a id="user-content-background" class="anchor" aria-hidden="true" href="#background"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Background</h2>
<h3 dir="auto"><a id="user-content-mechanism-design-perspective" class="anchor" aria-hidden="true" href="#mechanism-design-perspective"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Mechanism-design perspective</h3>
<p dir="auto">In many public school systems, such as those in New York City, Boston, and Amsterdam, students apply for seats by supplying a strict ranking of the schools they would like to attend. Likewise, each school has a ranking of the students, favoring e.g. students who live nearby, have siblings at the school, or have high grades. Schools’ preferences are <em>not</em> strict. Each school places students of common favorability into categories and provides a ranking over the categories. In addition, each school has a limit on how many students it can accept, and we assume that schools would prefer any student over an empty seat. Each student may be assigned to at most one school.</p>
<p dir="auto">The school-choice problem is, given the students’ and schools’ preference lists, what is the best way to assign students to schools? School-choice mechanisms generally attempt to accommodate a few important design considerations:</p>
<ul dir="auto">
<li>The matches should be <em>stable.</em> For example, if Aretha likes Brad’s school better than hers, and Brad’s school likes Aretha better than Brad, then Aretha and Brad’s school have an incentive to defect from the mechanism, and this matching is unstable.</li>
<li>Ideally, the match should be <em>Pareto-efficient</em> in student welfare. If Aretha likes Brad’s school better than hers, and Brad likes Aretha’s school better than his, then they would be better off if they switched.</li>
<li>The mechanism should be <em>incentive compatible.</em> This means that Aretha cannot obtain a better matching by lying about which school is her favorite.</li>
</ul>
<p dir="auto">If every student and school has a strict preference list, we can use <code>deferredacceptance()</code> to find a stable assignment (it is often unique). But to address the general case, there are a family of tiebreaking mechanisms that we can use to convert loose preference lists into strict ones. Many of these are incentive compatible.</p>
<p dir="auto">At the other extreme, when school preferences are weak (that is, schools consider many students interchangeable), we can use Pareto-improving cycles, implemented as <code>TTC_match()</code>, to search for student-optimal matches; this method is Pareto efficient but not incentive compatible.</p>
<h3 dir="auto"><a id="user-content-market-equilibrium-perspective" class="anchor" aria-hidden="true" href="#market-equilibrium-perspective"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Market equilibrium perspective</h3>
<p dir="auto">Schools are like vendors in a competitive market, where students’ <em>scores</em> (on standardized tests, as derived from letters of recommendation, etc.) are analogous to <em>prices</em> they must afford to attend each school. Each school attempts to set the highest score cutoff it can while still filling its class.</p>
<p dir="auto">A landmark paper by Azevedo and Leshno (2016) proposes a one-to-one relationship between <em>market-clearing cutoffs</em> and stable assignments. This result inspires a family of school-choice algorithms based on the concept of market equilibrium: <code>nonatomicdeferredacceptance_iid()</code>, which searches for score cutoffs in a DA-like situation where a fixed percentage of students have a given preference list, and <code>nonatomictatonnement()</code>, which applies a general algorithm for computing equilibrium prices to school-choice equilibria.</p>
<h2 dir="auto"><a id="user-content-comparison-of-tiebreaking-mechanisms" class="anchor" aria-hidden="true" href="#comparison-of-tiebreaking-mechanisms"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Comparison of tiebreaking mechanisms</h2>
<p dir="auto">Here is a cool graph, produced by the script <code>examples/Hybrid.jl</code>:</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="examples/hybrid/plot.png"><img src="examples/hybrid/plot.png" alt="Simulated market with 170 popular schools, 330 unpopular" style="max-width: 100%;"></a></p>
<p dir="auto">It compares the cumulative rank distributions associated with various DA tiebreaking rules in a simulated school-choice market involving 120 students and 120 seats. In overdemanded (popular) schools, single tiebreaking (STB) yields both better student welfare and greater equity than multiple tiebreaking (MTB), but MTB produces a more equitable distribution in underdemanded schools. A hybrid tiebreaking rule yields the best of both, but requires clairvoyance about which schools are popular and unpopular, a distinction that is less clear in real-world data (Ashlagi and Afshin 2020). Thus, a tiebreaking rule of my own creation (convex tiebreaking, XTB), parameterized in λ, allows the market designer to freely modulate the welfare–equity tradeoff between MTB and STB without prior information about the relative popularity of the schools.</p>
<p dir="auto">To discover a further extreme of the welfare-equality tradeoff phenomenon in underdemanded markets, we can use the student preference lists as primary tiebreakers; then, any of the four methods above can be used to break the remaining ties. This welfare tiebreaking rule (WTB) reflects the realistic assumption that a given school marginally prefers students who prefer it. WTB dominates STB in overdemanded markets, and in all markets, the difference between WXTB and WHTB (that is, WTB where secondary tiebreaking is performed by XTB or HTB, respectively) vanishes. WSTB is known as the “Boston mechanism” and is popular among parents even though it is not strategy proof; see <a href="#target-schools">Target schools</a> below for a possible workaround after Abdulkadiroğlu et al. (2015).</p>
<h2 dir="auto"><a id="user-content-target-schools" class="anchor" aria-hidden="true" href="#target-schools"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Target schools</h2>
<p dir="auto">As noted above, most of the obvious ways to optimize for student welfare when school preferences are nonstrict violate incentive compatibility--that is, they admit circumstances under which a student can obtain a better match by submitting a dishonest preference list. Abdulkadiroğlu et al. (2015) describe choice-augmented deferred acceptance (CADA), an incentive-compatible welfare-maximizing heuristic that works by having students supply a "target" school, where they will be given enhanced admission priority, in addition to their preference list. A demonstration included in the <code>examples/target/</code> directory shows that students who attempt to strategize by listing their target school as the first choice cannot obtain a match than that given by DA-STB (or -MTB). Moreover, the CADA matches offer a substantial improvement in welfare, as the following graph illustrates.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="examples/target/plot.png"><img src="examples/target/plot.png" alt="plot showing strategy proofness of DA" style="max-width: 100%;"></a></p>
<h2 dir="auto"><a id="user-content-two-round-dynamic-reassignment" class="anchor" aria-hidden="true" href="#two-round-dynamic-reassignment"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Two-round dynamic reassignment</h2>
<p dir="auto">Feigenbaum et al. (2020) describe a two-round tiebreaking assignment mechanism that accounts for students who elect to drop out of the lottery (e.g., to attend private school). The implementation challenge here is coming up with realistic input data that reflect the likelihood of students receiving and accepting an outside offer. A sketch appears in the <code>examples/dynamic/</code> directory. Making some reasonable assumptions about the extent to which students’ outside options improve between rounds, I was able to empirically verify their central finding, which is that the second-round assignments dominate the first-round assignments rankwise, and using the reverse lottery numbers in the second round minimizes reassignment and improves equity by moving the students who did worst in the first round many ranks up their preference lists.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="examples/dynamic/plot-hist.png"><img src="examples/dynamic/plot-hist.png" alt="Histogram showing rank assignments before and after reassignment in a single 100-by-70 market" style="max-width: 100%;"></a></p>
<h2 dir="auto"><a id="user-content-nonatomic-formulation" class="anchor" aria-hidden="true" href="#nonatomic-formulation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Nonatomic formulation</h2>
<p dir="auto">An important insight obtained from the economic formulation described above is that stable matches can be encoded by a set of score <em>cutoffs</em> at each school. Then sending each student to the best school whose cutoff they exceed yields in a stable match. The set of cutoffs has a cardinality equal to the number of schools, which is typically reasonably small, and the challenge is coming up with a demand function that returns the percentage of students who will attend each school given the cutoff vector. I have provided several such functions in this module, including several based on the widely used multinomial logit choice model.</p>
<p dir="auto">The charts below show an instance of overdemanded nonatomic DA, where half of the applicants prefer school 1 and half prefer school 2. The stable assignment has a distinctive Mondrian appearance, and generating a discrete DA instance with equivalently distributed student scores demonstrates the analogy between the nonatomic and discrete forms.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="examples/nonatomic/plot-cutoffs.png"><img src="examples/nonatomic/plot-cutoffs.png" alt="Mondrian graph showing cutoffs in overdemanded nonatomic market" style="max-width: 100%;"></a></p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="examples/nonatomic/plot-discrete.png"><img src="examples/nonatomic/plot-discrete.png" alt="Equivalent graph based on discrete DA where students have random, continuously distributed scores" style="max-width: 100%;"></a></p>
<h2 dir="auto"><a id="user-content-the-cost-of-stability" class="anchor" aria-hidden="true" href="#the-cost-of-stability"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>The cost of stability</h2>
<p dir="auto">Considering the problem from a game-theoretic point of view invites us to compare the stable assignments produced by DA algorithms with the welfare-optimal assignment produced by relaxing the stability constraint. We can compute the latter using integer programming, as well as optimize for total (equivalently, average) welfare subject to stability. Integer programming is intractable for large problems, but as a proof of concept, are the results of a single 40-by-40 hybrid instance:</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="examples/sysopt/plot.png"><img src="examples/sysopt/plot.png" alt="Simulated market with 100 schools, comparing system optima with those produced by DA" style="max-width: 100%;"></a></p>
<p dir="auto">I have also included another heuristic welfare maximizer known as top-trading cycles (TTC) for comparison.</p>
<p dir="auto">The code for this example can be found in the <code>examples/sysopt/</code> directory. I provide code that interfaces to several different solvers, but the defaults are the open-source GLPK and Cbc solvers.</p>
<p dir="auto">The optimal stable assignment can be reportedly be computed in polynomial time using an algorithm due to Erdil and Ergin (2008), but I haven’t implemented it yet.</p>
<h2 dir="auto"><a id="user-content-a-note-about-performance" class="anchor" aria-hidden="true" href="#a-note-about-performance"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>A note about performance</h2>
<p dir="auto">The code in this repository is much more performant than the Python code for the Gale-Shapley algorithm that lives <a href="https://github.com/maxkapur/assignment">here</a>, and thus I would recommend using this code to actually generate stable assignments in large problems. A 1000-by-1000 hybrid market like that shown in <a href="#comparison-of-tiebreaking-mechanisms">Comparison of tiebreaking mechanisms</a> takes 17 seconds on my unremarkable computer. Overdemanded markets generally take longer than underdemanded markets.</p>
<p dir="auto">For the purposes of estimating the characteristics of a school market—for example, seeing which schools have the most competition—the nonatomic formulation is much more computationally tractable.</p>
<h2 dir="auto"><a id="user-content-future-functionality" class="anchor" aria-hidden="true" href="#future-functionality"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Future functionality</h2>
<p dir="auto">My <a href="https://github.com/maxkapur/OneTest">current research, OneTest</a>, concerns school-choice markets where students are graded using a single score. DeferredAcceptance allows you to compute the equilibrium numerically in such a scenario directly using the demand function <code>demandfromMNL_singlescore()</code>, but it turns out that an analytic solution exists. I will incorporate this functionality soon.</p>
<p dir="auto">I also intend to update the interface to a somewhat more object-oriented approach, with structs like <code>NonatomicMarket</code> that hold all the relevant parameters of a market to facilitate easy comparison of equilibrium solvers. This is the approach used in OneTest as well as in some of my other equilibrium packages, <a href="https://github.com/maxkapur/NonatomicRouting">like NonatomicRouting</a>.</p>
<h2 dir="auto"><a id="user-content-references" class="anchor" aria-hidden="true" href="#references"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>References</h2>
<ul dir="auto">
<li>Abdulkadiroğlu, Atila, Yeon-Koo Che, and Yosuke Yasuda. 2015. “Expanding ‘Choice’ in School Choice.” <em>American Economic Journal: Microeconomics</em> 7, no. 1 (Feb.): 1–42.</li>
<li>Ashlagi, Itai and Afshin Nikzad. 2020. “What Matters in School Choice Tie-Breaking? How Competition Guides Design.” <em>Journal of Economic Theory</em> 190 (Oct.), article no. 105120.</li>
<li>Azevedo, Eduardo M. and Jacob D. Leshno. 2016. “A Supply and Demand Framework for Two-Sided Matching Markets.” <em>Journal of Political Economy</em> 124, no. 5 (Sept.): 1235–68.</li>
<li>Erdil, Aytek and Haluk Ergin. 2008. “What’s the Matter with Tie-Breaking? Improving Efficiency in School Choice.” <em>The American Economic Review</em> 98, no. 3 (June): 669–89.</li>
<li>Feigenbaum, Itai, Yash Kanoria, Irene Lo, and Jay Sethuraman. 2020. “Dynamic Matching in School Choice: Efficient Seat Reassignment After Late Cancellations.” <em>Management Science</em> 66, no. 11 (Nov.) 5341–61.</li>
<li>Nisan, Noam, Tim Roughgarden, Éva Tardos, and Vijay V. Vazirani, eds. 2007. <em>Algorithmic
Game Theory.</em> Cambridge University Press.</li>
<li>Roth, Alvin E. 1982. “The Economics of Matching: Stability and Incentives.” <em>Mathematics of Operations Research</em> 7, no. 4 (Nov.): 617–28.</li>
</ul>
</article></div>