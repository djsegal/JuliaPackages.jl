<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><h1 dir="auto"><a id="user-content-deepcompartmentmodelsjl" class="anchor" aria-hidden="true" href="#deepcompartmentmodelsjl"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>DeepCompartmentModels.jl</h1>
<p dir="auto">A package for fitting Deep Compartment Models in julia.</p>
<p dir="auto">This package is still under development, although most of the basic functionality have been implemented. If you have any suggestions with respect to improving this package, please do not hesitate to open an <a href="https://github.com/Janssena/DeepCompartmentModels.jl/issues/new">issue</a> or submit a pull request.</p>
<h4 dir="auto"><a id="user-content-introduction" class="anchor" aria-hidden="true" href="#introduction"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Introduction</h4>
<p dir="auto">Deep Compartment Models are a combination of neural networks and a system of differential equations. Their goal is to provide a more reliable framework for using deep learning approaches for the prediction of time series data (specifically in the field of pharmacometrics). A main problem with using machine learning as-is for this purpose is that there is a large amount of heterogeneity in blood sampling time or treatment strategies between patients. In regular machine learning approaches, we have to supply information as the time point of interest or the administered dose directly as inputs in the model, while we are uncertain how the algorithm will treat them. Generally, we thus see that such information is interpreted incorrect, and thus raises questions regarding the accuracy of the predictions. Instead, by using a system of differential equations, we can explicitly handle such information, and by using compartment models constrain the solution to follow a certain structure. This might also reduce the need for large data sets as we can supply prior knowledge about drug dynamics to the model <em>a priori</em>.</p>
<h4 dir="auto"><a id="user-content-installation" class="anchor" aria-hidden="true" href="#installation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Installation</h4>
<p dir="auto"><strong>Installing Julia.</strong></p>
<p dir="auto">Most pharmacometricians are used to programming in R, and likely do not yet have julia installed. You can download the appropriate julia installer <a href="https://julialang.org/downloads/" rel="nofollow">here</a>.</p>
<p dir="auto"><strong>Installing the DeepCompartmentModels package</strong></p>
<p dir="auto">After installing julia run the <code>julia</code> command in an open command line or bash window to launch a julia REPL. Enter the following commands:</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="julia&gt; ]
pkg&gt; add DeepCompartmentModels

# or 

julia&gt; using Pkg
julia&gt; Pkg.add(&quot;DeepCompartmentModels&quot;)"><pre>julia<span class="pl-k">&gt;</span> ]
pkg<span class="pl-k">&gt;</span> add DeepCompartmentModels

<span class="pl-c"><span class="pl-c">#</span> or </span>

julia<span class="pl-k">&gt;</span> <span class="pl-k">using</span> Pkg
julia<span class="pl-k">&gt;</span> Pkg<span class="pl-k">.</span><span class="pl-c1">add</span>(<span class="pl-s"><span class="pl-pds">"</span>DeepCompartmentModels<span class="pl-pds">"</span></span>)</pre></div>
<h4 dir="auto"><a id="user-content-fitting-a-model" class="anchor" aria-hidden="true" href="#fitting-a-model"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Fitting a model</h4>
<p dir="auto">Deep Compartment Models consist of a neural network and a system of differential equations. <a href="https://fluxml.ai/Flux.jl/stable/" rel="nofollow">Flux</a> is a machine learning library that simplifies initializing neural networks models.</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="import Flux

using DeepCompartmentModels

population = load(&quot;myDataset.csv&quot;, [:WEIGHT, :AGE])

ann = Flux.Chain(
    # Our data set contains two covariates, which we feed into a hidden layer with 16 neurons
    Flux.Dense(2, 16, Flux.sigmoid), 
    Flux.Dense(16, 4, Flux.softplus), # Our differential equation has four parameters
)

# DeepCompartmentModels already exports some compartmental structures including two_comp!
model = DCM(two_comp!, ann, 2) 

fit!(model, population) # optimize neural network

predict(model, population) # predict the concentration for the population."><pre><span class="pl-k">import</span> Flux

<span class="pl-k">using</span> DeepCompartmentModels

population <span class="pl-k">=</span> <span class="pl-c1">load</span>(<span class="pl-s"><span class="pl-pds">"</span>myDataset.csv<span class="pl-pds">"</span></span>, [<span class="pl-c1">:WEIGHT</span>, <span class="pl-c1">:AGE</span>])

ann <span class="pl-k">=</span> Flux<span class="pl-k">.</span><span class="pl-c1">Chain</span>(
    <span class="pl-c"><span class="pl-c">#</span> Our data set contains two covariates, which we feed into a hidden layer with 16 neurons</span>
    Flux<span class="pl-k">.</span><span class="pl-c1">Dense</span>(<span class="pl-c1">2</span>, <span class="pl-c1">16</span>, Flux<span class="pl-k">.</span>sigmoid), 
    Flux<span class="pl-k">.</span><span class="pl-c1">Dense</span>(<span class="pl-c1">16</span>, <span class="pl-c1">4</span>, Flux<span class="pl-k">.</span>softplus), <span class="pl-c"><span class="pl-c">#</span> Our differential equation has four parameters</span>
)

<span class="pl-c"><span class="pl-c">#</span> DeepCompartmentModels already exports some compartmental structures including two_comp!</span>
model <span class="pl-k">=</span> <span class="pl-c1">DCM</span>(two_comp!, ann, <span class="pl-c1">2</span>) 

<span class="pl-c1">fit!</span>(model, population) <span class="pl-c"><span class="pl-c">#</span> optimize neural network</span>

<span class="pl-c1">predict</span>(model, population) <span class="pl-c"><span class="pl-c">#</span> predict the concentration for the population.</span></pre></div>
<p dir="auto">For a more comprehensive walkthrough you can look browse through our <a href="https://github.com/Janssena/DeepCompartmentModels.jl/tree/main/tutorial">tutorial folder</a> which contains jupyter notebooks with more examples.</p>
</article></div>