<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><h1 dir="auto"><a id="user-content-genieauthorisation" class="anchor" aria-hidden="true" href="#genieauthorisation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>GenieAuthorisation</h1>
<p dir="auto">Role Based Authorisation (RBA) plugin for <code>Genie.jl</code></p>
<h2 dir="auto"><a id="user-content-installation" class="anchor" aria-hidden="true" href="#installation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Installation</h2>
<p dir="auto">The <code>GenieAuthorisation.jl</code> package is a role based authorisation plugin for <code>Genie.jl</code>, the highly productive Julia web framework.
As such, it requires installation within the environment of a <code>Genie.jl</code> MVC application, allowing the plugin to install
its files.</p>
<h3 dir="auto"><a id="user-content-configuring-authentication-before-using-authorisation" class="anchor" aria-hidden="true" href="#configuring-authentication-before-using-authorisation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Configuring authentication before using authorisation</h3>
<p dir="auto"><code>GenieAuthorisation.jl</code> works in tandem with <code>GenieAuthentication.jl</code>, the authentication plugin for <code>Genie.jl</code> apps.
In fact, <code>GenieAuthorisation.jl</code> adds an authorisation layer on top of the authentication features provided by <code>GenieAuthentication.jl</code>.
As such, first, please make sure that <code>GenieAuthentication.jl</code> is configured for your <code>Genie.jl</code> application, following the
instructions at: <a href="https://github.com/GenieFramework/GenieAuthentication.jl">https://github.com/GenieFramework/GenieAuthentication.jl</a></p>
<p dir="auto">With the <code>GenieAuthentication.jl</code> plugin installed, make sure you configure authenticated access to the areas you want to
further protect with role based authorisation. So the first step is to add user authentication to the app. Then refine access via
authorisation.</p>
<h3 dir="auto"><a id="user-content-add-the-plugin" class="anchor" aria-hidden="true" href="#add-the-plugin"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Add the plugin</h3>
<p dir="auto">Now that your application supports user authentication, it's time to add user authorisation.</p>
<p dir="auto">First, add the plugin (make sure you are in the environment of the <code>Genie.jl</code> app you want to protect with autorisation):</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="julia&gt; ]

(MyGenieApp) pkg&gt; add GenieAuthorisation"><pre>julia<span class="pl-k">&gt;</span> ]

(MyGenieApp) pkg<span class="pl-k">&gt;</span> add GenieAuthorisation</pre></div>
<p dir="auto">Once added, we can use its <code>install</code> function to add its files to the <code>Genie.jl</code> app (required only upon installation):</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="julia&gt; using GenieAuthorisation

julia&gt; GenieAuthorisation.install(@__DIR__)"><pre>julia<span class="pl-k">&gt;</span> <span class="pl-k">using</span> GenieAuthorisation

julia<span class="pl-k">&gt;</span> GenieAuthorisation<span class="pl-k">.</span><span class="pl-c1">install</span>(<span class="pl-c1">@__DIR__</span>)</pre></div>
<p dir="auto">The above command will set up the plugin's files within your <code>Genie.jl</code> app (will potentially add new views, controllers, models, migrations, initializers, etc).</p>
<h2 dir="auto"><a id="user-content-usage" class="anchor" aria-hidden="true" href="#usage"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Usage</h2>
<p dir="auto">The bulk of the authorisation features are provided by the package itself together with a series of database migrations which
set up the database tables needed to configure the RBA system.</p>
<h3 dir="auto"><a id="user-content-set-up-the-database" class="anchor" aria-hidden="true" href="#set-up-the-database"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Set up the database</h3>
<p dir="auto">The plugin needs DB support to store its configuration (roles, permissions and various relations).
You will find 4 new migration files within the <code>db/migrations/</code> folder. We need to run then, either by running all the migrations:</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="julia&gt; using SearchLight

julia&gt; SearchLight.Migration.all_up!!()"><pre>julia<span class="pl-k">&gt;</span> <span class="pl-k">using</span> SearchLight

julia<span class="pl-k">&gt;</span> SearchLight<span class="pl-k">.</span>Migration<span class="pl-k">.</span><span class="pl-c1">all_up!!</span>()</pre></div>
<p dir="auto">Or by individually running the 4 migrations:</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="julia&gt; using SearchLight

julia&gt; SearchLight.Migration.up(&quot;CreateTableRoles&quot;)
julia&gt; SearchLight.Migration.up(&quot;CreateTablePermissions&quot;)
julia&gt; SearchLight.Migration.up(&quot;CreateTableRolesUsers&quot;)
julia&gt; SearchLight.Migration.up(&quot;CreateTablePermissionsRoles&quot;)"><pre>julia<span class="pl-k">&gt;</span> <span class="pl-k">using</span> SearchLight

julia<span class="pl-k">&gt;</span> SearchLight<span class="pl-k">.</span>Migration<span class="pl-k">.</span><span class="pl-c1">up</span>(<span class="pl-s"><span class="pl-pds">"</span>CreateTableRoles<span class="pl-pds">"</span></span>)
julia<span class="pl-k">&gt;</span> SearchLight<span class="pl-k">.</span>Migration<span class="pl-k">.</span><span class="pl-c1">up</span>(<span class="pl-s"><span class="pl-pds">"</span>CreateTablePermissions<span class="pl-pds">"</span></span>)
julia<span class="pl-k">&gt;</span> SearchLight<span class="pl-k">.</span>Migration<span class="pl-k">.</span><span class="pl-c1">up</span>(<span class="pl-s"><span class="pl-pds">"</span>CreateTableRolesUsers<span class="pl-pds">"</span></span>)
julia<span class="pl-k">&gt;</span> SearchLight<span class="pl-k">.</span>Migration<span class="pl-k">.</span><span class="pl-c1">up</span>(<span class="pl-s"><span class="pl-pds">"</span>CreateTablePermissionsRoles<span class="pl-pds">"</span></span>)</pre></div>
<p dir="auto">This will create all the necessary table.</p>
<h3 dir="auto"><a id="user-content-users-roles-and-permissions" class="anchor" aria-hidden="true" href="#users-roles-and-permissions"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Users, roles, and permissions</h3>
<p dir="auto">A role based authorisation system implements access control through permissions. That is, certain features are accessible
only for users that have the necessary permission. For instance, this is how we require authorisation for a <code>user_admin</code> permission
at route level:</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="route(&quot;/admin/users&quot;) do; @authorised!(&quot;users_admin&quot;)
  # code can be accessed only by users with the `users_admin` permission
end"><pre><span class="pl-c1">route</span>(<span class="pl-s"><span class="pl-pds">"</span>/admin/users<span class="pl-pds">"</span></span>) <span class="pl-k">do</span>; <span class="pl-c1">@authorised!</span>(<span class="pl-s"><span class="pl-pds">"</span>users_admin<span class="pl-pds">"</span></span>)
  <span class="pl-c"><span class="pl-c">#</span> code can be accessed only by users with the `users_admin` permission</span>
<span class="pl-k">end</span></pre></div>
<p dir="auto">Permissions, however, are not assigned directly to users, but to roles. As such, a role can have multiple permissions - like
for example an <code>admin</code> role would have all the possible permissions. Finally, the users are assigned roles - getting access
to the role's respective permissions. A role can have any number of permissions and a user can have any number of roles.</p>
<p dir="auto"><code>GenieAuthorisation.jl</code> exposes an API which makes checking users permissions straightforward, without needing to handle
the actual roles. However, the roles make permission assignment manageable: we bundle permissions
into roles and then assign the roles to the users. This way, when we need to remove permissions from a user, we just
remove the role and eliminate the risk of failing to remove all the forbidden permissions.</p>
<h4 dir="auto"><a id="user-content-creating-permissions-and-roles" class="anchor" aria-hidden="true" href="#creating-permissions-and-roles"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Creating permissions and roles</h4>
<p dir="auto">Given that permissions and roles are stored in the database, we use <code>SearchLight.jl</code> to manage the data:</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="using GenieAuthorisation

# Create two roles, &quot;user&quot; and &quot;admin&quot;
for r in [&quot;user&quot;, &quot;admin&quot;]
  findone_or_create(Role, name = r) |&gt; save!
end

# Create some permissions
for p in [&quot;create&quot;, &quot;read&quot;, &quot;update&quot;, &quot;delete&quot;]
  findone_or_create(Permission, name = p) |&gt; save!
end"><pre><span class="pl-k">using</span> GenieAuthorisation

<span class="pl-c"><span class="pl-c">#</span> Create two roles, "user" and "admin"</span>
<span class="pl-k">for</span> r <span class="pl-k">in</span> [<span class="pl-s"><span class="pl-pds">"</span>user<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>admin<span class="pl-pds">"</span></span>]
  <span class="pl-c1">findone_or_create</span>(Role, name <span class="pl-k">=</span> r) <span class="pl-k">|&gt;</span> save!
<span class="pl-k">end</span>

<span class="pl-c"><span class="pl-c">#</span> Create some permissions</span>
<span class="pl-k">for</span> p <span class="pl-k">in</span> [<span class="pl-s"><span class="pl-pds">"</span>create<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>read<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>update<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>delete<span class="pl-pds">"</span></span>]
  <span class="pl-c1">findone_or_create</span>(Permission, name <span class="pl-k">=</span> p) <span class="pl-k">|&gt;</span> save!
<span class="pl-k">end</span></pre></div>
<p dir="auto">Now that the roles and the permissions are created, we need to assign permissions to roles:</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="using GenieAuthorisation

assign_permission(findone(Role, name = &quot;admin&quot;), findone(Permission, name = &quot;create&quot;))
assign_permission(findone(Role, name = &quot;admin&quot;), findone(Permission, name = &quot;read&quot;))
assign_permission(findone(Role, name = &quot;admin&quot;), findone(Permission, name = &quot;update&quot;))
assign_permission(findone(Role, name = &quot;admin&quot;), findone(Permission, name = &quot;delete&quot;))

assign_permission(findone(Role, name = &quot;user&quot;), findone(Permission, name = &quot;read&quot;))"><pre><span class="pl-k">using</span> GenieAuthorisation

<span class="pl-c1">assign_permission</span>(<span class="pl-c1">findone</span>(Role, name <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>admin<span class="pl-pds">"</span></span>), <span class="pl-c1">findone</span>(Permission, name <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>create<span class="pl-pds">"</span></span>))
<span class="pl-c1">assign_permission</span>(<span class="pl-c1">findone</span>(Role, name <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>admin<span class="pl-pds">"</span></span>), <span class="pl-c1">findone</span>(Permission, name <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>read<span class="pl-pds">"</span></span>))
<span class="pl-c1">assign_permission</span>(<span class="pl-c1">findone</span>(Role, name <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>admin<span class="pl-pds">"</span></span>), <span class="pl-c1">findone</span>(Permission, name <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>update<span class="pl-pds">"</span></span>))
<span class="pl-c1">assign_permission</span>(<span class="pl-c1">findone</span>(Role, name <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>admin<span class="pl-pds">"</span></span>), <span class="pl-c1">findone</span>(Permission, name <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>delete<span class="pl-pds">"</span></span>))

<span class="pl-c1">assign_permission</span>(<span class="pl-c1">findone</span>(Role, name <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>user<span class="pl-pds">"</span></span>), <span class="pl-c1">findone</span>(Permission, name <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>read<span class="pl-pds">"</span></span>))</pre></div>
<p dir="auto">We have assigned "create", "read", "update" and "delete" permissions to the <code>admin</code> role, and "read" permissions to the
<code>user</code> role.</p>
<p dir="auto">Now we need to assign roles to our users -- for example making the user with the username <code>essenciary</code> an "admin":</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="using GenieAuthorisation, GenieAuthentication, Users

assign_role(findone(User, username = &quot;essenciary&quot;), findone(Role, name = &quot;admin&quot;))"><pre><span class="pl-k">using</span> GenieAuthorisation, GenieAuthentication, Users

<span class="pl-c1">assign_role</span>(<span class="pl-c1">findone</span>(User, username <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>essenciary<span class="pl-pds">"</span></span>), <span class="pl-c1">findone</span>(Role, name <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>admin<span class="pl-pds">"</span></span>))</pre></div>
<hr>
<p dir="auto"><strong>HEADS UP</strong></p>
<p dir="auto">Users must be explicitly assigned roles in order to have any permissions.
Permissions are made available only through roles and this means that users without a role do not have any kind of permissions.</p>
<p dir="auto">It makes sense to automate role assignment, for example by assigning a default basic role upon user registration.</p>
<hr>
<h3 dir="auto"><a id="user-content-autorising-access" class="anchor" aria-hidden="true" href="#autorising-access"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Autorising access</h3>
<p dir="auto">Once we have permissions, roles, and users, and we have defined the relationships between them, we can enforce user
authorisation within the app.</p>
<h4 dir="auto"><a id="user-content-authorisedpermission" class="anchor" aria-hidden="true" href="#authorisedpermission"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a><code>@authorised!(&lt;permission&gt;)</code></h4>
<p dir="auto">The <code>@authorised!</code> macro checks that the current user has the <code>&lt;permission&gt;</code> permission - if not, an exception is automatically
thrown, stopping the current thread of execution:</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="using GenieAuthorisation

route(&quot;/admin/users/delete/:user_id&quot;) do; @authorised!(&quot;delete&quot;)
  # code can be accessed only by users with the `users_admin` permission
end"><pre><span class="pl-k">using</span> GenieAuthorisation

<span class="pl-c1">route</span>(<span class="pl-s"><span class="pl-pds">"</span>/admin/users/delete/:user_id<span class="pl-pds">"</span></span>) <span class="pl-k">do</span>; <span class="pl-c1">@authorised!</span>(<span class="pl-s"><span class="pl-pds">"</span>delete<span class="pl-pds">"</span></span>)
  <span class="pl-c"><span class="pl-c">#</span> code can be accessed only by users with the `users_admin` permission</span>
<span class="pl-k">end</span></pre></div>
<h4 dir="auto"><a id="user-content-has_permission-" class="anchor" aria-hidden="true" href="#has_permission-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>`has_permission(, )</h4>
<p dir="auto">We can also use the <code>has_permission</code> function to check if a user has the necessary permissions. The function returns a
<code>boolean</code> allowing us to implement conditional logic based on the status of the authorisation:</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="&lt;% if has_permission(current_user(), &quot;update&quot;) || has_permission(current_user(), &quot;delete&quot;) %&gt;
&lt;li class=&quot;nav-item dropdown&quot;&gt;
  &lt;a class=&quot;nav-link dropdown-toggle&quot; href=&quot;#&quot; data-toggle=&quot;dropdown&quot;&gt;User management&lt;/a&gt;
    &lt;div class=&quot;dropdown-menu&quot;&gt;

      &lt;% if has_permission(current_user(), &quot;update&quot;) %&gt;
      &lt;a class=&quot;dropdown-item&quot; href=&quot;/admin/users/edit/:user_id&quot;&gt;Edit user&lt;/a&gt;
      &lt;% end %&gt;

      &lt;% if has_permission(current_user(), &quot;delete&quot;) %&gt;
      &lt;a class=&quot;dropdown-item&quot; href=&quot;/admin/users/delete/:user_id&quot;&gt;Delete user&lt;/a&gt;
      &lt;% end %&gt;
    &lt;/div&gt;
&lt;/li&gt;
&lt;% end %&gt;"><pre><span class="pl-k">&lt;</span><span class="pl-k">%</span> <span class="pl-k">if</span> <span class="pl-c1">has_permission</span>(<span class="pl-c1">current_user</span>(), <span class="pl-s"><span class="pl-pds">"</span>update<span class="pl-pds">"</span></span>) <span class="pl-k">||</span> <span class="pl-c1">has_permission</span>(<span class="pl-c1">current_user</span>(), <span class="pl-s"><span class="pl-pds">"</span>delete<span class="pl-pds">"</span></span>) <span class="pl-k">%</span><span class="pl-k">&gt;</span>
<span class="pl-k">&lt;</span>li class<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>nav-item dropdown<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>
  <span class="pl-k">&lt;</span>a class<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>nav-link dropdown-toggle<span class="pl-pds">"</span></span> href<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>#<span class="pl-pds">"</span></span> data<span class="pl-k">-</span>toggle<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>dropdown<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>User management<span class="pl-k">&lt;</span><span class="pl-k">/</span>a<span class="pl-k">&gt;</span>
    <span class="pl-k">&lt;</span>div class<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>dropdown-menu<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>

      <span class="pl-k">&lt;</span><span class="pl-k">%</span> <span class="pl-k">if</span> <span class="pl-c1">has_permission</span>(<span class="pl-c1">current_user</span>(), <span class="pl-s"><span class="pl-pds">"</span>update<span class="pl-pds">"</span></span>) <span class="pl-k">%</span><span class="pl-k">&gt;</span>
      <span class="pl-k">&lt;</span>a class<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>dropdown-item<span class="pl-pds">"</span></span> href<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>/admin/users/edit/:user_id<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>Edit user<span class="pl-k">&lt;</span><span class="pl-k">/</span>a<span class="pl-k">&gt;</span>
      <span class="pl-k">&lt;</span><span class="pl-k">%</span> <span class="pl-k">end</span> <span class="pl-k">%</span><span class="pl-k">&gt;</span>

      <span class="pl-k">&lt;</span><span class="pl-k">%</span> <span class="pl-k">if</span> <span class="pl-c1">has_permission</span>(<span class="pl-c1">current_user</span>(), <span class="pl-s"><span class="pl-pds">"</span>delete<span class="pl-pds">"</span></span>) <span class="pl-k">%</span><span class="pl-k">&gt;</span>
      <span class="pl-k">&lt;</span>a class<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>dropdown-item<span class="pl-pds">"</span></span> href<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>/admin/users/delete/:user_id<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>Delete user<span class="pl-k">&lt;</span><span class="pl-k">/</span>a<span class="pl-k">&gt;</span>
      <span class="pl-k">&lt;</span><span class="pl-k">%</span> <span class="pl-k">end</span> <span class="pl-k">%</span><span class="pl-k">&gt;</span>
    <span class="pl-k">&lt;</span><span class="pl-k">/</span>div<span class="pl-k">&gt;</span>
<span class="pl-k">&lt;</span><span class="pl-k">/</span>li<span class="pl-k">&gt;</span>
<span class="pl-k">&lt;</span><span class="pl-k">%</span> <span class="pl-k">end</span> <span class="pl-k">%</span><span class="pl-k">&gt;</span></pre></div>
<h3 dir="auto"><a id="user-content-deleting-authorisation" class="anchor" aria-hidden="true" href="#deleting-authorisation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Deleting authorisation</h3>
<p dir="auto">Deleting authorisation is done by removing the relationships stored in the database, using the <code>SearchLight.jl</code> API.</p>
<p dir="auto">For example, to remove a permission from a role:</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="using SearchLight, GenieAuthorisation

Relationship!(findone(Role, name = &quot;admin&quot;), findone(Permission, name = &quot;delete&quot;)) |&gt; delete"><pre><span class="pl-k">using</span> SearchLight, GenieAuthorisation

<span class="pl-c1">Relationship!</span>(<span class="pl-c1">findone</span>(Role, name <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>admin<span class="pl-pds">"</span></span>), <span class="pl-c1">findone</span>(Permission, name <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>delete<span class="pl-pds">"</span></span>)) <span class="pl-k">|&gt;</span> delete</pre></div>
<p dir="auto">Or a role from a user:</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="using SearchLight, GenieAuthorisation, GenieAuthentication, Users

Relationship!(findone(User, username = &quot;essenciary&quot;), findone(Role, name = &quot;admin&quot;)) |&gt; delete"><pre><span class="pl-k">using</span> SearchLight, GenieAuthorisation, GenieAuthentication, Users

<span class="pl-c1">Relationship!</span>(<span class="pl-c1">findone</span>(User, username <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>essenciary<span class="pl-pds">"</span></span>), <span class="pl-c1">findone</span>(Role, name <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>admin<span class="pl-pds">"</span></span>)) <span class="pl-k">|&gt;</span> delete</pre></div>
<p dir="auto">Finally, to remove roles or permissions, we delete the respective entities:</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="using SearchLight, GenieAuthorisation

# remove the `delete` permission
delete(findone(Permission, name = &quot;delete&quot;))

# remove the `admin` role
delete(findone(Role, name = &quot;admin&quot;))"><pre><span class="pl-k">using</span> SearchLight, GenieAuthorisation

<span class="pl-c"><span class="pl-c">#</span> remove the `delete` permission</span>
<span class="pl-c1">delete</span>(<span class="pl-c1">findone</span>(Permission, name <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>delete<span class="pl-pds">"</span></span>))

<span class="pl-c"><span class="pl-c">#</span> remove the `admin` role</span>
<span class="pl-c1">delete</span>(<span class="pl-c1">findone</span>(Role, name <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>admin<span class="pl-pds">"</span></span>))</pre></div>
</article></div>