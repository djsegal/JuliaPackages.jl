<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><h1 dir="auto"><a id="user-content-spectrum" class="anchor" aria-hidden="true" href="#spectrum"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a><a target="_blank" rel="noopener noreferrer" href="NeXL_sm.png"><img src="NeXL_sm.png" alt="" style="max-width: 100%;"></a>Spectrum</h1>
<h2 dir="auto"><a id="user-content-microanalytical-x-ray-spectrum-analysis" class="anchor" aria-hidden="true" href="#microanalytical-x-ray-spectrum-analysis"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Microanalytical X-ray Spectrum Analysis</h2>
<table>
<thead>
<tr>
<th align="center"><strong>Documentation</strong></th>
<th align="center"><strong>Build Status</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><a href="https://pages.nist.gov/NeXLSpectrum.jl" rel="nofollow"><img src="https://camo.githubusercontent.com/c97f0a5f2ae95755f64a27f1aa8d9a17462941fd3d6c907c7630abd5d3e60acf/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f646f63732d737461626c652d626c75652e737667" alt="" data-canonical-src="https://img.shields.io/badge/docs-stable-blue.svg" style="max-width: 100%;"></a></td>
<td align="center"><a href="https://travis-ci.com/usnistgov/NeXLSpectrum.jl" rel="nofollow"><img src="https://camo.githubusercontent.com/2b5361e1847f229cd79cb2dbb5ffad97565363035fe4621648cfe5fc571efff0/68747470733a2f2f7472617669732d63692e636f6d2f75736e697374676f762f4e65584c537065637472756d2e6a6c2e7376673f6272616e63683d6d6173746572" alt="" data-canonical-src="https://travis-ci.com/usnistgov/NeXLSpectrum.jl.svg?branch=master" style="max-width: 100%;"></a></td>
</tr>
</tbody>
</table>
<h4 dir="auto"><a id="user-content-installation" class="anchor" aria-hidden="true" href="#installation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Installation</h4>
<p dir="auto">Install NeXLSpectrum using the Julia package manager</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="julia&gt; ]add NeXLSpectrum"><pre>julia<span class="pl-k">&gt;</span> ]add NeXLSpectrum</pre></div>
<p dir="auto">or</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="julia&gt; using Pkg
julia&gt; Pkg.add(&quot;NeXLSpectrum&quot;)"><pre>julia<span class="pl-k">&gt;</span> <span class="pl-k">using</span> Pkg
julia<span class="pl-k">&gt;</span> Pkg<span class="pl-k">.</span><span class="pl-c1">add</span>(<span class="pl-s"><span class="pl-pds">"</span>NeXLSpectrum<span class="pl-pds">"</span></span>)</pre></div>
<h4 dir="auto"><a id="user-content-notes" class="anchor" aria-hidden="true" href="#notes"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Notes</h4>
<p dir="auto"><code>NeXLSpectrum</code> is a library of tools for manipulating EDS spectrum within the
NeXL framework. <code>NeXLSpectrum</code> depends on <code>NeXLUncertainties</code>, <code>NeXLCore</code> and
<code>NeXLMatrixCorrection</code> and loading <code>NeXLSpectrum</code> will also make these
libraries available.</p>
<p dir="auto">In addition, <code>NeXLSpectrum</code> makes extensive use of the third-party libraries
<code>DataFrames</code> for data tables and <code>Gadfly</code> for plotting.  You will also want to
makes these libraries available.</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="julia&gt; ]add DataFrames, Gadfly"><pre>julia<span class="pl-k">&gt;</span> ]add DataFrames, Gadfly</pre></div>
<p dir="auto">Primarily, <code>NeXLSpectrum</code></p>
<ul dir="auto">
<li>
<p dir="auto">Implements the <code>Spectrum</code> type to represent individual EDS spectra</p>
<ul dir="auto">
<li>Reads <code>Spectrum</code> objects from disk files (or other streams) in EMSA, Bruker and ASPEX formats</li>
<li>Writes <code>Spectrum</code> objects to a disk file in EMSA format</li>
</ul>
</li>
<li>
<p dir="auto">Provides utilities and other low level tools to interogate and manipulate <code>Spectrum</code> objects</p>
</li>
<li>
<p dir="auto">Implements the <code>HyperSpectrum</code> type to represent hyper-spectra (linescan, image, cube, ...)</p>
<ul dir="auto">
<li>The individual pixels in a hyper-spectrum are visible as <code>Spectrum</code> objects</li>
<li>Reads <code>HyperSpectrum</code> objects from LISPIX-style RPL/RAW files</li>
<li>Writes <code>HyperSpectrum</code> objects to RPL/RAW files</li>
</ul>
</li>
<li>
<p dir="auto">Provides data types to define detector properties</p>
</li>
<li>
<p dir="auto">Extends <code>Gadfly.jl</code> to plot spectra and spectrum-related items</p>
</li>
<li>
<p dir="auto">Provides algorithms to perform Schamber-style filter-fitting of spectra</p>
<ul dir="auto">
<li>Implements a basic weighted LLSQ fit algorithm
<ul dir="auto">
<li>Fits characteristic, escape, Compton and other features</li>
</ul>
</li>
<li>Implements a 'vector-based' quick-quant algorithm for processing hyper-spectra</li>
</ul>
</li>
</ul>
<h2 dir="auto"><a id="user-content-nexl-and-packagecompiler" class="anchor" aria-hidden="true" href="#nexl-and-packagecompiler"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>NeXL and PackageCompiler</h2>
<p dir="auto">Because Julia uses a just-in-time compiler that recompiles libraries each time Julia
is restarted and the <code>NeXL</code> libraries are quite large, the first time you perform an
operation it can be quite slow.  Subsequent calls are much faster.  Fortunately, there
is a way around this.  The <code>PackageCompiler</code> library can be used to build a version of
Julia in which <code>NeXLSpectrum</code> and the libraries on which it depends are build into the
language much like the base libraries.  I recommend that you use the <code>PackageCompiler</code>
to rebuild Julia each time you update the packages (using <code>julia&gt; ]up</code>) or upgrade
to a new version of Julia.</p>
<p dir="auto">In Windows, this operation looks like:</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="julia&gt; using NeXLSpectrum, DataFrames, Gadfly # Load the basic libraries
julia&gt; using PackageCompiler 
julia&gt; PackageCompiler.create_sysimage(
    [ &quot;Gadfly&quot;, &quot;DataFrames&quot;, &quot;BoteSalvatICX&quot;, &quot;NeXLUncertainties&quot;, &quot;NeXLCore&quot;, &quot;NeXLMatrixCorrection&quot;, &quot;NeXLSpectrum&quot; ]; 
    sysimage_path=joinpath(homedir(), &quot;.julia&quot;, &quot;NeXLSysimage.dll&quot;),
    precompile_execution_file=joinpath(pkgdir(NeXLSpectrum),&quot;scripts&quot;, &quot;precompile.jl&quot;))"><pre>julia<span class="pl-k">&gt;</span> <span class="pl-k">using</span> NeXLSpectrum, DataFrames, Gadfly <span class="pl-c"><span class="pl-c">#</span> Load the basic libraries</span>
julia<span class="pl-k">&gt;</span> <span class="pl-k">using</span> PackageCompiler 
julia<span class="pl-k">&gt;</span> PackageCompiler<span class="pl-k">.</span><span class="pl-c1">create_sysimage</span>(
    [ <span class="pl-s"><span class="pl-pds">"</span>Gadfly<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>DataFrames<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>BoteSalvatICX<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>NeXLUncertainties<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>NeXLCore<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>NeXLMatrixCorrection<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>NeXLSpectrum<span class="pl-pds">"</span></span> ]; 
    sysimage_path<span class="pl-k">=</span><span class="pl-c1">joinpath</span>(<span class="pl-c1">homedir</span>(), <span class="pl-s"><span class="pl-pds">"</span>.julia<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>NeXLSysimage.dll<span class="pl-pds">"</span></span>),
    precompile_execution_file<span class="pl-k">=</span><span class="pl-c1">joinpath</span>(<span class="pl-c1">pkgdir</span>(NeXLSpectrum),<span class="pl-s"><span class="pl-pds">"</span>scripts<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>precompile.jl<span class="pl-pds">"</span></span>))</pre></div>
<p dir="auto">This operation may take tens-of-minutes to complete but will be worth the effort in terms of saved time
later on.</p>
<p dir="auto">In other operating systems, you will want to change the extension on the filename in the <code>sysimage_path</code>.</p>
<p dir="auto">This command creates a <code>sysimage</code> containing the <code>NeXL</code> libraries along with <code>DataFrames</code> and <code>Gadfly</code>.  You will now
have to tell Julia to use this <code>sysimage</code>.   I usually create multiple links to Julia that both use the default <code>sysimage</code>
and the <code>NeXLSysimage</code>.  The <code>sysimage</code> is selected using the <code>-J</code> command line option. In Windows, this looks like:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="## To use the sysimage, start Julia with the `-J` option
# &gt; julia -J&quot;C:\Users\username\.julia\NeXLSysimage.dll&quot;"><pre class="notranslate"><code>## To use the sysimage, start Julia with the `-J` option
# &gt; julia -J"C:\Users\username\.julia\NeXLSysimage.dll"
</code></pre></div>
<p dir="auto">You can edit the properties of the link used to start Julia to include the <code>-J</code> option.  While you are at it,
you might also want to add the <code>-t</code> option to start Julia with multiple threads.  For example,</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="## To use the sysimage, start Julia with the `-J` option
# &gt; julia -J&quot;C:\Users\username\.julia\NeXLSysimage.dll&quot; -t 4"><pre class="notranslate"><code>## To use the sysimage, start Julia with the `-J` option
# &gt; julia -J"C:\Users\username\.julia\NeXLSysimage.dll" -t 4
</code></pre></div>
<p dir="auto">will start Julia with the <code>sysimage</code> and 4 threads.  Usually, selecting the number of threads equal to the number of
cores (not HyperThreads) will produce the optimal performance.</p>
</article></div>