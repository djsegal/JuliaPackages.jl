<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><h1 dir="auto"><a id="user-content-judi4cloudjl" class="anchor" aria-hidden="true" href="#judi4cloudjl"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>JUDI4Cloud.jl</h1>
<p dir="auto">This package implements serverless parallelism on Azure (Azure batch) for <a href="https://github.com/slimgroup/JUDI.jl">JUDI</a> using <a href="https://github.com/microsoft/AzureClusterlessHPC.jl">AzureClusterlessHPC</a>.</p>
<h2 dir="auto"><a id="user-content-installation" class="anchor" aria-hidden="true" href="#installation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Installation</h2>
<p dir="auto">To install this package simply run the standard command</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="] add https://github.com/slimgroup/JUDI4Cloud.jl"><pre>] add https<span class="pl-k">:</span><span class="pl-k">//</span>github<span class="pl-k">.</span>com<span class="pl-k">/</span>slimgroup<span class="pl-k">/</span>JUDI4Cloud<span class="pl-k">.</span>jl</pre></div>
<p dir="auto"><em><strong>Note</strong></em> The default docker container used is based on <code>julia v1.7</code>. Since the communication with Azure Blob is done through Serialization, it is <strong>mandatory</strong> to use the same version of Julia locally. If you use the default container, use <code>Julia v1.7</code>, and if you use your own container make sure to have compatible Julia versions.</p>
<h2 dir="auto"><a id="user-content-remote-container" class="anchor" aria-hidden="true" href="#remote-container"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Remote container</h2>
<p dir="auto">Following <a href="https://github.com/microsoft/AzureClusterlessHPC.jl">AzureClusterlessHPC</a> convention, we rely on a remote runtime docker container with all the necessary packages installed and the runtime version of <a href="https://github.com/microsoft/AzureClusterlessHPC.jl">AzureClusterlessHPC</a> installed. For convenience, we provide a docker container with the latest version of <a href="https://github.com/microsoft/AzureClusterlessHPC.jl">AzureClusterlessHPC</a>, [JUDI4Cloud] and <a href="https://github.com/slimgroup/JUDI.jl">JUDI</a> installed for Julia <code>1.6</code> or <code>1.7</code>. These images are named <code>mloubout/judi4cloud:1.6</code> and <code>mloubout/judi4cloud:1.7</code>. This image contains additional SLIM packages as well such as <code>SegyIO</code> if the user were to need it.</p>
<p dir="auto">Additionally, these two premade images provide the Nvidia HPC SDK to enable GPU accceleration of the propagators. You can therefore use GPU instances as well. Enabling GPU can be done by specifying <code>gpu=true</code> when initializing the batch pool.</p>
<h2 dir="auto"><a id="user-content-usage" class="anchor" aria-hidden="true" href="#usage"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Usage</h2>
<p dir="auto">To use this package, simply replace <code>using JUDI</code> by <code>using JUDI4Cloud</code> at the top of your script. All JUDI functionalities are reexported to make your script compatible.</p>
<p dir="auto">Once <code>JUDI4Cloud</code> is imported, you can use its main functionality to start an Azure batch pool to use as your serverless remote task farm. To start a batch pool with <code>2</code> nodes and <code>4</code> threads per node run:</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="nworkers = 2
init_culsterless(nworkers; credentials=creds, vm_size=&quot;Standard_E2s_v3&quot;, pool_name=&quot;PoolTest&quot;, verbose=1, nthreads=4)"><pre>nworkers <span class="pl-k">=</span> <span class="pl-c1">2</span>
<span class="pl-c1">init_culsterless</span>(nworkers; credentials<span class="pl-k">=</span>creds, vm_size<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Standard_E2s_v3<span class="pl-pds">"</span></span>, pool_name<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>PoolTest<span class="pl-pds">"</span></span>, verbose<span class="pl-k">=</span><span class="pl-c1">1</span>, nthreads<span class="pl-k">=</span><span class="pl-c1">4</span>)</pre></div>
<p dir="auto">where:</p>
<ul dir="auto">
<li><code>creds</code> is the path to your credentials JSON file (see <a href="https://microsoft.github.io/AzureClusterlessHPC.jl/credentials/" rel="nofollow">credentials</a> for information)</li>
<li><code>vm_size</code> is the Azure VM you want to use. This VM needs to be available in your batch account</li>
<li><code>pool_name</code>  is the of the batch pool of nodes</li>
<li><code>verbose</code> controls <a href="https://github.com/microsoft/AzureClusterlessHPC.jl">AzureClusterlessHPC</a>'s verbosity</li>
<li><code>nthreads</code> defines the number of OpenMP threads to use on each node</li>
<li><code>gpu</code> whether to use (Nvidia) gpu for the propagators via openacc. You will need to specify a GPU VM.</li>
</ul>
<h2 dir="auto"><a id="user-content-examples" class="anchor" aria-hidden="true" href="#examples"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Examples</h2>
<p dir="auto">A simple example is available at <a href="https://github.com/slimgroup/JUDI4Cloud.jl/blob/master/examples/modeling_basic_2D.jl">examples/modeling_basic_2D.jl</a>. This example is a verbatim copy of the corresponding <a href="https://github.com/slimgroup/JUDI.jl">JUDI</a> example, with the exception of the Azure setup at the top, and shows the seamless usability of this package.</p>
<h2 dir="auto"><a id="user-content-future-work" class="anchor" aria-hidden="true" href="#future-work"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Future work</h2>
<p dir="auto">The following extensions are currently in development:</p>
<ul dir="auto">
<li>Parallel Julia on each node.</li>
<li>More flexibility to switch between conventional Julia parallelism and Azure</li>
<li>Out of core judiVector with Blob storage</li>
</ul>
<h1 dir="auto"><a id="user-content-author" class="anchor" aria-hidden="true" href="#author"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Author</h1>
<p dir="auto">This software is developed at Georgia Institute of Technology as part of the ML4Seismic consortium. For questions or issues, please open an issue on GitHub or contact the author:</p>
<ul dir="auto">
<li>Mathias Louboutin: <a href="mailto:mlouboutin3@gatech.edu">mlouboutin3@gatech.edu</a></li>
</ul>
</article></div>