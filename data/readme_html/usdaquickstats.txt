<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><h1><a id="user-content-usdaquickstatsjl" class="anchor" aria-hidden="true" href="#usdaquickstatsjl"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>USDAQuickStats.jl</h1>
<p><code>USDAQuickStats.jl</code> offers the possibility to access the USDA National Agricultural Statistics Service (NASS) <a href="https://quickstats.nass.usda.gov/api" rel="nofollow">Quick Stats database</a> in Julia.</p>
<h2><a id="user-content-installation" class="anchor" aria-hidden="true" href="#installation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Installation</h2>
<pre lang="@julia"><code>add USDAQuickStats
</code></pre>
<h2><a id="user-content-index" class="anchor" aria-hidden="true" href="#index"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Index</h2>
<p>The package contains following functions:</p>
<ul>
<li><code>set_api_key</code></li>
<li><code>get_counts</code></li>
<li><code>get_param_values</code></li>
<li><code>get_nass</code></li>
</ul>
<h2><a id="user-content-tutorial-and-workflow" class="anchor" aria-hidden="true" href="#tutorial-and-workflow"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Tutorial and Workflow</h2>
<h3><a id="user-content-set-up-an-environment-variable-for-the-nass-api-key" class="anchor" aria-hidden="true" href="#set-up-an-environment-variable-for-the-nass-api-key"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Set up an Environment Variable for the NASS API key</h3>
<p>To start using the API, the user first needs to get a <strong>personal API key</strong>.</p>
<p>The user can request a NASS API key at <a href="https://quickstats.nass.usda.gov/api" rel="nofollow">https://quickstats.nass.usda.gov/api</a>.</p>
<p>The API key can be saved as an environment variable called "USDA_QUICK_SURVEY_KEY" or used during each new Julia session by setting it up using:</p>
<pre lang="@julia"><code>using USDAQuickStats
set_api_key("YOUR_KEY"::String)
</code></pre>
<p>replacing <code>"YOUR_KEY"</code> with the private API key as a string.</p>
<p>Saving the key into a permanent variable in your environment is dependent on the operating system.</p>
<h3><a id="user-content-query-the-database" class="anchor" aria-hidden="true" href="#query-the-database"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Query the database</h3>
<p>The API for the Quick Stats database provides three main functions:</p>
<ul>
<li>get_nass</li>
<li>get_counts</li>
<li>get_param_values</li>
</ul>
<p><strong>get_nass</strong></p>
<p><code>get_nass(args...; format="json") </code>
The main function is <code>get_nass</code>, which queries the main USDA Quick Stats database.</p>
<p><code>args...</code> is a list of the different headers from the database that can be queried. Each argument is a string with the name of the header and the value from that header in uppercase, e.g. <code>"header=VALUE</code>. The description of the different headers (also called columns) for the database is available [here].(<a href="https://quickstats.nass.usda.gov/api" rel="nofollow">https://quickstats.nass.usda.gov/api</a>)</p>
<p>The <code>format</code> keyword can be added to the query after a semicolon <code>;</code> and defines the format of the response. It is set to <code>JSON</code> as a default, other formats provided by the database are <code>CSV</code> and <code>XML</code>.</p>
<p>The function returns a DataFrame with the requested query for the <code>JSON</code> and <code>CSV</code> formats, no DataFrame has been implemented for the <code>XML</code> format yet, PR's welcome.</p>
<p>In the following example, the survey data for oranges in California (CA) for the year 2019 was queried for information about the headers "ACRES BEARING" and "PRICE RECEIVED".</p>
<p>Notice that header values that have spaces in them need to be passed with the symbol <code>%20</code> replacing the space. In general, no spaces are allowed in the query.</p>
<pre lang="@julia"><code>query = get_nass("source_desc=SURVEY","commodity_desc=ORANGES","state_alpha=CA", "year=2019","statisticcat_desc=AREA%20BEARING","statisticcat_desc=PRICE%20RECEIVED")
</code></pre>
<p>output</p>
<pre lang="@julia"><code>276×39 DataFrame. Omitted printing of 30 columns
│ Row │ prodn_practice_desc      │ state_name │ country_name  │ asd_desc │ watershed_code │ state_fips_code │ source_desc │ location_desc │ statisticcat_desc │
│     │ String                   │ String     │ String        │ String   │ String         │ String          │ String      │ String        │ String            │
├─────┼──────────────────────────┼────────────┼───────────────┼──────────┼────────────────┼─────────────────┼─────────────┼───────────────┼───────────────────┤
│ 1   │ ALL PRODUCTION PRACTICES │ CALIFORNIA │ UNITED STATES │          │ 00000000       │ 06              │ SURVEY      │ CALIFORNIA    │ AREA BEARING      │
│ 2   │ ALL PRODUCTION PRACTICES │ CALIFORNIA │ UNITED STATES │          │ 00000000       │ 06              │ SURVEY      │ CALIFORNIA    │ PRICE RECEIVED    │
⋮
│ 274 │ ALL PRODUCTION PRACTICES │ CALIFORNIA │ UNITED STATES │          │ 00000000       │ 06              │ SURVEY      │ CALIFORNIA    │ PRICE RECEIVED    │
│ 275 │ ALL PRODUCTION PRACTICES │ CALIFORNIA │ UNITED STATES │          │ 00000000       │ 06              │ SURVEY      │ CALIFORNIA    │ PRICE RECEIVED    │
│ 276 │ ALL PRODUCTION PRACTICES │ CALIFORNIA │ UNITED STATES │          │ 00000000       │ 06              │ SURVEY      │ CALIFORNIA    │ PRICE RECEIVED    │
</code></pre>
<p><strong>get_param_values</strong></p>
<p><code>get_param_values(arg)</code> is a helper query that allow user to check the values of a field <code>arg</code> from the database. This is useful when constructing different query strings, as it allows the user to determine which values are available on each field.</p>
<pre lang="@julia"><code>db_values = get_param_values("sector_desc")
</code></pre>
<p>output</p>
<pre lang="@julia"><code>JSON3.Object{Array{UInt8,1},Array{UInt64,1}} with 1 entry:
  :sector_desc =&gt; ["ANIMALS &amp; PRODUCTS", "CROPS", "DEMOGRAPHICS", "ECONOMICS", "ENVIRONMENTAL"]
</code></pre>
<p>If the user need to access the values, they are available as an array <code>db_values[:sector_desc]</code>.</p>
<p><strong>get_counts</strong></p>
<p><code>get_counts(args...)</code> is a helper query that allows user to check the number of records a query using the fields in <code>args...</code> will produce before performing the query. This is important because the USDA Quick Stats API has a limit of 50,000 records per query. Any query requesting a number of records larger than this limit will fail.</p>
<p>As in <code>get_nass</code>, <code>args...</code> is a list of the different headers from the database that can be queried. Each argument is a string with the name of the header and the value from that header in uppercase, e.g. <code>"header=VALUE</code>. The description of the different headers (also called columns) for the database is available [here].(<a href="https://quickstats.nass.usda.gov/api" rel="nofollow">https://quickstats.nass.usda.gov/api</a>)</p>
<p>In the following example, the number of records for survey data for oranges in California (CA) for the year 2019 with information about the headers "ACRES BEARING" and "PRICE RECEIVED" was queried.</p>
<p>Notice that header values that have spaces in them need to be passed with the symbol <code>%20</code> replacing the space. In general, no spaces are allowed in the query.</p>
<pre lang="@julia"><code>count = get_counts("source_desc=SURVEY","commodity_desc=ORANGES","state_alpha=CA", "year=2019","statisticcat_desc=AREA%20BEARING","statisticcat_desc=PRICE%20RECEIVED")
</code></pre>
<p>output</p>
<pre lang="@julia"><code>JSON3.Object{Array{UInt8,1},Array{UInt64,1}} with 1 entry:
  :count =&gt; 276
</code></pre>
<p>Same as before, the value can be accessed as an array <code>count[:count]</code>.</p>
<p>A very large query would be for example:</p>
<pre lang="@julia"><code>get_counts("source_desc=SURVEY", "year=2019")
</code></pre>
<p>output</p>
<pre lang="@julia"><code>JSON3.Object{Array{UInt8,1},Array{UInt64,1}} with 1 entry:
  :count =&gt; 381929
</code></pre>
<p>I would like to thank @markushhh, because I heavily used his <a href="https://github.com/markushhh/FredApi.jl">FredApi.jl</a> for inspiration. And sometimes blatant plagiarism.</p>
<h2><a id="user-content-each-comment-suggestion-or-pull-request-is-welcome" class="anchor" aria-hidden="true" href="#each-comment-suggestion-or-pull-request-is-welcome"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Each comment, suggestion or pull request is welcome!</h2>
</article></div>