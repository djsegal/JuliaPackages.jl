<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><h1 dir="auto"><a id="user-content-plutodevmacros" class="anchor" aria-hidden="true" href="#plutodevmacros"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>PlutoDevMacros</h1>
<p dir="auto">This is a package containing macros/functions to help develop Packages using <a href="https://github.com/fonsp/Pluto.jl">Pluto</a> notebooks as building blocks</p>
<h2 dir="auto"><a id="user-content-frompackage-macro" class="anchor" aria-hidden="true" href="#frompackage-macro"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>@frompackage macro</h2>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="@frompackage target import_block"><pre><span class="pl-c1">@frompackage</span> target import_block</pre></div>
<p dir="auto">The macro is basically taking a local Package (derived from <code>target</code>), loading it as a submodule of the current Pluto workspace and then process the various import/using statements inside <code>import_block</code> to extract varables/functions from the local Package into the notebook.</p>
<p dir="auto">When changes to the code of the local Package are made, the cell containing the call to <code>@frompackage</code> can be re-executed to reload the most recent version of the module, allowing to work within Pluto with a workflow similar to Revise, with the added advantage that some of the limitations of Revise requiring to restart the Julia session (like redefining structs) are avoided.</p>
<p dir="auto">The main purpose of this is to be able to create packages starting from Pluto notebooks as building blocks. While this approach to Package development has its disadvantages, it can be very convenient to speed up the workflow especially at the beginning of development thanks to avoiding the need to restart Julia when redefining structs, and exploiting the reactivity of Pluto to quickly assess <em>automagically</em> that your code update did indeed fix the issues by just having some cells that depend on your changed functions in a notebook.</p>
<p dir="auto">While the points mentioned above are achievable within a single pluto notebook without requiring to use this macro, when notebooks become quite complex, containing many cells, they start to become quite sluggish or unresponsive, so it is quite conveniente to be able to split the code into various notebook and be able to access the functionality defined in other notebooks from a single cell within a new notebook.</p>
<p dir="auto">To simply import other notebooks, <code>@ingredients</code> from <a href="https://github.com/JuliaPluto/PlutoLinks.jl">PlutoHooks</a> or <code>@plutoinclude</code> (which is inspired from <code>@ingredients</code>) from this PlutoDevMacros already exist, but I found that they do have some limitations for what concerns directly using notebooks as building blocks for a package.</p>
<h3 dir="auto"><a id="user-content-important-note" class="anchor" aria-hidden="true" href="#important-note"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>IMPORTANT NOTE</h3>
<p dir="auto">As explained below, in the current implementation <code>@frompackage</code> only supports
<code>target</code> files which are contained inside a Package Folder. Moreover, the
package containing the <code>target</code> file must have a correctly resolved Manifest
file. Make sure that the target Package is correctly resolved (i.e. by calling
<code>Pkg.resolve</code> from the Package environment) in order to have <code>@frompackage</code> work
properly</p>
<h3 dir="auto"><a id="user-content-arguments" class="anchor" aria-hidden="true" href="#arguments"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Arguments</h3>
<p dir="auto">Here are more details on the two arguments expected by the macro</p>
<h4 dir="auto"><a id="user-content-target" class="anchor" aria-hidden="true" href="#target"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>target</h4>
<p dir="auto">The first argument <code>target</code> has to be a String containing the path (either absolute or relative to the file calling the macro) that points to a local Package (the path can be to any file or subfolder within the Package folder) or to a specific file that is <em>included</em> in the Package (so the <code>target</code> file appears within the Package module definition inside an <code>include</code> call).</p>
<ul dir="auto">
<li>When <code>target</code> is not pointing directly to a file included in the Package, the full code of the module defining the Package will be parsed and loaded in the Pluto workspace of the notebook calling the macro.</li>
<li>When <code>target</code> is actually a file included inside the Package. The macro will just parse the Package module code up to and excluding the inclusion of <code>target</code> and discard the rest of the code, thus loading inside Pluto just a reduced part of the package. This is mimicking the behavior of <code>include</code> within a package, such that each <code>included</code> file only has visibility on the code that was loaded <em>before</em> its inclusion. This behavior is also essential when using this macro from a notebook that is also included in the target Package, to avoid problems with variable redefinitions within the Pluto notebook (this is also the original usecase of the macro).</li>
</ul>
<h4 dir="auto"><a id="user-content-import_block" class="anchor" aria-hidden="true" href="#import_block"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a><code>import_block</code></h4>
<p dir="auto">The second argument to the macro is supposed to be either a single using/import statement, or multiple using/import statements wrapped inside a <code>begin...end</code> block.</p>
<p dir="auto">These statements are used to conveniently select which of the loaded Package names have te be imported within the notebook.
Most of these import statements are only relevant when called within Pluto, so <code>@frompackage</code> simply avoid loading the target Package and deletes these import statements <strong>in most cases</strong> when called oustide of Pluto. There is a specific type of import statement (relative import) that is relevant and applicable also outside of Pluto, so this kind of statement is maintained in the macro output even outside of Pluto.</p>
<p dir="auto">The macro respects the differentiation between <code>using</code> and <code>import</code> as in normal Julia, so statements containing <code>using Module</code> without any variable name specifier will import all the exported names of <code>Module</code>.</p>
<h3 dir="auto"><a id="user-content-supported-usingimport-statements" class="anchor" aria-hidden="true" href="#supported-usingimport-statements"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Supported using/import statements</h3>
<p dir="auto">All supported statements also allow the following (catch-all) notation <code>import Module: *</code>, which imports within the notebook all the variables that are created or imported within <code>Module</code>. This is useful when one wants to avoid having either export everything from the module file directly, or specify all the names of the module when importing it into the notebook.</p>
<p dir="auto"><strong>Each import statement can only contain one module</strong>, so statements like <code>import Module1, Module2</code> are not supported. In case multiple imports are needed, use multiple statements within a <code>begin...end</code> block.</p>
<p dir="auto">The type of import statements that are supported by the macro are of 4 Types:</p>
<ul dir="auto">
<li>Relative Imports</li>
<li>Imports from the Package module</li>
<li>Import from the Parent module (or submodule)</li>
<li>Direct dependency import.</li>
</ul>
<h4 dir="auto"><a id="user-content-relative-imports" class="anchor" aria-hidden="true" href="#relative-imports"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Relative Imports</h4>
<p dir="auto">Relative imports are the ones where the module name starts with a dot (.). These are mostly relevant when the loaded module contains multiple submodules and they are <strong>the only supported statement that is kept also outside of Pluto</strong>.</p>
<p dir="auto">While <em>catch-all</em> notation is supported also with relative imports (e.g. <code>import ..SiblingModule: *</code>), the extraction of all the names from the desired relative module requires loading and inspecting the full Package module and is thus only functional inside of Pluto. <strong>This kind of statement is deleted when @frompackage is called outside of Pluto</strong>.</p>
<h4 dir="auto"><a id="user-content-imports-from-package-module" class="anchor" aria-hidden="true" href="#imports-from-package-module"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Imports from Package module</h4>
<p dir="auto">These are all the import statements that have the name <code>PackageModule</code> as the
first identifier, e.g.: - <code>using PackageModule.SubModule</code> - <code>import PackageModule: varname</code> - <code>import PackageModule.SubModule.SubSubModule: *</code> These statements are
processed by the macro and transformed so that <code>PackageModule</code> actually points to
the module that was loaded by the macro.</p>
<p dir="auto">As alternative, <code>^</code> can also be used to represent the <code>PackageModule</code>, so one can write the two expressions below interchangeably</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="@fromparent import PackageModule: var_name
@fromparent import ^: var_name"><pre><span class="pl-c1">@fromparent</span> <span class="pl-k">import</span> PackageModule<span class="pl-k">:</span> var_name
<span class="pl-c1">@fromparent</span> <span class="pl-k">import</span> <span class="pl-k">^</span>: var_name</pre></div>
<p dir="auto">This is to avoid triggering the Pkg statusmark within Pluto which always appears when a valid name of a package is typed (<code>^</code> is not valid so it doesn't create the status mark). See image below:
<a target="_blank" rel="noopener noreferrer nofollow" href="https://user-images.githubusercontent.com/12846528/236888015-454183e6-44c1-4cd0-b9f8-9faf67aa0da6.png"><img src="https://user-images.githubusercontent.com/12846528/236888015-454183e6-44c1-4cd0-b9f8-9faf67aa0da6.png" alt="image" style="max-width: 100%;"></a></p>
<h4 dir="auto"><a id="user-content-imports-from-parent-module-or-submodule" class="anchor" aria-hidden="true" href="#imports-from-parent-module-or-submodule"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Imports from Parent module (or submodule)</h4>
<p dir="auto">These statements are similar to the previous (imports from Package module) ones, with two main difference:</p>
<ul dir="auto">
<li>They only work if the <code>target</code> file is actually a file that is included in the
loaded Package, giving an error otherwise</li>
<li><code>ParentModule</code> does not point to the loaded Package, but the module that
contains the line that calls <code>include(target)</code>. If <code>target</code>  is loaded from the
Package main module, and not from one of its submodules, then <code>ParentModule</code> will
point to the same module as <code>PackageModule</code>.</li>
</ul>
<h5 dir="auto"><a id="user-content-catch-all" class="anchor" aria-hidden="true" href="#catch-all"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Catch-All</h5>
<p dir="auto">A special kind parent module import is the form:</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="import *"><pre><span class="pl-k">import</span> <span class="pl-k">*</span></pre></div>
<p dir="auto">which is equivalent to <code>import FromParent: *</code>.</p>
<p dir="auto">This tries to reproduce within the namespace of the calling notebook, the
namespace that would be visible by the notebook file when it is loaded as part
of the Package module outside of Pluto.</p>
<h4 dir="auto"><a id="user-content-imports-from-direct-dependencies" class="anchor" aria-hidden="true" href="#imports-from-direct-dependencies"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Imports from Direct dependencies</h4>
<p dir="auto">It is possible to to import direct dependencie of the target Package from within the <code>@frompackage</code> macro. To do so, one must prepend the package name with <code>&gt;.</code>, so for example if one wants to load the <code>BenchmarkTools</code> package from the macro, assuming that it is indeed a direct dependency of the target package, one can do:</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="@frompackage target begin
    using &gt;.BenchmarkTools
end"><pre><span class="pl-c1">@frompackage</span> target <span class="pl-k">begin</span>
    <span class="pl-k">using</span> <span class="pl-k">&gt;</span><span class="pl-k">.</span>BenchmarkTools
<span class="pl-k">end</span></pre></div>
<p dir="auto">This modification is necessary when trying to use <code>@frompackage</code> in combination with the Pluto PkgManager, as explained in <a class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="1700277604" data-permission-text="Title is private" data-url="https://github.com/disberd/PlutoDevMacros.jl/issues/10" data-hovercard-type="pull_request" data-hovercard-url="/disberd/PlutoDevMacros.jl/pull/10/hovercard" href="https://github.com/disberd/PlutoDevMacros.jl/pull/10">#10</a>.</p>
<p dir="auto">These kind of statements (import/using from Direct Dependencies) are also supported both inside and outside Pluto, which means for example that the following code will effectively translate to <code>using BenchmarkTools</code> both inside and outside of Pluto"</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="@frompackage target begin
    using &gt;.BenchmarkTools
end"><pre><span class="pl-c1">@frompackage</span> target <span class="pl-k">begin</span>
    <span class="pl-k">using</span> <span class="pl-k">&gt;</span><span class="pl-k">.</span>BenchmarkTools
<span class="pl-k">end</span></pre></div>
<p dir="auto">These kind of statements can not be used in combination with the <code>catch-all</code>
imported name (*).</p>
<p dir="auto">This feature is useful when trying to combine <code>@frompackage</code> with the integrated
Pluto PkgManager. In this case, is preferable to keep in the Pluto notebook
environment just the packages that are not also part of the loaded Package
environment, and load the eventual packages that are also direct dependencies of
the loaded Package directly from within the <code>@frompackage</code> <code>import_block</code>.</p>
<p dir="auto">Doing so minimizes the risk of having issues caused by versions collision
between dependencies that are shared both by the notebook environment and the
loaded Package environment. Combining the use of <code>@frompackage</code> with the Pluto
PkgManager is a very experimental feature that comes with significant caveats.
Please read the <a href="#use-of-fromparentfrompackage-with-pluto-pkgmanager">related section</a> at the end of this README</p>
<h3 dir="auto"><a id="user-content-skipping-package-parts" class="anchor" aria-hidden="true" href="#skipping-package-parts"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Skipping Package Parts</h3>
<p dir="auto">The macro also allows to specify parts of the source code of the target Package that have to be skipped when loading it within Pluto. This is achieved by adding a statement inside the <code>import_block</code> like the following:</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="@skiplines lines"><pre><span class="pl-c1">@skiplines</span> lines</pre></div>
<p dir="auto">The <code>@skiplines</code> macro is not defined within the package, it's just processed during the parsing of the <code>@frompackage</code> macro.</p>
<p dir="auto"><code>lines</code> is expected to either be a single String, or a group of Strings within a <code>begin ... end</code> block.
Each string represent a part of a file that has to be skipped, with the following formats being supported:</p>
<ol dir="auto">
<li><code>filpeath:::firstline-lastline</code>: This specifies that all the lines between <code>firstline</code> and <code>lastline</code> (extrema included) in the file present at <code>filepath</code> must be skipped when loading the Package module</li>
<li><code>filepath:::line</code>: Like 1. but a single line is skipped</li>
<li><code>filepath</code>: Like 1. but the full file located at <code>filepath</code> is ignored when loading the module</li>
<li><code>line</code>: Ignores line number <code>line</code> in the Package entry point (i.e. the file at <code>src/PackageName.jl</code> in the folder of PackageName)</li>
<li><code>firstline-lastline</code>: Like 4., but ignores a range of lines.</li>
</ol>
<p dir="auto">In all of the examples above <code>filepath</code> can be provided as either an absolute path, or as a relative path <strong>starting from the <code>src</code> subfolder of the Package folder</strong></p>
<p dir="auto">The functionality of skipping lines is only used when <code>@frompackage</code> is called inside Pluto.
When calling the macro from outside of Pluto, the eventual statement with <code>@skiplines</code> is discarded.</p>
<h4 dir="auto"><a id="user-content-example" class="anchor" aria-hidden="true" href="#example"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Example</h4>
<p dir="auto">For an example consider the source file of the <code>TestPackage.jl</code> defined within the test subfolder with the contents shown below:
<a target="_blank" rel="noopener noreferrer nofollow" href="https://user-images.githubusercontent.com/12846528/236829189-dc30414a-d936-4a63-831b-963664249558.png"><img src="https://user-images.githubusercontent.com/12846528/236829189-dc30414a-d936-4a63-831b-963664249558.png" alt="image" style="max-width: 100%;"></a></p>
<p dir="auto">The notebook called <code>out_notebook.jl</code> located in the main folder of <code>TestPackage</code> gives an example of how to use the new functionality.
The following call to <code>@fromparent</code> is used to import the <code>TestPackage</code> in the notebook's workspace while removing some of the code that is present in the original source of <code>TestPackage</code>:</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="@fromparent begin
	import TestPackage
	@skiplines begin
		&quot;11&quot; # Skip line 11 in the main file TestPackage.jl.
		&quot;test_macro2.jl&quot; # This skips the whole file test_macro2.jl
		&quot;22-23&quot; # This skips from line 21 to 22 in the main file, including extrema.
		&quot;test_macro1.jl:::28-10000&quot; # This skips parts of test_macro1.jl
	end
end"><pre><span class="pl-c1">@fromparent</span> <span class="pl-k">begin</span>
	<span class="pl-k">import</span> TestPackage
	<span class="pl-c1">@skiplines</span> <span class="pl-k">begin</span>
		<span class="pl-s"><span class="pl-pds">"</span>11<span class="pl-pds">"</span></span> <span class="pl-c"><span class="pl-c">#</span> Skip line 11 in the main file TestPackage.jl.</span>
		<span class="pl-s"><span class="pl-pds">"</span>test_macro2.jl<span class="pl-pds">"</span></span> <span class="pl-c"><span class="pl-c">#</span> This skips the whole file test_macro2.jl</span>
		<span class="pl-s"><span class="pl-pds">"</span>22-23<span class="pl-pds">"</span></span> <span class="pl-c"><span class="pl-c">#</span> This skips from line 21 to 22 in the main file, including extrema.</span>
		<span class="pl-s"><span class="pl-pds">"</span>test_macro1.jl:::28-10000<span class="pl-pds">"</span></span> <span class="pl-c"><span class="pl-c">#</span> This skips parts of test_macro1.jl</span>
	<span class="pl-k">end</span>
<span class="pl-k">end</span></pre></div>
<p dir="auto">The output of the notebook is also pasted here for reference:
<a target="_blank" rel="noopener noreferrer nofollow" href="https://user-images.githubusercontent.com/12846528/236832303-eb2fdc0f-08fd-47e7-9c1d-35f1f1b637fd.png"><img src="https://user-images.githubusercontent.com/12846528/236832303-eb2fdc0f-08fd-47e7-9c1d-35f1f1b637fd.png" alt="image" style="max-width: 100%;"></a></p>
<h3 dir="auto"><a id="user-content-reload-button" class="anchor" aria-hidden="true" href="#reload-button"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Reload Button</h3>
<p dir="auto">The macro, when called within Pluto, also creates a convenient button that can be used to re-execute the cell calling the macro to reloade the Package code due to a change. It can also be used to quickly navigate to the position of the cell containing the macro by using Ctrl+Click. The reload button will change appearance (getting a red border) when the macrocall encountered an error either due to incorrect import statement (like if a <code>FromParent</code> import is used without a proper target) or due to an error encountered when loading the package code.</p>
<p dir="auto">Here is a short video showing the reload button. The window on the left has opened the <a href="https://github.com/disberd/PlutoDevMacros.jl/blob/8e481f552fdce1562cc9e45970cb11e8b54faa71/test/TestPackage/src/specific_imports1.jl">specific_imports1.jl</a> notebook, while the one on the right has the <a href="https://github.com/disberd/PlutoDevMacros.jl/blob/8e481f552fdce1562cc9e45970cb11e8b54faa71/test/TestPackage/src/specific_imports2.jl">specific_imports2.jl</a> one. Both are included in the TestPackage using for tests as follows:
</p><div class="Box Box--condensed my-2">
  <div class="Box-header f6">
    <p class="mb-0 text-bold">
      <a href="https://github.com/disberd/PlutoDevMacros.jl/blob/8e481f552fdce1562cc9e45970cb11e8b54faa71/test/TestPackage/src/TestPackage.jl#L20-L25">PlutoDevMacros.jl/test/TestPackage/src/TestPackage.jl</a>
    </p>
    <p class="mb-0 color-fg-muted">
        Lines 20 to 25
      in
      <a data-pjax="true" class="commit-tease-sha" href="/disberd/PlutoDevMacros.jl/commit/8e481f552fdce1562cc9e45970cb11e8b54faa71">8e481f5</a>
    </p>
  </div>
  <div itemprop="text" class="Box-body p-0 blob-wrapper blob-wrapper-embedded data">
    <table class="highlight tab-size mb-0 js-file-line-container" data-tab-size="8" data-paste-markdown-skip="">

        <tbody><tr class="border-0">
          <td id="L20" class="blob-num border-0 px-3 py-0 color-bg-default" data-line-number="20"></td>
          <td id="LC20" class="blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line">  </td>
        </tr>

        <tr class="border-0">
          <td id="L21" class="blob-num border-0 px-3 py-0 color-bg-default" data-line-number="21"></td>
          <td id="LC21" class="blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line"> <span class="pl-k">module</span> SpecificImport </td>
        </tr>

        <tr class="border-0">
          <td id="L22" class="blob-num border-0 px-3 py-0 color-bg-default" data-line-number="22"></td>
          <td id="LC22" class="blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line">     <span class="pl-c1">include</span>(<span class="pl-s"><span class="pl-pds">"</span>specific_imports1.jl<span class="pl-pds">"</span></span>) </td>
        </tr>

        <tr class="border-0">
          <td id="L23" class="blob-num border-0 px-3 py-0 color-bg-default" data-line-number="23"></td>
          <td id="LC23" class="blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line">     <span class="pl-c1">include</span>(<span class="pl-s"><span class="pl-pds">"</span>specific_imports2.jl<span class="pl-pds">"</span></span>) </td>
        </tr>

        <tr class="border-0">
          <td id="L24" class="blob-num border-0 px-3 py-0 color-bg-default" data-line-number="24"></td>
          <td id="LC24" class="blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line"> <span class="pl-k">end</span> </td>
        </tr>

        <tr class="border-0">
          <td id="L25" class="blob-num border-0 px-3 py-0 color-bg-default" data-line-number="25"></td>
          <td id="LC25" class="blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line">  </td>
        </tr>
    </tbody></table>
  </div>
</div>
<p></p>
<details open="" class="details-reset border rounded-2">
  <summary class="px-3 py-2">
    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-device-camera-video">
    <path d="M16 3.75v8.5a.75.75 0 0 1-1.136.643L11 10.575v.675A1.75 1.75 0 0 1 9.25 13h-7.5A1.75 1.75 0 0 1 0 11.25v-6.5C0 3.784.784 3 1.75 3h7.5c.966 0 1.75.784 1.75 1.75v.675l3.864-2.318A.75.75 0 0 1 16 3.75Zm-6.5 1a.25.25 0 0 0-.25-.25h-7.5a.25.25 0 0 0-.25.25v6.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-6.5ZM11 8.825l3.5 2.1v-5.85l-3.5 2.1Z"></path>
</svg>
    <span aria-label="Video description 85b7a6ed-4700-4145-9638-c160dc3331d6.mp4" class="m-1">85b7a6ed-4700-4145-9638-c160dc3331d6.mp4</span>
    <span class="dropdown-caret"></span>
  </summary>

  <video src="https://user-images.githubusercontent.com/12846528/236453634-c95aa7b2-61eb-492f-85f5-6539bbb714d5.mp4" data-canonical-src="https://user-images.githubusercontent.com/12846528/236453634-c95aa7b2-61eb-492f-85f5-6539bbb714d5.mp4" controls="controls" muted="muted" class="d-block rounded-bottom-2 border-top width-fit" style="max-height:640px; min-height: 200px">

  </video>
</details>

<h2 dir="auto"><a id="user-content-fromparent-macro" class="anchor" aria-hidden="true" href="#fromparent-macro"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>@fromparent macro</h2>
<p dir="auto">The <code>@fromparent</code> macro only accepts the <code>import_block</code> as single argument, and it uses the calling file as the target, so:</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="(@fromparent import_block) == (@frompackage @__FILE__ import_block)"><pre>(<span class="pl-c1">@fromparent</span> import_block) <span class="pl-k">==</span> (<span class="pl-c1">@frompackage</span> <span class="pl-c1">@__FILE__</span> import_block)</pre></div>
<h2 dir="auto"><a id="user-content-addmethod-macro" class="anchor" aria-hidden="true" href="#addmethod-macro"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>@addmethod macro</h2>
<p dir="auto">The <code>@fromparent</code>/<code>@frompackage</code> functions rely (like <code>@ingredients</code> and <code>@plutoinclude</code>) in generating temporary  modules and importing variables from those modules. This causes problems because Pluto currently does not support directly adding methods to functions imported from other modules (see #2). To circumvent this, PlutoDevMacros also exports the <code>@addmethod</code> function which simply takes care of <em>pre-pending</em> the correct module name in the function signature.</p>
<p dir="auto">So the code</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="@addmethod func(args...;kwargs...) = something"><pre><span class="pl-c1">@addmethod</span> <span class="pl-en">func</span>(args<span class="pl-k">...</span>;kwargs<span class="pl-k">...</span>) <span class="pl-k">=</span> something</pre></div>
<p dir="auto">is simply translated to</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="DefiningModule.func(args...;kwargs...) = something"><pre>DefiningModule<span class="pl-k">.</span><span class="pl-en">func</span>(args<span class="pl-k">...</span>;kwargs<span class="pl-k">...</span>) <span class="pl-k">=</span> something</pre></div>
<p dir="auto">where <code>DefiningModule</code> is the module where <code>func</code> is defined. When called outside of Pluto, <code>@addmethod</code> simply returns the given expression without modifying it.</p>
<p dir="auto">This is useful to avoid multiple definition errors inside Pluto but has the caveat that defining a method with <code>@addmethod</code> does not trigger a reactive run of all cells that call the modified function.
This also mean that when removing the cell with the <code>@addmethod</code> call, the actual method added to the <code>DefiningModule</code> will not be automatically erased by Pluto and is still accessible until it is not overwritten with another method with the same signature.
This is easy to fix in the case of adding methods to modules loaded with <code>@frompackage</code>/<code>@fromparent</code> as reloading the module is sufficient to remove the hanging method.</p>
<p dir="auto">See this video for an example:</p>
<details open="" class="details-reset border rounded-2">
  <summary class="px-3 py-2">
    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-device-camera-video">
    <path d="M16 3.75v8.5a.75.75 0 0 1-1.136.643L11 10.575v.675A1.75 1.75 0 0 1 9.25 13h-7.5A1.75 1.75 0 0 1 0 11.25v-6.5C0 3.784.784 3 1.75 3h7.5c.966 0 1.75.784 1.75 1.75v.675l3.864-2.318A.75.75 0 0 1 16 3.75Zm-6.5 1a.25.25 0 0 0-.25-.25h-7.5a.25.25 0 0 0-.25.25v6.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-6.5ZM11 8.825l3.5 2.1v-5.85l-3.5 2.1Z"></path>
</svg>
    <span aria-label="Video description bdd94beb-707c-45a8-bc7c-4326932f8aa3.mp4" class="m-1">bdd94beb-707c-45a8-bc7c-4326932f8aa3.mp4</span>
    <span class="dropdown-caret"></span>
  </summary>

  <video src="https://user-images.githubusercontent.com/12846528/236472989-da86a311-4501-4966-9f0b-1298bbd9d53b.mp4" data-canonical-src="https://user-images.githubusercontent.com/12846528/236472989-da86a311-4501-4966-9f0b-1298bbd9d53b.mp4" controls="controls" muted="muted" class="d-block rounded-bottom-2 border-top width-fit" style="max-height:640px; min-height: 200px">

  </video>
</details>

<h2 dir="auto"><a id="user-content-use-of-fromparentfrompackage-with-pluto-pkgmanager" class="anchor" aria-hidden="true" href="#use-of-fromparentfrompackage-with-pluto-pkgmanager"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Use of @fromparent/@frompackage with Pluto PkgManager</h2>
<p dir="auto">As the module of the Package is loaded/evaluated by the macro inside the notebook workspace, the notebook environment should also contain all the packages that are used by the target Package inside its own environment.</p>
<p dir="auto">Ideally this is achieved by deactivating the Pluto PkgManger by activating an environment that also contains the local Package as a dependency.</p>
<p dir="auto">This is sometime inconvenient, as the Pluto PkgManager has many advantages. If one wants to maintain the PkgManager, the notebook should also contain a cell import all the packages of the loaded module.</p>
<p dir="auto">This macro currently has a hack to allow loading the target Package module (and its direct dependencies) without having to add all of its dependencies to the notebook environment.
It does so by adding the Package environment to the <code>LOAD_PATH</code> just before attempting to load it, and removing it from the <code>LOAD_PATH</code> just after evaluating the various import statements.</p>
<p dir="auto">The macro tries to catch all possible exceptions that are thrown either during macro compilation or during the resulting expression evaluation (using a try catch) to correctly clean <code>LOAD_PATH</code> after the macro is executed.</p>
<p dir="auto">This approach is quite brittle, as it may cause issues in case the notebook and the package environment share some dependencies at different version. In this case, the one that was loaded first is the actual version used within the notebook (and within the Package module when loaded in the notebook).</p>
<p dir="auto">Adding the package environment at the second position in the LOAD_PATH (so after the notebook environment) should minimize the potential issues as the notebook environment is parsed first to find the packages.
This does not prevent the case when a package (for example DataFrames) that is only used by the loaded package, is also added to the notebook after the target Package has been loaded.
In this case, the version of DataFrames used by the notebook will be the version loaded by Package, and not the one installed in the notebook environment.
Upon restarting the notebook, the situation will flip. Since now DataFrames is in the notebook environment, the notebook version will be loaded both in the notebook and in the Package module, potentially causing issues with the PackageCode if it was depending on a different version of DataFrames.</p>
<p dir="auto"><strong>Due to the issues just mentioned, use the macro knowing that it might break if you want to use the Pluto PkgManager without manually adding all depending packages to the notebook environment</strong>.</p>
<h2 dir="auto"><a id="user-content-plutoinclude-macro" class="anchor" aria-hidden="true" href="#plutoinclude-macro"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>@plutoinclude macro</h2>
<p dir="auto"><code>@plutoinclude</code> is a macro aimed at simplifying the development of packages with multiple connected notebooks as building blocks.</p>
<p dir="auto">When creating a package whose functionality is divided into various notebooks that are included in the main package file, <code>@plutoinclude</code> can be used inside each notebook to serially chain the code definition from one notebook to the next. Each notebook (except the first one) should contain a <code>@plutoinclude</code> call to the one preceding it (in the same order you <code>include</code> the notebooks in the main package source).</p>
<p dir="auto">When called from inside a Pluto notebook, <code>@plutoinclude</code> takes care of including all variables and function definitions from <em>included</em> notebook into the <em>including</em> one. If called just with the notebook path, it only include variables and function <strong>explicitly</strong> marked with <code>export</code>. The string <code>"all"</code> can be given as second argument to the macrocall to import all variables and functions defined in the <em>included</em> notebook into the <em>including</em> one.
Lastly, the macro creates a button on the notebook front-end that can be clicked to trigger a re-computation of the inclusion, modifying the imported variables and definition following a modification of the <em>included</em> notebook.</p>
<p dir="auto">See the video example below, or check the <a href="./notebooks/plutoinclude_macro.jl">plutoinclude_macro</a>, <a href="./notebooks/plutoinclude_test.jl">plutoinclude_test</a> for basic usage or <a href="./notebooks/test1.jl">test1</a>, <a href="./notebooks/test2.jl">test2</a>, <a href="./notebooks/test3.jl">test3</a> for chained inclusion examples:</p>
<details open="" class="details-reset border rounded-2">
  <summary class="px-3 py-2">
    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-device-camera-video">
    <path d="M16 3.75v8.5a.75.75 0 0 1-1.136.643L11 10.575v.675A1.75 1.75 0 0 1 9.25 13h-7.5A1.75 1.75 0 0 1 0 11.25v-6.5C0 3.784.784 3 1.75 3h7.5c.966 0 1.75.784 1.75 1.75v.675l3.864-2.318A.75.75 0 0 1 16 3.75Zm-6.5 1a.25.25 0 0 0-.25-.25h-7.5a.25.25 0 0 0-.25.25v6.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-6.5ZM11 8.825l3.5 2.1v-5.85l-3.5 2.1Z"></path>
</svg>
    <span aria-label="Video description 8f41bc49-46dd-4c65-8995-f38eb24f3306.mp4" class="m-1">8f41bc49-46dd-4c65-8995-f38eb24f3306.mp4</span>
    <span class="dropdown-caret"></span>
  </summary>

  <video src="https://user-images.githubusercontent.com/12846528/157840718-29f754b0-2649-41ed-934f-b554bdab13b9.mp4" data-canonical-src="https://user-images.githubusercontent.com/12846528/157840718-29f754b0-2649-41ed-934f-b554bdab13b9.mp4" controls="controls" muted="muted" class="d-block rounded-bottom-2 border-top width-fit" style="max-height:640px; min-height: 200px">

  </video>
</details>

<h2 dir="auto"><a id="user-content-only_in_nb-only_out_nb" class="anchor" aria-hidden="true" href="#only_in_nb-only_out_nb"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a><code>@only_in_nb</code>, <code>@only_out_nb</code></h2>
<p dir="auto">The exported macro <code>@only_in_nb</code> ensures that the content of a cell are only executed when ran from the notebook where they are defined.</p>
<p dir="auto">Similarly, the macro <code>@only_out_nb</code> only executes code in the cell when this is included by calling <code>include</code> on the notebook file from another julia file</p>
<p dir="auto">This is useful especially when you want to create and test a functionality in a standalone notebook in which you would use <code>import Pkg</code> and <code>using</code> in some cells at the beginning of the notebook, but you don't want to have the code in these cells to be executed when the notebook file is included from somewhere else.</p>
<p dir="auto">The code was inspired and heavily based on the <code>@skip_as_script</code> and <code>@only_as_script</code> macros that are found <a href="https://github.com/fonsp/Pluto.jl/blob/main/src/webserver/Firebasey.jl">inside the Pluto main package</a> and in <a href="https://github.com/JuliaPluto/PlutoTest.jl">PlutoTest</a>.</p>
<p dir="auto">The need for this separate macros is for two reasons:</p>
<ul dir="auto">
<li>The original Pluto macros are not limiting execution to in or out of the specific notebook, but in or out of a Pluto session (if you <code>include</code> a notebook from another notebook, all the <code>@skip_as_script</code> macros are executed)</li>
<li>I had an issue making the original Pluto macros work together with @requires from <a href="https://github.com/JuliaPackaging/Requires.jl">Requires</a> while developing a personal package and this macro seems to solve the issue</li>
</ul>
<p dir="auto">NOTE: Now most of the functionality originally intended by <code>@only_in_nb</code> and <code>@only_out_nb</code> is directly achieavable in Pluto using the <code>skip_as_script</code> implemented in <a href="https://github.com/fonsp/Pluto.jl/pull/2018" data-hovercard-type="pull_request" data-hovercard-url="/fonsp/Pluto.jl/pull/2018/hovercard">this PR</a>.</p>
</article></div>