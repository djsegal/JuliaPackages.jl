<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><h1><a id="user-content-experienceanalysis" class="anchor" aria-hidden="true" href="#experienceanalysis"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>ExperienceAnalysis</h1>
<p><a href="https://JuliaActuary.github.io/ExperienceAnalysis.jl/stable" rel="nofollow"><img src="https://camo.githubusercontent.com/c97f0a5f2ae95755f64a27f1aa8d9a17462941fd3d6c907c7630abd5d3e60acf/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f646f63732d737461626c652d626c75652e737667" alt="Stable" data-canonical-src="https://img.shields.io/badge/docs-stable-blue.svg" style="max-width:100%;"></a>
<a href="https://JuliaActuary.github.io/ExperienceAnalysis.jl/dev" rel="nofollow"><img src="https://camo.githubusercontent.com/7fcec4b2d3ab291529fce8ef6a4fcd4129a0683b2f5d5fe2f5c648f02db8b616/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f646f63732d6465762d626c75652e737667" alt="Dev" data-canonical-src="https://img.shields.io/badge/docs-dev-blue.svg" style="max-width:100%;"></a>
<a target="_blank" rel="noopener noreferrer" href="https://github.com/JuliaActuary/LifeContingencies.jl/workflows/CI/badge.svg"><img src="https://github.com/JuliaActuary/LifeContingencies.jl/workflows/CI/badge.svg" alt="" style="max-width:100%;"></a>
<a href="https://codecov.io/gh/JuliaActuary/ExperienceAnalysis.jl" rel="nofollow"><img src="https://camo.githubusercontent.com/6b4d9594a85ca7609e98d48c103ea6253617146b6d7b529a7f958947766a28d1/68747470733a2f2f636f6465636f762e696f2f67682f4a756c6961416374756172792f457870657269656e6365416e616c797369732e6a6c2f6272616e63682f6d61737465722f67726170682f62616467652e737667" alt="Coverage" data-canonical-src="https://codecov.io/gh/JuliaActuary/ExperienceAnalysis.jl/branch/master/graph/badge.svg" style="max-width:100%;"></a>
<a href="https://www.tidyverse.org/lifecycle/" rel="nofollow"><img src="https://camo.githubusercontent.com/1a3d36a0843e12ed91c0fb2dc987d64be584df3e1475c75bfb0e0fb0f32e4b42/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4c6966654379636c652d446576656c6f70696e672d626c756c65" alt="lifecycle" data-canonical-src="https://img.shields.io/badge/LifeCycle-Developing-blule" style="max-width:100%;"></a></p>
<p>Calculate exposures.</p>
<h2><a id="user-content-quickstart" class="anchor" aria-hidden="true" href="#quickstart"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Quickstart</h2>
<div class="highlight highlight-source-julia position-relative" data-snippet-clipboard-copy-content="using ExperienceAnalysis
using Dates

issue = Date(2016, 7, 4)
termination = Date(2020, 1, 17)
basis = ExperienceAnalysis.Anniversary(Year(1))
exposure(basis, issue, termination)
"><pre><span class="pl-k">using</span> ExperienceAnalysis
<span class="pl-k">using</span> Dates

issue <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-c1">2016</span>, <span class="pl-c1">7</span>, <span class="pl-c1">4</span>)
termination <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-c1">2020</span>, <span class="pl-c1">1</span>, <span class="pl-c1">17</span>)
basis <span class="pl-k">=</span> ExperienceAnalysis<span class="pl-k">.</span><span class="pl-c1">Anniversary</span>(<span class="pl-c1">Year</span>(<span class="pl-c1">1</span>))
<span class="pl-c1">exposure</span>(basis, issue, termination)</pre></div>
<p>This will return an array of tuples with a <code>from</code> and <code>to</code> date:</p>
<div class="highlight highlight-source-julia position-relative" data-snippet-clipboard-copy-content="4-element Array{NamedTuple{(:from, :to),Tuple{Date,Date}},1}:
 (from = Date(&quot;2016-07-04&quot;), to = Date(&quot;2017-07-04&quot;))
 (from = Date(&quot;2017-07-04&quot;), to = Date(&quot;2018-07-04&quot;))
 (from = Date(&quot;2018-07-04&quot;), to = Date(&quot;2019-07-04&quot;))
 (from = Date(&quot;2019-07-04&quot;), to = Date(&quot;2020-01-17&quot;))
"><pre><span class="pl-c1">4</span><span class="pl-k">-</span>element Array{NamedTuple{(<span class="pl-c1">:from</span>, <span class="pl-c1">:to</span>),Tuple{Date,Date}},<span class="pl-c1">1</span>}<span class="pl-k">:</span>
 (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2016-07-04<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2017-07-04<span class="pl-pds">"</span></span>))
 (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2017-07-04<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2018-07-04<span class="pl-pds">"</span></span>))
 (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2018-07-04<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2019-07-04<span class="pl-pds">"</span></span>))
 (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2019-07-04<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2020-01-17<span class="pl-pds">"</span></span>))</pre></div>
<h2><a id="user-content-available-exposure-basis" class="anchor" aria-hidden="true" href="#available-exposure-basis"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Available Exposure Basis</h2>
<ul>
<li><code>ExperienceAnalysis.Anniversary(period)</code> will give exposures periods based on the first date</li>
<li><code>ExperienceAnalysis.Calendar(period)</code> will follow calendar periods (e.g. month or year)</li>
<li><code>ExperienceAnalysis.AnniversaryCalendar(period,period)</code> will split into the smaller of the calendar or policy anniversary period.</li>
</ul>
<p>Where <code>period</code> is a <a href="https://docs.julialang.org/en/v1/stdlib/Dates/#Period-Types" rel="nofollow">Period Type from the Dates standard library</a>.</p>
<p>Calculate exposures with <code>exposures(basis,from,to,continue_exposure)</code>.</p>
<ul>
<li><code>continue_exposures</code> indicates whether the exposure should be extended through the full exposure period rather than terminate at the <code>to</code> date.</li>
</ul>
<h2><a id="user-content-full-example" class="anchor" aria-hidden="true" href="#full-example"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Full Example</h2>
<p>We'll start with this as our data:</p>
<div class="highlight highlight-source-julia position-relative" data-snippet-clipboard-copy-content="julia&gt; df

3×4 DataFrame
│ Row │ id     │ issue      │ termination │ status  │
│     │ String │ Date       │ Date?       │ String  │
├─────┼────────┼────────────┼─────────────┼─────────┤
│ 1   │ 1      │ 2016-07-04 │ 2020-01-17  │ Claim   │
│ 2   │ 2      │ 2016-01-01 │ 2018-05-04  │ Lapse   │
│ 3   │ 3      │ 2016-01-01 │ missing     │ Inforce │
"><pre>julia<span class="pl-k">&gt;</span> df

<span class="pl-c1">3</span><span class="pl-k">×</span><span class="pl-c1">4</span> DataFrame
│ Row │ id     │ issue      │ termination │ status  │
│     │ String │ Date       │ Date?       │ String  │
├─────┼────────┼────────────┼─────────────┼─────────┤
│ <span class="pl-c1">1</span>   │ <span class="pl-c1">1</span>      │ <span class="pl-c1">2016</span><span class="pl-k">-</span><span class="pl-c1">07</span><span class="pl-k">-</span><span class="pl-c1">04</span> │ <span class="pl-c1">2020</span><span class="pl-k">-</span><span class="pl-c1">01</span><span class="pl-k">-</span><span class="pl-c1">17</span>  │ Claim   │
│ <span class="pl-c1">2</span>   │ <span class="pl-c1">2</span>      │ <span class="pl-c1">2016</span><span class="pl-k">-</span><span class="pl-c1">01</span><span class="pl-k">-</span><span class="pl-c1">01</span> │ <span class="pl-c1">2018</span><span class="pl-k">-</span><span class="pl-c1">05</span><span class="pl-k">-</span><span class="pl-c1">04</span>  │ Lapse   │
│ <span class="pl-c1">3</span>   │ <span class="pl-c1">3</span>      │ <span class="pl-c1">2016</span><span class="pl-k">-</span><span class="pl-c1">01</span><span class="pl-k">-</span><span class="pl-c1">01</span> │ <span class="pl-c1">missing</span>     │ Inforce │</pre></div>
<p>Define the study end:</p>
<div class="highlight highlight-source-julia position-relative" data-snippet-clipboard-copy-content="study_end = Date(2020,12,31)
"><pre>study_end <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-c1">2020</span>,<span class="pl-c1">12</span>,<span class="pl-c1">31</span>)</pre></div>
<p>Next, we do two things by iterating over and creating a new array of dates:</p>
<ol>
<li>Handle the <code>missing</code> case by letting the <code>to</code> reflect the <code>study_end</code></li>
<li>Cap the ending date at the <code>study_end</code>. This doesn't come into play in this example, but it's included for demonstration purposes.</li>
</ol>
<div class="highlight highlight-source-julia position-relative" data-snippet-clipboard-copy-content="to = [ismissing(d) ? study_end : min(study_end,d) for d in df.termination]
"><pre>to <span class="pl-k">=</span> [<span class="pl-c1">ismissing</span>(d) <span class="pl-k">?</span> study_end <span class="pl-k">:</span> <span class="pl-c1">min</span>(study_end,d) <span class="pl-k">for</span> d <span class="pl-k">in</span> df<span class="pl-k">.</span>termination]</pre></div>
<p>Calculate the exposure by <a href="https://docs.julialang.org/en/v1/manual/mathematical-operations/#man-dot-operators" rel="nofollow">broadcasting</a> the exposure function over the three arrays we are passing to it:</p>
<div class="highlight highlight-source-julia position-relative" data-snippet-clipboard-copy-content="df.exposure = exposure.(
    ExperienceAnalysis.Anniversary(Year(1)),   # The basis for our exposures
    df.issue,                             # The `from` date
    to                                    # the `to` date array we created above
    )
"><pre>df<span class="pl-k">.</span>exposure <span class="pl-k">=</span> <span class="pl-c1">exposure</span>.(
    ExperienceAnalysis<span class="pl-k">.</span><span class="pl-c1">Anniversary</span>(<span class="pl-c1">Year</span>(<span class="pl-c1">1</span>)),   <span class="pl-c"><span class="pl-c">#</span> The basis for our exposures</span>
    df<span class="pl-k">.</span>issue,                             <span class="pl-c"><span class="pl-c">#</span> The `from` date</span>
    to                                    <span class="pl-c"><span class="pl-c">#</span> the `to` date array we created above</span>
    )</pre></div>
<p>In our dataframe, we actually have a column that contains an array of tuples now, so to expand it so that each exposure period gets a row, we <code>flatten</code> the dataframe:</p>
<div class="highlight highlight-source-julia position-relative" data-snippet-clipboard-copy-content="df = flatten(df,:exposure)
"><pre>df <span class="pl-k">=</span> <span class="pl-c1">flatten</span>(df,<span class="pl-c1">:exposure</span>)</pre></div>
<p>So now we have our exposures:</p>
<div class="highlight highlight-source-julia position-relative" data-snippet-clipboard-copy-content="│ id     │ issue      │ termination │ status  │ exposure                                             │
│ String │ Date       │ Date?       │ String  │ NamedTuple{(:from, :to),Tuple{Date,Date}}            │
┼────────┼────────────┼─────────────┼─────────┼──────────────────────────────────────────────────────┼
│ 1      │ 2016-07-04 │ 2020-01-17  │ Claim   │ (from = Date(&quot;2016-07-04&quot;), to = Date(&quot;2017-07-04&quot;)) │
│ 1      │ 2016-07-04 │ 2020-01-17  │ Claim   │ (from = Date(&quot;2017-07-04&quot;), to = Date(&quot;2018-07-04&quot;)) │
│ 1      │ 2016-07-04 │ 2020-01-17  │ Claim   │ (from = Date(&quot;2018-07-04&quot;), to = Date(&quot;2019-07-04&quot;)) │
│ 1      │ 2016-07-04 │ 2020-01-17  │ Claim   │ (from = Date(&quot;2019-07-04&quot;), to = Date(&quot;2020-01-17&quot;)) │
│ 2      │ 2016-01-01 │ 2018-05-04  │ Lapse   │ (from = Date(&quot;2016-01-01&quot;), to = Date(&quot;2017-01-01&quot;)) │
│ 2      │ 2016-01-01 │ 2018-05-04  │ Lapse   │ (from = Date(&quot;2017-01-01&quot;), to = Date(&quot;2018-01-01&quot;)) │
│ 2      │ 2016-01-01 │ 2018-05-04  │ Lapse   │ (from = Date(&quot;2018-01-01&quot;), to = Date(&quot;2018-05-04&quot;)) │
│ 3      │ 2016-01-01 │ missing     │ Inforce │ (from = Date(&quot;2016-01-01&quot;), to = Date(&quot;2017-01-01&quot;)) │
│ 3      │ 2016-01-01 │ missing     │ Inforce │ (from = Date(&quot;2017-01-01&quot;), to = Date(&quot;2018-01-01&quot;)) │
│ 3      │ 2016-01-01 │ missing     │ Inforce │ (from = Date(&quot;2018-01-01&quot;), to = Date(&quot;2019-01-01&quot;)) │
│ 3      │ 2016-01-01 │ missing     │ Inforce │ (from = Date(&quot;2019-01-01&quot;), to = Date(&quot;2020-01-01&quot;)) │
│ 3      │ 2016-01-01 │ missing     │ Inforce │ (from = Date(&quot;2020-01-01&quot;), to = Date(&quot;2020-12-31&quot;)) │
"><pre>│ id     │ issue      │ termination │ status  │ exposure                                             │
│ String │ Date       │ Date?       │ String  │ NamedTuple{(<span class="pl-c1">:from</span>, <span class="pl-c1">:to</span>),Tuple{Date,Date}}            │
┼────────┼────────────┼─────────────┼─────────┼──────────────────────────────────────────────────────┼
│ <span class="pl-c1">1</span>      │ <span class="pl-c1">2016</span><span class="pl-k">-</span><span class="pl-c1">07</span><span class="pl-k">-</span><span class="pl-c1">04</span> │ <span class="pl-c1">2020</span><span class="pl-k">-</span><span class="pl-c1">01</span><span class="pl-k">-</span><span class="pl-c1">17</span>  │ Claim   │ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2016-07-04<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2017-07-04<span class="pl-pds">"</span></span>)) │
│ <span class="pl-c1">1</span>      │ <span class="pl-c1">2016</span><span class="pl-k">-</span><span class="pl-c1">07</span><span class="pl-k">-</span><span class="pl-c1">04</span> │ <span class="pl-c1">2020</span><span class="pl-k">-</span><span class="pl-c1">01</span><span class="pl-k">-</span><span class="pl-c1">17</span>  │ Claim   │ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2017-07-04<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2018-07-04<span class="pl-pds">"</span></span>)) │
│ <span class="pl-c1">1</span>      │ <span class="pl-c1">2016</span><span class="pl-k">-</span><span class="pl-c1">07</span><span class="pl-k">-</span><span class="pl-c1">04</span> │ <span class="pl-c1">2020</span><span class="pl-k">-</span><span class="pl-c1">01</span><span class="pl-k">-</span><span class="pl-c1">17</span>  │ Claim   │ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2018-07-04<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2019-07-04<span class="pl-pds">"</span></span>)) │
│ <span class="pl-c1">1</span>      │ <span class="pl-c1">2016</span><span class="pl-k">-</span><span class="pl-c1">07</span><span class="pl-k">-</span><span class="pl-c1">04</span> │ <span class="pl-c1">2020</span><span class="pl-k">-</span><span class="pl-c1">01</span><span class="pl-k">-</span><span class="pl-c1">17</span>  │ Claim   │ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2019-07-04<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2020-01-17<span class="pl-pds">"</span></span>)) │
│ <span class="pl-c1">2</span>      │ <span class="pl-c1">2016</span><span class="pl-k">-</span><span class="pl-c1">01</span><span class="pl-k">-</span><span class="pl-c1">01</span> │ <span class="pl-c1">2018</span><span class="pl-k">-</span><span class="pl-c1">05</span><span class="pl-k">-</span><span class="pl-c1">04</span>  │ Lapse   │ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2016-01-01<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2017-01-01<span class="pl-pds">"</span></span>)) │
│ <span class="pl-c1">2</span>      │ <span class="pl-c1">2016</span><span class="pl-k">-</span><span class="pl-c1">01</span><span class="pl-k">-</span><span class="pl-c1">01</span> │ <span class="pl-c1">2018</span><span class="pl-k">-</span><span class="pl-c1">05</span><span class="pl-k">-</span><span class="pl-c1">04</span>  │ Lapse   │ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2017-01-01<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2018-01-01<span class="pl-pds">"</span></span>)) │
│ <span class="pl-c1">2</span>      │ <span class="pl-c1">2016</span><span class="pl-k">-</span><span class="pl-c1">01</span><span class="pl-k">-</span><span class="pl-c1">01</span> │ <span class="pl-c1">2018</span><span class="pl-k">-</span><span class="pl-c1">05</span><span class="pl-k">-</span><span class="pl-c1">04</span>  │ Lapse   │ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2018-01-01<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2018-05-04<span class="pl-pds">"</span></span>)) │
│ <span class="pl-c1">3</span>      │ <span class="pl-c1">2016</span><span class="pl-k">-</span><span class="pl-c1">01</span><span class="pl-k">-</span><span class="pl-c1">01</span> │ <span class="pl-c1">missing</span>     │ Inforce │ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2016-01-01<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2017-01-01<span class="pl-pds">"</span></span>)) │
│ <span class="pl-c1">3</span>      │ <span class="pl-c1">2016</span><span class="pl-k">-</span><span class="pl-c1">01</span><span class="pl-k">-</span><span class="pl-c1">01</span> │ <span class="pl-c1">missing</span>     │ Inforce │ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2017-01-01<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2018-01-01<span class="pl-pds">"</span></span>)) │
│ <span class="pl-c1">3</span>      │ <span class="pl-c1">2016</span><span class="pl-k">-</span><span class="pl-c1">01</span><span class="pl-k">-</span><span class="pl-c1">01</span> │ <span class="pl-c1">missing</span>     │ Inforce │ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2018-01-01<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2019-01-01<span class="pl-pds">"</span></span>)) │
│ <span class="pl-c1">3</span>      │ <span class="pl-c1">2016</span><span class="pl-k">-</span><span class="pl-c1">01</span><span class="pl-k">-</span><span class="pl-c1">01</span> │ <span class="pl-c1">missing</span>     │ Inforce │ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2019-01-01<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2020-01-01<span class="pl-pds">"</span></span>)) │
│ <span class="pl-c1">3</span>      │ <span class="pl-c1">2016</span><span class="pl-k">-</span><span class="pl-c1">01</span><span class="pl-k">-</span><span class="pl-c1">01</span> │ <span class="pl-c1">missing</span>     │ Inforce │ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2020-01-01<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2020-12-31<span class="pl-pds">"</span></span>)) │</pre></div>
<h3><a id="user-content-exposure-fraction" class="anchor" aria-hidden="true" href="#exposure-fraction"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Exposure Fraction</h3>
<p>This can be extended to calculate the decimal fraction of the year under different day count conventions, such as assuming 30/360 or Actual/365, etc. using the <a href="https://github.com/JuliaFinance/DayCounts.jl"><code>DayCounts.jl</code> package</a>.</p>
<div class="highlight highlight-source-julia position-relative" data-snippet-clipboard-copy-content="using DayCounts

df.exposure_fraction = map(e -&gt; yearfrac(e.from,e.to,DayCounts.Actual360()),df.exposure)
"><pre><span class="pl-k">using</span> DayCounts

df<span class="pl-k">.</span>exposure_fraction <span class="pl-k">=</span> <span class="pl-c1">map</span>(e <span class="pl-k">-&gt;</span> <span class="pl-c1">yearfrac</span>(e<span class="pl-k">.</span>from,e<span class="pl-k">.</span>to,DayCounts<span class="pl-k">.</span><span class="pl-c1">Actual360</span>()),df<span class="pl-k">.</span>exposure)</pre></div>
<p>So now we have:</p>
<div class="highlight highlight-source-julia position-relative" data-snippet-clipboard-copy-content="│ exposure                                             │ exposure_fraction │
│ NamedTuple{(:from, :to),Tuple{Date,Date}}            │ Float64           │
┼──────────────────────────────────────────────────────┼───────────────────┤
│ (from = Date(&quot;2016-07-04&quot;), to = Date(&quot;2017-07-04&quot;)) │ 1.01389           │
│ (from = Date(&quot;2017-07-04&quot;), to = Date(&quot;2018-07-04&quot;)) │ 1.01389           │
│ (from = Date(&quot;2018-07-04&quot;), to = Date(&quot;2019-07-04&quot;)) │ 1.01389           │
│ (from = Date(&quot;2019-07-04&quot;), to = Date(&quot;2020-07-04&quot;)) │ 0.54722           │
│ (from = Date(&quot;2016-01-01&quot;), to = Date(&quot;2017-01-01&quot;)) │ 1.01667           │
│ (from = Date(&quot;2017-01-01&quot;), to = Date(&quot;2018-01-01&quot;)) │ 1.01389           │
│ (from = Date(&quot;2018-01-01&quot;), to = Date(&quot;2018-05-04&quot;)) │ 0.34167           │
│ (from = Date(&quot;2016-01-01&quot;), to = Date(&quot;2017-01-01&quot;)) │ 1.01667           │
│ (from = Date(&quot;2017-01-01&quot;), to = Date(&quot;2018-01-01&quot;)) │ 1.01389           │
│ (from = Date(&quot;2018-01-01&quot;), to = Date(&quot;2019-01-01&quot;)) │ 1.01389           │
│ (from = Date(&quot;2019-01-01&quot;), to = Date(&quot;2020-01-01&quot;)) │ 1.01389           │
│ (from = Date(&quot;2020-01-01&quot;), to = Date(&quot;2020-12-31&quot;)) │ 1.01389           │
"><pre>│ exposure                                             │ exposure_fraction │
│ NamedTuple{(<span class="pl-c1">:from</span>, <span class="pl-c1">:to</span>),Tuple{Date,Date}}            │ Float64           │
┼──────────────────────────────────────────────────────┼───────────────────┤
│ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2016-07-04<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2017-07-04<span class="pl-pds">"</span></span>)) │ <span class="pl-c1">1.01389</span>           │
│ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2017-07-04<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2018-07-04<span class="pl-pds">"</span></span>)) │ <span class="pl-c1">1.01389</span>           │
│ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2018-07-04<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2019-07-04<span class="pl-pds">"</span></span>)) │ <span class="pl-c1">1.01389</span>           │
│ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2019-07-04<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2020-07-04<span class="pl-pds">"</span></span>)) │ <span class="pl-c1">0.54722</span>           │
│ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2016-01-01<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2017-01-01<span class="pl-pds">"</span></span>)) │ <span class="pl-c1">1.01667</span>           │
│ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2017-01-01<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2018-01-01<span class="pl-pds">"</span></span>)) │ <span class="pl-c1">1.01389</span>           │
│ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2018-01-01<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2018-05-04<span class="pl-pds">"</span></span>)) │ <span class="pl-c1">0.34167</span>           │
│ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2016-01-01<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2017-01-01<span class="pl-pds">"</span></span>)) │ <span class="pl-c1">1.01667</span>           │
│ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2017-01-01<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2018-01-01<span class="pl-pds">"</span></span>)) │ <span class="pl-c1">1.01389</span>           │
│ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2018-01-01<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2019-01-01<span class="pl-pds">"</span></span>)) │ <span class="pl-c1">1.01389</span>           │
│ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2019-01-01<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2020-01-01<span class="pl-pds">"</span></span>)) │ <span class="pl-c1">1.01389</span>           │
│ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2020-01-01<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2020-12-31<span class="pl-pds">"</span></span>)) │ <span class="pl-c1">1.01389</span>           │</pre></div>
<h3><a id="user-content-continued-exposure" class="anchor" aria-hidden="true" href="#continued-exposure"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Continued Exposure</h3>
<p>To get the proper exposure for the termination type under consideration, <code>exposure</code> takes an optional fourth argument which will continue the exposure until the end of what would be the period notwithstanding the termination.</p>
<p>Extending the above analysis, we want a full exposure period for any <code>"Claim"</code> in this case:</p>
<div class="highlight highlight-source-julia position-relative" data-snippet-clipboard-copy-content="continue_exposure = df.status .== &quot;Claim&quot;

df.exposure = exposure.(
    ExperienceAnalysis.Anniversary(Year(1)),   # The basis for our exposures
    df.issue,                             # The `from` date
    to,                                   # the `to` date array we created above
    continue_exposure                     # full exposure or not (true/false)
    )
"><pre>continue_exposure <span class="pl-k">=</span> df<span class="pl-k">.</span>status <span class="pl-k">.==</span> <span class="pl-s"><span class="pl-pds">"</span>Claim<span class="pl-pds">"</span></span>

df<span class="pl-k">.</span>exposure <span class="pl-k">=</span> <span class="pl-c1">exposure</span>.(
    ExperienceAnalysis<span class="pl-k">.</span><span class="pl-c1">Anniversary</span>(<span class="pl-c1">Year</span>(<span class="pl-c1">1</span>)),   <span class="pl-c"><span class="pl-c">#</span> The basis for our exposures</span>
    df<span class="pl-k">.</span>issue,                             <span class="pl-c"><span class="pl-c">#</span> The `from` date</span>
    to,                                   <span class="pl-c"><span class="pl-c">#</span> the `to` date array we created above</span>
    continue_exposure                     <span class="pl-c"><span class="pl-c">#</span> full exposure or not (true/false)</span>
    )</pre></div>
<p>And then the exposures look like the following. Note the difference in the fourth row:</p>
<div class="highlight highlight-source-julia position-relative" data-snippet-clipboard-copy-content="│ exposure                                             │ exposure_fraction │
│ NamedTuple{(:from, :to),Tuple{Date,Date}}            │ Float64           │
┼──────────────────────────────────────────────────────┼───────────────────┤
│ (from = Date(&quot;2016-07-04&quot;), to = Date(&quot;2017-07-04&quot;)) │ 1.01389           │
│ (from = Date(&quot;2017-07-04&quot;), to = Date(&quot;2018-07-04&quot;)) │ 1.01389           │
│ (from = Date(&quot;2018-07-04&quot;), to = Date(&quot;2019-07-04&quot;)) │ 1.01389           │
│ (from = Date(&quot;2019-07-04&quot;), to = Date(&quot;2020-07-04&quot;)) │ 1.01667           │
│ (from = Date(&quot;2016-01-01&quot;), to = Date(&quot;2017-01-01&quot;)) │ 1.01667           │
│ (from = Date(&quot;2017-01-01&quot;), to = Date(&quot;2018-01-01&quot;)) │ 1.01389           │
│ (from = Date(&quot;2018-01-01&quot;), to = Date(&quot;2018-05-04&quot;)) │ 0.341667          │
│ (from = Date(&quot;2016-01-01&quot;), to = Date(&quot;2017-01-01&quot;)) │ 1.01667           │
│ (from = Date(&quot;2017-01-01&quot;), to = Date(&quot;2018-01-01&quot;)) │ 1.01389           │
│ (from = Date(&quot;2018-01-01&quot;), to = Date(&quot;2019-01-01&quot;)) │ 1.01389           │
│ (from = Date(&quot;2019-01-01&quot;), to = Date(&quot;2020-01-01&quot;)) │ 1.01389           │
│ (from = Date(&quot;2020-01-01&quot;), to = Date(&quot;2020-12-31&quot;)) │ 1.01389           │
"><pre>│ exposure                                             │ exposure_fraction │
│ NamedTuple{(<span class="pl-c1">:from</span>, <span class="pl-c1">:to</span>),Tuple{Date,Date}}            │ Float64           │
┼──────────────────────────────────────────────────────┼───────────────────┤
│ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2016-07-04<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2017-07-04<span class="pl-pds">"</span></span>)) │ <span class="pl-c1">1.01389</span>           │
│ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2017-07-04<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2018-07-04<span class="pl-pds">"</span></span>)) │ <span class="pl-c1">1.01389</span>           │
│ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2018-07-04<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2019-07-04<span class="pl-pds">"</span></span>)) │ <span class="pl-c1">1.01389</span>           │
│ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2019-07-04<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2020-07-04<span class="pl-pds">"</span></span>)) │ <span class="pl-c1">1.01667</span>           │
│ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2016-01-01<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2017-01-01<span class="pl-pds">"</span></span>)) │ <span class="pl-c1">1.01667</span>           │
│ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2017-01-01<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2018-01-01<span class="pl-pds">"</span></span>)) │ <span class="pl-c1">1.01389</span>           │
│ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2018-01-01<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2018-05-04<span class="pl-pds">"</span></span>)) │ <span class="pl-c1">0.341667</span>          │
│ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2016-01-01<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2017-01-01<span class="pl-pds">"</span></span>)) │ <span class="pl-c1">1.01667</span>           │
│ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2017-01-01<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2018-01-01<span class="pl-pds">"</span></span>)) │ <span class="pl-c1">1.01389</span>           │
│ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2018-01-01<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2019-01-01<span class="pl-pds">"</span></span>)) │ <span class="pl-c1">1.01389</span>           │
│ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2019-01-01<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2020-01-01<span class="pl-pds">"</span></span>)) │ <span class="pl-c1">1.01389</span>           │
│ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2020-01-01<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2020-12-31<span class="pl-pds">"</span></span>)) │ <span class="pl-c1">1.01389</span>           │</pre></div>
<h3><a id="user-content-study-endstart-dates" class="anchor" aria-hidden="true" href="#study-endstart-dates"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Study End/Start dates</h3>
<p>The examples above already incorporated the study end date. However, the study start date must be truncated as a post-processing step. This is because the <code>to</code> argument to the <code>exposure(...)</code> function defines the anchor point for the policy anniversary iteration. If the <code>to</code> was the study start date, then the anniversaries would follow that calendar date.</p>
<p>To truncate the exposures, you would need to drop/update exposures. Continuing the example above:</p>
<div class="highlight highlight-source-julia position-relative" data-snippet-clipboard-copy-content="study_start = Date(2017,1,1)

# drop rows where the whole expsoure is before the study_start
df_truncated = filter(row -&gt; row.exposure.to &gt;= study_start,df)

# update the `from` where remaining exposures start before the study_start
df_truncated.exposure = map(e -&gt; (from = max(study_start,e.from),to = e.to), df_truncated.exposure)
"><pre>study_start <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-c1">2017</span>,<span class="pl-c1">1</span>,<span class="pl-c1">1</span>)

<span class="pl-c"><span class="pl-c">#</span> drop rows where the whole expsoure is before the study_start</span>
df_truncated <span class="pl-k">=</span> <span class="pl-c1">filter</span>(row <span class="pl-k">-&gt;</span> row<span class="pl-k">.</span>exposure<span class="pl-k">.</span>to <span class="pl-k">&gt;=</span> study_start,df)

<span class="pl-c"><span class="pl-c">#</span> update the `from` where remaining exposures start before the study_start</span>
df_truncated<span class="pl-k">.</span>exposure <span class="pl-k">=</span> <span class="pl-c1">map</span>(e <span class="pl-k">-&gt;</span> (from <span class="pl-k">=</span> <span class="pl-c1">max</span>(study_start,e<span class="pl-k">.</span>from),to <span class="pl-k">=</span> e<span class="pl-k">.</span>to), df_truncated<span class="pl-k">.</span>exposure)</pre></div>
<p>And then <code>df_truncated</code> contains:</p>
<div class="highlight highlight-source-julia position-relative" data-snippet-clipboard-copy-content="│ exposure                                             │
│ NamedTuple{(:from, :to),Tuple{Date,Date}}            │
┼──────────────────────────────────────────────────────┼
│ (from = Date(&quot;2017-01-01&quot;), to = Date(&quot;2017-07-04&quot;)) │
│ (from = Date(&quot;2017-07-04&quot;), to = Date(&quot;2018-07-04&quot;)) │
│ (from = Date(&quot;2018-07-04&quot;), to = Date(&quot;2019-07-04&quot;)) │
│ (from = Date(&quot;2019-07-04&quot;), to = Date(&quot;2020-07-04&quot;)) │
│ (from = Date(&quot;2017-01-01&quot;), to = Date(&quot;2017-01-01&quot;)) │
│ (from = Date(&quot;2017-01-01&quot;), to = Date(&quot;2018-01-01&quot;)) │
│ (from = Date(&quot;2018-01-01&quot;), to = Date(&quot;2018-05-04&quot;)) │
│ (from = Date(&quot;2017-01-01&quot;), to = Date(&quot;2017-01-01&quot;)) │
│ (from = Date(&quot;2017-01-01&quot;), to = Date(&quot;2018-01-01&quot;)) │
│ (from = Date(&quot;2018-01-01&quot;), to = Date(&quot;2019-01-01&quot;)) │
│ (from = Date(&quot;2019-01-01&quot;), to = Date(&quot;2020-01-01&quot;)) │
│ (from = Date(&quot;2020-01-01&quot;), to = Date(&quot;2020-12-31&quot;)) │
"><pre>│ exposure                                             │
│ NamedTuple{(<span class="pl-c1">:from</span>, <span class="pl-c1">:to</span>),Tuple{Date,Date}}            │
┼──────────────────────────────────────────────────────┼
│ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2017-01-01<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2017-07-04<span class="pl-pds">"</span></span>)) │
│ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2017-07-04<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2018-07-04<span class="pl-pds">"</span></span>)) │
│ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2018-07-04<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2019-07-04<span class="pl-pds">"</span></span>)) │
│ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2019-07-04<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2020-07-04<span class="pl-pds">"</span></span>)) │
│ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2017-01-01<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2017-01-01<span class="pl-pds">"</span></span>)) │
│ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2017-01-01<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2018-01-01<span class="pl-pds">"</span></span>)) │
│ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2018-01-01<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2018-05-04<span class="pl-pds">"</span></span>)) │
│ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2017-01-01<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2017-01-01<span class="pl-pds">"</span></span>)) │
│ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2017-01-01<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2018-01-01<span class="pl-pds">"</span></span>)) │
│ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2018-01-01<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2019-01-01<span class="pl-pds">"</span></span>)) │
│ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2019-01-01<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2020-01-01<span class="pl-pds">"</span></span>)) │
│ (from <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2020-01-01<span class="pl-pds">"</span></span>), to <span class="pl-k">=</span> <span class="pl-c1">Date</span>(<span class="pl-s"><span class="pl-pds">"</span>2020-12-31<span class="pl-pds">"</span></span>)) │</pre></div>
<p>Last item to note is that you need to recalculate the <code>exposure_fraction</code> as it currently reflects the pre-truncated values. When actually building a process, you could truncate before calculating the fraction to begin with.</p>
<h2><a id="user-content-discussion-and-questions" class="anchor" aria-hidden="true" href="#discussion-and-questions"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Discussion and Questions</h2>
<p>If you have other ideas or questions, feel free to also open an issue, or discuss on the community <a href="https://julialang.zulipchat.com/#narrow/stream/249536-actuary" rel="nofollow">Zulip</a> or <a href="https://slackinvite.julialang.org/" rel="nofollow">Slack #actuary channel</a>. We welcome all actuarial and related disciplines!</p>
<h2><a id="user-content-endnotes" class="anchor" aria-hidden="true" href="#endnotes"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Endnotes</h2>
<h3><a id="user-content-references" class="anchor" aria-hidden="true" href="#references"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>References</h3>
<ul>
<li><a href="https://www.soa.org/globalassets/assets/files/research/experience-study-calculations.pdf" rel="nofollow">Experience Study Calculations</a> by the Society of Actuaries</li>
</ul>
<h3><a id="user-content-related-packages" class="anchor" aria-hidden="true" href="#related-packages"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Related Packages</h3>
<ul>
<li><a href="https://github.com/MatthewCaseres/expstudies">expstudies</a>, an R package</li>
</ul>
</article></div>