<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><h1 dir="auto"><a id="user-content-p4estjl" class="anchor" aria-hidden="true" href="#p4estjl"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>P4est.jl</h1>
<p dir="auto"><a href="https://trixi-framework.github.io/P4est.jl/stable" rel="nofollow"><img src="https://camo.githubusercontent.com/c97f0a5f2ae95755f64a27f1aa8d9a17462941fd3d6c907c7630abd5d3e60acf/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f646f63732d737461626c652d626c75652e737667" alt="Docs-stable" data-canonical-src="https://img.shields.io/badge/docs-stable-blue.svg" style="max-width: 100%;"></a>
<a href="https://github.com/trixi-framework/P4est.jl/actions?query=workflow%3ACI"><img src="https://github.com/trixi-framework/P4est.jl/workflows/CI/badge.svg" alt="Build Status" style="max-width: 100%;"></a>
<a href="https://codecov.io/gh/trixi-framework/P4est.jl" rel="nofollow"><img src="https://camo.githubusercontent.com/06317279716ab420787f4e7036f61d331d98e0fd840f081983b7417bff76acc7/68747470733a2f2f636f6465636f762e696f2f67682f74726978692d6672616d65776f726b2f50346573742e6a6c2f6272616e63682f6d61696e2f67726170682f62616467652e737667" alt="Codecov" data-canonical-src="https://codecov.io/gh/trixi-framework/P4est.jl/branch/main/graph/badge.svg" style="max-width: 100%;"></a>
<a href="https://coveralls.io/github/trixi-framework/P4est.jl?branch=main" rel="nofollow"><img src="https://camo.githubusercontent.com/b50cfb62694854252b196935c2e2fec693ab0157c6141741a8a0e70a39adb02b/68747470733a2f2f636f766572616c6c732e696f2f7265706f732f6769746875622f74726978692d6672616d65776f726b2f50346573742e6a6c2f62616467652e7376673f6272616e63683d6d61696e" alt="Coveralls" data-canonical-src="https://coveralls.io/repos/github/trixi-framework/P4est.jl/badge.svg?branch=main" style="max-width: 100%;"></a>
<a href="https://opensource.org/licenses/MIT" rel="nofollow"><img src="https://camo.githubusercontent.com/2da4b47047416995ad40532496f4b028e9aeca4a9ad036ed17bee5d2fb753b32/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4c6963656e73652d4d49542d737563636573732e737667" alt="License: MIT" data-canonical-src="https://img.shields.io/badge/License-MIT-success.svg" style="max-width: 100%;"></a></p>
<p dir="auto"><a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a> is a Julia package
that wraps <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a>, a C library to manage
multiple connected adaptive quadtrees or octrees in parallel.</p>
<p dir="auto"><a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a> mainly provides low-level
wrappers of functionality from <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a>.
The Julia package <a href="https://github.com/lcw/P4estTypes.jl">P4estTypes.jl</a> builds
on top of <a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a> and provides a
high-level interface.</p>
<h2 dir="auto"><a id="user-content-installation" class="anchor" aria-hidden="true" href="#installation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Installation</h2>
<p dir="auto">If you have not yet installed Julia, please <a href="https://julialang.org/downloads/platform/" rel="nofollow">follow the instructions for your
operating system</a>.
<a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a> works with Julia v1.6
and later.</p>
<p dir="auto"><a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a> is a registered Julia
package. Hence, you can install it by executing the following commands in the
Julia REPL:</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="julia&gt; import Pkg; Pkg.add([&quot;P4est&quot;, &quot;MPI&quot;])"><pre>julia<span class="pl-k">&gt;</span> <span class="pl-k">import</span> Pkg; Pkg<span class="pl-k">.</span><span class="pl-c1">add</span>([<span class="pl-s"><span class="pl-pds">"</span>P4est<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>MPI<span class="pl-pds">"</span></span>])</pre></div>
<p dir="auto">With this command, you install both
<a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a> and
<a href="https://github.com/JuliaParallel/MPI.jl">MPI.jl</a>.
Currently, <a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a> supports
only builds of the C library <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a>
with MPI support, so you need to initialize MPI appropriately as described
in the <a href="#usage">Usage</a> section below.</p>
<p dir="auto"><a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a> depends on the binary
distribution of the <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> library,
which is available in the Julia package P4est_jll.jl and which is automatically
installed as a dependency. The binaries provided by P4est_jll.jl support MPI
and are compiled against the default MPI binaries of MPI.jl. At the time of
writing, these are the binaries provided by MicrosoftMPI_jll.jl on Windows and
MPICH_jll.jl on all other platforms.</p>
<p dir="auto">By default, <a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a> provides
pre-generated Julia bindings to all exported C functions of the underlying
<a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> library. If you want/need to
generate new bindings, please follow the instructions in the <code>dev</code> folder and
copy the generated files to the appropriate places in <code>src</code>.</p>
<h3 dir="auto"><a id="user-content-using-a-custom-version-of-mpi-andor-p4est" class="anchor" aria-hidden="true" href="#using-a-custom-version-of-mpi-andor-p4est"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Using a custom version of MPI and/or <code>p4est</code></h3>
<p dir="auto">The C library <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> needs to be
compiled against the same MPI implementation used by
<a href="https://github.com/JuliaParallel/MPI.jl">MPI.jl</a>. Thus, if you want to
configure <a href="https://github.com/JuliaParallel/MPI.jl">MPI.jl</a> to not use the
default MPI binary provided by JLL wrappers, you also need to build the C
library <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> locally using the same
MPI implementation. This is typically the situation on HPC clusters. If you
are just using a single workstation, the default installation instructions
should be sufficient.</p>
<p dir="auto"><a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a> allows using a
<a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> binary different from the default
one provided by P4est_jll.jl.
To enable this, you first need to obtain a local binary installation of
<a href="https://github.com/cburstedde/p4est"><code>p4est</code></a>. Next, you need to configure
<a href="https://github.com/JuliaParallel/MPI.jl">MPI.jl</a> to use the same MPI
implementation used to build your local installation of
<a href="https://github.com/cburstedde/p4est"><code>p4est</code></a>, see
<a href="https://juliaparallel.org/MPI.jl/stable/configuration/" rel="nofollow">the documentation of MPI.jl</a>.
At the time of writing, this can be done via</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="julia&gt; using MPIPreferences

julia&gt; MPIPreferences.use_system_binary()"><pre>julia<span class="pl-k">&gt;</span> <span class="pl-k">using</span> MPIPreferences

julia<span class="pl-k">&gt;</span> MPIPreferences<span class="pl-k">.</span><span class="pl-c1">use_system_binary</span>()</pre></div>
<p dir="auto">if you use the default system MPI binary installation to build
<a href="https://github.com/cburstedde/p4est"><code>p4est</code></a>.</p>
<p dir="auto">Next, you need to set up the
<a href="https://github.com/JuliaPackaging/Preferences.jl">Preferences.jl</a>
setting containing the path to your local build of the shared library of
<a href="https://github.com/cburstedde/p4est"><code>p4est</code></a>.</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="julia&gt; using Preferences, UUIDs

julia&gt; set_preferences!(
           UUID(&quot;7d669430-f675-4ae7-b43e-fab78ec5a902&quot;), # UUID of P4est.jl
           &quot;libp4est&quot; =&gt; &quot;/path/to/your/libp4est.so&quot;, force = true)"><pre>julia<span class="pl-k">&gt;</span> <span class="pl-k">using</span> Preferences, UUIDs

julia<span class="pl-k">&gt;</span> <span class="pl-c1">set_preferences!</span>(
           <span class="pl-c1">UUID</span>(<span class="pl-s"><span class="pl-pds">"</span>7d669430-f675-4ae7-b43e-fab78ec5a902<span class="pl-pds">"</span></span>), <span class="pl-c"><span class="pl-c">#</span> UUID of P4est.jl</span>
           <span class="pl-s"><span class="pl-pds">"</span>libp4est<span class="pl-pds">"</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>/path/to/your/libp4est.so<span class="pl-pds">"</span></span>, force <span class="pl-k">=</span> <span class="pl-c1">true</span>)</pre></div>
<p dir="auto">On Windows you also need to set the path to the local build of the shared library
of <a href="https://github.com/cburstedde/libsc/tree/master"><code>libsc</code></a>, which is a subpackage
of <code>p4est</code>. On other systems, this is not necessary as the library is already linked
by <code>libp4est.so</code>, but it can be used to employ also a custom build of <code>libsc</code>.</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="julia&gt; set_preferences!(
           UUID(&quot;7d669430-f675-4ae7-b43e-fab78ec5a902&quot;), # UUID of P4est.jl
           &quot;libsc&quot; =&gt; &quot;/path/to/your/libsc.so&quot;, force = true)"><pre>julia<span class="pl-k">&gt;</span> <span class="pl-c1">set_preferences!</span>(
           <span class="pl-c1">UUID</span>(<span class="pl-s"><span class="pl-pds">"</span>7d669430-f675-4ae7-b43e-fab78ec5a902<span class="pl-pds">"</span></span>), <span class="pl-c"><span class="pl-c">#</span> UUID of P4est.jl</span>
           <span class="pl-s"><span class="pl-pds">"</span>libsc<span class="pl-pds">"</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>/path/to/your/libsc.so<span class="pl-pds">"</span></span>, force <span class="pl-k">=</span> <span class="pl-c1">true</span>)</pre></div>
<p dir="auto">Note that you should restart your Julia session after changing the preferences.
To sum up, follow these steps to use
<a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a> with a custom
installation of the underlying C libraries.</p>
<ul dir="auto">
<li>Create a Julia project for your setup.
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="julia&gt; import Pkg; Pkg.activate(&quot;.&quot;)"><pre>julia<span class="pl-k">&gt;</span> <span class="pl-k">import</span> Pkg; Pkg<span class="pl-k">.</span><span class="pl-c1">activate</span>(<span class="pl-s"><span class="pl-pds">"</span>.<span class="pl-pds">"</span></span>)</pre></div>
This uses the Julia project in your current working directory or creates a
new one if there is none.</li>
<li>Install the required packages.
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="julia&gt; Pkg.add([&quot;MPIPreferences&quot;, &quot;MPI&quot;, &quot;UUIDs&quot;, &quot;Preferences&quot;, &quot;P4est&quot;])"><pre>julia<span class="pl-k">&gt;</span> Pkg<span class="pl-k">.</span><span class="pl-c1">add</span>([<span class="pl-s"><span class="pl-pds">"</span>MPIPreferences<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>MPI<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>UUIDs<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Preferences<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>P4est<span class="pl-pds">"</span></span>])</pre></div>
</li>
<li>Set <a href="https://github.com/JuliaParallel/MPI.jl">MPI.jl</a> preferences.
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="julia&gt; using MPIPreferences

julia&gt; MPIPreferences.use_system_binary()"><pre>julia<span class="pl-k">&gt;</span> <span class="pl-k">using</span> MPIPreferences

julia<span class="pl-k">&gt;</span> MPIPreferences<span class="pl-k">.</span><span class="pl-c1">use_system_binary</span>()</pre></div>
</li>
<li>Set <a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a> preferences.
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="julia&gt; using Preferences, UUIDs

julia&gt; set_preferences!(
           UUID(&quot;7d669430-f675-4ae7-b43e-fab78ec5a902&quot;), # UUID of P4est.jl
           &quot;libp4est&quot; =&gt; &quot;/path/to/your/libp4est.so&quot;, force = true)

julia&gt; set_preferences!(
           UUID(&quot;7d669430-f675-4ae7-b43e-fab78ec5a902&quot;), # UUID of P4est.jl
           &quot;libsc&quot; =&gt; &quot;/path/to/your/libsc.so&quot;, force = true)"><pre>julia<span class="pl-k">&gt;</span> <span class="pl-k">using</span> Preferences, UUIDs

julia<span class="pl-k">&gt;</span> <span class="pl-c1">set_preferences!</span>(
           <span class="pl-c1">UUID</span>(<span class="pl-s"><span class="pl-pds">"</span>7d669430-f675-4ae7-b43e-fab78ec5a902<span class="pl-pds">"</span></span>), <span class="pl-c"><span class="pl-c">#</span> UUID of P4est.jl</span>
           <span class="pl-s"><span class="pl-pds">"</span>libp4est<span class="pl-pds">"</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>/path/to/your/libp4est.so<span class="pl-pds">"</span></span>, force <span class="pl-k">=</span> <span class="pl-c1">true</span>)

julia<span class="pl-k">&gt;</span> <span class="pl-c1">set_preferences!</span>(
           <span class="pl-c1">UUID</span>(<span class="pl-s"><span class="pl-pds">"</span>7d669430-f675-4ae7-b43e-fab78ec5a902<span class="pl-pds">"</span></span>), <span class="pl-c"><span class="pl-c">#</span> UUID of P4est.jl</span>
           <span class="pl-s"><span class="pl-pds">"</span>libsc<span class="pl-pds">"</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>/path/to/your/libsc.so<span class="pl-pds">"</span></span>, force <span class="pl-k">=</span> <span class="pl-c1">true</span>)</pre></div>
</li>
<li>Restart the Julia REPL and load the packages.
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="julia&gt; import Pkg; Pkg.activate(&quot;.&quot;)

julia&gt; using P4est, MPI; MPI.Init()"><pre>julia<span class="pl-k">&gt;</span> <span class="pl-k">import</span> Pkg; Pkg<span class="pl-k">.</span><span class="pl-c1">activate</span>(<span class="pl-s"><span class="pl-pds">"</span>.<span class="pl-pds">"</span></span>)

julia<span class="pl-k">&gt;</span> <span class="pl-k">using</span> P4est, MPI; MPI<span class="pl-k">.</span><span class="pl-c1">Init</span>()</pre></div>
</li>
</ul>
<p dir="auto">Currently, custom builds of <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a>
without MPI support are not supported.</p>
<h2 dir="auto"><a id="user-content-usage" class="anchor" aria-hidden="true" href="#usage"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Usage</h2>
<p dir="auto">The <code>P4est.uses_mpi()</code> function can be used to check if the
<a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> binaries that
<a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a> uses were compiled with
MPI enabled. This returns <code>true</code> for the default binaries provided by the
P4est_jll.jl package. In this case
<a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a> can be used as follows.</p>
<p dir="auto">In the Julia REPL, first load the packages
<a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a> and
<a href="https://github.com/JuliaParallel/MPI.jl">MPI.jl</a> in any order and
initialize MPI.</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="julia&gt; using P4est, MPI; MPI.Init()"><pre>julia<span class="pl-k">&gt;</span> <span class="pl-k">using</span> P4est, MPI; MPI<span class="pl-k">.</span><span class="pl-c1">Init</span>()</pre></div>
<p dir="auto">You can then access the full <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> API
that is defined by the headers. For example, to create a periodic connectivity
and check its validity, execute the following lines:</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="julia&gt; using P4est, MPI; MPI.Init()

julia&gt; connectivity = p4est_connectivity_new_periodic()
Ptr{p4est_connectivity} @0x0000000002412d20

julia&gt; p4est_connectivity_is_valid(connectivity)
1

julia&gt; p4est = p4est_new_ext(MPI.COMM_WORLD, connectivity, 0, 2, 0, 0, C_NULL, C_NULL)
Into p4est_new with min quadrants 0 level 2 uniform 0
New p4est with 1 trees on 1 processors
Initial level 2 potential global quadrants 16 per tree 16
Done p4est_new with 10 total quadrants
Ptr{p4est} @0x0000000002dd1fd0

julia&gt; p4est_obj = unsafe_load(p4est)
P4est.LibP4est.p4est(1140850688, 1, 0, 0, 0x0000000000000000, Ptr{Nothing} @0x0000000000000000, 0, 0, 0, 10, 10, Ptr{Int64} @0x00000000021a5f70, Ptr{p4est_quadrant} @0x0000000002274330, Ptr{p4est_connectivity} @0x000000000255cdf0, Ptr{sc_array} @0x00000000023b64a0, Ptr{sc_mempool} @0x0000000000000000, Ptr{sc_mempool} @0x00000000023b1620, Ptr{p4est_inspect} @0x0000000000000000)

julia&gt; p4est_obj.connectivity == connectivity
true

julia&gt; connectivity_obj = unsafe_load(p4est_obj.connectivity)
p4est_connectivity(4, 1, 1, Ptr{Float64} @0x00000000021e8170, Ptr{Int32} @0x00000000020d2450, 0x0000000000000000, Cstring(0x0000000000000000), Ptr{Int32} @0x0000000002468e10, Ptr{Int8} @0x00000000022035e0, Ptr{Int32} @0x0000000002667230, Ptr{Int32} @0x000000000219eea0, Ptr{Int32} @0x000000000279ae00, Ptr{Int8} @0x00000000021ff910)

julia&gt; connectivity_obj.num_trees
1

julia&gt; p4est_destroy(p4est)

julia&gt; p4est_connectivity_destroy(connectivity)"><pre>julia<span class="pl-k">&gt;</span> <span class="pl-k">using</span> P4est, MPI; MPI<span class="pl-k">.</span><span class="pl-c1">Init</span>()

julia<span class="pl-k">&gt;</span> connectivity <span class="pl-k">=</span> <span class="pl-c1">p4est_connectivity_new_periodic</span>()
Ptr{p4est_connectivity} @<span class="pl-c1">0x0000000002412d20</span>

julia<span class="pl-k">&gt;</span> <span class="pl-c1">p4est_connectivity_is_valid</span>(connectivity)
<span class="pl-c1">1</span>

julia<span class="pl-k">&gt;</span> p4est <span class="pl-k">=</span> <span class="pl-c1">p4est_new_ext</span>(MPI<span class="pl-k">.</span>COMM_WORLD, connectivity, <span class="pl-c1">0</span>, <span class="pl-c1">2</span>, <span class="pl-c1">0</span>, <span class="pl-c1">0</span>, <span class="pl-c1">C_NULL</span>, <span class="pl-c1">C_NULL</span>)
Into p4est_new with min quadrants <span class="pl-c1">0</span> level <span class="pl-c1">2</span> uniform <span class="pl-c1">0</span>
New p4est with <span class="pl-c1">1</span> trees on <span class="pl-c1">1</span> processors
Initial level <span class="pl-c1">2</span> potential <span class="pl-k">global</span> quadrants <span class="pl-c1">16</span> per tree <span class="pl-c1">16</span>
Done p4est_new with <span class="pl-c1">10</span> total quadrants
Ptr{p4est} @<span class="pl-c1">0x0000000002dd1fd0</span>

julia<span class="pl-k">&gt;</span> p4est_obj <span class="pl-k">=</span> <span class="pl-c1">unsafe_load</span>(p4est)
P4est<span class="pl-k">.</span>LibP4est<span class="pl-k">.</span><span class="pl-c1">p4est</span>(<span class="pl-c1">1140850688</span>, <span class="pl-c1">1</span>, <span class="pl-c1">0</span>, <span class="pl-c1">0</span>, <span class="pl-c1">0x0000000000000000</span>, Ptr{Nothing} @<span class="pl-c1">0x0000000000000000</span>, <span class="pl-c1">0</span>, <span class="pl-c1">0</span>, <span class="pl-c1">0</span>, <span class="pl-c1">10</span>, <span class="pl-c1">10</span>, Ptr{Int64} @<span class="pl-c1">0x00000000021a5f70</span>, Ptr{p4est_quadrant} @<span class="pl-c1">0x0000000002274330</span>, Ptr{p4est_connectivity} @<span class="pl-c1">0x000000000255cdf0</span>, Ptr{sc_array} @<span class="pl-c1">0x00000000023b64a0</span>, Ptr{sc_mempool} @<span class="pl-c1">0x0000000000000000</span>, Ptr{sc_mempool} @<span class="pl-c1">0x00000000023b1620</span>, Ptr{p4est_inspect} @<span class="pl-c1">0x0000000000000000</span>)

julia<span class="pl-k">&gt;</span> p4est_obj<span class="pl-k">.</span>connectivity <span class="pl-k">==</span> connectivity
<span class="pl-c1">true</span>

julia<span class="pl-k">&gt;</span> connectivity_obj <span class="pl-k">=</span> <span class="pl-c1">unsafe_load</span>(p4est_obj<span class="pl-k">.</span>connectivity)
<span class="pl-c1">p4est_connectivity</span>(<span class="pl-c1">4</span>, <span class="pl-c1">1</span>, <span class="pl-c1">1</span>, Ptr{Float64} @<span class="pl-c1">0x00000000021e8170</span>, Ptr{Int32} @<span class="pl-c1">0x00000000020d2450</span>, <span class="pl-c1">0x0000000000000000</span>, <span class="pl-c1">Cstring</span>(<span class="pl-c1">0x0000000000000000</span>), Ptr{Int32} @<span class="pl-c1">0x0000000002468e10</span>, Ptr{Int8} @<span class="pl-c1">0x00000000022035e0</span>, Ptr{Int32} @<span class="pl-c1">0x0000000002667230</span>, Ptr{Int32} @<span class="pl-c1">0x000000000219eea0</span>, Ptr{Int32} @<span class="pl-c1">0x000000000279ae00</span>, Ptr{Int8} @<span class="pl-c1">0x00000000021ff910</span>)

julia<span class="pl-k">&gt;</span> connectivity_obj<span class="pl-k">.</span>num_trees
<span class="pl-c1">1</span>

julia<span class="pl-k">&gt;</span> <span class="pl-c1">p4est_destroy</span>(p4est)

julia<span class="pl-k">&gt;</span> <span class="pl-c1">p4est_connectivity_destroy</span>(connectivity)</pre></div>
<p dir="auto">As shown here, <code>unsafe_load</code> allows to convert pointers to
<a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> C <code>struct</code>s to the corresponding
Julia wrapper type generated by
<a href="https://github.com/JuliaInterop/Clang.jl">Clang.jl</a>. They follow the basic
<a href="https://docs.julialang.org/en/v1/manual/calling-c-and-fortran-code/" rel="nofollow">C interface of Julia</a>.</p>
<p dir="auto">If you start Julia on multiple MPI ranks, you can check whether everything is
set up correctly by the following extended smoke test. Copy the following
code to a local file:</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="using P4est, MPI; MPI.Init()
connectivity = p4est_connectivity_new_periodic()
p4est = p4est_new_ext(MPI.COMM_WORLD, connectivity, 0, 2, 0, 0, C_NULL, C_NULL)
p4est_obj = unsafe_load(p4est)
MPI.Barrier(MPI.COMM_WORLD)
rank = MPI.Comm_rank(MPI.COMM_WORLD)
@info &quot;Setup&quot; rank p4est_obj.local_num_quadrants p4est_obj.global_num_quadrants
p4est_destroy(p4est)
p4est_connectivity_destroy(connectivity)"><pre><span class="pl-k">using</span> P4est, MPI; MPI<span class="pl-k">.</span><span class="pl-c1">Init</span>()
connectivity <span class="pl-k">=</span> <span class="pl-c1">p4est_connectivity_new_periodic</span>()
p4est <span class="pl-k">=</span> <span class="pl-c1">p4est_new_ext</span>(MPI<span class="pl-k">.</span>COMM_WORLD, connectivity, <span class="pl-c1">0</span>, <span class="pl-c1">2</span>, <span class="pl-c1">0</span>, <span class="pl-c1">0</span>, <span class="pl-c1">C_NULL</span>, <span class="pl-c1">C_NULL</span>)
p4est_obj <span class="pl-k">=</span> <span class="pl-c1">unsafe_load</span>(p4est)
MPI<span class="pl-k">.</span><span class="pl-c1">Barrier</span>(MPI<span class="pl-k">.</span>COMM_WORLD)
rank <span class="pl-k">=</span> MPI<span class="pl-k">.</span><span class="pl-c1">Comm_rank</span>(MPI<span class="pl-k">.</span>COMM_WORLD)
<span class="pl-c1">@info</span> <span class="pl-s"><span class="pl-pds">"</span>Setup<span class="pl-pds">"</span></span> rank p4est_obj<span class="pl-k">.</span>local_num_quadrants p4est_obj<span class="pl-k">.</span>global_num_quadrants
<span class="pl-c1">p4est_destroy</span>(p4est)
<span class="pl-c1">p4est_connectivity_destroy</span>(connectivity)</pre></div>
<p dir="auto">Run Julia with the MPI implementation used by MPI.jl and execute the script
shown above. You should get an output like</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="Into p4est_new with min quadrants 0 level 2 uniform 0
New p4est with 1 trees on 2 processors
Initial level 2 potential global quadrants 16 per tree 16
Into p4est_new with min quadrants 0 level 2 uniform 0
New p4est with 1 trees on 2 processors
Initial level 2 potential global quadrants 16 per tree 16
Done p4est_new with 13 total quadrants
Done p4est_new with 13 total quadrants
┌ Info: Setup
│   rank = 0
│   p4est_obj.local_num_quadrants = 5
└   p4est_obj.global_num_quadrants = 13
┌ Info: Setup
│   rank = 1
│   p4est_obj.local_num_quadrants = 8
└   p4est_obj.global_num_quadrants = 13"><pre class="notranslate"><code>Into p4est_new with min quadrants 0 level 2 uniform 0
New p4est with 1 trees on 2 processors
Initial level 2 potential global quadrants 16 per tree 16
Into p4est_new with min quadrants 0 level 2 uniform 0
New p4est with 1 trees on 2 processors
Initial level 2 potential global quadrants 16 per tree 16
Done p4est_new with 13 total quadrants
Done p4est_new with 13 total quadrants
┌ Info: Setup
│   rank = 0
│   p4est_obj.local_num_quadrants = 5
└   p4est_obj.global_num_quadrants = 13
┌ Info: Setup
│   rank = 1
│   p4est_obj.local_num_quadrants = 8
└   p4est_obj.global_num_quadrants = 13
</code></pre></div>
<p dir="auto">To suppress the relatively verbose output of
<a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> in the example above, you can
call <code>P4est.init(C_NULL, SC_LP_ERROR)</code> before calling other functions from
<a href="https://github.com/cburstedde/p4est"><code>p4est</code></a>.</p>
<p dir="auto">Many functions and types in <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> have
been documented with comments by the <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a>
authors; you can access this documentation as you would for any Julia-native
entity through <code>?</code>:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="help?&gt; p4est_memory_used
search: p4est_memory_used p4est_mesh_memory_used p4est_ghost_memory_used p4est_connectivity_memory_used

  p4est_memory_used(p4est_)

  Calculate local memory usage of a forest structure. Not collective. The memory used on the current rank is
  returned. The connectivity structure is not counted since it is not owned; use
  p4est_connectivity_memory_usage (p4est-&gt;connectivity).

  Parameters
  ––––––––––––

    •  p4est:[in] Valid forest structure.

  Returns
  –––––––––

  Memory used in bytes.

  Prototype
  –––––––––––

  size_t p4est_memory_used (p4est_t * p4est);"><pre class="notranslate"><code>help?&gt; p4est_memory_used
search: p4est_memory_used p4est_mesh_memory_used p4est_ghost_memory_used p4est_connectivity_memory_used

  p4est_memory_used(p4est_)

  Calculate local memory usage of a forest structure. Not collective. The memory used on the current rank is
  returned. The connectivity structure is not counted since it is not owned; use
  p4est_connectivity_memory_usage (p4est-&gt;connectivity).

  Parameters
  ––––––––––––

    •  p4est:[in] Valid forest structure.

  Returns
  –––––––––

  Memory used in bytes.

  Prototype
  –––––––––––

  size_t p4est_memory_used (p4est_t * p4est);
</code></pre></div>
<p dir="auto">The same is of course true for the higher-level interface functions provided
by <a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a>, e.g.,</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="help?&gt; P4est.init
  P4est.init(log_handler, log_threshold)

  Calls p4est_init if it has not already been called, otherwise do nothing. Thus, P4est.init can safely be
  called multiple times.

  To use the default log handler and suppress most output created by default by p4est, call this function as

  P4est.init(C_NULL, SC_LP_ERROR)

  before calling other functions from p4est."><pre class="notranslate"><code>help?&gt; P4est.init
  P4est.init(log_handler, log_threshold)

  Calls p4est_init if it has not already been called, otherwise do nothing. Thus, P4est.init can safely be
  called multiple times.

  To use the default log handler and suppress most output created by default by p4est, call this function as

  P4est.init(C_NULL, SC_LP_ERROR)

  before calling other functions from p4est.
</code></pre></div>
<p dir="auto">For more information on how to use <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a>,
please refer to the <a href="http://www.p4est.org/" rel="nofollow">documentation for p4est itself</a> or
to the header files (<code>*.h</code>) in the
<a href="https://github.com/cburstedde/p4est/tree/master/src"><code>p4est</code> repository</a>.</p>
<p dir="auto">For more information on how to use the Julia wrapper
<a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a>, please consult the
<a href="https://trixi-framework.github.io/P4est.jl/stable" rel="nofollow">documentation</a>.</p>
<h2 dir="auto"><a id="user-content-authors" class="anchor" aria-hidden="true" href="#authors"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Authors</h2>
<p dir="auto">P4est.jl is mainly maintained by
<a href="https://lakemper.eu" rel="nofollow">Michael Schlottke-Lakemper</a>
(RWTH Aachen University/High-Performance Computing Center Stuttgart (HLRS), Germany)
and <a href="https://ranocha.de" rel="nofollow">Hendrik Ranocha</a> (University of Hamburg, Germany).
The full list of contributors can be found in <a href="AUTHORS.md">AUTHORS.md</a>.
The <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> library itself is written by
Carsten Burstedde, Lucas C. Wilcox, and Tobin Isaac.</p>
<h2 dir="auto"><a id="user-content-license-and-contributing" class="anchor" aria-hidden="true" href="#license-and-contributing"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>License and contributing</h2>
<p dir="auto">P4est.jl is licensed under the MIT license (see <a href="LICENSE.md">LICENSE.md</a>).
<a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> itself is licensed under the GNU
General Public License, version 2.</p>
</article></div>