<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-pardisojl" class="anchor" aria-hidden="true" href="#pardisojl"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Pardiso.jl</h1>
<p><a href="https://travis-ci.org/JuliaSparse/Pardiso.jl" rel="nofollow"><img src="https://camo.githubusercontent.com/d592ed33af62e05f4de1f3f00d8f527f19060020/68747470733a2f2f7472617669732d63692e6f72672f4a756c69615370617273652f5061726469736f2e6a6c2e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/JuliaSparse/Pardiso.jl.svg?branch=master" style="max-width:100%;"></a></p>
<p>The Pardiso.jl package provides an interface for using <a href="http://www.pardiso-project.org/" rel="nofollow">PARDISO
6.0</a> and <a href="https://software.intel.com/en-us/node/470282" rel="nofollow">Intel MKL
PARDISO</a> from the <a href="http://julialang.org" rel="nofollow">Julia
language</a>. You cannot use <code>Pardiso.jl</code> without either
having a valid license for PARDISO or having the MKL library installed. This
package is available free of charge and in no way replaces or alters any
functionality of the linked libraries.</p>
<h2><a id="user-content-installation" class="anchor" aria-hidden="true" href="#installation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Installation</h2>
<p>The package itself is installed with <code>Pkg.add("Pardiso")</code> but you also need to
follow the installation instructions below to install a working PARDISO
library.</p>
<h3><a id="user-content-mkl-pardiso" class="anchor" aria-hidden="true" href="#mkl-pardiso"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>MKL PARDISO</h3>
<p>By default Julia, will automatically install a suitable MKL for your platform.
If you rather use a self installed MKL follow these instructions:</p>
<ul>
<li>Set the <code>MKLROOT</code> environment variable. See the <a href="https://software.intel.com/en-us/articles/intel-mkl-103-getting-started" rel="nofollow">MKL getting started
manual</a>
for a thorough guide how to set this variable correctly, typically done by
executing something like <code>source /opt/intel/mkl/bin/mklvars.sh intel64</code> or
running <code>"C:\Program Files (x86)\IntelSWTools\compilers_and_libraries\windows\mkl\bin\mklvars.bat" intel64</code></li>
<li>Run <code>Pkg.build("Pardiso")</code></li>
<li>Run <code>Pardiso.show_build_log()</code> to see the build log for additional
information.</li>
<li>Note that the <code>MKLROOT</code> environment variable must be set whenever using the library.</li>
</ul>
<h3><a id="user-content-pardiso-60" class="anchor" aria-hidden="true" href="#pardiso-60"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>PARDISO 6.0</h3>
<ul>
<li>Put the PARDISO library <code>libpardiso600-WIN-X86-64.dll</code>, <code>libpardiso600-GNUXXX-X86-64.so</code> or
<code>libpardiso600-MACOS-X86-64.dylib</code> in a folder somewhere and set the environment variable <code>JULIA_PARDISO</code> to that folder.
For example, create an entry <code>ENV["JULIA_PARDISO"] = "/Users/Someone/Pardiso"</code> in the
<code>.julia/config/startup.jl</code> file and download the Pardiso library to that folder.</li>
<li>Perform the platform specific steps below</li>
<li>Run <code>Pkg.build("Pardiso")</code></li>
<li>Run <code>Pardiso.show_build_log()</code> to see the build log for additional information.</li>
</ul>
<p>Note: Weird errors and problems with MKL Pardiso has been observed when Pardiso 6.0 is enabled
(likely because some library that is needed by Pardiso 6.0 is problematic with MKL).
If you want to use MKL Pardiso it is better ot just disable Paridso 6.0 by not setting
the environment variable <code>JULIA_PARDISO</code> (and rerunning <code>build Pardiso</code>).</p>
<h5><a id="user-content-linux--macos-specific" class="anchor" aria-hidden="true" href="#linux--macos-specific"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Linux / macOS specific</h5>
<ul>
<li>Make sure that the version of <code>gfortran</code> corresponding to the pardiso library is installed.</li>
<li>Make sure OpenMP is installed.</li>
<li>Install a (fast) installation of a BLAS and LAPACK (this should preferably be single threaded since PARDISO handles threading itself), using for example <a href="https://github.com/xianyi/OpenBLAS/wiki/Precompiled-installation-packages">OpenBLAS</a></li>
</ul>
<h2><a id="user-content-basic-usage" class="anchor" aria-hidden="true" href="#basic-usage"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Basic Usage</h2>
<p>This section will explain how to solve equations using <code>Pardiso.jl</code> with the default settings of the library. For more advanced users there is a section further down.</p>
<h2><a id="user-content-creating-the-pardisosolver" class="anchor" aria-hidden="true" href="#creating-the-pardisosolver"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Creating the PardisoSolver</h2>
<p>A <code>PardisoSolver</code> is created with <code>PardisoSolver()</code> for solving with PARDISO 6.0 or <code>MKLPardisoSolver()</code> for solving with MKL PARDISO. This object will hold the settings of the solver and will be passed into the solve functions. In the following sections an instance of a <code>PardisoSolver</code> or an <code>MKLPardisoSolver()</code> will be referred to as <code>ps</code>.</p>
<h3><a id="user-content-solving" class="anchor" aria-hidden="true" href="#solving"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Solving</h3>
<p>Solving equations is done with the <code>solve</code> and <code>solve!</code> functions. They have the following signatures:</p>
<ul>
<li><code>solve(ps, A, B)</code> solves <code>AX=B</code> and returns <code>X</code></li>
<li><code>solve!(ps, X, A, B)</code> solves <code>AX=B</code> and stores it in <code>X</code></li>
</ul>
<p>The symbols <code>:T</code> or <code>:C</code> can be added as an extra argument to solve the transposed or the conjugate transposed system of equations, respectively.</p>
<p>Here is an example of solving a system of real equations with two right-hand sides:</p>
<div class="highlight highlight-source-julia"><pre>ps <span class="pl-k">=</span> <span class="pl-c1">PardisoSolver</span>()

A <span class="pl-k">=</span> <span class="pl-c1">sparse</span>(<span class="pl-c1">rand</span>(<span class="pl-c1">10</span>, <span class="pl-c1">10</span>))
B <span class="pl-k">=</span> <span class="pl-c1">rand</span>(<span class="pl-c1">10</span>, <span class="pl-c1">2</span>)
X <span class="pl-k">=</span> <span class="pl-c1">zeros</span>(<span class="pl-c1">10</span>, <span class="pl-c1">2</span>)
<span class="pl-c1">solve!</span>(ps, X, A, B)</pre></div>
<p>which happened to give the result</p>
<div class="highlight highlight-source-julia"><pre>julia<span class="pl-k">&gt;</span> X
<span class="pl-c1">10</span>x2 Array{Float64,<span class="pl-c1">2</span>}<span class="pl-k">:</span>
 <span class="pl-k">-</span><span class="pl-c1">0.487361</span>  <span class="pl-k">-</span><span class="pl-c1">0.715372</span>
 <span class="pl-k">-</span><span class="pl-c1">0.644219</span>  <span class="pl-k">-</span><span class="pl-c1">3.38342</span>
  <span class="pl-c1">0.465575</span>   <span class="pl-c1">4.4838</span>
  <span class="pl-c1">1.14448</span>   <span class="pl-k">-</span><span class="pl-c1">0.103854</span>
  <span class="pl-c1">2.00892</span>   <span class="pl-k">-</span><span class="pl-c1">7.04965</span>
  <span class="pl-c1">0.870507</span>   <span class="pl-c1">1.7014</span>
  <span class="pl-c1">0.590723</span>  <span class="pl-k">-</span><span class="pl-c1">5.74338</span>
 <span class="pl-k">-</span><span class="pl-c1">0.843841</span>  <span class="pl-k">-</span><span class="pl-c1">0.903796</span>
 <span class="pl-k">-</span><span class="pl-c1">0.279381</span>   <span class="pl-c1">7.24754</span>
 <span class="pl-k">-</span><span class="pl-c1">1.17295</span>    <span class="pl-c1">8.47922</span></pre></div>
<h3><a id="user-content-schur-complement-60-only" class="anchor" aria-hidden="true" href="#schur-complement-60-only"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Schur Complement (6.0 only)</h3>
<p>Given a partitioned matrix <code>M = [A B; C D]</code>, the Schur complement of <code>A</code> in <code>M</code> is <code>S = D-CA⁻¹B</code>.
This can be found with the function <code>schur_complement</code> with the following signatures:</p>
<ul>
<li><code>schur_complement(ps, M, n)</code> returns Schur complement of submatrix <code>A</code> in <code>M</code>, where <code>n</code> is the size of submatrix <code>D</code> (and therefore also of Schur complement)</li>
<li><code>schur_complement(ps, M, x)</code> returns Schur complement of submatrix <code>A</code> in <code>M</code>, where submatrix <code>D</code> is defined by nonzero rows of <code>SparseVector</code> or <code>SparseMatrix</code> <code>x</code>.</li>
</ul>
<p>The symbols <code>:T</code> or <code>:C</code> can be added as an extra argument to solve the transposed or the conjugate transposed system of equations, respectively.</p>
<p>Here is an example of finding the Schur complement:</p>
<div class="highlight highlight-source-julia"><pre>ps <span class="pl-k">=</span> <span class="pl-c1">PardisoSolver</span>()
m <span class="pl-k">=</span> <span class="pl-c1">100</span>; n <span class="pl-k">=</span> <span class="pl-c1">5</span>; p <span class="pl-k">=</span> <span class="pl-c1">.5</span>; T <span class="pl-k">=</span> Float64
rng <span class="pl-k">=</span> <span class="pl-c1">MersenneTwister</span>(<span class="pl-c1">1234</span>);
A <span class="pl-k">=</span> I <span class="pl-k">+</span> <span class="pl-c1">sprand</span>(rng,T,m,m,p)
A⁻¹ <span class="pl-k">=</span> <span class="pl-c1">inv</span>(<span class="pl-c1">Matrix</span>(A))
B <span class="pl-k">=</span> <span class="pl-c1">sprand</span>(rng,T,m,n,p)
C <span class="pl-k">=</span> <span class="pl-c1">sprand</span>(rng,T,n,m,p)
D <span class="pl-k">=</span> <span class="pl-c1">sprand</span>(rng,T,n,n,p)
M <span class="pl-k">=</span> [A B; C D]
S <span class="pl-k">=</span> <span class="pl-c1">schur_complement</span>(ps,M,n)</pre></div>
<p>which gives</p>
<div class="highlight highlight-source-julia"><pre>julia<span class="pl-k">&gt;</span> S
<span class="pl-c1">5</span><span class="pl-k">×</span><span class="pl-c1">5</span> Array{Float64,<span class="pl-c1">2</span>}<span class="pl-k">:</span>
  <span class="pl-k">-</span><span class="pl-c1">0.121404</span>    <span class="pl-c1">1.49473</span>  <span class="pl-k">-</span><span class="pl-c1">1.25965</span>    <span class="pl-c1">7.40326</span>    <span class="pl-c1">0.571538</span>
 <span class="pl-k">-</span><span class="pl-c1">19.4928</span>     <span class="pl-k">-</span><span class="pl-c1">7.71151</span>  <span class="pl-c1">12.9496</span>    <span class="pl-k">-</span><span class="pl-c1">7.13646</span>  <span class="pl-k">-</span><span class="pl-c1">20.4194</span>  
   <span class="pl-c1">9.88029</span>     <span class="pl-c1">3.35502</span>  <span class="pl-k">-</span><span class="pl-c1">7.2346</span>     <span class="pl-c1">1.70651</span>   <span class="pl-c1">13.9759</span>  
  <span class="pl-k">-</span><span class="pl-c1">9.06094</span>    <span class="pl-k">-</span><span class="pl-c1">5.86454</span>   <span class="pl-c1">7.44917</span>   <span class="pl-k">-</span><span class="pl-c1">2.54985</span>   <span class="pl-k">-</span><span class="pl-c1">9.17327</span>
 <span class="pl-k">-</span><span class="pl-c1">33.7006</span>    <span class="pl-k">-</span><span class="pl-c1">17.8323</span>   <span class="pl-c1">20.2588</span>   <span class="pl-k">-</span><span class="pl-c1">19.5863</span>   <span class="pl-k">-</span><span class="pl-c1">37.6132</span></pre></div>
<p>We can check the validity by comparing to explicity form:</p>
<div class="highlight highlight-source-julia"><pre>julia<span class="pl-k">&gt;</span> <span class="pl-c1">norm</span>(D <span class="pl-k">-</span> C<span class="pl-k">*</span>A⁻¹<span class="pl-k">*</span>B <span class="pl-k">-</span> S)
<span class="pl-c1">5.033075778861378e-13</span></pre></div>
<p>At present there seems to be an instability in the Schur complement computation for complex matrices.</p>
<h3><a id="user-content-setting-the-number-of-threads" class="anchor" aria-hidden="true" href="#setting-the-number-of-threads"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Setting the number of threads</h3>
<p>The number of threads to use is set in different ways for MKL PARDISO and PARDISO 6.0.</p>
<h4><a id="user-content-mkl-pardiso-1" class="anchor" aria-hidden="true" href="#mkl-pardiso-1"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>MKL PARDISO</h4>
<div class="highlight highlight-source-julia"><pre><span class="pl-c1">set_nprocs!</span>(ps, i) <span class="pl-c"><span class="pl-c">#</span> Sets the number of threads to use</span>
<span class="pl-c1">get_nprocs</span>(ps) <span class="pl-c"><span class="pl-c">#</span> Gets the number of threads being used</span></pre></div>
<h4><a id="user-content-pardiso-60-1" class="anchor" aria-hidden="true" href="#pardiso-60-1"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>PARDISO 6.0</h4>
<p>The number of threads are set at the creation of the <code>PardisoSolver</code> by looking for the environment variable <code>OMP_NUM_THREADS</code>. This can be done in Julia with for example <code>ENV["OMP_NUM_THREADS"] = 2</code>. <strong>Note:</strong> <code>OMP_NUM_THREADS</code> must be set <em>before</em> <code>Pardiso</code> is loaded and can not be changed during runtime.</p>
<p>The number of threads used by a <code>PardisoSolver</code> can be retrieved with <code>get_nprocs(ps)</code></p>
<h2><a id="user-content-more-advanced-usage" class="anchor" aria-hidden="true" href="#more-advanced-usage"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>More advanced usage.</h2>
<p>This section discusses some more advanced usage of <code>Pardiso.jl</code>.</p>
<p>For terminology in this section please refer to the <a href="http://www.pardiso-project.org/manual/manual.pdf" rel="nofollow">PARDISO 6.0 manual</a> and the <a href="https://software.intel.com/en-us/node/470282" rel="nofollow">MKL PARDISO section</a>.</p>
<p>After using functionality in this section, calls should no longer be made to the <code>solve</code> functions but instead directly to the function</p>
<div class="highlight highlight-source-julia"><pre><span class="pl-c1">pardiso</span>(ps, X, A, B)</pre></div>
<p>This will ensure that the properties you set will not be overwritten.</p>
<p>If you want, you can use <code>get_matrix(ps, A, T)</code> to return a matrix that is suitable to use with <code>pardiso</code> depending on the matrix type that <code>ps</code> has set. The parameter <code>T</code> is a symbol representing if you will solve the normal, transposed or conjugated system. These are represented by <code>:N, :T, :C)</code> respectively.</p>
<p>For ease of use, <code>Pardiso.jl</code> provides enums for most options. These are not exported so has to either be explicitly imported or qualified with the module name first. It is possible to both use the enum as an input key to the options or the corresponding integer as given in the manuals.</p>
<h3><a id="user-content-setting-the-matrix-type" class="anchor" aria-hidden="true" href="#setting-the-matrix-type"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Setting the matrix type</h3>
<p>The matrix type can be explicitly set with <code>set_matrixtype!(ps, key)</code> where the key has the following meaning:</p>
<table>
<thead>
<tr>
<th>enum</th>
<th>integer</th>
<th>Matrix type</th>
</tr>
</thead>
<tbody>
<tr>
<td>REAL_SYM</td>
<td>1</td>
<td>real and structurally symmetric</td>
</tr>
<tr>
<td>REAL_SYM_POSDEF</td>
<td>2</td>
<td>real and symmetric positive definite</td>
</tr>
<tr>
<td>REAL_SYM_INDEF</td>
<td>-2</td>
<td>real and symmetric indefinite</td>
</tr>
<tr>
<td>COMPLEX_STRUCT_SYM</td>
<td>3</td>
<td>complex and structurally symmetric</td>
</tr>
<tr>
<td>COMPLEX_HERM_POSDEF</td>
<td>4</td>
<td>complex and Hermitian positive definite</td>
</tr>
<tr>
<td>COMPLEX_HERM_INDEF</td>
<td>-4</td>
<td>complex and Hermitian indefinite</td>
</tr>
<tr>
<td>COMPLEX_SYM</td>
<td>6</td>
<td>complex and symmetric</td>
</tr>
<tr>
<td>REAL_NONSYM</td>
<td>11</td>
<td>real and nonsymmetric</td>
</tr>
<tr>
<td>COMPLEX_NONSYM</td>
<td>13</td>
<td>complex and nonsymmetric</td>
</tr>
</tbody>
</table>
<p>The matrix type for a solver can be retrieved with <code>get_matrixtype(ps)</code>.</p>
<h3><a id="user-content-setting-the-solver-60-only" class="anchor" aria-hidden="true" href="#setting-the-solver-60-only"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Setting the solver (6.0 only)</h3>
<p>PARDISO 6.0 supports direct and iterative solvers. The solver is set with <code>set_solver!(ps, key)</code> where the key has the following meaning:</p>
<table>
<thead>
<tr>
<th>enum</th>
<th>integer</th>
<th>Solver</th>
</tr>
</thead>
<tbody>
<tr>
<td>DIRECT_SOLVER</td>
<td>0</td>
<td>sparse direct solver</td>
</tr>
<tr>
<td>ITERATIVE_SOLVER</td>
<td>1</td>
<td>multi-recursive iterative solver</td>
</tr>
</tbody>
</table>
<h3><a id="user-content-setting-the-phase" class="anchor" aria-hidden="true" href="#setting-the-phase"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Setting the phase</h3>
<p>Depending on the phase calls to <code>solve</code> (and <code>pardiso</code> which is mentioned later) does different things. The phase is set with <code>set_phase!(ps, key)</code> where key has the meaning:</p>
<table>
<thead>
<tr>
<th>enum</th>
<th>integer</th>
<th>Solver Execution Steps</th>
</tr>
</thead>
<tbody>
<tr>
<td>ANALYSIS</td>
<td>11</td>
<td>Analysis</td>
</tr>
<tr>
<td>ANALYSIS_NUM_FACT</td>
<td>12</td>
<td>Analysis, numerical factorization</td>
</tr>
<tr>
<td>ANALYSIS_NUM_FACT_SOLVE_REFINE</td>
<td>13</td>
<td>Analysis, numerical factorization, solve, iterative refinement</td>
</tr>
<tr>
<td>NUM_FACT</td>
<td>22</td>
<td>Numerical factorization</td>
</tr>
<tr>
<td>SELECTED_INVERSION</td>
<td>-22</td>
<td>Selected Inversion</td>
</tr>
<tr>
<td>NUM_FACT_SOLVE_REFINE</td>
<td>23</td>
<td>Numerical factorization, solve, iterative refinement</td>
</tr>
<tr>
<td>SOLVE_ITERATIVE_REFINE</td>
<td>33</td>
<td>Solve, iterative refinement</td>
</tr>
<tr>
<td>SOLVE_ITERATIVE_REFINE_ONLY_FORWARD</td>
<td>331</td>
<td>MKL only, like phase=33, but only forward substitution</td>
</tr>
<tr>
<td>SOLVE_ITERATIVE_REFINE_ONLY_DIAG</td>
<td>332</td>
<td>MKL only, like phase=33, but only diagonal substitution (if available)</td>
</tr>
<tr>
<td>SOLVE_ITERATIVE_REFINE_ONLY_BACKWARD</td>
<td>333</td>
<td>MKL only, like phase=33, but only backward substitution</td>
</tr>
<tr>
<td>RELEASE_LU_MNUM</td>
<td>0</td>
<td>Release internal memory for L and U matrix number MNUM</td>
</tr>
<tr>
<td>RELEASE_ALL</td>
<td>-1</td>
<td>Release all internal memory for all matrices</td>
</tr>
</tbody>
</table>
<h3><a id="user-content-setting-iparm-and-dparm-explicitly" class="anchor" aria-hidden="true" href="#setting-iparm-and-dparm-explicitly"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Setting <code>IPARM</code> and <code>DPARM</code> explicitly</h3>
<p>Advanced users likely want to explicitly set and retrieve the <code>IPARM</code> and <code>DPARM</code> (6.0 only) parameters.
This can be done with the getters and setters:</p>
<div class="highlight highlight-source-julia"><pre><span class="pl-c1">get_iparm</span>(ps, i) <span class="pl-c"><span class="pl-c">#</span> Gets IPARM[i]</span>
<span class="pl-c1">get_iparms</span>(ps) <span class="pl-c"><span class="pl-c">#</span> Gets IPARM</span>
<span class="pl-c1">set_iparm!</span>(ps, i, v) <span class="pl-c"><span class="pl-c">#</span> Sets IPARM[i] = v</span>

<span class="pl-c"><span class="pl-c">#</span> 6.0 only</span>
<span class="pl-c1">get_dparm</span>(ps, i) <span class="pl-c"><span class="pl-c">#</span> Gets DPARM[i]</span>
<span class="pl-c1">get_dparms</span>(ps) <span class="pl-c"><span class="pl-c">#</span> Gets DPARM</span>
<span class="pl-c1">set_dparm!</span>(ps, i, v) <span class="pl-c"><span class="pl-c">#</span> Sets DPARM[i] = v</span></pre></div>
<p>To set the default values of the <code>IPARM</code> and <code>DPARM</code> call <code>pardisoinit(ps)</code>. The default values depend on what solver and matrix type is set.</p>
<h3><a id="user-content-setting-message-level" class="anchor" aria-hidden="true" href="#setting-message-level"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Setting message level</h3>
<p>It is possible for Pardiso to print out timings and statistics when solving. This is done by <code>set_msglvl!(ps, key)</code> where <code>key</code> has the meaning:</p>
<table>
<thead>
<tr>
<th>enum</th>
<th>integer</th>
<th>Solver</th>
</tr>
</thead>
<tbody>
<tr>
<td>MESSAGE_LEVEL_OFF</td>
<td>0</td>
<td>no statistics printed</td>
</tr>
<tr>
<td>MESSAGE_LEVEL_ON</td>
<td>1</td>
<td>statistics printed</td>
</tr>
</tbody>
</table>
<h3><a id="user-content-matrix-and-vector-checkers" class="anchor" aria-hidden="true" href="#matrix-and-vector-checkers"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Matrix and vector checkers</h3>
<p>PARDISO 6.0 comes with a few matrix and vector checkers to check the consistency and integrity of the input data. These can be called with the functions:</p>
<div class="highlight highlight-source-julia"><pre><span class="pl-c1">printstats</span>(ps, A, B)
<span class="pl-c1">checkmatrix</span>(ps, A)
<span class="pl-c1">checkvec</span>(ps, B)</pre></div>
<p>In MKL PARDISO this is instead done by setting <code>IPARM[27]</code> to 1 before calling <code>pardiso</code>.</p>
<h3><a id="user-content-mnum-maxfct-perm" class="anchor" aria-hidden="true" href="#mnum-maxfct-perm"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>MNUM, MAXFCT, PERM</h3>
<p>These are set and retrieved with the functions</p>
<div class="highlight highlight-source-julia"><pre><span class="pl-c1">set_mnum!</span>(ps, i)
<span class="pl-c1">get_mnum</span>(ps)

<span class="pl-c1">set_maxfct!</span>(ps, i)
<span class="pl-c1">get_maxfct</span>(ps)

<span class="pl-c1">get_perm</span>(ps)
<span class="pl-c1">set_perm!</span>(ps, perm) <span class="pl-c"><span class="pl-c">#</span> Perm is a Vector{Int}</span></pre></div>
<h3><a id="user-content-schur-complement-60-only-1" class="anchor" aria-hidden="true" href="#schur-complement-60-only-1"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Schur Complement (6.0 only)</h3>
<p>The <code>pardiso(ps,...)</code> syntax can be used to compute the Schur compelement (as described below). The answer can be retrieved with <code>pardisogetschur(ps)</code>.</p>
<p>To use the low-level API to compute the Schur complement:</p>
<ul>
<li>use custom IPARMS (<code>set_iparm!(ps,1,1)</code>), set the Schur complement block size to <code>n</code> (<code>set_iparm!(ps,38,n)</code>), and set the phase to analyze &amp; factorize (<code>set_phase!(ps,12)</code>).</li>
<li>compute the Schur complement by calling <code>pardiso(ps,X,M,X)</code>, where <code>B</code> is a dummy vector with <code>length(X)=size(M,1)</code> that shares element type with <code>M</code>.</li>
<li>retrieve with <code>pardisogetschur(ps)</code></li>
</ul>
<h3><a id="user-content-potential-gotchas" class="anchor" aria-hidden="true" href="#potential-gotchas"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Potential "gotchas"</h3>
<ul>
<li>Julia uses CSC sparse matrices while PARDISO expects a CSR matrix. These can be seen as transposes of each other so to solve <code>AX = B</code> the transpose flag (<code>IPARAM[12]</code>) should be set to 1.</li>
<li>For <strong>symmetric</strong> matrices, PARDISO needs to have the diagonal stored in the sparse structure even if the diagonal element happens to be 0. The manual recommends adding an <code>eps</code> to the diagonal when you suspect you might have 0 values diagonal elements that are not stored in the sparse structure.</li>
<li>Unless <code>IPARM[1] = 1</code>, all values in <code>IPARM</code> will be ignored and default values are used.</li>
<li>When solving a symmetric matrix, Pardiso expects only the upper triangular part. Since Julia has CSC matrices this means you should pass in <code>tril(A)</code> to the <code>pardiso</code> function. Use <code>checkmatrix</code> to see that you managed to get the matrix in a valid format.</li>
</ul>
<h1><a id="user-content-contributions" class="anchor" aria-hidden="true" href="#contributions"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Contributions</h1>
<p>If you have suggestions or idea of improving this package, please file an issue or even better, create a PR!</p>
</article></div>