<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><h1 dir="auto"><a id="user-content-marsagliadiscretesamplers" class="anchor" aria-hidden="true" href="#marsagliadiscretesamplers"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>MarsagliaDiscreteSamplers</h1>
<h2 dir="auto"><a id="user-content-installation" class="anchor" aria-hidden="true" href="#installation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Installation</h2>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="using Pkg
Pkg.add(&quot;MarsagliaDiscreteSamplers&quot;)"><pre><span class="pl-k">using</span> Pkg
Pkg<span class="pl-k">.</span><span class="pl-c1">add</span>(<span class="pl-s"><span class="pl-pds">"</span>MarsagliaDiscreteSamplers<span class="pl-pds">"</span></span>)</pre></div>
<h2 dir="auto"><a id="user-content-description" class="anchor" aria-hidden="true" href="#description"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Description</h2>
<p dir="auto">An implementation of methods described in <a href="https://www.jstatsoft.org/article/view/v011i03" rel="nofollow">Fast Generation of Discrete Random Variables</a>. Performance compares favorably to extant discrete samplers and is agnostic to type of discrete distribution.</p>
<h2 dir="auto"><a id="user-content-usage" class="anchor" aria-hidden="true" href="#usage"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Usage</h2>
<p dir="auto">Given a discrete distribution defined by a probability table, <code>p âˆˆ â„á´º : âˆ‘áµ¢páµ¢ = 1, 0 â‰¤ páµ¢ â‰¤ 1</code>,
construct a square histogram in <code>ğ’ª(N)</code> time and space, then draw samples in <code>ğ’ª(1)</code> time.
Each draw is an index. In the simplest case, this index is identical to the category the
probability mass of which is <code>páµ¢</code>; this corresponds to <code>x ~ Categorical(p)</code>.</p>
<p dir="auto">Any arbitrary discrete distribution may be sampled in this manner, as its probability mass function can be represented by a vector <code>p</code>. However, the draw(s) will need to be converted to whatever entity is indexed.
The categorical distribution is the trivial case, as the conversion function is the identity function.
If we take a slightly more complicated example, using the binomial distribution, e.g. <code>Binomial(3, 0.3)</code>, the probability mass function for which is</p>
<p dir="auto"><code>p(i, n, p) = binomial(n, i) * p^i * (1-p)^(n-i)</code></p>
<p dir="auto">This yields the probability vector</p>
<p dir="auto"><code>p = [1 * 0.7^3, 3 * 0.3 * 0.7^2, 3 * 0.3^2 * 0.7, 1 * 0.3^3]</code></p>
<p dir="auto">The draws returned by the sampler will be âˆˆ {1,2,3,4}, as there are 4 "categories" of outcome defined by the pmf of Bin(3, 0.3). It just happens to be the case that a 1-indexed numbering scheme for categories produces this. In other words, the first category corresponds to 0, the second to 1, etc. The conversion function is simply <code>f(x) = x - 1</code>.</p>
<p dir="auto">At first glance, this may seem like a disadvantage, but it is in fact an advantage, as the sampler efficiency is not tied to any particular distribution. Consider a motivating example: <code>Binomial(100, 0.99)</code>,
the probability mass function for which is negligible for all but a small subset of its support.
One can sample from said distribution by providing the pmf evaluated on the subset of the support with non-negligible mass. Being generous, let us use the range <code>80:100</code>, such that <code>p âˆˆ â„Â²Â¹</code> which will return <code>x âˆˆ 1:21</code>. The conversion function is then <code>f(x) = x + 79</code>.
More generally, if the support of the binomial is restricted to <code>l:u</code> using lower bound, <code>l â‰¥ 0</code>, and upper bound, <code>u â‰¤ n</code>, this produces a <code>p âˆˆ â„áµ˜â»Ë¡âºÂ¹</code>, returns <code>x âˆˆ 1:(u-l+1)</code> and the conversion function to the true support is <code>f(x) = x + l - 1</code>. One could view this as the composition of functions, <code>h = f âˆ˜ g</code>, <code>f(x) = x - 1</code> (unrestricted support), <code>g(x) = x + l</code> (adjustment for restricted support).
This applies to the Poisson, negative binomial, geometric, hypergeometric, etc. distributions.</p>
<p dir="auto">Let us consider another example, applicable to any probability mass function which admits a sparse representation. The categorical distribution is selected for simplicity, but the approach is the same for any arbitrary pmf.
Consider <code>p âˆˆ â„Â¹â°â°â°â°</code>, with <code>pâ‚ = 0.3, pâ‚‚ = 0.2, pâ‚â‚€â‚€â‚€â‚€ = 0.5, and páµ¢ = 0, i = 3,â€¦,9999</code>.
It would be much more efficient to sample from <code>pâ€² = [pâ‚, pâ‚‚, pâ‚â‚€â‚€â‚€â‚€]</code>, and re-index the x's returned. To this end define <code>I = [1, 2, 10000]</code>. Now, <code>x âˆˆ 1:3</code> and one converts to the true category with <code>f(x) = I[x]</code>. Once one has the true category, <code>y = f(x)</code>, additional conversions (defined on the original support) can be applied.</p>
<h2 dir="auto"><a id="user-content-examples" class="anchor" aria-hidden="true" href="#examples"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Examples</h2>
<h3 dir="auto"><a id="user-content-binomial3-03" class="anchor" aria-hidden="true" href="#binomial3-03"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a><code>Binomial(3, 0.3)</code></h3>
<details>
 
<p dir="auto">
</p><p dir="auto">The intent is to demonstrate the speed which can be achieved with Marsaglia's square histogram method.</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="julia&gt; using MarsagliaDiscreteSamplers, BenchmarkTools

julia&gt; pmf(i, n, p) = binomial(n, i) * p^i * (1-p)^(n-i);

julia&gt; n = 3; p = 0.3;

julia&gt; ğ“… = pmf.(0:n, n, p)
4-element Vector{Float64}:
 0.3429999999999999
 0.4409999999999999
 0.189
 0.027

julia&gt; z = SqHist(ğ“…);

julia&gt; x = generate(z, 10^6);

julia&gt; f(x) = x - 1

julia&gt; y = f.(x);

julia&gt; @benchmark generate!($x, $z)
BenchmarkTools.Trial: 3117 samples with 1 evaluation.
 Range (min â€¦ max):  1.380 ms â€¦   4.139 ms  â”Š GC (min â€¦ max): 0.00% â€¦ 34.68%
 Time  (median):     1.516 ms               â”Š GC (median):    0.00%
 Time  (mean Â± Ïƒ):   1.597 ms Â± 350.273 Î¼s  â”Š GC (mean Â± Ïƒ):  5.63% Â± 11.95%

 Memory estimate: 7.63 MiB, allocs estimate: 2.

julia&gt; u = similar(x, Float64); # pre-allocate temporary storage for repeated calls

julia&gt; @benchmark generate!($x, $u, $z)
BenchmarkTools.Trial: 5988 samples with 1 evaluation.
 Range (min â€¦ max):  825.778 Î¼s â€¦  1.622 ms  â”Š GC (min â€¦ max): 0.00% â€¦ 0.00%
 Time  (median):     827.810 Î¼s              â”Š GC (median):    0.00%
 Time  (mean Â± Ïƒ):   829.109 Î¼s Â± 16.532 Î¼s  â”Š GC (mean Â± Ïƒ):  0.00% Â± 0.00%

 Memory estimate: 0 bytes, allocs estimate: 0.
 
julia&gt; using Distributions

julia&gt; d = Binomial(n, p)
Binomial{Float64}(n=3, p=0.3)

julia&gt; w = rand(d, 10^6);

julia&gt; @benchmark rand!($d, $w)
BenchmarkTools.Trial: 105 samples with 1 evaluation.
 Range (min â€¦ max):  47.509 ms â€¦  49.507 ms  â”Š GC (min â€¦ max): 0.00% â€¦ 0.00%
 Time  (median):     47.686 ms               â”Š GC (median):    0.00%
 Time  (mean Â± Ïƒ):   47.743 ms Â± 266.732 Î¼s  â”Š GC (mean Â± Ïƒ):  0.00% Â± 0.00%
 
 Memory estimate: 0 bytes, allocs estimate: 0.
 
julia&gt; using Plots

julia&gt; gr(size=(1200,800))

julia&gt; p1 = histogram(y, label=&quot;Marsaglia square histogram method&quot;);

julia&gt; p2 = histogram(w, label=&quot;Distributions&quot;);

julia&gt; savefig(plot(p1, p2), joinpath(pwd(), &quot;binomials_$(n)_$(p).pdf&quot;))"><pre>julia<span class="pl-k">&gt;</span> <span class="pl-k">using</span> MarsagliaDiscreteSamplers, BenchmarkTools

julia<span class="pl-k">&gt;</span> <span class="pl-en">pmf</span>(i, n, p) <span class="pl-k">=</span> <span class="pl-c1">binomial</span>(n, i) <span class="pl-k">*</span> p<span class="pl-k">^</span>i <span class="pl-k">*</span> (<span class="pl-c1">1</span><span class="pl-k">-</span>p)<span class="pl-k">^</span>(n<span class="pl-k">-</span>i);

julia<span class="pl-k">&gt;</span> n <span class="pl-k">=</span> <span class="pl-c1">3</span>; p <span class="pl-k">=</span> <span class="pl-c1">0.3</span>;

julia<span class="pl-k">&gt;</span> ğ“… <span class="pl-k">=</span> <span class="pl-c1">pmf</span>.(<span class="pl-c1">0</span><span class="pl-k">:</span>n, n, p)
<span class="pl-c1">4</span><span class="pl-k">-</span>element Vector{Float64}<span class="pl-k">:</span>
 <span class="pl-c1">0.3429999999999999</span>
 <span class="pl-c1">0.4409999999999999</span>
 <span class="pl-c1">0.189</span>
 <span class="pl-c1">0.027</span>

julia<span class="pl-k">&gt;</span> z <span class="pl-k">=</span> <span class="pl-c1">SqHist</span>(ğ“…);

julia<span class="pl-k">&gt;</span> x <span class="pl-k">=</span> <span class="pl-c1">generate</span>(z, <span class="pl-c1">10</span><span class="pl-k">^</span><span class="pl-c1">6</span>);

julia<span class="pl-k">&gt;</span> <span class="pl-en">f</span>(x) <span class="pl-k">=</span> x <span class="pl-k">-</span> <span class="pl-c1">1</span>

julia<span class="pl-k">&gt;</span> y <span class="pl-k">=</span> <span class="pl-c1">f</span>.(x);

julia<span class="pl-k">&gt;</span> <span class="pl-c1">@benchmark</span> <span class="pl-c1">generate!</span>(<span class="pl-k">$</span>x, <span class="pl-k">$</span>z)
BenchmarkTools<span class="pl-k">.</span>Trial<span class="pl-k">:</span> <span class="pl-c1">3117</span> samples with <span class="pl-c1">1</span> evaluation.
 Range (min â€¦ max)<span class="pl-k">:</span>  <span class="pl-c1">1.380</span> ms â€¦   <span class="pl-c1">4.139</span> ms  â”Š GC (min â€¦ max)<span class="pl-k">:</span> <span class="pl-c1">0.00</span><span class="pl-k">%</span> â€¦ <span class="pl-c1">34.68</span><span class="pl-k">%</span>
 Time  (median)<span class="pl-k">:</span>     <span class="pl-c1">1.516</span> ms               â”Š GC (median)<span class="pl-k">:</span>    <span class="pl-c1">0.00</span><span class="pl-k">%</span>
 Time  (mean Â± Ïƒ)<span class="pl-k">:</span>   <span class="pl-c1">1.597</span> ms Â± <span class="pl-c1">350.273</span> Î¼s  â”Š GC (mean Â± Ïƒ)<span class="pl-k">:</span>  <span class="pl-c1">5.63</span><span class="pl-k">%</span> Â± <span class="pl-c1">11.95</span><span class="pl-k">%</span>

 Memory estimate<span class="pl-k">:</span> <span class="pl-c1">7.63</span> MiB, allocs estimate<span class="pl-k">:</span> <span class="pl-c1">2.</span>

julia<span class="pl-k">&gt;</span> u <span class="pl-k">=</span> <span class="pl-c1">similar</span>(x, Float64); <span class="pl-c"><span class="pl-c">#</span> pre-allocate temporary storage for repeated calls</span>

julia<span class="pl-k">&gt;</span> <span class="pl-c1">@benchmark</span> <span class="pl-c1">generate!</span>(<span class="pl-k">$</span>x, <span class="pl-k">$</span>u, <span class="pl-k">$</span>z)
BenchmarkTools<span class="pl-k">.</span>Trial<span class="pl-k">:</span> <span class="pl-c1">5988</span> samples with <span class="pl-c1">1</span> evaluation.
 Range (min â€¦ max)<span class="pl-k">:</span>  <span class="pl-c1">825.778</span> Î¼s â€¦  <span class="pl-c1">1.622</span> ms  â”Š GC (min â€¦ max)<span class="pl-k">:</span> <span class="pl-c1">0.00</span><span class="pl-k">%</span> â€¦ <span class="pl-c1">0.00</span><span class="pl-k">%</span>
 Time  (median)<span class="pl-k">:</span>     <span class="pl-c1">827.810</span> Î¼s              â”Š GC (median)<span class="pl-k">:</span>    <span class="pl-c1">0.00</span><span class="pl-k">%</span>
 Time  (mean Â± Ïƒ)<span class="pl-k">:</span>   <span class="pl-c1">829.109</span> Î¼s Â± <span class="pl-c1">16.532</span> Î¼s  â”Š GC (mean Â± Ïƒ)<span class="pl-k">:</span>  <span class="pl-c1">0.00</span><span class="pl-k">%</span> Â± <span class="pl-c1">0.00</span><span class="pl-k">%</span>

 Memory estimate<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes, allocs estimate<span class="pl-k">:</span> <span class="pl-c1">0.</span>
 
julia<span class="pl-k">&gt;</span> <span class="pl-k">using</span> Distributions

julia<span class="pl-k">&gt;</span> d <span class="pl-k">=</span> <span class="pl-c1">Binomial</span>(n, p)
<span class="pl-c1">Binomial</span><span class="pl-c1">{Float64}</span>(n<span class="pl-k">=</span><span class="pl-c1">3</span>, p<span class="pl-k">=</span><span class="pl-c1">0.3</span>)

julia<span class="pl-k">&gt;</span> w <span class="pl-k">=</span> <span class="pl-c1">rand</span>(d, <span class="pl-c1">10</span><span class="pl-k">^</span><span class="pl-c1">6</span>);

julia<span class="pl-k">&gt;</span> <span class="pl-c1">@benchmark</span> <span class="pl-c1">rand!</span>(<span class="pl-k">$</span>d, <span class="pl-k">$</span>w)
BenchmarkTools<span class="pl-k">.</span>Trial<span class="pl-k">:</span> <span class="pl-c1">105</span> samples with <span class="pl-c1">1</span> evaluation.
 Range (min â€¦ max)<span class="pl-k">:</span>  <span class="pl-c1">47.509</span> ms â€¦  <span class="pl-c1">49.507</span> ms  â”Š GC (min â€¦ max)<span class="pl-k">:</span> <span class="pl-c1">0.00</span><span class="pl-k">%</span> â€¦ <span class="pl-c1">0.00</span><span class="pl-k">%</span>
 Time  (median)<span class="pl-k">:</span>     <span class="pl-c1">47.686</span> ms               â”Š GC (median)<span class="pl-k">:</span>    <span class="pl-c1">0.00</span><span class="pl-k">%</span>
 Time  (mean Â± Ïƒ)<span class="pl-k">:</span>   <span class="pl-c1">47.743</span> ms Â± <span class="pl-c1">266.732</span> Î¼s  â”Š GC (mean Â± Ïƒ)<span class="pl-k">:</span>  <span class="pl-c1">0.00</span><span class="pl-k">%</span> Â± <span class="pl-c1">0.00</span><span class="pl-k">%</span>
 
 Memory estimate<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes, allocs estimate<span class="pl-k">:</span> <span class="pl-c1">0.</span>
 
julia<span class="pl-k">&gt;</span> <span class="pl-k">using</span> Plots

julia<span class="pl-k">&gt;</span> <span class="pl-c1">gr</span>(size<span class="pl-k">=</span>(<span class="pl-c1">1200</span>,<span class="pl-c1">800</span>))

julia<span class="pl-k">&gt;</span> p1 <span class="pl-k">=</span> <span class="pl-c1">histogram</span>(y, label<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Marsaglia square histogram method<span class="pl-pds">"</span></span>);

julia<span class="pl-k">&gt;</span> p2 <span class="pl-k">=</span> <span class="pl-c1">histogram</span>(w, label<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Distributions<span class="pl-pds">"</span></span>);

julia<span class="pl-k">&gt;</span> <span class="pl-c1">savefig</span>(<span class="pl-c1">plot</span>(p1, p2), <span class="pl-c1">joinpath</span>(<span class="pl-c1">pwd</span>(), <span class="pl-s"><span class="pl-pds">"</span>binomials_<span class="pl-v">$(n)</span>_<span class="pl-v">$(p)</span>.pdf<span class="pl-pds">"</span></span>))</pre></div>
<p dir="auto"></p>
</details>
<h3 dir="auto"><a id="user-content-binomial100-099" class="anchor" aria-hidden="true" href="#binomial100-099"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a><code>Binomial(100, 0.99)</code></h3>
<details>
 
<p dir="auto">
</p><p dir="auto">It is often beneficial, but not strictly necessary, to use only the points at which the pmf has non-negligible mass.</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="julia&gt; using MarsagliaDiscreteSamplers, SpecialFunctions, BenchmarkTools

julia&gt; pmf(i, n, p) = exp(loggamma(n+1) - loggamma(i+1) - loggamma(n-i+1)) * p^i * (1-p)^(n-i);

julia&gt; n = 100; p = 0.99;

julia&gt; lb, ub = 80, 100;

julia&gt; ğ“… = pmf.(lb:ub, n, p)
21-element Vector{Float64}:
 2.3986500044707484e-20
 5.86336667759521e-19
 1.3449991122629671e-17
 2.887696889220166e-16
 5.785706981616233e-15
 1.0781835128094341e-13
 1.8617471122347987e-12
 2.965955744318942e-11
 4.337710276066538e-10
 5.790112143783152e-9
 7.006035693977694e-8
 7.621950919821446e-7
 7.381693771261788e-6
 6.286345663268353e-5
 0.000463450802621816
 0.0028977871237615923
 0.014941714856895579
 0.060999165807532
 0.18486481882487396
 0.36972963764971967
 0.3660323412732292

julia&gt; z = SqHist(ğ“…);

julia&gt; x = generate(z, 10^6);

julia&gt; f(x, lb) = x - 1 + lb

julia&gt; y = f.(x, lb);

julia&gt; @benchmark generate!($x, $z)
BenchmarkTools.Trial: 2795 samples with 1 evaluation.
 Range (min â€¦ max):  1.372 ms â€¦   3.968 ms  â”Š GC (min â€¦ max): 0.00% â€¦ 39.03%
 Time  (median):     1.524 ms               â”Š GC (median):    0.00%
 Time  (mean Â± Ïƒ):   1.782 ms Â± 588.526 Î¼s  â”Š GC (mean Â± Ïƒ):  6.31% Â± 12.23%

 Memory estimate: 7.63 MiB, allocs estimate: 2.

julia&gt; u = similar(x, Float64); # pre-allocate temporary storage for repeated calls

julia&gt; @benchmark generate!($x, $u, $z)
BenchmarkTools.Trial: 5984 samples with 1 evaluation.
 Range (min â€¦ max):  826.627 Î¼s â€¦  1.621 ms  â”Š GC (min â€¦ max): 0.00% â€¦ 0.00%
 Time  (median):     828.592 Î¼s              â”Š GC (median):    0.00%
 Time  (mean Â± Ïƒ):   829.513 Î¼s Â± 13.763 Î¼s  â”Š GC (mean Â± Ïƒ):  0.00% Â± 0.00%

 Memory estimate: 0 bytes, allocs estimate: 0.

julia&gt; using Distributions

julia&gt; d = Binomial(n, p)
Binomial{Float64}(n=100, p=0.99)

julia&gt; w = rand(d, 10^6);

julia&gt; @benchmark rand!($d, $w)
BenchmarkTools.Trial: 116 samples with 1 evaluation.
 Range (min â€¦ max):  42.929 ms â€¦  45.213 ms  â”Š GC (min â€¦ max): 0.00% â€¦ 0.00%
 Time  (median):     43.037 ms               â”Š GC (median):    0.00%
 Time  (mean Â± Ïƒ):   43.097 ms Â± 321.675 Î¼s  â”Š GC (mean Â± Ïƒ):  0.00% Â± 0.00%
 
 Memory estimate: 0 bytes, allocs estimate: 0.
 
julia&gt; using Plots

julia&gt; gr(size=(1200,800))

julia&gt; p1 = histogram(y, label=&quot;Marsaglia square histogram method&quot;);

julia&gt; p2 = histogram(w, label=&quot;Distributions&quot;);

julia&gt; savefig(plot(p1, p2), joinpath(pwd(), &quot;binomials_$(n)_$(p).pdf&quot;))"><pre>julia<span class="pl-k">&gt;</span> <span class="pl-k">using</span> MarsagliaDiscreteSamplers, SpecialFunctions, BenchmarkTools

julia<span class="pl-k">&gt;</span> <span class="pl-en">pmf</span>(i, n, p) <span class="pl-k">=</span> <span class="pl-c1">exp</span>(<span class="pl-c1">loggamma</span>(n<span class="pl-k">+</span><span class="pl-c1">1</span>) <span class="pl-k">-</span> <span class="pl-c1">loggamma</span>(i<span class="pl-k">+</span><span class="pl-c1">1</span>) <span class="pl-k">-</span> <span class="pl-c1">loggamma</span>(n<span class="pl-k">-</span>i<span class="pl-k">+</span><span class="pl-c1">1</span>)) <span class="pl-k">*</span> p<span class="pl-k">^</span>i <span class="pl-k">*</span> (<span class="pl-c1">1</span><span class="pl-k">-</span>p)<span class="pl-k">^</span>(n<span class="pl-k">-</span>i);

julia<span class="pl-k">&gt;</span> n <span class="pl-k">=</span> <span class="pl-c1">100</span>; p <span class="pl-k">=</span> <span class="pl-c1">0.99</span>;

julia<span class="pl-k">&gt;</span> lb, ub <span class="pl-k">=</span> <span class="pl-c1">80</span>, <span class="pl-c1">100</span>;

julia<span class="pl-k">&gt;</span> ğ“… <span class="pl-k">=</span> <span class="pl-c1">pmf</span>.(lb<span class="pl-k">:</span>ub, n, p)
<span class="pl-c1">21</span><span class="pl-k">-</span>element Vector{Float64}<span class="pl-k">:</span>
 <span class="pl-c1">2.3986500044707484e-20</span>
 <span class="pl-c1">5.86336667759521e-19</span>
 <span class="pl-c1">1.3449991122629671e-17</span>
 <span class="pl-c1">2.887696889220166e-16</span>
 <span class="pl-c1">5.785706981616233e-15</span>
 <span class="pl-c1">1.0781835128094341e-13</span>
 <span class="pl-c1">1.8617471122347987e-12</span>
 <span class="pl-c1">2.965955744318942e-11</span>
 <span class="pl-c1">4.337710276066538e-10</span>
 <span class="pl-c1">5.790112143783152e-9</span>
 <span class="pl-c1">7.006035693977694e-8</span>
 <span class="pl-c1">7.621950919821446e-7</span>
 <span class="pl-c1">7.381693771261788e-6</span>
 <span class="pl-c1">6.286345663268353e-5</span>
 <span class="pl-c1">0.000463450802621816</span>
 <span class="pl-c1">0.0028977871237615923</span>
 <span class="pl-c1">0.014941714856895579</span>
 <span class="pl-c1">0.060999165807532</span>
 <span class="pl-c1">0.18486481882487396</span>
 <span class="pl-c1">0.36972963764971967</span>
 <span class="pl-c1">0.3660323412732292</span>

julia<span class="pl-k">&gt;</span> z <span class="pl-k">=</span> <span class="pl-c1">SqHist</span>(ğ“…);

julia<span class="pl-k">&gt;</span> x <span class="pl-k">=</span> <span class="pl-c1">generate</span>(z, <span class="pl-c1">10</span><span class="pl-k">^</span><span class="pl-c1">6</span>);

julia<span class="pl-k">&gt;</span> <span class="pl-en">f</span>(x, lb) <span class="pl-k">=</span> x <span class="pl-k">-</span> <span class="pl-c1">1</span> <span class="pl-k">+</span> lb

julia<span class="pl-k">&gt;</span> y <span class="pl-k">=</span> <span class="pl-c1">f</span>.(x, lb);

julia<span class="pl-k">&gt;</span> <span class="pl-c1">@benchmark</span> <span class="pl-c1">generate!</span>(<span class="pl-k">$</span>x, <span class="pl-k">$</span>z)
BenchmarkTools<span class="pl-k">.</span>Trial<span class="pl-k">:</span> <span class="pl-c1">2795</span> samples with <span class="pl-c1">1</span> evaluation.
 Range (min â€¦ max)<span class="pl-k">:</span>  <span class="pl-c1">1.372</span> ms â€¦   <span class="pl-c1">3.968</span> ms  â”Š GC (min â€¦ max)<span class="pl-k">:</span> <span class="pl-c1">0.00</span><span class="pl-k">%</span> â€¦ <span class="pl-c1">39.03</span><span class="pl-k">%</span>
 Time  (median)<span class="pl-k">:</span>     <span class="pl-c1">1.524</span> ms               â”Š GC (median)<span class="pl-k">:</span>    <span class="pl-c1">0.00</span><span class="pl-k">%</span>
 Time  (mean Â± Ïƒ)<span class="pl-k">:</span>   <span class="pl-c1">1.782</span> ms Â± <span class="pl-c1">588.526</span> Î¼s  â”Š GC (mean Â± Ïƒ)<span class="pl-k">:</span>  <span class="pl-c1">6.31</span><span class="pl-k">%</span> Â± <span class="pl-c1">12.23</span><span class="pl-k">%</span>

 Memory estimate<span class="pl-k">:</span> <span class="pl-c1">7.63</span> MiB, allocs estimate<span class="pl-k">:</span> <span class="pl-c1">2.</span>

julia<span class="pl-k">&gt;</span> u <span class="pl-k">=</span> <span class="pl-c1">similar</span>(x, Float64); <span class="pl-c"><span class="pl-c">#</span> pre-allocate temporary storage for repeated calls</span>

julia<span class="pl-k">&gt;</span> <span class="pl-c1">@benchmark</span> <span class="pl-c1">generate!</span>(<span class="pl-k">$</span>x, <span class="pl-k">$</span>u, <span class="pl-k">$</span>z)
BenchmarkTools<span class="pl-k">.</span>Trial<span class="pl-k">:</span> <span class="pl-c1">5984</span> samples with <span class="pl-c1">1</span> evaluation.
 Range (min â€¦ max)<span class="pl-k">:</span>  <span class="pl-c1">826.627</span> Î¼s â€¦  <span class="pl-c1">1.621</span> ms  â”Š GC (min â€¦ max)<span class="pl-k">:</span> <span class="pl-c1">0.00</span><span class="pl-k">%</span> â€¦ <span class="pl-c1">0.00</span><span class="pl-k">%</span>
 Time  (median)<span class="pl-k">:</span>     <span class="pl-c1">828.592</span> Î¼s              â”Š GC (median)<span class="pl-k">:</span>    <span class="pl-c1">0.00</span><span class="pl-k">%</span>
 Time  (mean Â± Ïƒ)<span class="pl-k">:</span>   <span class="pl-c1">829.513</span> Î¼s Â± <span class="pl-c1">13.763</span> Î¼s  â”Š GC (mean Â± Ïƒ)<span class="pl-k">:</span>  <span class="pl-c1">0.00</span><span class="pl-k">%</span> Â± <span class="pl-c1">0.00</span><span class="pl-k">%</span>

 Memory estimate<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes, allocs estimate<span class="pl-k">:</span> <span class="pl-c1">0.</span>

julia<span class="pl-k">&gt;</span> <span class="pl-k">using</span> Distributions

julia<span class="pl-k">&gt;</span> d <span class="pl-k">=</span> <span class="pl-c1">Binomial</span>(n, p)
<span class="pl-c1">Binomial</span><span class="pl-c1">{Float64}</span>(n<span class="pl-k">=</span><span class="pl-c1">100</span>, p<span class="pl-k">=</span><span class="pl-c1">0.99</span>)

julia<span class="pl-k">&gt;</span> w <span class="pl-k">=</span> <span class="pl-c1">rand</span>(d, <span class="pl-c1">10</span><span class="pl-k">^</span><span class="pl-c1">6</span>);

julia<span class="pl-k">&gt;</span> <span class="pl-c1">@benchmark</span> <span class="pl-c1">rand!</span>(<span class="pl-k">$</span>d, <span class="pl-k">$</span>w)
BenchmarkTools<span class="pl-k">.</span>Trial<span class="pl-k">:</span> <span class="pl-c1">116</span> samples with <span class="pl-c1">1</span> evaluation.
 Range (min â€¦ max)<span class="pl-k">:</span>  <span class="pl-c1">42.929</span> ms â€¦  <span class="pl-c1">45.213</span> ms  â”Š GC (min â€¦ max)<span class="pl-k">:</span> <span class="pl-c1">0.00</span><span class="pl-k">%</span> â€¦ <span class="pl-c1">0.00</span><span class="pl-k">%</span>
 Time  (median)<span class="pl-k">:</span>     <span class="pl-c1">43.037</span> ms               â”Š GC (median)<span class="pl-k">:</span>    <span class="pl-c1">0.00</span><span class="pl-k">%</span>
 Time  (mean Â± Ïƒ)<span class="pl-k">:</span>   <span class="pl-c1">43.097</span> ms Â± <span class="pl-c1">321.675</span> Î¼s  â”Š GC (mean Â± Ïƒ)<span class="pl-k">:</span>  <span class="pl-c1">0.00</span><span class="pl-k">%</span> Â± <span class="pl-c1">0.00</span><span class="pl-k">%</span>
 
 Memory estimate<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes, allocs estimate<span class="pl-k">:</span> <span class="pl-c1">0.</span>
 
julia<span class="pl-k">&gt;</span> <span class="pl-k">using</span> Plots

julia<span class="pl-k">&gt;</span> <span class="pl-c1">gr</span>(size<span class="pl-k">=</span>(<span class="pl-c1">1200</span>,<span class="pl-c1">800</span>))

julia<span class="pl-k">&gt;</span> p1 <span class="pl-k">=</span> <span class="pl-c1">histogram</span>(y, label<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Marsaglia square histogram method<span class="pl-pds">"</span></span>);

julia<span class="pl-k">&gt;</span> p2 <span class="pl-k">=</span> <span class="pl-c1">histogram</span>(w, label<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Distributions<span class="pl-pds">"</span></span>);

julia<span class="pl-k">&gt;</span> <span class="pl-c1">savefig</span>(<span class="pl-c1">plot</span>(p1, p2), <span class="pl-c1">joinpath</span>(<span class="pl-c1">pwd</span>(), <span class="pl-s"><span class="pl-pds">"</span>binomials_<span class="pl-v">$(n)</span>_<span class="pl-v">$(p)</span>.pdf<span class="pl-pds">"</span></span>))</pre></div>
<p dir="auto"></p>
</details>
<h3 dir="auto"><a id="user-content-categorical03-02-0--0-05" class="anchor" aria-hidden="true" href="#categorical03-02-0--0-05"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a><code>Categorical([0.3, 0.2, 0, â€¦, 0, 0.5])</code></h3>
<details>
 
<p dir="auto">
</p><p dir="auto">Far more efficient to sample from sparse pmf's using an approach such as below, though,
one does not begin to truly realize the gains until <code>n</code> becomes larger than can be held in the L2 cache.</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="julia&gt; using MarsagliaDiscreteSamplers, BenchmarkTools

julia&gt; n = 10^4

julia&gt; p = [0.3; 0.2; fill(0.0, n - 3); 0.5];

julia&gt; pâ€² = [0.3, 0.2, 0.5];

julia&gt; I = [1, 2, n];

julia&gt; z = SqHist(pâ€²);

julia&gt; x = generate(z, 10^6);

julia&gt; f(x) = I[x];

julia&gt; y = f.(x);

julia&gt; @benchmark generate!($x, $z)
BenchmarkTools.Trial: 3162 samples with 1 evaluation.
 Range (min â€¦ max):  1.349 ms â€¦   4.729 ms  â”Š GC (min â€¦ max): 0.00% â€¦ 69.94%
 Time  (median):     1.499 ms               â”Š GC (median):    0.00%
 Time  (mean Â± Ïƒ):   1.574 ms Â± 347.685 Î¼s  â”Š GC (mean Â± Ïƒ):  5.59% Â± 12.02%

 Memory estimate: 7.63 MiB, allocs estimate: 2.

julia&gt; u = similar(x, Float64); # pre-allocate temporary storage for repeated calls

julia&gt; @benchmark generate!($x, $u, $z)
BenchmarkTools.Trial: 6117 samples with 1 evaluation.
 Range (min â€¦ max):  808.113 Î¼s â€¦  1.616 ms  â”Š GC (min â€¦ max): 0.00% â€¦ 0.00%
 Time  (median):     809.980 Î¼s              â”Š GC (median):    0.00%
 Time  (mean Â± Ïƒ):   811.404 Î¼s Â± 16.157 Î¼s  â”Š GC (mean Â± Ïƒ):  0.00% Â± 0.00%

 Memory estimate: 0 bytes, allocs estimate: 0.

julia&gt; using Distributions

julia&gt; d = Categorical(p);

julia&gt; w = rand(d, 10^6);

julia&gt; @benchmark rand!($d, $w)
BenchmarkTools.Trial: 664 samples with 1 evaluation.
 Range (min â€¦ max):  7.000 ms â€¦  10.171 ms  â”Š GC (min â€¦ max): 0.00% â€¦ 0.00%
 Time  (median):     7.467 ms               â”Š GC (median):    0.00%
 Time  (mean Â± Ïƒ):   7.527 ms Â± 303.820 Î¼s  â”Š GC (mean Â± Ïƒ):  0.03% Â± 0.72%

 Memory estimate: 312.69 KiB, allocs estimate: 8.
 
julia&gt; using Plots

julia&gt; gr(size=(1200,800))

# Difficult to distinguish on plots

julia&gt; p1 = histogram(y, label=&quot;Marsaglia square histogram method&quot;, bins=n);

julia&gt; p2 = histogram(w, label=&quot;Distributions&quot;, bins=n);

julia&gt; savefig(plot(p1, p2), joinpath(pwd(), &quot;categoricals_$(n).pdf&quot;))

julia&gt; function unsafe_countcategory!(v::AbstractArray, A::AbstractArray)
           @inbounds for i âˆˆ eachindex(A)
               v[A[i]] += 1
           end
           v
       end;

julia&gt; unsafe_countcategory(A, n::Int) = unsafe_countcategory!(zeros(Int, n), A);

julia&gt; unsafe_countcategory(y, n)[I]
3-element Vector{Float64}:
 0.300233
 0.199834
 0.499933

julia&gt; unsafe_countcategory(w, n)[I]
3-element Vector{Float64}:
 0.299828
 0.199998
 0.500174"><pre>julia<span class="pl-k">&gt;</span> <span class="pl-k">using</span> MarsagliaDiscreteSamplers, BenchmarkTools

julia<span class="pl-k">&gt;</span> n <span class="pl-k">=</span> <span class="pl-c1">10</span><span class="pl-k">^</span><span class="pl-c1">4</span>

julia<span class="pl-k">&gt;</span> p <span class="pl-k">=</span> [<span class="pl-c1">0.3</span>; <span class="pl-c1">0.2</span>; <span class="pl-c1">fill</span>(<span class="pl-c1">0.0</span>, n <span class="pl-k">-</span> <span class="pl-c1">3</span>); <span class="pl-c1">0.5</span>];

julia<span class="pl-k">&gt;</span> pâ€² <span class="pl-k">=</span> [<span class="pl-c1">0.3</span>, <span class="pl-c1">0.2</span>, <span class="pl-c1">0.5</span>];

julia<span class="pl-k">&gt;</span> I <span class="pl-k">=</span> [<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, n];

julia<span class="pl-k">&gt;</span> z <span class="pl-k">=</span> <span class="pl-c1">SqHist</span>(pâ€²);

julia<span class="pl-k">&gt;</span> x <span class="pl-k">=</span> <span class="pl-c1">generate</span>(z, <span class="pl-c1">10</span><span class="pl-k">^</span><span class="pl-c1">6</span>);

julia<span class="pl-k">&gt;</span> <span class="pl-en">f</span>(x) <span class="pl-k">=</span> I[x];

julia<span class="pl-k">&gt;</span> y <span class="pl-k">=</span> <span class="pl-c1">f</span>.(x);

julia<span class="pl-k">&gt;</span> <span class="pl-c1">@benchmark</span> <span class="pl-c1">generate!</span>(<span class="pl-k">$</span>x, <span class="pl-k">$</span>z)
BenchmarkTools<span class="pl-k">.</span>Trial<span class="pl-k">:</span> <span class="pl-c1">3162</span> samples with <span class="pl-c1">1</span> evaluation.
 Range (min â€¦ max)<span class="pl-k">:</span>  <span class="pl-c1">1.349</span> ms â€¦   <span class="pl-c1">4.729</span> ms  â”Š GC (min â€¦ max)<span class="pl-k">:</span> <span class="pl-c1">0.00</span><span class="pl-k">%</span> â€¦ <span class="pl-c1">69.94</span><span class="pl-k">%</span>
 Time  (median)<span class="pl-k">:</span>     <span class="pl-c1">1.499</span> ms               â”Š GC (median)<span class="pl-k">:</span>    <span class="pl-c1">0.00</span><span class="pl-k">%</span>
 Time  (mean Â± Ïƒ)<span class="pl-k">:</span>   <span class="pl-c1">1.574</span> ms Â± <span class="pl-c1">347.685</span> Î¼s  â”Š GC (mean Â± Ïƒ)<span class="pl-k">:</span>  <span class="pl-c1">5.59</span><span class="pl-k">%</span> Â± <span class="pl-c1">12.02</span><span class="pl-k">%</span>

 Memory estimate<span class="pl-k">:</span> <span class="pl-c1">7.63</span> MiB, allocs estimate<span class="pl-k">:</span> <span class="pl-c1">2.</span>

julia<span class="pl-k">&gt;</span> u <span class="pl-k">=</span> <span class="pl-c1">similar</span>(x, Float64); <span class="pl-c"><span class="pl-c">#</span> pre-allocate temporary storage for repeated calls</span>

julia<span class="pl-k">&gt;</span> <span class="pl-c1">@benchmark</span> <span class="pl-c1">generate!</span>(<span class="pl-k">$</span>x, <span class="pl-k">$</span>u, <span class="pl-k">$</span>z)
BenchmarkTools<span class="pl-k">.</span>Trial<span class="pl-k">:</span> <span class="pl-c1">6117</span> samples with <span class="pl-c1">1</span> evaluation.
 Range (min â€¦ max)<span class="pl-k">:</span>  <span class="pl-c1">808.113</span> Î¼s â€¦  <span class="pl-c1">1.616</span> ms  â”Š GC (min â€¦ max)<span class="pl-k">:</span> <span class="pl-c1">0.00</span><span class="pl-k">%</span> â€¦ <span class="pl-c1">0.00</span><span class="pl-k">%</span>
 Time  (median)<span class="pl-k">:</span>     <span class="pl-c1">809.980</span> Î¼s              â”Š GC (median)<span class="pl-k">:</span>    <span class="pl-c1">0.00</span><span class="pl-k">%</span>
 Time  (mean Â± Ïƒ)<span class="pl-k">:</span>   <span class="pl-c1">811.404</span> Î¼s Â± <span class="pl-c1">16.157</span> Î¼s  â”Š GC (mean Â± Ïƒ)<span class="pl-k">:</span>  <span class="pl-c1">0.00</span><span class="pl-k">%</span> Â± <span class="pl-c1">0.00</span><span class="pl-k">%</span>

 Memory estimate<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes, allocs estimate<span class="pl-k">:</span> <span class="pl-c1">0.</span>

julia<span class="pl-k">&gt;</span> <span class="pl-k">using</span> Distributions

julia<span class="pl-k">&gt;</span> d <span class="pl-k">=</span> <span class="pl-c1">Categorical</span>(p);

julia<span class="pl-k">&gt;</span> w <span class="pl-k">=</span> <span class="pl-c1">rand</span>(d, <span class="pl-c1">10</span><span class="pl-k">^</span><span class="pl-c1">6</span>);

julia<span class="pl-k">&gt;</span> <span class="pl-c1">@benchmark</span> <span class="pl-c1">rand!</span>(<span class="pl-k">$</span>d, <span class="pl-k">$</span>w)
BenchmarkTools<span class="pl-k">.</span>Trial<span class="pl-k">:</span> <span class="pl-c1">664</span> samples with <span class="pl-c1">1</span> evaluation.
 Range (min â€¦ max)<span class="pl-k">:</span>  <span class="pl-c1">7.000</span> ms â€¦  <span class="pl-c1">10.171</span> ms  â”Š GC (min â€¦ max)<span class="pl-k">:</span> <span class="pl-c1">0.00</span><span class="pl-k">%</span> â€¦ <span class="pl-c1">0.00</span><span class="pl-k">%</span>
 Time  (median)<span class="pl-k">:</span>     <span class="pl-c1">7.467</span> ms               â”Š GC (median)<span class="pl-k">:</span>    <span class="pl-c1">0.00</span><span class="pl-k">%</span>
 Time  (mean Â± Ïƒ)<span class="pl-k">:</span>   <span class="pl-c1">7.527</span> ms Â± <span class="pl-c1">303.820</span> Î¼s  â”Š GC (mean Â± Ïƒ)<span class="pl-k">:</span>  <span class="pl-c1">0.03</span><span class="pl-k">%</span> Â± <span class="pl-c1">0.72</span><span class="pl-k">%</span>

 Memory estimate<span class="pl-k">:</span> <span class="pl-c1">312.69</span> KiB, allocs estimate<span class="pl-k">:</span> <span class="pl-c1">8.</span>
 
julia<span class="pl-k">&gt;</span> <span class="pl-k">using</span> Plots

julia<span class="pl-k">&gt;</span> <span class="pl-c1">gr</span>(size<span class="pl-k">=</span>(<span class="pl-c1">1200</span>,<span class="pl-c1">800</span>))

<span class="pl-c"><span class="pl-c">#</span> Difficult to distinguish on plots</span>

julia<span class="pl-k">&gt;</span> p1 <span class="pl-k">=</span> <span class="pl-c1">histogram</span>(y, label<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Marsaglia square histogram method<span class="pl-pds">"</span></span>, bins<span class="pl-k">=</span>n);

julia<span class="pl-k">&gt;</span> p2 <span class="pl-k">=</span> <span class="pl-c1">histogram</span>(w, label<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Distributions<span class="pl-pds">"</span></span>, bins<span class="pl-k">=</span>n);

julia<span class="pl-k">&gt;</span> <span class="pl-c1">savefig</span>(<span class="pl-c1">plot</span>(p1, p2), <span class="pl-c1">joinpath</span>(<span class="pl-c1">pwd</span>(), <span class="pl-s"><span class="pl-pds">"</span>categoricals_<span class="pl-v">$(n)</span>.pdf<span class="pl-pds">"</span></span>))

julia<span class="pl-k">&gt;</span> <span class="pl-k">function</span> <span class="pl-en">unsafe_countcategory!</span>(v<span class="pl-k">::</span><span class="pl-c1">AbstractArray</span>, A<span class="pl-k">::</span><span class="pl-c1">AbstractArray</span>)
           <span class="pl-c1">@inbounds</span> <span class="pl-k">for</span> i <span class="pl-k">âˆˆ</span> <span class="pl-c1">eachindex</span>(A)
               v[A[i]] <span class="pl-k">+=</span> <span class="pl-c1">1</span>
           <span class="pl-k">end</span>
           v
       <span class="pl-k">end</span>;

julia<span class="pl-k">&gt;</span> <span class="pl-en">unsafe_countcategory</span>(A, n<span class="pl-k">::</span><span class="pl-c1">Int</span>) <span class="pl-k">=</span> <span class="pl-c1">unsafe_countcategory!</span>(<span class="pl-c1">zeros</span>(Int, n), A);

julia<span class="pl-k">&gt;</span> <span class="pl-c1">unsafe_countcategory</span>(y, n)[I]
<span class="pl-c1">3</span><span class="pl-k">-</span>element Vector{Float64}<span class="pl-k">:</span>
 <span class="pl-c1">0.300233</span>
 <span class="pl-c1">0.199834</span>
 <span class="pl-c1">0.499933</span>

julia<span class="pl-k">&gt;</span> <span class="pl-c1">unsafe_countcategory</span>(w, n)[I]
<span class="pl-c1">3</span><span class="pl-k">-</span>element Vector{Float64}<span class="pl-k">:</span>
 <span class="pl-c1">0.299828</span>
 <span class="pl-c1">0.199998</span>
 <span class="pl-c1">0.500174</span></pre></div>
<p dir="auto"></p>
</details>
<h3 dir="auto"><a id="user-content-comparison-to-results-from-article-itself" class="anchor" aria-hidden="true" href="#comparison-to-results-from-article-itself"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Comparison to results from article itself</h3>
<details>
 
<p dir="auto">
</p><p dir="auto">In Section 6 of the article, 3 tables of comparisons are given. The following replicates those
tables, using what is ultimately a simplification of "Method II" -- proceed straight to
the square histogram method, skipping the alias table. It turns out that for a vectorized sampler,
skipping the alias table portion of Method II yields faster code, as the square histogram step can be
made branchless. Further testing is needed to determine under what circumstances the branch (alias table or square histogram) may be worthwhile.</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="julia&gt; using MarsagliaDiscreteSamplers, Distributions, BenchmarkTools

julia&gt; n_sample = 10^8; A = Vector{Int}(undef, n_sample); U = similar(A, Float64);

# Time required to draw 10^8 samples from Binomial

julia&gt; for n âˆˆ [20, 100, 1000, 10000, 100000]
           println(&quot;n = &quot;, n)
           for Ï âˆˆ (.1, .4)
               println(&quot;\t p = &quot;, Ï)
               d = Binomial(n, Ï)
               p = map(n -&gt; pdf(d, n), 0:n)
               K, V = sqhist(p)
               @btime generate!($A, $U, $K, $V)
           end
       end
n = 20
         p = 0.1
  168.665 ms (0 allocations: 0 bytes)
         p = 0.4
  168.530 ms (0 allocations: 0 bytes)
n = 100
         p = 0.1
  169.132 ms (0 allocations: 0 bytes)
         p = 0.4
  168.981 ms (0 allocations: 0 bytes)
n = 1000
         p = 0.1
  169.180 ms (0 allocations: 0 bytes)
         p = 0.4
  169.197 ms (0 allocations: 0 bytes)
n = 10000
         p = 0.1
  190.279 ms (0 allocations: 0 bytes)
         p = 0.4
  190.923 ms (0 allocations: 0 bytes)
n = 100000
         p = 0.1
  318.831 ms (0 allocations: 0 bytes)
         p = 0.4
  315.848 ms (0 allocations: 0 bytes)
  
# Time required to draw 10^8 samples from Poisson

julia&gt; for Î» âˆˆ [1, 10, 25, 100, 250, 1000]
           println(&quot;Î» = &quot;, Î»)
           d = Poisson(Î»)
           p = map(n -&gt; pdf(d, n), 0:max(1.5Î», 100))
           K, V = sqhist(p)
           @btime generate!($A, $U, $K, $V)
       end

Î» = 1
  169.456 ms (0 allocations: 0 bytes)
Î» = 10
  169.094 ms (0 allocations: 0 bytes)
Î» = 25
  168.813 ms (0 allocations: 0 bytes)
Î» = 100
  168.890 ms (0 allocations: 0 bytes)
Î» = 250
  169.144 ms (0 allocations: 0 bytes)
Î» = 1000
  169.457 ms (0 allocations: 0 bytes)

  
# Time required to draw 10^8 samples from Hypergeometric
# -- admittedly, not entirely clear that these are the parameterizations from the article
# This assumes that N1 is number of draws, N2 the population size and K the number of success states

julia&gt; for (N1, N2, K) âˆˆ [(20, 20, 20), (100, 100, 20), (100, 100, 100), (100, 1000, 100),
                          (1000, 1000, 100), (1000, 1000, 1000), (1000, 10000, 100),
                          (1000, 10000, 1000), (10000, 10000, 1000), (10000, 10000, 10000)]
           println(&quot;N1 = &quot;, N1, &quot; N2 = &quot;, N2, &quot; K = &quot;, K)
           ğ‘ , ğ‘“, ğ‘› = K, N2 - K, N1
           d = Hypergeometric(ğ‘ , ğ‘“, ğ‘›)
           p = map(n -&gt; pdf(d, n), support(d))
           K, V = sqhist(p)
           @btime generate!($A, $U, $K, $V)
       end
N1 = 20 N2 = 20 K = 20
  62.897 ms (0 allocations: 0 bytes)
N1 = 100 N2 = 100 K = 20
  62.913 ms (0 allocations: 0 bytes)
N1 = 100 N2 = 100 K = 100
  62.929 ms (0 allocations: 0 bytes)
N1 = 100 N2 = 1000 K = 100
  170.922 ms (0 allocations: 0 bytes)
N1 = 1000 N2 = 1000 K = 100
  62.888 ms (0 allocations: 0 bytes)
N1 = 1000 N2 = 1000 K = 1000
  62.919 ms (0 allocations: 0 bytes)
N1 = 1000 N2 = 10000 K = 100
  170.938 ms (0 allocations: 0 bytes)
N1 = 1000 N2 = 10000 K = 1000
  171.234 ms (0 allocations: 0 bytes)
N1 = 10000 N2 = 10000 K = 1000
  62.914 ms (0 allocations: 0 bytes)
N1 = 10000 N2 = 10000 K = 10000
  62.889 ms (0 allocations: 0 bytes)
  
# It could alternatively be N1 the number of draws, N2 the number of failures and K the
# number of success states -- this gives a more reasonable range of support.
# Alas, the files attached to the paper seem to be missing the hypergeometric distribution

julia&gt; for (N1, N2, K) âˆˆ [(20, 20, 20), (100, 100, 20), (100, 100, 100), (100, 1000, 100),
                          (1000, 1000, 100), (1000, 1000, 1000), (1000, 10000, 100),
                          (1000, 10000, 1000), (10000, 10000, 1000), (10000, 10000, 10000)]
           println(&quot;N1 = &quot;, N1, &quot; N2 = &quot;, N2, &quot; K = &quot;, K)
           ğ‘ , ğ‘“, ğ‘› = K, N2, N1
           d = Hypergeometric(ğ‘ , ğ‘“, ğ‘›)
           p = map(n -&gt; pdf(d, n), support(d))
           K, V = sqhist(p)
           @btime generate!($A, $U, $K, $V)
       end
N1 = 20 N2 = 20 K = 20
  170.708 ms (0 allocations: 0 bytes)
N1 = 100 N2 = 100 K = 20
  170.384 ms (0 allocations: 0 bytes)
N1 = 100 N2 = 100 K = 100
  170.881 ms (0 allocations: 0 bytes)
N1 = 100 N2 = 1000 K = 100
  170.931 ms (0 allocations: 0 bytes)
N1 = 1000 N2 = 1000 K = 100
  170.873 ms (0 allocations: 0 bytes)
N1 = 1000 N2 = 1000 K = 1000
  170.993 ms (0 allocations: 0 bytes)
N1 = 1000 N2 = 10000 K = 100
  170.966 ms (0 allocations: 0 bytes)
N1 = 1000 N2 = 10000 K = 1000
  171.030 ms (0 allocations: 0 bytes)
N1 = 10000 N2 = 10000 K = 1000
  171.167 ms (0 allocations: 0 bytes)
N1 = 10000 N2 = 10000 K = 10000
  192.990 ms (0 allocations: 0 bytes)"><pre>julia<span class="pl-k">&gt;</span> <span class="pl-k">using</span> MarsagliaDiscreteSamplers, Distributions, BenchmarkTools

julia<span class="pl-k">&gt;</span> n_sample <span class="pl-k">=</span> <span class="pl-c1">10</span><span class="pl-k">^</span><span class="pl-c1">8</span>; A <span class="pl-k">=</span> <span class="pl-c1">Vector</span><span class="pl-c1">{Int}</span>(undef, n_sample); U <span class="pl-k">=</span> <span class="pl-c1">similar</span>(A, Float64);

<span class="pl-c"><span class="pl-c">#</span> Time required to draw 10^8 samples from Binomial</span>

julia<span class="pl-k">&gt;</span> <span class="pl-k">for</span> n <span class="pl-k">âˆˆ</span> [<span class="pl-c1">20</span>, <span class="pl-c1">100</span>, <span class="pl-c1">1000</span>, <span class="pl-c1">10000</span>, <span class="pl-c1">100000</span>]
           <span class="pl-c1">println</span>(<span class="pl-s"><span class="pl-pds">"</span>n = <span class="pl-pds">"</span></span>, n)
           <span class="pl-k">for</span> Ï <span class="pl-k">âˆˆ</span> (.<span class="pl-c1">1</span>, .<span class="pl-c1">4</span>)
               <span class="pl-c1">println</span>(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\t</span> p = <span class="pl-pds">"</span></span>, Ï)
               d <span class="pl-k">=</span> <span class="pl-c1">Binomial</span>(n, Ï)
               p <span class="pl-k">=</span> <span class="pl-c1">map</span>(n <span class="pl-k">-&gt;</span> <span class="pl-c1">pdf</span>(d, n), <span class="pl-c1">0</span><span class="pl-k">:</span>n)
               K, V <span class="pl-k">=</span> <span class="pl-c1">sqhist</span>(p)
               <span class="pl-c1">@btime</span> <span class="pl-c1">generate!</span>(<span class="pl-k">$</span>A, <span class="pl-k">$</span>U, <span class="pl-k">$</span>K, <span class="pl-k">$</span>V)
           <span class="pl-k">end</span>
       <span class="pl-k">end</span>
n <span class="pl-k">=</span> <span class="pl-c1">20</span>
         p <span class="pl-k">=</span> <span class="pl-c1">0.1</span>
  <span class="pl-c1">168.665</span> ms (<span class="pl-c1">0</span> allocations<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes)
         p <span class="pl-k">=</span> <span class="pl-c1">0.4</span>
  <span class="pl-c1">168.530</span> ms (<span class="pl-c1">0</span> allocations<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes)
n <span class="pl-k">=</span> <span class="pl-c1">100</span>
         p <span class="pl-k">=</span> <span class="pl-c1">0.1</span>
  <span class="pl-c1">169.132</span> ms (<span class="pl-c1">0</span> allocations<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes)
         p <span class="pl-k">=</span> <span class="pl-c1">0.4</span>
  <span class="pl-c1">168.981</span> ms (<span class="pl-c1">0</span> allocations<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes)
n <span class="pl-k">=</span> <span class="pl-c1">1000</span>
         p <span class="pl-k">=</span> <span class="pl-c1">0.1</span>
  <span class="pl-c1">169.180</span> ms (<span class="pl-c1">0</span> allocations<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes)
         p <span class="pl-k">=</span> <span class="pl-c1">0.4</span>
  <span class="pl-c1">169.197</span> ms (<span class="pl-c1">0</span> allocations<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes)
n <span class="pl-k">=</span> <span class="pl-c1">10000</span>
         p <span class="pl-k">=</span> <span class="pl-c1">0.1</span>
  <span class="pl-c1">190.279</span> ms (<span class="pl-c1">0</span> allocations<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes)
         p <span class="pl-k">=</span> <span class="pl-c1">0.4</span>
  <span class="pl-c1">190.923</span> ms (<span class="pl-c1">0</span> allocations<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes)
n <span class="pl-k">=</span> <span class="pl-c1">100000</span>
         p <span class="pl-k">=</span> <span class="pl-c1">0.1</span>
  <span class="pl-c1">318.831</span> ms (<span class="pl-c1">0</span> allocations<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes)
         p <span class="pl-k">=</span> <span class="pl-c1">0.4</span>
  <span class="pl-c1">315.848</span> ms (<span class="pl-c1">0</span> allocations<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes)
  
<span class="pl-c"><span class="pl-c">#</span> Time required to draw 10^8 samples from Poisson</span>

julia<span class="pl-k">&gt;</span> <span class="pl-k">for</span> Î» <span class="pl-k">âˆˆ</span> [<span class="pl-c1">1</span>, <span class="pl-c1">10</span>, <span class="pl-c1">25</span>, <span class="pl-c1">100</span>, <span class="pl-c1">250</span>, <span class="pl-c1">1000</span>]
           <span class="pl-c1">println</span>(<span class="pl-s"><span class="pl-pds">"</span>Î» = <span class="pl-pds">"</span></span>, Î»)
           d <span class="pl-k">=</span> <span class="pl-c1">Poisson</span>(Î»)
           p <span class="pl-k">=</span> <span class="pl-c1">map</span>(n <span class="pl-k">-&gt;</span> <span class="pl-c1">pdf</span>(d, n), <span class="pl-c1">0</span><span class="pl-k">:</span><span class="pl-c1">max</span>(<span class="pl-c1">1.5</span>Î», <span class="pl-c1">100</span>))
           K, V <span class="pl-k">=</span> <span class="pl-c1">sqhist</span>(p)
           <span class="pl-c1">@btime</span> <span class="pl-c1">generate!</span>(<span class="pl-k">$</span>A, <span class="pl-k">$</span>U, <span class="pl-k">$</span>K, <span class="pl-k">$</span>V)
       <span class="pl-k">end</span>

Î» <span class="pl-k">=</span> <span class="pl-c1">1</span>
  <span class="pl-c1">169.456</span> ms (<span class="pl-c1">0</span> allocations<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes)
Î» <span class="pl-k">=</span> <span class="pl-c1">10</span>
  <span class="pl-c1">169.094</span> ms (<span class="pl-c1">0</span> allocations<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes)
Î» <span class="pl-k">=</span> <span class="pl-c1">25</span>
  <span class="pl-c1">168.813</span> ms (<span class="pl-c1">0</span> allocations<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes)
Î» <span class="pl-k">=</span> <span class="pl-c1">100</span>
  <span class="pl-c1">168.890</span> ms (<span class="pl-c1">0</span> allocations<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes)
Î» <span class="pl-k">=</span> <span class="pl-c1">250</span>
  <span class="pl-c1">169.144</span> ms (<span class="pl-c1">0</span> allocations<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes)
Î» <span class="pl-k">=</span> <span class="pl-c1">1000</span>
  <span class="pl-c1">169.457</span> ms (<span class="pl-c1">0</span> allocations<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes)

  
<span class="pl-c"><span class="pl-c">#</span> Time required to draw 10^8 samples from Hypergeometric</span>
<span class="pl-c"><span class="pl-c">#</span> -- admittedly, not entirely clear that these are the parameterizations from the article</span>
<span class="pl-c"><span class="pl-c">#</span> This assumes that N1 is number of draws, N2 the population size and K the number of success states</span>

julia<span class="pl-k">&gt;</span> <span class="pl-k">for</span> (N1, N2, K) <span class="pl-k">âˆˆ</span> [(<span class="pl-c1">20</span>, <span class="pl-c1">20</span>, <span class="pl-c1">20</span>), (<span class="pl-c1">100</span>, <span class="pl-c1">100</span>, <span class="pl-c1">20</span>), (<span class="pl-c1">100</span>, <span class="pl-c1">100</span>, <span class="pl-c1">100</span>), (<span class="pl-c1">100</span>, <span class="pl-c1">1000</span>, <span class="pl-c1">100</span>),
                          (<span class="pl-c1">1000</span>, <span class="pl-c1">1000</span>, <span class="pl-c1">100</span>), (<span class="pl-c1">1000</span>, <span class="pl-c1">1000</span>, <span class="pl-c1">1000</span>), (<span class="pl-c1">1000</span>, <span class="pl-c1">10000</span>, <span class="pl-c1">100</span>),
                          (<span class="pl-c1">1000</span>, <span class="pl-c1">10000</span>, <span class="pl-c1">1000</span>), (<span class="pl-c1">10000</span>, <span class="pl-c1">10000</span>, <span class="pl-c1">1000</span>), (<span class="pl-c1">10000</span>, <span class="pl-c1">10000</span>, <span class="pl-c1">10000</span>)]
           <span class="pl-c1">println</span>(<span class="pl-s"><span class="pl-pds">"</span>N1 = <span class="pl-pds">"</span></span>, N1, <span class="pl-s"><span class="pl-pds">"</span> N2 = <span class="pl-pds">"</span></span>, N2, <span class="pl-s"><span class="pl-pds">"</span> K = <span class="pl-pds">"</span></span>, K)
           ğ‘ , ğ‘“, ğ‘› <span class="pl-k">=</span> K, N2 <span class="pl-k">-</span> K, N1
           d <span class="pl-k">=</span> <span class="pl-c1">Hypergeometric</span>(ğ‘ , ğ‘“, ğ‘›)
           p <span class="pl-k">=</span> <span class="pl-c1">map</span>(n <span class="pl-k">-&gt;</span> <span class="pl-c1">pdf</span>(d, n), <span class="pl-c1">support</span>(d))
           K, V <span class="pl-k">=</span> <span class="pl-c1">sqhist</span>(p)
           <span class="pl-c1">@btime</span> <span class="pl-c1">generate!</span>(<span class="pl-k">$</span>A, <span class="pl-k">$</span>U, <span class="pl-k">$</span>K, <span class="pl-k">$</span>V)
       <span class="pl-k">end</span>
N1 <span class="pl-k">=</span> <span class="pl-c1">20</span> N2 <span class="pl-k">=</span> <span class="pl-c1">20</span> K <span class="pl-k">=</span> <span class="pl-c1">20</span>
  <span class="pl-c1">62.897</span> ms (<span class="pl-c1">0</span> allocations<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes)
N1 <span class="pl-k">=</span> <span class="pl-c1">100</span> N2 <span class="pl-k">=</span> <span class="pl-c1">100</span> K <span class="pl-k">=</span> <span class="pl-c1">20</span>
  <span class="pl-c1">62.913</span> ms (<span class="pl-c1">0</span> allocations<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes)
N1 <span class="pl-k">=</span> <span class="pl-c1">100</span> N2 <span class="pl-k">=</span> <span class="pl-c1">100</span> K <span class="pl-k">=</span> <span class="pl-c1">100</span>
  <span class="pl-c1">62.929</span> ms (<span class="pl-c1">0</span> allocations<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes)
N1 <span class="pl-k">=</span> <span class="pl-c1">100</span> N2 <span class="pl-k">=</span> <span class="pl-c1">1000</span> K <span class="pl-k">=</span> <span class="pl-c1">100</span>
  <span class="pl-c1">170.922</span> ms (<span class="pl-c1">0</span> allocations<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes)
N1 <span class="pl-k">=</span> <span class="pl-c1">1000</span> N2 <span class="pl-k">=</span> <span class="pl-c1">1000</span> K <span class="pl-k">=</span> <span class="pl-c1">100</span>
  <span class="pl-c1">62.888</span> ms (<span class="pl-c1">0</span> allocations<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes)
N1 <span class="pl-k">=</span> <span class="pl-c1">1000</span> N2 <span class="pl-k">=</span> <span class="pl-c1">1000</span> K <span class="pl-k">=</span> <span class="pl-c1">1000</span>
  <span class="pl-c1">62.919</span> ms (<span class="pl-c1">0</span> allocations<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes)
N1 <span class="pl-k">=</span> <span class="pl-c1">1000</span> N2 <span class="pl-k">=</span> <span class="pl-c1">10000</span> K <span class="pl-k">=</span> <span class="pl-c1">100</span>
  <span class="pl-c1">170.938</span> ms (<span class="pl-c1">0</span> allocations<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes)
N1 <span class="pl-k">=</span> <span class="pl-c1">1000</span> N2 <span class="pl-k">=</span> <span class="pl-c1">10000</span> K <span class="pl-k">=</span> <span class="pl-c1">1000</span>
  <span class="pl-c1">171.234</span> ms (<span class="pl-c1">0</span> allocations<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes)
N1 <span class="pl-k">=</span> <span class="pl-c1">10000</span> N2 <span class="pl-k">=</span> <span class="pl-c1">10000</span> K <span class="pl-k">=</span> <span class="pl-c1">1000</span>
  <span class="pl-c1">62.914</span> ms (<span class="pl-c1">0</span> allocations<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes)
N1 <span class="pl-k">=</span> <span class="pl-c1">10000</span> N2 <span class="pl-k">=</span> <span class="pl-c1">10000</span> K <span class="pl-k">=</span> <span class="pl-c1">10000</span>
  <span class="pl-c1">62.889</span> ms (<span class="pl-c1">0</span> allocations<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes)
  
<span class="pl-c"><span class="pl-c">#</span> It could alternatively be N1 the number of draws, N2 the number of failures and K the</span>
<span class="pl-c"><span class="pl-c">#</span> number of success states -- this gives a more reasonable range of support.</span>
<span class="pl-c"><span class="pl-c">#</span> Alas, the files attached to the paper seem to be missing the hypergeometric distribution</span>

julia<span class="pl-k">&gt;</span> <span class="pl-k">for</span> (N1, N2, K) <span class="pl-k">âˆˆ</span> [(<span class="pl-c1">20</span>, <span class="pl-c1">20</span>, <span class="pl-c1">20</span>), (<span class="pl-c1">100</span>, <span class="pl-c1">100</span>, <span class="pl-c1">20</span>), (<span class="pl-c1">100</span>, <span class="pl-c1">100</span>, <span class="pl-c1">100</span>), (<span class="pl-c1">100</span>, <span class="pl-c1">1000</span>, <span class="pl-c1">100</span>),
                          (<span class="pl-c1">1000</span>, <span class="pl-c1">1000</span>, <span class="pl-c1">100</span>), (<span class="pl-c1">1000</span>, <span class="pl-c1">1000</span>, <span class="pl-c1">1000</span>), (<span class="pl-c1">1000</span>, <span class="pl-c1">10000</span>, <span class="pl-c1">100</span>),
                          (<span class="pl-c1">1000</span>, <span class="pl-c1">10000</span>, <span class="pl-c1">1000</span>), (<span class="pl-c1">10000</span>, <span class="pl-c1">10000</span>, <span class="pl-c1">1000</span>), (<span class="pl-c1">10000</span>, <span class="pl-c1">10000</span>, <span class="pl-c1">10000</span>)]
           <span class="pl-c1">println</span>(<span class="pl-s"><span class="pl-pds">"</span>N1 = <span class="pl-pds">"</span></span>, N1, <span class="pl-s"><span class="pl-pds">"</span> N2 = <span class="pl-pds">"</span></span>, N2, <span class="pl-s"><span class="pl-pds">"</span> K = <span class="pl-pds">"</span></span>, K)
           ğ‘ , ğ‘“, ğ‘› <span class="pl-k">=</span> K, N2, N1
           d <span class="pl-k">=</span> <span class="pl-c1">Hypergeometric</span>(ğ‘ , ğ‘“, ğ‘›)
           p <span class="pl-k">=</span> <span class="pl-c1">map</span>(n <span class="pl-k">-&gt;</span> <span class="pl-c1">pdf</span>(d, n), <span class="pl-c1">support</span>(d))
           K, V <span class="pl-k">=</span> <span class="pl-c1">sqhist</span>(p)
           <span class="pl-c1">@btime</span> <span class="pl-c1">generate!</span>(<span class="pl-k">$</span>A, <span class="pl-k">$</span>U, <span class="pl-k">$</span>K, <span class="pl-k">$</span>V)
       <span class="pl-k">end</span>
N1 <span class="pl-k">=</span> <span class="pl-c1">20</span> N2 <span class="pl-k">=</span> <span class="pl-c1">20</span> K <span class="pl-k">=</span> <span class="pl-c1">20</span>
  <span class="pl-c1">170.708</span> ms (<span class="pl-c1">0</span> allocations<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes)
N1 <span class="pl-k">=</span> <span class="pl-c1">100</span> N2 <span class="pl-k">=</span> <span class="pl-c1">100</span> K <span class="pl-k">=</span> <span class="pl-c1">20</span>
  <span class="pl-c1">170.384</span> ms (<span class="pl-c1">0</span> allocations<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes)
N1 <span class="pl-k">=</span> <span class="pl-c1">100</span> N2 <span class="pl-k">=</span> <span class="pl-c1">100</span> K <span class="pl-k">=</span> <span class="pl-c1">100</span>
  <span class="pl-c1">170.881</span> ms (<span class="pl-c1">0</span> allocations<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes)
N1 <span class="pl-k">=</span> <span class="pl-c1">100</span> N2 <span class="pl-k">=</span> <span class="pl-c1">1000</span> K <span class="pl-k">=</span> <span class="pl-c1">100</span>
  <span class="pl-c1">170.931</span> ms (<span class="pl-c1">0</span> allocations<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes)
N1 <span class="pl-k">=</span> <span class="pl-c1">1000</span> N2 <span class="pl-k">=</span> <span class="pl-c1">1000</span> K <span class="pl-k">=</span> <span class="pl-c1">100</span>
  <span class="pl-c1">170.873</span> ms (<span class="pl-c1">0</span> allocations<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes)
N1 <span class="pl-k">=</span> <span class="pl-c1">1000</span> N2 <span class="pl-k">=</span> <span class="pl-c1">1000</span> K <span class="pl-k">=</span> <span class="pl-c1">1000</span>
  <span class="pl-c1">170.993</span> ms (<span class="pl-c1">0</span> allocations<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes)
N1 <span class="pl-k">=</span> <span class="pl-c1">1000</span> N2 <span class="pl-k">=</span> <span class="pl-c1">10000</span> K <span class="pl-k">=</span> <span class="pl-c1">100</span>
  <span class="pl-c1">170.966</span> ms (<span class="pl-c1">0</span> allocations<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes)
N1 <span class="pl-k">=</span> <span class="pl-c1">1000</span> N2 <span class="pl-k">=</span> <span class="pl-c1">10000</span> K <span class="pl-k">=</span> <span class="pl-c1">1000</span>
  <span class="pl-c1">171.030</span> ms (<span class="pl-c1">0</span> allocations<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes)
N1 <span class="pl-k">=</span> <span class="pl-c1">10000</span> N2 <span class="pl-k">=</span> <span class="pl-c1">10000</span> K <span class="pl-k">=</span> <span class="pl-c1">1000</span>
  <span class="pl-c1">171.167</span> ms (<span class="pl-c1">0</span> allocations<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes)
N1 <span class="pl-k">=</span> <span class="pl-c1">10000</span> N2 <span class="pl-k">=</span> <span class="pl-c1">10000</span> K <span class="pl-k">=</span> <span class="pl-c1">10000</span>
  <span class="pl-c1">192.990</span> ms (<span class="pl-c1">0</span> allocations<span class="pl-k">:</span> <span class="pl-c1">0</span> bytes)</pre></div>
<p dir="auto"></p>
</details>
<h2 dir="auto"><a id="user-content-references" class="anchor" aria-hidden="true" href="#references"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>References</h2>
<ul dir="auto">
<li>Marsaglia, George, Wai Wan Tsang, and Jingbo Wang. "Fast generation of discrete random variables." Journal of Statistical Software 11 (2004): 1-11.</li>
</ul>
</article></div>