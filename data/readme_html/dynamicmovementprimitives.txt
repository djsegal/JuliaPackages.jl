<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content" itemprop="text"><h1><a id="user-content-dynamicmovementprimitives" class="anchor" aria-hidden="true" href="#dynamicmovementprimitives"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DynamicMovementPrimitives</h1>
<p><a href="http://pkg.julialang.org/?pkg=DynamicMovementPrimitives" rel="nofollow"><img src="https://camo.githubusercontent.com/cf5377fcd9e1633f4e6970bd37eefae6f7381f25/687474703a2f2f706b672e6a756c69616c616e672e6f72672f6261646765732f44796e616d69634d6f76656d656e745072696d6974697665735f302e362e737667" alt="DynamicMovementPrimitives" data-canonical-src="http://pkg.julialang.org/badges/DynamicMovementPrimitives_0.6.svg" style="max-width:100%;"></a>
<a href="https://travis-ci.org/baggepinnen/DynamicMovementPrimitives.jl" rel="nofollow"><img src="https://camo.githubusercontent.com/836a3a67d61f1cfd3167e28915cb557328b58247/68747470733a2f2f7472617669732d63692e6f72672f626167676570696e6e656e2f44796e616d69634d6f76656d656e745072696d6974697665732e6a6c2e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/baggepinnen/DynamicMovementPrimitives.jl.svg?branch=master" style="max-width:100%;"></a></p>
<p>Provides implementations of Ijspeert et al. 2013 and of Martin Karlsson, Fredrik Bagge Carlson, et al. 2017</p>
<h2><a id="user-content-installation" class="anchor" aria-hidden="true" href="#installation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Installation</h2>
<div class="highlight highlight-source-julia"><pre><span class="pl-k">using</span> Pkg; Pkg<span class="pl-k">.</span><span class="pl-c1">add</span>(<span class="pl-s"><span class="pl-pds">"</span>DynamicMovementPrimitives<span class="pl-pds">"</span></span>)
<span class="pl-k">using</span> DynamicMovementPrimitives</pre></div>
<h2><a id="user-content-usage" class="anchor" aria-hidden="true" href="#usage"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Usage</h2>
<h3><a id="user-content-standard-dmp" class="anchor" aria-hidden="true" href="#standard-dmp"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Standard DMP</h3>
<div class="highlight highlight-source-julia"><pre><span class="pl-k">using</span> DynamicMovementPrimitives
Nbasis  <span class="pl-k">=</span> <span class="pl-c1">15</span>
αz      <span class="pl-k">=</span> <span class="pl-c1">25.</span>
αx      <span class="pl-k">=</span> <span class="pl-c1">1.</span>
opts    <span class="pl-k">=</span> <span class="pl-c1">DMPopts</span>(Nbasis,αx,αz)

y       <span class="pl-k">=</span> [<span class="pl-c1">zeros</span>(<span class="pl-c1">10</span>);<span class="pl-c1">LinRange</span>(<span class="pl-c1">0</span>,<span class="pl-c1">2</span>,<span class="pl-c1">1000</span>); <span class="pl-c1">2</span><span class="pl-c1">ones</span>(<span class="pl-c1">500</span>)]
T       <span class="pl-k">=</span> <span class="pl-c1">length</span>(y)
t       <span class="pl-k">=</span> <span class="pl-c1">LinRange</span>(<span class="pl-c1">0</span>,<span class="pl-c1">10</span>,T)
h       <span class="pl-k">=</span> t[<span class="pl-c1">2</span>]<span class="pl-k">-</span>t[<span class="pl-c1">1</span>] <span class="pl-c"><span class="pl-c">#</span> Sample interval</span>
y       <span class="pl-k">=</span> [y <span class="pl-c1">0.5</span>y]
ẏ       <span class="pl-k">=</span> <span class="pl-c1">centraldiff</span>(y) <span class="pl-k">./</span>h <span class="pl-c"><span class="pl-c">#</span> Differentiate position to get velocity</span>
ÿ       <span class="pl-k">=</span> <span class="pl-c1">centraldiff</span>(ẏ) <span class="pl-k">./</span>h
dmp     <span class="pl-k">=</span> <span class="pl-c1">fit</span>(y,ẏ,ÿ,t,opts)

tout,yout,ẏout,xout <span class="pl-k">=</span> <span class="pl-c1">solve</span>(dmp,t) <span class="pl-c"><span class="pl-c">#</span> Generate trajectory, see ?solve for options</span>
<span class="pl-c1">plot</span>(dmp) <span class="pl-c"><span class="pl-c">#</span> Requires Plots.jl, plots the trajectory from solve with default options</span>
<span class="pl-c1">plot</span>(dmp,<span class="pl-c1">true</span>)</pre></div>
<h3><a id="user-content-dmp-with-two-degrees-of-freedom-karlsson-bagge-carlson-et-al-2017" class="anchor" aria-hidden="true" href="#dmp-with-two-degrees-of-freedom-karlsson-bagge-carlson-et-al-2017"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DMP with two degrees of freedom (Karlsson, Bagge Carlson et al. 2017)</h3>
<p>This package also contains an implementation of</p>
<div class="highlight highlight-text-bibtex"><pre><span class="pl-k">@inproceedings</span>{<span class="pl-en">karlsson2017dmp</span>,
  <span class="pl-s">title</span>        = <span class="pl-s"><span class="pl-pds">{</span>Two-Degree-of-Freedom Control for Trajectory Tracking and Perturbation Recovery during Execution of Dynamical Movement Primitives<span class="pl-pds">}</span></span>,
  <span class="pl-s">author</span>       = <span class="pl-s"><span class="pl-pds">{</span>Karlsson, Martin and Bagge Carlson, Fredrik and Robertsson, Anders and Johansson, Rolf<span class="pl-pds">}</span></span>,
  <span class="pl-s">booktitle</span>    = <span class="pl-s"><span class="pl-pds">{</span>20th IFAC World Congress<span class="pl-pds">}</span></span>,
  <span class="pl-s">year</span>         = <span class="pl-s"><span class="pl-pds">{</span>2017<span class="pl-pds">}</span></span>,
}</pre></div>
<p>We start by upgrading the DMP object to incorporate also the controller parameters for the 2DOF controller</p>
<div class="highlight highlight-source-julia"><pre>dmp2opts <span class="pl-k">=</span> <span class="pl-c1">DMP2dofopts</span>(kp <span class="pl-k">=</span> <span class="pl-c1">25</span>,kv <span class="pl-k">=</span> <span class="pl-c1">10</span>,kc <span class="pl-k">=</span> <span class="pl-c1">10_000</span>,αe <span class="pl-k">=</span> <span class="pl-c1">5</span>)
dmp2 <span class="pl-k">=</span> <span class="pl-c1">DMP2dof</span>(dmp, dmp2opts) <span class="pl-c"><span class="pl-c">#</span> Upgrade dmp to 2DOF version</span>

t,yc,ẏc,x,ya,ẏa,e <span class="pl-k">=</span> <span class="pl-c1">solve</span>(dmp2,t)
<span class="pl-c1">plot</span>(dmp2) <span class="pl-c"><span class="pl-c">#</span> Requires Plots.jl, plots the trajectory from solve with default options</span>
<span class="pl-c1">plot</span>(dmp2,<span class="pl-c1">true</span>)</pre></div>
<p>We test the performance of the 2DOF controller by implementing a solver callback. Between <code>t=2.5</code> and <code>t=4</code>, we stop the evolution of the physical system by setting <code>ẏa = 0</code> through <code>u[3] = uprev[3]</code>.</p>
<div class="highlight highlight-source-julia"><pre><span class="pl-k">import</span> OrdinaryDiffEq
<span class="pl-en">condition</span>(u,t,integrator) <span class="pl-k">=</span> <span class="pl-c1">2.5</span> <span class="pl-k">&lt;=</span> t <span class="pl-k">&lt;</span> <span class="pl-c1">4</span>
<span class="pl-en">affect!</span>(integrator) <span class="pl-k">=</span> (integrator<span class="pl-k">.</span>u[<span class="pl-c1">3</span>] <span class="pl-k">=</span> integrator<span class="pl-k">.</span>uprev[<span class="pl-c1">3</span>])
cb <span class="pl-k">=</span> OrdinaryDiffEq<span class="pl-k">.</span><span class="pl-c1">DiscreteCallback</span>(condition,affect!)</pre></div>
<p>We can call the solve method with our custom callback and plot the result. It should be clear from the figures that this time, the coupled signal <code>yc</code> slows down when there is a nonzero error.</p>
<div class="highlight highlight-source-julia"><pre>t,yc,ẏc,x,ya,ẏa,e <span class="pl-k">=</span> <span class="pl-c1">solve</span>(dmp2,t, solver<span class="pl-k">=</span>OrdinaryDiffEq<span class="pl-k">.</span><span class="pl-c1">Euler</span>(), callback<span class="pl-k">=</span>cb)
<span class="pl-c1">plot</span>(t,ẏc, lab<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\$</span>ẏ_c<span class="pl-cce">\$</span><span class="pl-pds">"</span></span>, c<span class="pl-k">=</span><span class="pl-c1">:red</span>, l<span class="pl-k">=</span>(<span class="pl-c1">:dash</span>, <span class="pl-c1">3</span>), layout<span class="pl-k">=</span>(<span class="pl-c1">2</span>,<span class="pl-c1">2</span>), subplot<span class="pl-k">=</span><span class="pl-c1">1</span>)
<span class="pl-c1">plot!</span>(t,yc, lab<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\$</span>y_c<span class="pl-cce">\$</span><span class="pl-pds">"</span></span>, c<span class="pl-k">=</span><span class="pl-c1">:red</span>, l<span class="pl-k">=</span>(<span class="pl-c1">:dash</span>, <span class="pl-c1">3</span>), subplot<span class="pl-k">=</span><span class="pl-c1">2</span>)
<span class="pl-c1">plot!</span>(t,ẏa, lab<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\$</span>ẏ_a<span class="pl-cce">\$</span><span class="pl-pds">"</span></span>, c<span class="pl-k">=</span><span class="pl-c1">:blue</span>, subplot<span class="pl-k">=</span><span class="pl-c1">1</span>)
<span class="pl-c1">plot!</span>(t,ya, lab<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\$</span>y_a<span class="pl-cce">\$</span><span class="pl-pds">"</span></span>, c<span class="pl-k">=</span><span class="pl-c1">:blue</span>, subplot<span class="pl-k">=</span><span class="pl-c1">2</span>)
<span class="pl-c1">plot!</span>(t,e, lab<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\$</span>e<span class="pl-cce">\$</span><span class="pl-pds">"</span></span>, c<span class="pl-k">=</span><span class="pl-c1">:green</span>, subplot<span class="pl-k">=</span><span class="pl-c1">3</span>)
<span class="pl-c1">plot!</span>(t,<span class="pl-c1">400</span> <span class="pl-k">.&lt;=</span> <span class="pl-c1">1</span><span class="pl-k">:</span>T <span class="pl-k">.&lt;</span> <span class="pl-c1">600</span>, lab<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Disturbance<span class="pl-pds">"</span></span>, c<span class="pl-k">=</span><span class="pl-c1">:green</span>, subplot<span class="pl-k">=</span><span class="pl-c1">4</span>, fillrange<span class="pl-k">=</span><span class="pl-c1">0</span>)
t,yc,ẏc,x,ya,ẏa,e <span class="pl-k">=</span> <span class="pl-c1">solve</span>(dmp2,t)
<span class="pl-c1">plot!</span>(t,ẏc, lab<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\$</span>ẏ_u<span class="pl-cce">\$</span><span class="pl-pds">"</span></span>, c<span class="pl-k">=</span><span class="pl-c1">:black</span>, l<span class="pl-k">=</span>(<span class="pl-c1">:dashdot</span>, <span class="pl-c1">3</span>), subplot<span class="pl-k">=</span><span class="pl-c1">1</span>)
<span class="pl-c1">plot!</span>(t,yc, lab<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\$</span>y_u<span class="pl-cce">\$</span><span class="pl-pds">"</span></span>, c<span class="pl-k">=</span><span class="pl-c1">:black</span>, l<span class="pl-k">=</span>(<span class="pl-c1">:dashdot</span>, <span class="pl-c1">3</span>), subplot<span class="pl-k">=</span><span class="pl-c1">2</span>)</pre></div>
<p>In the figure below, the black line represents the evolution with no disturbance, in the paper referred to as the unperturbed evolution. The blue evolution is the actual system evolution whereas the red curve displays the coupled system evolution.
<a target="_blank" rel="noopener noreferrer" href="figs/dmp2.png"><img src="figs/dmp2.png" alt="DMP2dof plot" style="max-width:100%;"></a></p>
</article></div>