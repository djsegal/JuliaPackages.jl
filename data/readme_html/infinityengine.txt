<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><p dir="auto"><a href="https://plut.github.io/InfinityEngine.jl/dev/" rel="nofollow"><img src="https://camo.githubusercontent.com/56f8252ba8e9d3f0b810769543f77823d2fe031ce560d4c2d69fb1fcad800383/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f646f63732d6c61746573742d626c75652e737667" alt="Documentation|Dev" data-canonical-src="https://img.shields.io/badge/docs-latest-blue.svg" style="max-width: 100%;"></a></p>
<h1 dir="auto"><a id="user-content-infinity-engine-editor" class="anchor" aria-hidden="true" href="#infinity-engine-editor"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Infinity Engine editor</h1>
<h2 dir="auto"><a id="user-content-teaser" class="anchor" aria-hidden="true" href="#teaser"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Teaser</h2>
<p dir="auto">A (future) simpler way of writing Infinity Engine mods:</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# Let's create a big sword!

bigsword = Longsword(_&quot;Really Big Sword&quot;, +5, weight = 200,
  description = _&quot;A sword so big that it does crushing-type damage!&quot;)
bigsword.abilities[1].damage = Crushing(2d6+5)

# Translations are handled by `.po` files, no need to bother
# with @XXX strings.


# And add an extra line to Imoen's Candlekeep dialogue:
from(&quot;imoen&quot;, 1)
actor(&quot;reevor&quot;) interject(_&quot;Hey, you! Be gentle with Imoen!&quot;)"><pre><span class="pl-c"><span class="pl-c">#</span> Let's create a big sword!</span>

bigsword <span class="pl-k">=</span> <span class="pl-c1">Longsword</span>(<span class="pl-s"><span class="pl-pds"><span class="pl-c1">_</span>"</span>Really Big Sword<span class="pl-pds">"</span></span>, <span class="pl-k">+</span><span class="pl-c1">5</span>, weight <span class="pl-k">=</span> <span class="pl-c1">200</span>,
  description <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds"><span class="pl-c1">_</span>"</span>A sword so big that it does crushing-type damage!<span class="pl-pds">"</span></span>)
bigsword<span class="pl-k">.</span>abilities[<span class="pl-c1">1</span>]<span class="pl-k">.</span>damage <span class="pl-k">=</span> <span class="pl-c1">Crushing</span>(<span class="pl-c1">2</span>d6<span class="pl-k">+</span><span class="pl-c1">5</span>)

<span class="pl-c"><span class="pl-c">#</span> Translations are handled by `.po` files, no need to bother</span>
<span class="pl-c"><span class="pl-c">#</span> with @XXX strings.</span>


<span class="pl-c"><span class="pl-c">#</span> And add an extra line to Imoen's Candlekeep dialogue:</span>
<span class="pl-c1">from</span>(<span class="pl-s"><span class="pl-pds">"</span>imoen<span class="pl-pds">"</span></span>, <span class="pl-c1">1</span>)
<span class="pl-c1">actor</span>(<span class="pl-s"><span class="pl-pds">"</span>reevor<span class="pl-pds">"</span></span>) <span class="pl-c1">interject</span>(<span class="pl-s"><span class="pl-pds"><span class="pl-c1">_</span>"</span>Hey, you! Be gentle with Imoen!<span class="pl-pds">"</span></span>)</pre></div>
<h2 dir="auto"><a id="user-content-summary" class="anchor" aria-hidden="true" href="#summary"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Summary</h2>
<p dir="auto">Access InfinityEngine data from within a “real” programming language.
This should eventually be able to do what NearInfinity, WeiDU
and ProjectInfinity do, with the following advantages:</p>
<ul dir="auto">
<li>no need to learn several ad-hoc languages: <code>.tp2</code> and <code>.d</code> can both
be replaced by standard Julia syntax;</li>
<li>WeiDU more or less always assumes that it is run interactively, which
is quite inconvenient for large installations;</li>
<li>easier syntax for defining game objects, e.g. we can currently say
<code>Longsword("Sword of Infinity", +5, ...)</code></li>
<li>hiding the 8-byte limit for game resources: mod authors can index them
by arbitrary strings (with implicit namespaces for conflict
prevention);</li>
<li>translations are handled by standard <code>.po</code> files and everything is
done to help translators know some context about the strings they are
translating, leading to better translations;</li>
<li>mod contents are easier to validate, leading to less install crashes
than WeiDU mods;</li>
<li>built-in portability (no need to call shell scripts or <code>.bat</code> files,
Julia contains all the needed functions);</li>
<li>speed (all changes could be computed in one single execution of the program:
no need to do many rewrites of <code>dialog.tlk</code> with total
quadratic complexity...);</li>
<li>easier inclusion of mod metadata;</li>
<li>automatic mod conflict detection.</li>
</ul>
<p dir="auto">Current status: <strong>very limited use cases</strong>. The core set of features
(loading resources, translating strings etc) is well advanced,
but for testing this, only items and dialogs are currently available.
The module can currently load, display and (with limits) edit them.
Once the module core is stabilized,
adding more resource types should be relatively simple.</p>
<p dir="auto"><strong>This is currently limited to BGEE, BG2EE and EET games.</strong>
Adding support for other IE games is a (long-term) goal.</p>
<h2 dir="auto"><a id="user-content-design-goals" class="anchor" aria-hidden="true" href="#design-goals"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Design goals</h2>
<p dir="auto">The design goals include (roughly, by decreasing priority):</p>
<h3 dir="auto"><a id="user-content-user-friendliness-cli-style" class="anchor" aria-hidden="true" href="#user-friendliness-cli-style"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>User-friendliness (CLI style)</h3>
<p dir="auto">Prevent the user from needing to learn several ad-hoc languages
(<code>tp2</code>, <code>d</code>; all of them frankly quite esoteric)
and instead use a single general-purpose language,
quite simple to learn and for which loads of documentation already exist.</p>
<p dir="auto">The module tries hard to abstract some of the game's ugliest points away
from the user/mod author.
Objects and their properties are represented by plain Julia structs:</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="i = item(&quot;sw1h01&quot;) # Bastard sword
i.min_strength = 14
i.abilities[1].damage = Crushing(2d4+1) # nonsense, but shows syntax"><pre>i <span class="pl-k">=</span> <span class="pl-c1">item</span>(<span class="pl-s"><span class="pl-pds">"</span>sw1h01<span class="pl-pds">"</span></span>) <span class="pl-c"><span class="pl-c">#</span> Bastard sword</span>
i<span class="pl-k">.</span>min_strength <span class="pl-k">=</span> <span class="pl-c1">14</span>
i<span class="pl-k">.</span>abilities[<span class="pl-c1">1</span>]<span class="pl-k">.</span>damage <span class="pl-k">=</span> <span class="pl-c1">Crushing</span>(<span class="pl-c1">2</span>d4<span class="pl-k">+</span><span class="pl-c1">1</span>) <span class="pl-c"><span class="pl-c">#</span> nonsense, but shows syntax</span></pre></div>
<p dir="auto">This should help in writing efficient (and robust) code without requiring
frequent use of <a href="https://gibberlings3.github.io/iesdp" rel="nofollow">IESDP documentation</a>.</p>
<p dir="auto">Moreover, references to game objects (such as <code>"sw1h01"</code> above)
are namespaced. This should prevent mod interference without requiring
two-byte author prefixes.
While namespaces should be mostly transparent to mod authors,
they are explained in more detail in the relevant documentation.</p>
<p dir="auto">Finally, having mods as Julia programs should ideally ease their
development, testing, and validation before release.</p>
<h3 dir="auto"><a id="user-content-robustness" class="anchor" aria-hidden="true" href="#robustness"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Robustness</h3>
<p dir="auto">This module tries to have an in-depth­view of game structures,
which means that checks will be quite easy to implement
(e.g. missing resources, missing translated strings etc.).
And using a “real” programming language means that at least
syntax is easy to validate.</p>
<p dir="auto">(on the other hand, this module's initial author had several WeiDU mods
crash on install because of a missing tilde
in some released translation files: <strong>this should never happen</strong>.
And I'm not even counting the number of UTF8-related errors!).</p>
<h3 dir="auto"><a id="user-content-portability" class="anchor" aria-hidden="true" href="#portability"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Portability</h3>
<p dir="auto">Julia itself is portable (at least on all platforms able to run IE
games), and code can be kept portable as long as some basic precautions
are taken (e.g. <code>joinpath</code> instead of using slashes, not using
assumptions about symlinks, etc.).</p>
<p dir="auto">In particular, since this tool is currently developed on Unix, at
least some care will be taken w.r.t filenames case-sensitivity.
Ideally this should be able to run mods without any ugly solution such as
<code>ciopfs</code> or a separate NTFS partition, which should help with speed.</p>
<p dir="auto">Also, where some mods require the use of shell scripts or batch files,
Julia contains all the basic shell functions (<code>mv</code>, <code>mkdir</code> etc),
allowing to write such scripts in a self-supporting and portable way.</p>
<h3 dir="auto"><a id="user-content-mod-stack-management" class="anchor" aria-hidden="true" href="#mod-stack-management"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Mod stack management</h3>
<p dir="auto">This project will be able to manage a whole set of mods,
including which files are replaced by which mods.
This will enable automatic detection of conflicts
(optimistically, it should even be possible to fine-grain
conflict detection, for example when two mods overwrite
the same object property, table entry, or dialog state).</p>
<p dir="auto">On the other hand, WeiDU mods are stand-alone,
and therefore conflict detection (if any)
must be performed by the mods themselves.</p>
<p dir="auto">Current status: <strong>project</strong>.
We have some code for managing a WeiDU mod stack
(basically a command-line equivalent of BigWorldSetup etc.);
this unreleased yet, but working.
A significant part of this code could be reused.</p>
<h3 dir="auto"><a id="user-content-speed" class="anchor" aria-hidden="true" href="#speed"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Speed</h3>
<p dir="auto">This is a minor goal, but installing a big stack of WeiDU mods can take
hours, and fine-tuning a single mod also crucially depends on the speed
of installing this mod.</p>
<p dir="auto">Julia is a quite fast language (it is more-or-less an assembly code generator
after all) whereas WeiDU is a scripting language,
which may also call local shell scripts etc.</p>
<p dir="auto">Also, since each WeiDU mod is a standalone program, huge files
(namely <code>dialog.tlk</code>) are rewritten many times (even for tiny
changes), leading to quadratic complexity. InfinityExplorer is written
in Java and hence quite slow.</p>
<p dir="auto">Currently, this module can load all the un-modded game data
in almost-negligible time (once Julia is started,
only a few milliseconds on a typical laptop).</p>
<p dir="auto">Some mods which would be particularly interesting to translate to this
language would be big mods such as SCS, for which
both the speed and readability gains would be quite consequent.</p>
<h2 dir="auto"><a id="user-content-dialogs" class="anchor" aria-hidden="true" href="#dialogs"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Dialogs</h2>
<p dir="auto">This module defines Julia syntax for IE dialogs.</p>
<p dir="auto">The goal here is to have something simpler to use (for mod authors)
than Weidu's <code>.d</code> syntax,
by <em>not</em> writing a parser and using Julia's instead.</p>
<p dir="auto">The feature list could be summed up as “be more user-friendly than
WeiDU”:</p>
<ul dir="auto">
<li>define dialogue in a single file (instead of <code>.d</code>/<code>.tra</code>) by having
inline strings and using proper translation formats (<code>.po</code>),
for which appropriate editing tools already exist.</li>
<li>allow a simple way to modify several dialogues at once (à la Weidu's
<code>CHAIN</code>).</li>
<li>prevent namespace conflicts without requiring the use of prefixes,
by solving all the <code>resref</code> machinery without user intervention
(a bit like what WeiDU does with <code>strref</code>, but in a more user-friendly
way).</li>
</ul>
<p dir="auto">Here is a short example of this syntax, namely Imoen's dialog from BG1
prologue. The following code is actually decompiled from the game's data:</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# actor 'imoen' with 10 states:
trigger(&quot;  NumberOfTimesTalkedTo(0)\r\n&quot;)
say(0 =&gt; _&quot;I'm surprised that stuffy ol' Gorion let you away...&quot;)
# 5 transitions: 
  reply(_&quot;I'm afraid I cannot chat today, little one....&quot;)
  journal(_&quot;My old friend Imoen pestered me today...&quot;)
 
  trigger(&quot;  ReactionLT(LastTalkedToBy,NEUTRAL_LOWER)\r\n&quot;)
  reply(_&quot;I am sorry, child, but I am not to tell anyone what I am doing...&quot;)"><pre><span class="pl-c"><span class="pl-c">#</span> actor 'imoen' with 10 states:</span>
<span class="pl-c1">trigger</span>(<span class="pl-s"><span class="pl-pds">"</span>  NumberOfTimesTalkedTo(0)<span class="pl-cce">\r\n</span><span class="pl-pds">"</span></span>)
<span class="pl-c1">say</span>(<span class="pl-c1">0</span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds"><span class="pl-c1">_</span>"</span>I'm surprised that stuffy ol' Gorion let you away...<span class="pl-pds">"</span></span>)
<span class="pl-c"><span class="pl-c">#</span> 5 transitions: </span>
  <span class="pl-c1">reply</span>(<span class="pl-s"><span class="pl-pds"><span class="pl-c1">_</span>"</span>I'm afraid I cannot chat today, little one....<span class="pl-pds">"</span></span>)
  <span class="pl-c1">journal</span>(<span class="pl-s"><span class="pl-pds"><span class="pl-c1">_</span>"</span>My old friend Imoen pestered me today...<span class="pl-pds">"</span></span>)
 
  <span class="pl-c1">trigger</span>(<span class="pl-s"><span class="pl-pds">"</span>  ReactionLT(LastTalkedToBy,NEUTRAL_LOWER)<span class="pl-cce">\r\n</span><span class="pl-pds">"</span></span>)
  <span class="pl-c1">reply</span>(<span class="pl-s"><span class="pl-pds"><span class="pl-c1">_</span>"</span>I am sorry, child, but I am not to tell anyone what I am doing...<span class="pl-pds">"</span></span>)</pre></div>
<p dir="auto">The syntax is roughly stabilized (although some details might still vary)
and most simple features are implemented
(extending dialogs, inserting transitions),
but significant work remains
(e.g. quest management or handling of <code>Strref</code>s in actions).</p>
<p dir="auto">The work on translations (using standard <code>.po</code> files) is almost complete.
This makes it easier to translate mods using already-existing tools,
and also make the system more robust (e.g. partial or somewhat obsolete
translations will remain usable, and syntax errors in translation files
will <strong>not</strong> cause a mod crash).</p>
<p dir="auto">Moreover, the translation system is able to include some context about
translated strings; the mod author can include some context manually,
and the module tries to complement this automatically if possible
(e.g. identify whether a line is said by a NPC or by CHARNAME).</p>
<h2 dir="auto"><a id="user-content-but-weidu-already-exists" class="anchor" aria-hidden="true" href="#but-weidu-already-exists"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>But WeiDU already exists!</h2>
<p dir="auto">And it has certainly been used to write lots of wonderful work.
But these games have already been out for 20 years
and will (hopefully) be out for at least as long,
so it's never too late to try and build something even better than WeiDU.
On the other hand, WeiDU does show both its age
(programming tools advanced quite a lot in 20 years)
and the preoccupations of its author.</p>
<p dir="auto">Also, a (long-term) goal is to automate at least a part of translation
from WeiDU to this tool (it is very likely possible to do this at least
for <code>.d</code>/<code>.tra</code> files), making it easier to port a mod from one language
to another.</p>
</article></div>