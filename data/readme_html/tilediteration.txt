<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><h1 dir="auto"><a id="user-content-tilediteration" class="anchor" aria-hidden="true" href="#tilediteration"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>TiledIteration</h1>
<p dir="auto"><a href="https://travis-ci.org/JuliaArrays/TiledIteration.jl" rel="nofollow"><img src="https://camo.githubusercontent.com/9ecffec974bbd3557af658f22d3b72cd3e64a74e85e2f6f387cf55f72d3f56db/68747470733a2f2f7472617669732d63692e6f72672f4a756c69614172726179732f54696c6564497465726174696f6e2e6a6c2e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/JuliaArrays/TiledIteration.jl.svg?branch=master" style="max-width: 100%;"></a></p>
<p dir="auto"><a href="http://codecov.io/github/JuliaArrays/TiledIteration.jl?branch=master" rel="nofollow"><img src="https://camo.githubusercontent.com/c8552510cb2899354173c332d774b8dffc1668f9bbfcdb21d2a0cb3274a0e84e/687474703a2f2f636f6465636f762e696f2f6769746875622f4a756c69614172726179732f54696c6564497465726174696f6e2e6a6c2f636f7665726167652e7376673f6272616e63683d6d6173746572" alt="codecov.io" data-canonical-src="http://codecov.io/github/JuliaArrays/TiledIteration.jl/coverage.svg?branch=master" style="max-width: 100%;"></a></p>
<p dir="auto">This Julia package handles some of the low-level details for writing
cache-efficient, possibly-multithreaded code for multidimensional
arrays. A "tile" corresponds to a chunk of a larger array, typically a
region that is large enough to encompass any "local" computations you
need to perform; some of these computations may require temporary storage.</p>
<p dir="auto">A related package with different aims is <a href="https://github.com/bionanoimaging/TiledViews.jl">TiledViews.jl</a>.</p>
<h2 dir="auto"><a id="user-content-usage" class="anchor" aria-hidden="true" href="#usage"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Usage</h2>
<p dir="auto">This package offers two basic kinds of functionality: the management
of temporary buffers for processing on tiles, and the iteration over
disjoint tiles of a larger array.</p>
<h3 dir="auto"><a id="user-content-iteration" class="anchor" aria-hidden="true" href="#iteration"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Iteration</h3>
<h4 dir="auto"><a id="user-content-splitaxis-and-splitaxes" class="anchor" aria-hidden="true" href="#splitaxis-and-splitaxes"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>SplitAxis and SplitAxes</h4>
<p dir="auto">The main use for these simple types is in distributing work across
threads, usually in circumstances that do not require
multidimensional locality as provided by <code>TileIterator</code>.  <code>SplitAxis</code>
splits a single array axis, and <code>SplitAxes</code> splits multidimensional
axes along the final axis.  For example:</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="julia&gt; using TiledIteration

julia&gt; A = rand(3, 20);

julia&gt; collect(SplitAxes(axes(A), 4))
4-element Vector{Tuple{UnitRange{Int64}, UnitRange{Int64}}}:
 (1:3, 1:5)
 (1:3, 6:10)
 (1:3, 11:15)
 (1:3, 16:20)"><pre>julia<span class="pl-k">&gt;</span> <span class="pl-k">using</span> TiledIteration

julia<span class="pl-k">&gt;</span> A <span class="pl-k">=</span> <span class="pl-c1">rand</span>(<span class="pl-c1">3</span>, <span class="pl-c1">20</span>);

julia<span class="pl-k">&gt;</span> <span class="pl-c1">collect</span>(<span class="pl-c1">SplitAxes</span>(<span class="pl-c1">axes</span>(A), <span class="pl-c1">4</span>))
<span class="pl-c1">4</span><span class="pl-k">-</span>element Vector{Tuple{UnitRange{Int64}, UnitRange{Int64}}}<span class="pl-k">:</span>
 (<span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">3</span>, <span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">5</span>)
 (<span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">3</span>, <span class="pl-c1">6</span><span class="pl-k">:</span><span class="pl-c1">10</span>)
 (<span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">3</span>, <span class="pl-c1">11</span><span class="pl-k">:</span><span class="pl-c1">15</span>)
 (<span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">3</span>, <span class="pl-c1">16</span><span class="pl-k">:</span><span class="pl-c1">20</span>)</pre></div>
<p dir="auto">You can also reduce the amount of work assigned to thread 1 (often the
main thread is responsible for scheduling the other threads):</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="julia&gt; collect(SplitAxes(axes(A), 3.5))
4-element Vector{Tuple{UnitRange{Int64}, UnitRange{Int64}}}:
 (1:3, 1:2)
 (1:3, 3:8)
 (1:3, 9:14)
 (1:3, 15:20)"><pre>julia<span class="pl-k">&gt;</span> <span class="pl-c1">collect</span>(<span class="pl-c1">SplitAxes</span>(<span class="pl-c1">axes</span>(A), <span class="pl-c1">3.5</span>))
<span class="pl-c1">4</span><span class="pl-k">-</span>element Vector{Tuple{UnitRange{Int64}, UnitRange{Int64}}}<span class="pl-k">:</span>
 (<span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">3</span>, <span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">2</span>)
 (<span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">3</span>, <span class="pl-c1">3</span><span class="pl-k">:</span><span class="pl-c1">8</span>)
 (<span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">3</span>, <span class="pl-c1">9</span><span class="pl-k">:</span><span class="pl-c1">14</span>)
 (<span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">3</span>, <span class="pl-c1">15</span><span class="pl-k">:</span><span class="pl-c1">20</span>)</pre></div>
<p dir="auto">Using "3.5 chunks" forces the later workers to perform 6 columns of
work (rounding 20/3.5 up to the next integer), leaving only two
columns remaining for the first thread.</p>
<h4 dir="auto"><a id="user-content-tileiterator" class="anchor" aria-hidden="true" href="#tileiterator"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>TileIterator</h4>
<p dir="auto">More general iteration over disjoint tiles of a larger array can be done
with <code>TileIterator</code>:</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="using TiledIteration

A = rand(1000,1000);   # our big array
for tileaxs in TileIterator(axes(A), (128,8))
    @show tileaxs
end"><pre><span class="pl-k">using</span> TiledIteration

A <span class="pl-k">=</span> <span class="pl-c1">rand</span>(<span class="pl-c1">1000</span>,<span class="pl-c1">1000</span>);   <span class="pl-c"><span class="pl-c">#</span> our big array</span>
<span class="pl-k">for</span> tileaxs <span class="pl-k">in</span> <span class="pl-c1">TileIterator</span>(<span class="pl-c1">axes</span>(A), (<span class="pl-c1">128</span>,<span class="pl-c1">8</span>))
    <span class="pl-c1">@show</span> tileaxs
<span class="pl-k">end</span></pre></div>
<p dir="auto">This produces</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="tileaxs = (1:128,1:8)
tileaxs = (129:256,1:8)
tileaxs = (257:384,1:8)
tileaxs = (385:512,1:8)
tileaxs = (513:640,1:8)
tileaxs = (641:768,1:8)
tileaxs = (769:896,1:8)
tileaxs = (897:1000,1:8)
tileaxs = (1:128,9:16)
tileaxs = (129:256,9:16)
tileaxs = (257:384,9:16)
tileaxs = (385:512,9:16)
..."><pre>tileaxs <span class="pl-k">=</span> (<span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">128</span>,<span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">8</span>)
tileaxs <span class="pl-k">=</span> (<span class="pl-c1">129</span><span class="pl-k">:</span><span class="pl-c1">256</span>,<span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">8</span>)
tileaxs <span class="pl-k">=</span> (<span class="pl-c1">257</span><span class="pl-k">:</span><span class="pl-c1">384</span>,<span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">8</span>)
tileaxs <span class="pl-k">=</span> (<span class="pl-c1">385</span><span class="pl-k">:</span><span class="pl-c1">512</span>,<span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">8</span>)
tileaxs <span class="pl-k">=</span> (<span class="pl-c1">513</span><span class="pl-k">:</span><span class="pl-c1">640</span>,<span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">8</span>)
tileaxs <span class="pl-k">=</span> (<span class="pl-c1">641</span><span class="pl-k">:</span><span class="pl-c1">768</span>,<span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">8</span>)
tileaxs <span class="pl-k">=</span> (<span class="pl-c1">769</span><span class="pl-k">:</span><span class="pl-c1">896</span>,<span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">8</span>)
tileaxs <span class="pl-k">=</span> (<span class="pl-c1">897</span><span class="pl-k">:</span><span class="pl-c1">1000</span>,<span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">8</span>)
tileaxs <span class="pl-k">=</span> (<span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">128</span>,<span class="pl-c1">9</span><span class="pl-k">:</span><span class="pl-c1">16</span>)
tileaxs <span class="pl-k">=</span> (<span class="pl-c1">129</span><span class="pl-k">:</span><span class="pl-c1">256</span>,<span class="pl-c1">9</span><span class="pl-k">:</span><span class="pl-c1">16</span>)
tileaxs <span class="pl-k">=</span> (<span class="pl-c1">257</span><span class="pl-k">:</span><span class="pl-c1">384</span>,<span class="pl-c1">9</span><span class="pl-k">:</span><span class="pl-c1">16</span>)
tileaxs <span class="pl-k">=</span> (<span class="pl-c1">385</span><span class="pl-k">:</span><span class="pl-c1">512</span>,<span class="pl-c1">9</span><span class="pl-k">:</span><span class="pl-c1">16</span>)
<span class="pl-k">...</span></pre></div>
<p dir="auto">You can see that the total axes range is split up into chunks,
which are of size <code>(128,8)</code> except at the edges of <code>A</code>. Naturally,
these axes serve as the basis for processing individual chunks of
the array.</p>
<p dir="auto">As a further example, suppose you've started julia with <code>JULIA_NUM_THREADS=4</code>; then</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="function fillid!(A, tilesz)
    tileinds_all = collect(TileIterator(axes(A), tilesz))
    Threads.@threads for i = 1:length(tileinds_all)
        tileaxs = tileinds_all[i]
        A[tileaxs...] .= Threads.threadid()
    end
    A
end

A = zeros(Int, 8, 8)
fillid!(A, (2,2))"><pre><span class="pl-k">function</span> <span class="pl-en">fillid!</span>(A, tilesz)
    tileinds_all <span class="pl-k">=</span> <span class="pl-c1">collect</span>(<span class="pl-c1">TileIterator</span>(<span class="pl-c1">axes</span>(A), tilesz))
    Threads<span class="pl-k">.</span><span class="pl-c1">@threads</span> <span class="pl-k">for</span> i <span class="pl-k">=</span> <span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">length</span>(tileinds_all)
        tileaxs <span class="pl-k">=</span> tileinds_all[i]
        A[tileaxs<span class="pl-k">...</span>] <span class="pl-k">.=</span> Threads<span class="pl-k">.</span><span class="pl-c1">threadid</span>()
    <span class="pl-k">end</span>
    A
<span class="pl-k">end</span>

A <span class="pl-k">=</span> <span class="pl-c1">zeros</span>(Int, <span class="pl-c1">8</span>, <span class="pl-c1">8</span>)
<span class="pl-c1">fillid!</span>(A, (<span class="pl-c1">2</span>,<span class="pl-c1">2</span>))</pre></div>
<p dir="auto">would yield</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="8×8 Array{Int64,2}:
 1  1  2  2  3  3  4  4
 1  1  2  2  3  3  4  4
 1  1  2  2  3  3  4  4
 1  1  2  2  3  3  4  4
 1  1  2  2  3  3  4  4
 1  1  2  2  3  3  4  4
 1  1  2  2  3  3  4  4
 1  1  2  2  3  3  4  4"><pre><span class="pl-c1">8</span><span class="pl-k">×</span><span class="pl-c1">8</span> Array{Int64,<span class="pl-c1">2</span>}<span class="pl-k">:</span>
 <span class="pl-c1">1</span>  <span class="pl-c1">1</span>  <span class="pl-c1">2</span>  <span class="pl-c1">2</span>  <span class="pl-c1">3</span>  <span class="pl-c1">3</span>  <span class="pl-c1">4</span>  <span class="pl-c1">4</span>
 <span class="pl-c1">1</span>  <span class="pl-c1">1</span>  <span class="pl-c1">2</span>  <span class="pl-c1">2</span>  <span class="pl-c1">3</span>  <span class="pl-c1">3</span>  <span class="pl-c1">4</span>  <span class="pl-c1">4</span>
 <span class="pl-c1">1</span>  <span class="pl-c1">1</span>  <span class="pl-c1">2</span>  <span class="pl-c1">2</span>  <span class="pl-c1">3</span>  <span class="pl-c1">3</span>  <span class="pl-c1">4</span>  <span class="pl-c1">4</span>
 <span class="pl-c1">1</span>  <span class="pl-c1">1</span>  <span class="pl-c1">2</span>  <span class="pl-c1">2</span>  <span class="pl-c1">3</span>  <span class="pl-c1">3</span>  <span class="pl-c1">4</span>  <span class="pl-c1">4</span>
 <span class="pl-c1">1</span>  <span class="pl-c1">1</span>  <span class="pl-c1">2</span>  <span class="pl-c1">2</span>  <span class="pl-c1">3</span>  <span class="pl-c1">3</span>  <span class="pl-c1">4</span>  <span class="pl-c1">4</span>
 <span class="pl-c1">1</span>  <span class="pl-c1">1</span>  <span class="pl-c1">2</span>  <span class="pl-c1">2</span>  <span class="pl-c1">3</span>  <span class="pl-c1">3</span>  <span class="pl-c1">4</span>  <span class="pl-c1">4</span>
 <span class="pl-c1">1</span>  <span class="pl-c1">1</span>  <span class="pl-c1">2</span>  <span class="pl-c1">2</span>  <span class="pl-c1">3</span>  <span class="pl-c1">3</span>  <span class="pl-c1">4</span>  <span class="pl-c1">4</span>
 <span class="pl-c1">1</span>  <span class="pl-c1">1</span>  <span class="pl-c1">2</span>  <span class="pl-c1">2</span>  <span class="pl-c1">3</span>  <span class="pl-c1">3</span>  <span class="pl-c1">4</span>  <span class="pl-c1">4</span></pre></div>
<p dir="auto">See also "EdgeIterator" below.</p>
<h3 dir="auto"><a id="user-content-determining-the-chunk-size" class="anchor" aria-hidden="true" href="#determining-the-chunk-size"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Determining the chunk size</h3>
<p dir="auto"><a href="https://en.wikipedia.org/wiki/Stencil_code" rel="nofollow">Stencil computations</a>
typically require "padding" values, so the inputs to a computation may
be of a different size than the resulting outputs. Naturally, you can
set the tile size manually; a simple convenience function,
<code>padded_tilesize</code>, attempts to pick reasonable choices for you
depending on the size of your kernel (stencil) and element type you'll
be using:</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="julia&gt; padded_tilesize(UInt8, (3,3))
(768,18)

julia&gt; padded_tilesize(UInt8, (3,3), 4)  # we want 4 of these to fit in L1 cache at once
(512,12)

julia&gt; padded_tilesize(Float64, (3,3))
(96,18)

julia&gt; padded_tilesize(Float32, (3,3,3))
(64,6,6)"><pre>julia<span class="pl-k">&gt;</span> <span class="pl-c1">padded_tilesize</span>(UInt8, (<span class="pl-c1">3</span>,<span class="pl-c1">3</span>))
(<span class="pl-c1">768</span>,<span class="pl-c1">18</span>)

julia<span class="pl-k">&gt;</span> <span class="pl-c1">padded_tilesize</span>(UInt8, (<span class="pl-c1">3</span>,<span class="pl-c1">3</span>), <span class="pl-c1">4</span>)  <span class="pl-c"><span class="pl-c">#</span> we want 4 of these to fit in L1 cache at once</span>
(<span class="pl-c1">512</span>,<span class="pl-c1">12</span>)

julia<span class="pl-k">&gt;</span> <span class="pl-c1">padded_tilesize</span>(Float64, (<span class="pl-c1">3</span>,<span class="pl-c1">3</span>))
(<span class="pl-c1">96</span>,<span class="pl-c1">18</span>)

julia<span class="pl-k">&gt;</span> <span class="pl-c1">padded_tilesize</span>(Float32, (<span class="pl-c1">3</span>,<span class="pl-c1">3</span>,<span class="pl-c1">3</span>))
(<span class="pl-c1">64</span>,<span class="pl-c1">6</span>,<span class="pl-c1">6</span>)</pre></div>
<h3 dir="auto"><a id="user-content-allocating-and-managing-temporary-storage" class="anchor" aria-hidden="true" href="#allocating-and-managing-temporary-storage"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Allocating and managing temporary storage</h3>
<p dir="auto">To allocate temporary storage while working with tiles, use <code>TileBuffer</code>:</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="julia&gt; tileaxs = (-1:15, 0:7)  # really this might have come from TileIterator

julia&gt; buf = TileBuffer(Float32, tileaxs)
TiledIteration.TileBuffer{Float32,2,2} with indices -1:15×0:7:
 0.0  0.0          2.38221f-44  0.0          0.0          0.0          9.3887f-44   0.0
 0.0  1.26117f-44  0.0          0.0          0.0          8.26766f-44  0.0          0.0
 0.0  0.0          0.0          0.0          0.0          0.0          0.0          0.0
 0.0  0.0          0.0          6.02558f-44  0.0          0.0          0.0          0.0
 0.0  0.0          0.0          0.0          7.28675f-44  0.0          0.0          0.0
 0.0  1.54143f-44  0.0          0.0          0.0          0.0          0.0          0.0
 0.0  0.0          0.0          0.0          0.0          0.0          0.0          0.0
 0.0  0.0          0.0          0.0          0.0          0.0          0.0          0.0
 0.0  0.0          0.0          0.0          0.0          0.0          9.94922f-44  0.0
 0.0  0.0          0.0          0.0          0.0          8.82818f-44  0.0          0.0
 0.0  0.0          0.0          0.0          0.0          0.0          0.0          0.0
 0.0  0.0          0.0          0.0          0.0          0.0          0.0          0.0
 0.0  0.0          0.0          0.0          0.0          0.0          0.0          0.0
 0.0  0.0          0.0          0.0          0.0          9.10844f-44  0.0          0.0
 0.0  0.0          0.0          0.0          0.0          0.0          1.03696f-43  0.0
 0.0  0.0          0.0          0.0          0.0          0.0          0.0          0.0
 0.0  0.0          0.0          0.0          0.0          0.0          0.0          0.0"><pre>julia<span class="pl-k">&gt;</span> tileaxs <span class="pl-k">=</span> (<span class="pl-k">-</span><span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">15</span>, <span class="pl-c1">0</span><span class="pl-k">:</span><span class="pl-c1">7</span>)  <span class="pl-c"><span class="pl-c">#</span> really this might have come from TileIterator</span>

julia<span class="pl-k">&gt;</span> buf <span class="pl-k">=</span> <span class="pl-c1">TileBuffer</span>(Float32, tileaxs)
TiledIteration<span class="pl-k">.</span>TileBuffer{Float32,<span class="pl-c1">2</span>,<span class="pl-c1">2</span>} with indices <span class="pl-k">-</span><span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">15</span><span class="pl-k">×</span><span class="pl-c1">0</span><span class="pl-k">:</span><span class="pl-c1">7</span><span class="pl-k">:</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">2.38221f-44</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">9.3887f-44</span>   <span class="pl-c1">0.0</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">1.26117f-44</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">8.26766f-44</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">6.02558f-44</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">7.28675f-44</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">1.54143f-44</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">9.94922f-44</span>  <span class="pl-c1">0.0</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">8.82818f-44</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">9.10844f-44</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">1.03696f-43</span>  <span class="pl-c1">0.0</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span></pre></div>
<p dir="auto">This returns an uninitialized buffer for use over the indicated domain. You can reuse this same storage for the next tile, even if the tile is smaller because it corresponds to the edge of the original array:</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="julia&gt; pointer(buf)
Ptr{Float32} @0x00007f79131fd550

julia&gt; buf = TileBuffer(buf, (16:20, 0:7))
TiledIteration.TileBuffer{Float32,2,2} with indices 16:20×0:7:
 0.0  0.0  0.0  0.0          0.0          0.0  0.0          0.0
 0.0  0.0  0.0  0.0          0.0          0.0  0.0          0.0
 0.0  0.0  0.0  0.0          1.54143f-44  0.0  0.0          0.0
 0.0  0.0  0.0  1.26117f-44  0.0          0.0  0.0          0.0
 0.0  0.0  0.0  0.0          0.0          0.0  2.38221f-44  0.0

julia&gt; pointer(buf)
Ptr{Float32} @0x00007f79131fd550"><pre>julia<span class="pl-k">&gt;</span> <span class="pl-c1">pointer</span>(buf)
Ptr{Float32} @<span class="pl-c1">0x00007f79131fd550</span>

julia<span class="pl-k">&gt;</span> buf <span class="pl-k">=</span> <span class="pl-c1">TileBuffer</span>(buf, (<span class="pl-c1">16</span><span class="pl-k">:</span><span class="pl-c1">20</span>, <span class="pl-c1">0</span><span class="pl-k">:</span><span class="pl-c1">7</span>))
TiledIteration<span class="pl-k">.</span>TileBuffer{Float32,<span class="pl-c1">2</span>,<span class="pl-c1">2</span>} with indices <span class="pl-c1">16</span><span class="pl-k">:</span><span class="pl-c1">20</span><span class="pl-k">×</span><span class="pl-c1">0</span><span class="pl-k">:</span><span class="pl-c1">7</span><span class="pl-k">:</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">1.54143f-44</span>  <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>  <span class="pl-c1">1.26117f-44</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>  <span class="pl-c1">2.38221f-44</span>  <span class="pl-c1">0.0</span>

julia<span class="pl-k">&gt;</span> <span class="pl-c1">pointer</span>(buf)
Ptr{Float32} @<span class="pl-c1">0x00007f79131fd550</span></pre></div>
<p dir="auto">When you use it again at the top of the next block of columns, it returns to its original size while still reusing the same memory:</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="julia&gt; buf = TileBuffer(buf, (-1:15, 8:15))
TiledIteration.TileBuffer{Float32,2,2} with indices -1:15×8:15:
 0.0  0.0          2.38221f-44  0.0          0.0          0.0          9.3887f-44   0.0
 0.0  1.26117f-44  0.0          0.0          0.0          8.26766f-44  0.0          0.0
 0.0  0.0          0.0          0.0          0.0          0.0          0.0          0.0
 0.0  0.0          0.0          6.02558f-44  0.0          0.0          0.0          0.0
 0.0  0.0          0.0          0.0          7.28675f-44  0.0          0.0          0.0
 0.0  1.54143f-44  0.0          0.0          0.0          0.0          0.0          0.0
 0.0  0.0          0.0          0.0          0.0          0.0          0.0          0.0
 0.0  0.0          0.0          0.0          0.0          0.0          0.0          0.0
 0.0  0.0          0.0          0.0          0.0          0.0          9.94922f-44  0.0
 0.0  0.0          0.0          0.0          0.0          8.82818f-44  0.0          0.0
 0.0  0.0          0.0          0.0          0.0          0.0          0.0          0.0
 0.0  0.0          0.0          0.0          0.0          0.0          0.0          0.0
 0.0  0.0          0.0          0.0          0.0          0.0          0.0          0.0
 0.0  0.0          0.0          0.0          0.0          9.10844f-44  0.0          0.0
 0.0  0.0          0.0          0.0          0.0          0.0          1.03696f-43  0.0
 0.0  0.0          0.0          0.0          0.0          0.0          0.0          0.0
 0.0  0.0          0.0          0.0          0.0          0.0          0.0          0.0

julia&gt; pointer(buf)
Ptr{Float32} @0x00007f79131fd550"><pre>julia<span class="pl-k">&gt;</span> buf <span class="pl-k">=</span> <span class="pl-c1">TileBuffer</span>(buf, (<span class="pl-k">-</span><span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">15</span>, <span class="pl-c1">8</span><span class="pl-k">:</span><span class="pl-c1">15</span>))
TiledIteration<span class="pl-k">.</span>TileBuffer{Float32,<span class="pl-c1">2</span>,<span class="pl-c1">2</span>} with indices <span class="pl-k">-</span><span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">15</span><span class="pl-k">×</span><span class="pl-c1">8</span><span class="pl-k">:</span><span class="pl-c1">15</span><span class="pl-k">:</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">2.38221f-44</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">9.3887f-44</span>   <span class="pl-c1">0.0</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">1.26117f-44</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">8.26766f-44</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">6.02558f-44</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">7.28675f-44</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">1.54143f-44</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">9.94922f-44</span>  <span class="pl-c1">0.0</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">8.82818f-44</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">9.10844f-44</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">1.03696f-43</span>  <span class="pl-c1">0.0</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>
 <span class="pl-c1">0.0</span>  <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>          <span class="pl-c1">0.0</span>

julia<span class="pl-k">&gt;</span> <span class="pl-c1">pointer</span>(buf)
Ptr{Float32} @<span class="pl-c1">0x00007f79131fd550</span></pre></div>
<h3 dir="auto"><a id="user-content-edgeiterator" class="anchor" aria-hidden="true" href="#edgeiterator"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>EdgeIterator</h3>
<p dir="auto">When performing stencil operations, oftentimes the edge of the array
requires special treatment. Several approaches to handling the edges
(adding explicit padding, or executing special code just when on the
boundaries) can slow your algorithm down because of extra steps or
branches.</p>
<p dir="auto">This package helps support implementations which first handle the
"interior" of an array (for example using <code>TiledIterator</code> over just
the interior) using a "fast path," and then handle just the edges by a
(possibly) less carefully optimized algorithm. The key component of
this is <code>EdgeIterator</code>:</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="outerrange = CartesianIndices((-1:4, 0:3))
innerrange = CartesianIndices(( 1:3, 1:2))
julia&gt; for I in EdgeIterator(outerrange, innerrange)
           @show I
       end
I = CartesianIndex(-1, 0)
I = CartesianIndex(0, 0)
I = CartesianIndex(1, 0)
I = CartesianIndex(2, 0)
I = CartesianIndex(3, 0)
I = CartesianIndex(4, 0)
I = CartesianIndex(-1, 1)
I = CartesianIndex(0, 1)
I = CartesianIndex(4, 1)
I = CartesianIndex(-1, 2)
I = CartesianIndex(0, 2)
I = CartesianIndex(4, 2)
I = CartesianIndex(-1, 3)
I = CartesianIndex(0, 3)
I = CartesianIndex(1, 3)
I = CartesianIndex(2, 3)
I = CartesianIndex(3, 3)
I = CartesianIndex(4, 3)"><pre>outerrange <span class="pl-k">=</span> <span class="pl-c1">CartesianIndices</span>((<span class="pl-k">-</span><span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">4</span>, <span class="pl-c1">0</span><span class="pl-k">:</span><span class="pl-c1">3</span>))
innerrange <span class="pl-k">=</span> <span class="pl-c1">CartesianIndices</span>(( <span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">3</span>, <span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">2</span>))
julia<span class="pl-k">&gt;</span> <span class="pl-k">for</span> I <span class="pl-k">in</span> <span class="pl-c1">EdgeIterator</span>(outerrange, innerrange)
           <span class="pl-c1">@show</span> I
       <span class="pl-k">end</span>
I <span class="pl-k">=</span> <span class="pl-c1">CartesianIndex</span>(<span class="pl-k">-</span><span class="pl-c1">1</span>, <span class="pl-c1">0</span>)
I <span class="pl-k">=</span> <span class="pl-c1">CartesianIndex</span>(<span class="pl-c1">0</span>, <span class="pl-c1">0</span>)
I <span class="pl-k">=</span> <span class="pl-c1">CartesianIndex</span>(<span class="pl-c1">1</span>, <span class="pl-c1">0</span>)
I <span class="pl-k">=</span> <span class="pl-c1">CartesianIndex</span>(<span class="pl-c1">2</span>, <span class="pl-c1">0</span>)
I <span class="pl-k">=</span> <span class="pl-c1">CartesianIndex</span>(<span class="pl-c1">3</span>, <span class="pl-c1">0</span>)
I <span class="pl-k">=</span> <span class="pl-c1">CartesianIndex</span>(<span class="pl-c1">4</span>, <span class="pl-c1">0</span>)
I <span class="pl-k">=</span> <span class="pl-c1">CartesianIndex</span>(<span class="pl-k">-</span><span class="pl-c1">1</span>, <span class="pl-c1">1</span>)
I <span class="pl-k">=</span> <span class="pl-c1">CartesianIndex</span>(<span class="pl-c1">0</span>, <span class="pl-c1">1</span>)
I <span class="pl-k">=</span> <span class="pl-c1">CartesianIndex</span>(<span class="pl-c1">4</span>, <span class="pl-c1">1</span>)
I <span class="pl-k">=</span> <span class="pl-c1">CartesianIndex</span>(<span class="pl-k">-</span><span class="pl-c1">1</span>, <span class="pl-c1">2</span>)
I <span class="pl-k">=</span> <span class="pl-c1">CartesianIndex</span>(<span class="pl-c1">0</span>, <span class="pl-c1">2</span>)
I <span class="pl-k">=</span> <span class="pl-c1">CartesianIndex</span>(<span class="pl-c1">4</span>, <span class="pl-c1">2</span>)
I <span class="pl-k">=</span> <span class="pl-c1">CartesianIndex</span>(<span class="pl-k">-</span><span class="pl-c1">1</span>, <span class="pl-c1">3</span>)
I <span class="pl-k">=</span> <span class="pl-c1">CartesianIndex</span>(<span class="pl-c1">0</span>, <span class="pl-c1">3</span>)
I <span class="pl-k">=</span> <span class="pl-c1">CartesianIndex</span>(<span class="pl-c1">1</span>, <span class="pl-c1">3</span>)
I <span class="pl-k">=</span> <span class="pl-c1">CartesianIndex</span>(<span class="pl-c1">2</span>, <span class="pl-c1">3</span>)
I <span class="pl-k">=</span> <span class="pl-c1">CartesianIndex</span>(<span class="pl-c1">3</span>, <span class="pl-c1">3</span>)
I <span class="pl-k">=</span> <span class="pl-c1">CartesianIndex</span>(<span class="pl-c1">4</span>, <span class="pl-c1">3</span>)</pre></div>
<p dir="auto">The time required to visit these edge sites is on the order of the
number of edge sites, not the order of the number of sites encompassed
by <code>outerrange</code>, and consequently is efficient.</p>
</article></div>