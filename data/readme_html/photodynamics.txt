<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><h1 dir="auto"><a id="user-content-photodynamics" class="anchor" aria-hidden="true" href="#photodynamics"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Photodynamics</h1>
<p dir="auto"><a href="https://github.com/langfzac/Photodynamics.jl/actions"><img src="https://github.com/langfzac/Photodynamics.jl/workflows/CI/badge.svg" alt="Build Status" style="max-width: 100%;"></a>
<a href="https://codecov.io/gh/langfzac/Photodynamics.jl" rel="nofollow"><img src="https://camo.githubusercontent.com/371cc548404fc19597cf7bacf738e087e715d1d42b0ca23344e67d79092bb7f5/68747470733a2f2f636f6465636f762e696f2f67682f6c616e67667a61632f50686f746f64796e616d6963732e6a6c2f6272616e63682f6d61696e2f67726170682f62616467652e737667" alt="Coverage" data-canonical-src="https://codecov.io/gh/langfzac/Photodynamics.jl/branch/main/graph/badge.svg" style="max-width: 100%;"></a>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/a772fcf2c9d810159aa0eea20a6e7bdeb848f08aec18315c8cc6b40ee59b38db/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f646f63732d636f6d696e67253230736f6f6e2d726564"><img src="https://camo.githubusercontent.com/a772fcf2c9d810159aa0eea20a6e7bdeb848f08aec18315c8cc6b40ee59b38db/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f646f63732d636f6d696e67253230736f6f6e2d726564" alt="Coming Soon" data-canonical-src="https://img.shields.io/badge/docs-coming%20soon-red" style="max-width: 100%;"></a></p>
<p dir="auto">A differentiable photodynamics code built on <a href="https://github.com/ericagol/NbodyGradient.jl">NbodyGradient.jl</a> and <a href="https://github.com/rodluger/limbdark.jl">Limbdark.jl</a>, and methods from <a href="https://ui.adsabs.harvard.edu/abs/2020MNRAS.499.3356P/abstract" rel="nofollow">Parviainen &amp; Korth (2020)</a>.</p>
<h1 dir="auto"><a id="user-content-installation" class="anchor" aria-hidden="true" href="#installation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Installation</h1>
<p dir="auto">You can install <code>Photodynamics.jl</code> in the usual way -- via <a href="https://github.com/JuliaLang/Pkg.jl"><code>Pkg.jl</code></a>.</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="pkg&gt; add Photodynamics"><pre>pkg<span class="pl-k">&gt;</span> add Photodynamics</pre></div>
<h1 dir="auto"><a id="user-content-basic-usage" class="anchor" aria-hidden="true" href="#basic-usage"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Basic Usage</h1>
<p dir="auto">This package is very much still in-progress. The below is a simple working example using the current API, which is likely to change soon.</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="using Photodynamics, Plots

# Setup a simple 3 body system using NbodyGradient.jl initial conditions
# Distance: AU
# Time: Days
# Masses: Solar Masses
# Angles: radians
N = 3
t0 = 0.0
star = Elements(m = 1.0)
planet_b = Elements(m = 3e-5, P = 1.5, t0=0.32, ecosϖ = 0.03, I =  π/2)
planet_c = Elements(m = 6e-5, P = 2.4, t0=0.35, ecosϖ = 0.02, I =  π/2)
ic = ElementsIC(t0, 3, star, planet_b, planet_c)

# Stellar/transit properties
rstar = 0.00465047 * 0.1192 # Trappist-1 (Rstar/AU)
k = [0.085, 0.083]  # Radius ratios
u_n = [0.28, 0.11]  # Limbdarkening coefficients

# Setup simulated lightcurve
cadence = 2 / 60 / 24  # 2 minute cadence in days
obs_duration = 2.0  # Duration of observations in days
obs_times = collect(t0:cadence:obs_duration)
lc = Lightcurve(cadence, obs_times, ones(length(obs_times)), zeros(length(obs_times)), u_n, k, rstar)

# Compute the dynamical model
intr = Integrator(0.05, obs_duration)
s = State(ic)
ts = TransitSeries(obs_duration, ic)
tt = TransitTiming(obs_duration, ic)
intr(s, ts, tt; grad=false)

# Compute the photometry
compute_lightcurve!(lc, ts)

# Make a, not very glamorous, plot of the lightcurve
mask = 0.3 .&lt; lc.tobs .&lt; 0.375
plot(lc.tobs[mask], lc.flux[mask] .+ 1, legend=false, marker=true)
xlabel!(&quot;Time [Days]&quot;); ylabel!(&quot;Relative Flux&quot;)"><pre><span class="pl-k">using</span> Photodynamics, Plots

<span class="pl-c"><span class="pl-c">#</span> Setup a simple 3 body system using NbodyGradient.jl initial conditions</span>
<span class="pl-c"><span class="pl-c">#</span> Distance: AU</span>
<span class="pl-c"><span class="pl-c">#</span> Time: Days</span>
<span class="pl-c"><span class="pl-c">#</span> Masses: Solar Masses</span>
<span class="pl-c"><span class="pl-c">#</span> Angles: radians</span>
N <span class="pl-k">=</span> <span class="pl-c1">3</span>
t0 <span class="pl-k">=</span> <span class="pl-c1">0.0</span>
star <span class="pl-k">=</span> <span class="pl-c1">Elements</span>(m <span class="pl-k">=</span> <span class="pl-c1">1.0</span>)
planet_b <span class="pl-k">=</span> <span class="pl-c1">Elements</span>(m <span class="pl-k">=</span> <span class="pl-c1">3e-5</span>, P <span class="pl-k">=</span> <span class="pl-c1">1.5</span>, t0<span class="pl-k">=</span><span class="pl-c1">0.32</span>, ecosϖ <span class="pl-k">=</span> <span class="pl-c1">0.03</span>, I <span class="pl-k">=</span>  π<span class="pl-k">/</span><span class="pl-c1">2</span>)
planet_c <span class="pl-k">=</span> <span class="pl-c1">Elements</span>(m <span class="pl-k">=</span> <span class="pl-c1">6e-5</span>, P <span class="pl-k">=</span> <span class="pl-c1">2.4</span>, t0<span class="pl-k">=</span><span class="pl-c1">0.35</span>, ecosϖ <span class="pl-k">=</span> <span class="pl-c1">0.02</span>, I <span class="pl-k">=</span>  π<span class="pl-k">/</span><span class="pl-c1">2</span>)
ic <span class="pl-k">=</span> <span class="pl-c1">ElementsIC</span>(t0, <span class="pl-c1">3</span>, star, planet_b, planet_c)

<span class="pl-c"><span class="pl-c">#</span> Stellar/transit properties</span>
rstar <span class="pl-k">=</span> <span class="pl-c1">0.00465047</span> <span class="pl-k">*</span> <span class="pl-c1">0.1192</span> <span class="pl-c"><span class="pl-c">#</span> Trappist-1 (Rstar/AU)</span>
k <span class="pl-k">=</span> [<span class="pl-c1">0.085</span>, <span class="pl-c1">0.083</span>]  <span class="pl-c"><span class="pl-c">#</span> Radius ratios</span>
u_n <span class="pl-k">=</span> [<span class="pl-c1">0.28</span>, <span class="pl-c1">0.11</span>]  <span class="pl-c"><span class="pl-c">#</span> Limbdarkening coefficients</span>

<span class="pl-c"><span class="pl-c">#</span> Setup simulated lightcurve</span>
cadence <span class="pl-k">=</span> <span class="pl-c1">2</span> <span class="pl-k">/</span> <span class="pl-c1">60</span> <span class="pl-k">/</span> <span class="pl-c1">24</span>  <span class="pl-c"><span class="pl-c">#</span> 2 minute cadence in days</span>
obs_duration <span class="pl-k">=</span> <span class="pl-c1">2.0</span>  <span class="pl-c"><span class="pl-c">#</span> Duration of observations in days</span>
obs_times <span class="pl-k">=</span> <span class="pl-c1">collect</span>(t0<span class="pl-k">:</span>cadence<span class="pl-k">:</span>obs_duration)
lc <span class="pl-k">=</span> <span class="pl-c1">Lightcurve</span>(cadence, obs_times, <span class="pl-c1">ones</span>(<span class="pl-c1">length</span>(obs_times)), <span class="pl-c1">zeros</span>(<span class="pl-c1">length</span>(obs_times)), u_n, k, rstar)

<span class="pl-c"><span class="pl-c">#</span> Compute the dynamical model</span>
intr <span class="pl-k">=</span> <span class="pl-c1">Integrator</span>(<span class="pl-c1">0.05</span>, obs_duration)
s <span class="pl-k">=</span> <span class="pl-c1">State</span>(ic)
ts <span class="pl-k">=</span> <span class="pl-c1">TransitSeries</span>(obs_duration, ic)
tt <span class="pl-k">=</span> <span class="pl-c1">TransitTiming</span>(obs_duration, ic)
<span class="pl-c1">intr</span>(s, ts, tt; grad<span class="pl-k">=</span><span class="pl-c1">false</span>)

<span class="pl-c"><span class="pl-c">#</span> Compute the photometry</span>
<span class="pl-c1">compute_lightcurve!</span>(lc, ts)

<span class="pl-c"><span class="pl-c">#</span> Make a, not very glamorous, plot of the lightcurve</span>
mask <span class="pl-k">=</span> <span class="pl-c1">0.3</span> <span class="pl-k">.&lt;</span> lc<span class="pl-k">.</span>tobs <span class="pl-k">.&lt;</span> <span class="pl-c1">0.375</span>
<span class="pl-c1">plot</span>(lc<span class="pl-k">.</span>tobs[mask], lc<span class="pl-k">.</span>flux[mask] <span class="pl-k">.+</span> <span class="pl-c1">1</span>, legend<span class="pl-k">=</span><span class="pl-c1">false</span>, marker<span class="pl-k">=</span><span class="pl-c1">true</span>)
<span class="pl-c1">xlabel!</span>(<span class="pl-s"><span class="pl-pds">"</span>Time [Days]<span class="pl-pds">"</span></span>); <span class="pl-c1">ylabel!</span>(<span class="pl-s"><span class="pl-pds">"</span>Relative Flux<span class="pl-pds">"</span></span>)</pre></div>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="docs/src/assets/three_body.png"><img src="docs/src/assets/three_body.png" alt="" style="max-width: 100%;"></a></p>
</article></div>