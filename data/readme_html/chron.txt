<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><h1 dir="auto"><a id="user-content-chronjl" class="anchor" aria-hidden="true" href="#chronjl"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Chron.jl</h1>
<p dir="auto"><a href="https://doi.org/10.17605/OSF.IO/TQX3F" rel="nofollow"><img src="readme_figures/osf_io_TQX3F.svg" alt="DOI" style="max-width: 100%;"></a>
<a href="https://brenhinkeller.github.io/Chron.jl/dev/" rel="nofollow"><img src="https://camo.githubusercontent.com/7fcec4b2d3ab291529fce8ef6a4fcd4129a0683b2f5d5fe2f5c648f02db8b616/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f646f63732d6465762d626c75652e737667" alt="Docs" data-canonical-src="https://img.shields.io/badge/docs-dev-blue.svg" style="max-width: 100%;"></a>
<a href="https://github.com/brenhinkeller/Chron.jl/actions/workflows/CI.yml"><img src="https://github.com/brenhinkeller/Chron.jl/workflows/CI/badge.svg" alt="CI" style="max-width: 100%;"></a>
<a href="https://github.com/brenhinkeller/Chron.jl/actions/workflows/CI-julia-nightly.yml"><img src="https://github.com/brenhinkeller/Chron.jl/workflows/CI%20(Julia%20nightly)/badge.svg" alt="CI (julia nightly)" style="max-width: 100%;"></a>
<a href="http://app.codecov.io/github/brenhinkeller/Chron.jl?branch=main" rel="nofollow"><img src="https://camo.githubusercontent.com/2ae0d509735c9fc65c86e1cdb78d2e9656f57d0c8cabcb0a9e4809a2409ec6aa/687474703a2f2f636f6465636f762e696f2f6769746875622f6272656e68696e6b656c6c65722f4368726f6e2e6a6c2f636f7665726167652e7376673f6272616e63683d6d61696e" alt="codecov.io" data-canonical-src="http://codecov.io/github/brenhinkeller/Chron.jl/coverage.svg?branch=main" style="max-width: 100%;"></a></p>
<p dir="auto"><em>A Bayesian framework for integrated eruption age and age-depth modelling</em></p>
<p dir="auto">Chron.jl is a two-part framework for any combination of (1) estimating eruption/deposition age distributions from complex mineral age spectra and/or (2) subsequently building a stratigraphic age model based on those distributions. Each step relies on a Markov-Chain Monte Carlo model, and either step can be run as a standalone model if you do not need both components.</p>
<p dir="auto">The first (distribution) MCMC model is based on the work of <a href="https://doi.org/10.7185/geochemlet.1826" rel="nofollow">Keller, Schoene, and Samperton (2018)</a> and uses information about the possible shape of the true mineral crystallization (or closure) age distribution (e.g., no crystallization possible after eruption or deposition). In this first model, the true eruption or deposition age is a parameter of this scaled crystallization distribution. The stationary distribution of this first MCMC model then gives an estimate of the eruption/deposition age.</p>
<p dir="auto">The second (stratigraphic) MCMC model, developed for use in <a href="https://doi.org/10.1126/science.aau2422" rel="nofollow">Schoene et al. (2019)</a> and <a href="https://doi.org/10.1016/j.quascirev.2019.05.009" rel="nofollow">Deino et al. (2019)</a> among others, uses the estimated (posterior) eruption/deposition age distributions along with the constraint of stratigraphic superposition to produce an age-depth model. This stratigraphic model can incorporate either standard Gaussian or asymmetric empirical distributions as age constraints, as well additional complications such as hiatuses of known minimum duration, height uncertainty, and one-sided age constraints. The stationary distribution of this second MCMC model yields an estimate of age at each model horizon throughout the section.</p>
<p dir="auto">In addition to the functions defined and exported here directly, Chron.jl also reexports (and depends upon internally) <a href="https://github.com/brenhinkeller/StatGeochemBase.jl">StatGeochemBase.jl</a>, <a href="https://github.com/brenhinkeller/NaNStatistics.jl">NaNStatistics.jl</a>, and <a href="https://github.com/JuliaGeochronology/Isoplot.jl">Isoplot.jl</a>.</p>
<p dir="auto">For Chron.jl-style age-depth modelling combined with subsidence analysis, see <a href="https://github.com/JuliaGeochronology/SubsidenceChron.jl">SubsidenceChron.jl</a></p>
<h2 dir="auto"><a id="user-content-citation" class="anchor" aria-hidden="true" href="#citation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Citation</h2>
<p dir="auto">You may cite Chron.jl as:</p>
<blockquote>
<p dir="auto">Keller, C.B. (2018). <em>Chron.jl: A Bayesian framework for integrated eruption age and age-depth modelling</em>. <a href="https://doi.org/10.17605/osf.io/TQX3F" rel="nofollow">https://doi.org/10.17605/osf.io/TQX3F</a></p>
</blockquote>
<p dir="auto">Additional citations may include:
For eruption age estimation</p>
<blockquote>
<p dir="auto">Keller, C.B., Schoene, B., &amp; Samperton, K.M. (2018). A Stochastic Sampling Approach to Zircon Eruption Age Interpretation. <em>Geochemical Persectives Letters</em> 8, 31–35</p>
</blockquote>
<p dir="auto">For the extension of this eruption age estimation to sanidine Ar-Ar data</p>
<blockquote>
<p dir="auto">van Zalinge, M.E, Mark, D.F., Sparks R.S.J., Tremblay, M.M. Keller, C.B., Cooper, F.J. &amp; Rust, A. (2022). Timescales for pluton growth, magma-chamber formation and super-eruptions. <em>Nature</em> 608, 87-92.</p>
</blockquote>
<p dir="auto">For age-depth modelling, applied to zircon U-Pb data</p>
<blockquote>
<p dir="auto">Schoene, B., Eddy, M.P., Samperton, K.M., Keller, C.B., Keller, G., Adatte, T., &amp; Khadri, S.F.R. (2019). U-Pb constraints on pulsed eruption of the Deccan Traps across the end-Cretaceous mass extinction. <em>Science</em> 363 (6429), 862–866.</p>
</blockquote>
<p dir="auto">For age-depth modelling, applied to sanidine Ar-Ar data</p>
<blockquote>
<p dir="auto">Deino, A.L., Dommain, R., Keller, C.B., Potts, R., Behrensmeyer, A.K., Beverly, E.J., King, J., Heil, C.W., Stockhecke, M., Brown, E.T., Moerman, J., de Menocal, P., Levin, N.E., &amp; ODP Scientific Team. (2019). Chronostratigraphic model of a high-resolution drill core record of the past million years from the Koora Basin, south Kenya Rift: Overcoming the difficulties of variable sedimentation rate and hiatuses. <em>Quaternary Science Reviews</em> 215, 213–231.</p>
</blockquote>
<h2 dir="auto"><a id="user-content-installation" class="anchor" aria-hidden="true" href="#installation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Installation</h2>
<p dir="auto">Chron.jl is written in the <a href="https://julialang.org/" rel="nofollow">Julia programming language</a>, and is registered on the General registry. To install, enter the Julia package manager (type ] in the REPL) and type:</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="pkg&gt; add Chron"><pre>pkg<span class="pl-k">&gt;</span> add Chron</pre></div>
<p dir="auto">If you are trying to use Chron with a published script written prior to ~2021, you may want to use the oldest registered version of the package, which you can install with (e.g.)</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="pkg&gt; add Chron@v0.1"><pre>pkg<span class="pl-k">&gt;</span> add Chron<span class="pl-c1">@v0</span>.<span class="pl-c1">1</span></pre></div>
<h2 dir="auto"><a id="user-content-online--notebook-usage" class="anchor" aria-hidden="true" href="#online--notebook-usage"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Online / Notebook Usage</h2>
<h3 dir="auto"><a id="user-content-coupled-eruptiondeposition-age-and-age-depth-modelling" class="anchor" aria-hidden="true" href="#coupled-eruptiondeposition-age-and-age-depth-modelling"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Coupled eruption/deposition age and age-depth modelling</h3>
<p dir="auto">For a quick test (without having to install anything), try the <a href="https://mybinder.org/v2/gh/brenhinkeller/Chron.jl/main?filepath=examples/Chron1.0Coupled.ipynb" rel="nofollow">interactive online Jupyter notebook</a> (note: it'll take a few minutes for the notebook to launch). <a href="https://mybinder.org/v2/gh/brenhinkeller/Chron.jl/main?filepath=examples/Chron1.0Coupled.ipynb" rel="nofollow"><img src="https://camo.githubusercontent.com/581c077bdbc6ca6899c86d0acc6145ae85e9d80e6f805a1071793dbe48917982/68747470733a2f2f6d7962696e6465722e6f72672f62616467655f6c6f676f2e737667" alt="Binder" data-canonical-src="https://mybinder.org/badge_logo.svg" style="max-width: 100%;"></a></p>
<p dir="auto">This runs <a href="examples/Chron1.0Coupled.ipynb">examples/Chron1.0Coupled.ipynb</a> on a <a href="https://github.com/jupyterhub/jupyterhub">JupyterHub</a> server hosted by the <a href="https://mybinder.org" rel="nofollow">Binder</a> project. If you make changes to the interactive online notebook, you can save them with <code>File</code> &gt; <code>Download as</code> &gt; <code>Notebook (.ipynb)</code> To run a downloaded notebook locally, use <a href="https://github.com/JuliaLang/IJulia.jl">IJulia</a></p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="julia&gt; using IJulia
julia&gt; notebook()"><pre>julia<span class="pl-k">&gt;</span> <span class="pl-k">using</span> IJulia
julia<span class="pl-k">&gt;</span> <span class="pl-c1">notebook</span>()</pre></div>
<p dir="auto">For an example of the Pb-loss-aware options, see also</p>
<ul dir="auto">
<li><a href="https://mybinder.org/v2/gh/brenhinkeller/Chron.jl/main?filepath=examples/Chron1.0CoupledConcordia.ipynb" rel="nofollow"><img src="https://camo.githubusercontent.com/581c077bdbc6ca6899c86d0acc6145ae85e9d80e6f805a1071793dbe48917982/68747470733a2f2f6d7962696e6465722e6f72672f62616467655f6c6f676f2e737667" alt="Binder" data-canonical-src="https://mybinder.org/badge_logo.svg" style="max-width: 100%;"></a> <a href="https://mybinder.org/v2/gh/brenhinkeller/Chron.jl/main?filepath=examples/Chron1.0CoupledConcordia.ipynb" rel="nofollow">Age-depth modelling with simple Gaussian age constraints</a></li>
</ul>
<h3 dir="auto"><a id="user-content-standalone-age-depth-modelling" class="anchor" aria-hidden="true" href="#standalone-age-depth-modelling"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Standalone age-depth modelling</h3>
<p dir="auto">If you want to use Chron.jl for for age-depth modelling without the eruption/deposition age estimation step, there are also example notebooks standalone age-depth modelling using either</p>
<ul dir="auto">
<li><a href="https://mybinder.org/v2/gh/brenhinkeller/Chron.jl/main?filepath=examples/Chron1.0StratOnly.ipynb" rel="nofollow"><img src="https://camo.githubusercontent.com/581c077bdbc6ca6899c86d0acc6145ae85e9d80e6f805a1071793dbe48917982/68747470733a2f2f6d7962696e6465722e6f72672f62616467655f6c6f676f2e737667" alt="Binder" data-canonical-src="https://mybinder.org/badge_logo.svg" style="max-width: 100%;"></a> <a href="https://mybinder.org/v2/gh/brenhinkeller/Chron.jl/main?filepath=examples/Chron1.0StratOnly.ipynb" rel="nofollow">Age-depth modelling with simple Gaussian age constraints</a> or</li>
<li><a href="https://mybinder.org/v2/gh/brenhinkeller/Chron.jl/main?filepath=examples/Chron1.0Radiocarbon.ipynb" rel="nofollow"><img src="https://camo.githubusercontent.com/581c077bdbc6ca6899c86d0acc6145ae85e9d80e6f805a1071793dbe48917982/68747470733a2f2f6d7962696e6465722e6f72672f62616467655f6c6f676f2e737667" alt="Binder" data-canonical-src="https://mybinder.org/badge_logo.svg" style="max-width: 100%;"></a> <a href="https://mybinder.org/v2/gh/brenhinkeller/Chron.jl/main?filepath=examples/Chron1.0Radiocarbon.ipynb" rel="nofollow">Age-depth modelling with radiocarbon age constraints</a></li>
</ul>
<p dir="auto">with or without hiatuses.</p>
<h3 dir="auto"><a id="user-content-standalone-eruptiondeposition-age-modelling" class="anchor" aria-hidden="true" href="#standalone-eruptiondeposition-age-modelling"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Standalone eruption/deposition age modelling</h3>
<p dir="auto">To run an eruption/deposition age estimate, without any age-depth modelling, try the notebook for</p>
<ul dir="auto">
<li><a href="https://mybinder.org/v2/gh/brenhinkeller/Chron.jl/main?filepath=examples/Chron1.0DistOnly.ipynb" rel="nofollow"><img src="https://camo.githubusercontent.com/581c077bdbc6ca6899c86d0acc6145ae85e9d80e6f805a1071793dbe48917982/68747470733a2f2f6d7962696e6465722e6f72672f62616467655f6c6f676f2e737667" alt="Binder" data-canonical-src="https://mybinder.org/badge_logo.svg" style="max-width: 100%;"></a> <a href="https://mybinder.org/v2/gh/brenhinkeller/Chron.jl/main?filepath=examples/Chron1.0DistOnly.ipynb" rel="nofollow">Standalone eruption/deposition age modelling</a></li>
<li><a href="https://mybinder.org/v2/gh/brenhinkeller/Chron.jl/main?filepath=examples/EruptionDepositionAgeDemonstration.ipynb" rel="nofollow"><img src="https://camo.githubusercontent.com/581c077bdbc6ca6899c86d0acc6145ae85e9d80e6f805a1071793dbe48917982/68747470733a2f2f6d7962696e6465722e6f72672f62616467655f6c6f676f2e737667" alt="Binder" data-canonical-src="https://mybinder.org/badge_logo.svg" style="max-width: 100%;"></a> <a href="https://mybinder.org/v2/gh/brenhinkeller/Chron.jl/main?filepath=examples/EruptionDepositionAgeDemonstration.ipynb" rel="nofollow">Eruption/deposition age demo</a></li>
</ul>
<h2 dir="auto"><a id="user-content-standard-usage" class="anchor" aria-hidden="true" href="#standard-usage"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Standard Usage</h2>
<p dir="auto">After installing <a href="https://julialang.org/downloads/" rel="nofollow">Julia</a> with or without <a href="http://junolab.org/" rel="nofollow">Juno</a>, and Chron.jl (above), run <a href="examples/Chron1.0Coupled.jl">examples/Chron1.0Coupled.jl</a> to see how the code works. It should look something like this:</p>
<h4 dir="auto"><a id="user-content-load-necessary-julia-packages" class="anchor" aria-hidden="true" href="#load-necessary-julia-packages"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Load necessary Julia packages</h4>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="if VERSION&gt;=v&quot;0.7&quot;
    using Statistics, StatsBase, DelimitedFiles, SpecialFunctions
else
    using Compat
end

using Chron

using Plots; gr();"><pre><span class="pl-k">if</span> <span class="pl-c1">VERSION</span><span class="pl-k">&gt;=</span><span class="pl-s"><span class="pl-pds"><span class="pl-c1">v</span>"</span>0.7<span class="pl-pds">"</span></span>
    <span class="pl-k">using</span> Statistics, StatsBase, DelimitedFiles, SpecialFunctions
<span class="pl-k">else</span>
    <span class="pl-k">using</span> Compat
<span class="pl-k">end</span>

<span class="pl-k">using</span> Chron

<span class="pl-k">using</span> Plots; <span class="pl-c1">gr</span>();</pre></div>
<h4 dir="auto"><a id="user-content-enter-sample-information" class="anchor" aria-hidden="true" href="#enter-sample-information"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Enter sample information</h4>
<p dir="auto">This example data is from Clyde et al. (2016) "Direct high-precision
U–Pb geochronology of the end-Cretaceous extinction and calibration of
Paleocene astronomical timescales" EPSL 452, 272–280.
doi: <a href="https://doi.org/10.1016/j.epsl.2016.07.041" rel="nofollow">10.1016/j.epsl.2016.07.041</a></p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="nSamples = 5 # The number of samples you have data for
smpl = ChronAgeData(nSamples)
smpl.Name      =   (&quot;KJ08-157&quot;, &quot;KJ04-75&quot;, &quot;KJ09-66&quot;, &quot;KJ04-72&quot;, &quot;KJ04-70&quot;,)
smpl.Height[:] =   [     -52.0,      44.0,      54.0,      82.0,      93.0,]
smpl.Height_sigma[:] = [   3.0,       1.0,       3.0,       3.0,       3.0,]
smpl.Age_Sidedness[:] = zeros(nSamples) # Sidedness (zeros by default: geochron constraints are two-sided). Use -1 for a maximum age and +1 for a minimum age, 0 for two-sided
smpl.Path = &quot;DenverUPbExampleData/&quot; # Where are the data files?
smpl.inputSigmaLevel = 2 # i.e., are the data files 1-sigma or 2-sigma. Integer.

AgeUnit = &quot;Ma&quot; # Unit of measurement for ages and errors in the data files
HeightUnit = &quot;cm&quot;; # Unit of measurement for Height and Height_sigma"><pre>nSamples <span class="pl-k">=</span> <span class="pl-c1">5</span> <span class="pl-c"><span class="pl-c">#</span> The number of samples you have data for</span>
smpl <span class="pl-k">=</span> <span class="pl-c1">ChronAgeData</span>(nSamples)
smpl<span class="pl-k">.</span>Name      <span class="pl-k">=</span>   (<span class="pl-s"><span class="pl-pds">"</span>KJ08-157<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>KJ04-75<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>KJ09-66<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>KJ04-72<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>KJ04-70<span class="pl-pds">"</span></span>,)
smpl<span class="pl-k">.</span>Height[:] <span class="pl-k">=</span>   [     <span class="pl-k">-</span><span class="pl-c1">52.0</span>,      <span class="pl-c1">44.0</span>,      <span class="pl-c1">54.0</span>,      <span class="pl-c1">82.0</span>,      <span class="pl-c1">93.0</span>,]
smpl<span class="pl-k">.</span>Height_sigma[:] <span class="pl-k">=</span> [   <span class="pl-c1">3.0</span>,       <span class="pl-c1">1.0</span>,       <span class="pl-c1">3.0</span>,       <span class="pl-c1">3.0</span>,       <span class="pl-c1">3.0</span>,]
smpl<span class="pl-k">.</span>Age_Sidedness[:] <span class="pl-k">=</span> <span class="pl-c1">zeros</span>(nSamples) <span class="pl-c"><span class="pl-c">#</span> Sidedness (zeros by default: geochron constraints are two-sided). Use -1 for a maximum age and +1 for a minimum age, 0 for two-sided</span>
smpl<span class="pl-k">.</span>Path <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>DenverUPbExampleData/<span class="pl-pds">"</span></span> <span class="pl-c"><span class="pl-c">#</span> Where are the data files?</span>
smpl<span class="pl-k">.</span>inputSigmaLevel <span class="pl-k">=</span> <span class="pl-c1">2</span> <span class="pl-c"><span class="pl-c">#</span> i.e., are the data files 1-sigma or 2-sigma. Integer.</span>

AgeUnit <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Ma<span class="pl-pds">"</span></span> <span class="pl-c"><span class="pl-c">#</span> Unit of measurement for ages and errors in the data files</span>
HeightUnit <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>cm<span class="pl-pds">"</span></span>; <span class="pl-c"><span class="pl-c">#</span> Unit of measurement for Height and Height_sigma</span></pre></div>
<p dir="auto">For each sample in <code>smpl.Name</code>, we must have a <code>.csv</code> file in <code>smpl.Path</code> which contains each individual mineral age and uncertainty. For instance, <a href="examples/DenverUPbExampleData/KJ08-157.csv">examples/DenverUPbExampleData/KJ08-157.csv</a> contains:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="66.12,0.14
66.115,0.048
66.11,0.1
66.11,0.17
66.096,0.056
66.088,0.081
66.085,0.076
66.073,0.084
66.07,0.11
66.055,0.043
66.05,0.16
65.97,0.12"><pre class="notranslate"><code>66.12,0.14
66.115,0.048
66.11,0.1
66.11,0.17
66.096,0.056
66.088,0.081
66.085,0.076
66.073,0.084
66.07,0.11
66.055,0.043
66.05,0.16
65.97,0.12
</code></pre></div>
<p dir="auto">Note also that smpl.Height <em>must</em> increase with increasing stratigraphic height -- i.e., stratigraphically younger samples must be more positive. For this reason, it is convenient to represent depths below surface as negative numbers.</p>
<h4 dir="auto"><a id="user-content-configure-and-run-eruptiondeposition-age-model" class="anchor" aria-hidden="true" href="#configure-and-run-eruptiondeposition-age-model"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Configure and run eruption/deposition age model</h4>
<p dir="auto">To learn more about the eruption/deposition age estimation model, see also <a href="https://doi.org/10.7185/geochemlet.1826" rel="nofollow">Keller, Schoene, and Samperton (2018)</a> and the <a href="http://brenh.in/BayeZirChron" rel="nofollow">BayeZirChron demo notebook</a>. It is important to note that this model (like most if not all others) has no knowledge of open-system behaviour, so <em>e.g.</em>, Pb-loss will lead to erroneous results.</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# Number of steps to run in distribution MCMC
distSteps = 10^7
distBurnin = floor(Int,distSteps/100)

# Choose the form of the prior distribution to use.
# A variety of potentially useful distributions are provided in DistMetropolis.jl - Options include UniformDisribution,
# TriangularDistribution, BootstrappedDistribution, and MeltsVolcanicZirconDistribution - or you can define your own.
dist = TriangularDistribution;

# Run MCMC to estimate saturation and eruption/deposition age distributions
smpl = tMinDistMetropolis(smpl,distSteps,distBurnin,dist);"><pre><span class="pl-c"><span class="pl-c">#</span> Number of steps to run in distribution MCMC</span>
distSteps <span class="pl-k">=</span> <span class="pl-c1">10</span><span class="pl-k">^</span><span class="pl-c1">7</span>
distBurnin <span class="pl-k">=</span> <span class="pl-c1">floor</span>(Int,distSteps<span class="pl-k">/</span><span class="pl-c1">100</span>)

<span class="pl-c"><span class="pl-c">#</span> Choose the form of the prior distribution to use.</span>
<span class="pl-c"><span class="pl-c">#</span> A variety of potentially useful distributions are provided in DistMetropolis.jl - Options include UniformDisribution,</span>
<span class="pl-c"><span class="pl-c">#</span> TriangularDistribution, BootstrappedDistribution, and MeltsVolcanicZirconDistribution - or you can define your own.</span>
dist <span class="pl-k">=</span> TriangularDistribution;

<span class="pl-c"><span class="pl-c">#</span> Run MCMC to estimate saturation and eruption/deposition age distributions</span>
smpl <span class="pl-k">=</span> <span class="pl-c1">tMinDistMetropolis</span>(smpl,distSteps,distBurnin,dist);</pre></div>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="Estimating eruption/deposition age distributions...
1: KJ08-157
2: KJ04-75
3: KJ09-66
4: KJ04-72
5: KJ04-70"><pre class="notranslate"><code>Estimating eruption/deposition age distributions...
1: KJ08-157
2: KJ04-75
3: KJ09-66
4: KJ04-72
5: KJ04-70
</code></pre></div>
<p dir="auto">Let's see what that did</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="; ls $(smpl.Path)
results = readdlm(smpl.Path*&quot;results.csv&quot;,',')
; open $(smpl.Path*&quot;KJ04-75_rankorder.pdf&quot;)"><pre>; ls <span class="pl-k">$</span>(smpl<span class="pl-k">.</span>Path)
results <span class="pl-k">=</span> <span class="pl-c1">readdlm</span>(smpl<span class="pl-k">.</span>Path<span class="pl-k">*</span><span class="pl-s"><span class="pl-pds">"</span>results.csv<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">'</span>,<span class="pl-pds">'</span></span>)
; open <span class="pl-k">$</span>(smpl<span class="pl-k">.</span>Path<span class="pl-k">*</span><span class="pl-s"><span class="pl-pds">"</span>KJ04-75_rankorder.pdf<span class="pl-pds">"</span></span>)</pre></div>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="BootstrappedDistribution.pdf
KJ04-70.csv
KJ04-70_distribution.pdf
KJ04-70_rankorder.pdf
KJ04-72.csv
KJ04-72_distribution.pdf
KJ04-72_rankorder.pdf
KJ04-75.csv
KJ04-75_distribution.pdf
KJ04-75_rankorder.pdf
KJ08-157.csv
KJ08-157_distribution.pdf
KJ08-157_rankorder.pdf
KJ09-66.csv
KJ09-66_distribution.pdf
KJ09-66_rankorder.pdf
KJ12-01.csv
results.csv


6×5 Array{Any,2}:
 &quot;Sample&quot;      &quot;Age&quot;    &quot;2.5% CI&quot;    &quot;97.5% CI&quot;   &quot;sigma&quot;
 &quot;KJ08-157&quot;  66.065   66.0312      66.0896       0.0151996
 &quot;KJ04-75&quot;   65.9744  65.9237      66.0056       0.0198365
 &quot;KJ09-66&quot;   65.9475  65.9143      65.9807       0.0168379
 &quot;KJ04-72&quot;   65.9531  65.9194      65.9737       0.0135548
 &quot;KJ04-70&quot;   65.8518  65.7857      65.898        0.0288371"><pre class="notranslate"><code>BootstrappedDistribution.pdf
KJ04-70.csv
KJ04-70_distribution.pdf
KJ04-70_rankorder.pdf
KJ04-72.csv
KJ04-72_distribution.pdf
KJ04-72_rankorder.pdf
KJ04-75.csv
KJ04-75_distribution.pdf
KJ04-75_rankorder.pdf
KJ08-157.csv
KJ08-157_distribution.pdf
KJ08-157_rankorder.pdf
KJ09-66.csv
KJ09-66_distribution.pdf
KJ09-66_rankorder.pdf
KJ12-01.csv
results.csv


6×5 Array{Any,2}:
 "Sample"      "Age"    "2.5% CI"    "97.5% CI"   "sigma"
 "KJ08-157"  66.065   66.0312      66.0896       0.0151996
 "KJ04-75"   65.9744  65.9237      66.0056       0.0198365
 "KJ09-66"   65.9475  65.9143      65.9807       0.0168379
 "KJ04-72"   65.9531  65.9194      65.9737       0.0135548
 "KJ04-70"   65.8518  65.7857      65.898        0.0288371
</code></pre></div>
<p dir="auto">Let's look at the plots for sample KJ04-70:</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="readme_figures/KJ04-70_rankorder.svg"><img src="readme_figures/KJ04-70_rankorder.svg" alt="svg" style="max-width: 100%;"></a></p>
<p dir="auto">For each sample, the eruption/deposition age distribution is inherently asymmetric, because of the one-sided relationship between mineral closure and eruption/deposition. For example:</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="readme_figures/KJ04-70_distribution.svg"><img src="readme_figures/KJ04-70_distribution.svg" alt="svg" style="max-width: 100%;"></a></p>
<p dir="auto">Consequently, rather than simply taking a mean and standard deviation of the stationary distribtuion of the Markov Chain, the histogram of the stationary distribution is fit to an empirical distribution function of the form</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="readme_figures/Eqn1.png"><img src="readme_figures/Eqn1.png" width="565" style="max-width: 100%;"></a></p>
<p dir="auto">where</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="readme_figures/Eqn2.png"><img src="readme_figures/Eqn2.png" width="110" style="max-width: 100%;"></a></p>
<p dir="auto"><em>i.e.</em>, an asymmetric exponential function with two log-linear segments joined with an arctangent sigmoid. After fitting, the five parameters <math-renderer class="js-inline-math" style="display: inline" data-static-url="https://github.githubassets.com/static" data-run-id="357b324b81f0d0e58ba767dfecc6970c">$a$</math-renderer> - <math-renderer class="js-inline-math" style="display: inline" data-static-url="https://github.githubassets.com/static" data-run-id="357b324b81f0d0e58ba767dfecc6970c">$e$</math-renderer> are stored in <code>smpl.params</code> and passed to the stratigraphic model</p>
<h4 dir="auto">
<a id="user-content-configure-and-run-stratigraphic-model" class="anchor" aria-hidden="true" href="#configure-and-run-stratigraphic-model"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Configure and run stratigraphic model</h4>
<p dir="auto">For a publication-quality result, you probably want nsteps and burnin on the order of</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="config.nsteps = 30000 # Number of steps to run in distribution MCMC
config.burnin = 10000*npoints_approx # Number to discard"><pre class="notranslate"><code>config.nsteps = 30000 # Number of steps to run in distribution MCMC
config.burnin = 10000*npoints_approx # Number to discard
</code></pre></div>
<p dir="auto">and examine the log likelihood plot to make sure you've converged.</p>
<p dir="auto">To run the stratigraphic MCMC model, we call the <code>StratMetropolisDist</code> function. If you want to skip the first step and simply input run the stratigraphic model with Gaussian mean age and standard deviation for some number of stratigraphic horizons, then you can set <code>smpl.Age</code> and <code>smpl.Age_sigma</code> directly, but then you'll need to call <code>StratMetropolis</code> instead of <code>StratMetropolisDist</code></p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# Configure the stratigraphic Monte Carlo model
config = StratAgeModelConfiguration()
# If you in doubt, you can probably leave these parameters as-is
config.resolution = 1.0 # Same units as sample height. Smaller is slower!
config.bounding = 0.1 # how far away do we place runaway bounds, as a fraction of total section height
(bottom, top) = extrema(smpl.Height)
npoints_approx = round(Int,length(bottom:config.resolution:top) * (1 + 2*config.bounding))
config.nsteps = 15000 # Number of steps to run in distribution MCMC
config.burnin = 10000*npoints_approx # Number to discard
config.sieve = round(Int,npoints_approx) # Record one out of every nsieve steps

# Run the stratigraphic MCMC model
(mdl, agedist, lldist) = StratMetropolisDist(smpl, config); sleep(0.5)

# Plot the log likelihood to make sure we're converged (n.b burnin isn't recorded)
plot(lldist,xlabel=&quot;Step number&quot;,ylabel=&quot;Log likelihood&quot;,label=&quot;&quot;,line=(0.85,:darkblue))="><pre><span class="pl-c"><span class="pl-c">#</span> Configure the stratigraphic Monte Carlo model</span>
config <span class="pl-k">=</span> <span class="pl-c1">StratAgeModelConfiguration</span>()
<span class="pl-c"><span class="pl-c">#</span> If you in doubt, you can probably leave these parameters as-is</span>
config<span class="pl-k">.</span>resolution <span class="pl-k">=</span> <span class="pl-c1">1.0</span> <span class="pl-c"><span class="pl-c">#</span> Same units as sample height. Smaller is slower!</span>
config<span class="pl-k">.</span>bounding <span class="pl-k">=</span> <span class="pl-c1">0.1</span> <span class="pl-c"><span class="pl-c">#</span> how far away do we place runaway bounds, as a fraction of total section height</span>
(bottom, top) <span class="pl-k">=</span> <span class="pl-c1">extrema</span>(smpl<span class="pl-k">.</span>Height)
npoints_approx <span class="pl-k">=</span> <span class="pl-c1">round</span>(Int,<span class="pl-c1">length</span>(bottom<span class="pl-k">:</span>config<span class="pl-k">.</span>resolution<span class="pl-k">:</span>top) <span class="pl-k">*</span> (<span class="pl-c1">1</span> <span class="pl-k">+</span> <span class="pl-c1">2</span><span class="pl-k">*</span>config<span class="pl-k">.</span>bounding))
config<span class="pl-k">.</span>nsteps <span class="pl-k">=</span> <span class="pl-c1">15000</span> <span class="pl-c"><span class="pl-c">#</span> Number of steps to run in distribution MCMC</span>
config<span class="pl-k">.</span>burnin <span class="pl-k">=</span> <span class="pl-c1">10000</span><span class="pl-k">*</span>npoints_approx <span class="pl-c"><span class="pl-c">#</span> Number to discard</span>
config<span class="pl-k">.</span>sieve <span class="pl-k">=</span> <span class="pl-c1">round</span>(Int,npoints_approx) <span class="pl-c"><span class="pl-c">#</span> Record one out of every nsieve steps</span>

<span class="pl-c"><span class="pl-c">#</span> Run the stratigraphic MCMC model</span>
(mdl, agedist, lldist) <span class="pl-k">=</span> <span class="pl-c1">StratMetropolisDist</span>(smpl, config); <span class="pl-c1">sleep</span>(<span class="pl-c1">0.5</span>)

<span class="pl-c"><span class="pl-c">#</span> Plot the log likelihood to make sure we're converged (n.b burnin isn't recorded)</span>
<span class="pl-en">plot</span>(lldist,xlabel<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Step number<span class="pl-pds">"</span></span>,ylabel<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Log likelihood<span class="pl-pds">"</span></span>,label<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>,line<span class="pl-k">=</span>(<span class="pl-c1">0.85</span>,<span class="pl-c1">:darkblue</span>))<span class="pl-k">=</span></pre></div>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="Generating stratigraphic age-depth model...
Burn-in: 1750000 steps
Collecting sieved stationary distribution: 2625000 steps"><pre class="notranslate"><code>Generating stratigraphic age-depth model...
Burn-in: 1750000 steps
Collecting sieved stationary distribution: 2625000 steps
</code></pre></div>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="readme_figures/output_12_4.png"><img src="readme_figures/output_12_4.png" alt="png" style="max-width: 100%;"></a></p>
<h4 dir="auto">
<a id="user-content-plot-results" class="anchor" aria-hidden="true" href="#plot-results"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Plot results</h4>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# Plot results (mean and 95% confidence interval for both model and data)
hdl = plot([mdl.Age_025CI; reverse(mdl.Age_975CI)],[mdl.Height; reverse(mdl.Height)], fill=(minimum(mdl.Height),0.5,:blue), label=&quot;model&quot;)
plot!(hdl, mdl.Age, mdl.Height, linecolor=:blue, label=&quot;&quot;, fg_color_legend=:white)
plot!(hdl, smpl.Age, smpl.Height, xerror=(smpl.Age-smpl.Age_025CI,smpl.Age_975CI-smpl.Age),label=&quot;data&quot;,seriestype=:scatter,color=:black)
plot!(hdl, xlabel=&quot;Age ($AgeUnit)&quot;, ylabel=&quot;Height ($HeightUnit)&quot;)
savefig(hdl,&quot;AgeDepthModel.pdf&quot;);
display(hdl)"><pre><span class="pl-c"><span class="pl-c">#</span> Plot results (mean and 95% confidence interval for both model and data)</span>
hdl <span class="pl-k">=</span> <span class="pl-c1">plot</span>([mdl<span class="pl-k">.</span>Age_025CI; <span class="pl-c1">reverse</span>(mdl<span class="pl-k">.</span>Age_975CI)],[mdl<span class="pl-k">.</span>Height; <span class="pl-c1">reverse</span>(mdl<span class="pl-k">.</span>Height)], fill<span class="pl-k">=</span>(<span class="pl-c1">minimum</span>(mdl<span class="pl-k">.</span>Height),<span class="pl-c1">0.5</span>,<span class="pl-c1">:blue</span>), label<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>model<span class="pl-pds">"</span></span>)
<span class="pl-c1">plot!</span>(hdl, mdl<span class="pl-k">.</span>Age, mdl<span class="pl-k">.</span>Height, linecolor<span class="pl-k">=</span><span class="pl-c1">:blue</span>, label<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>, fg_color_legend<span class="pl-k">=</span><span class="pl-c1">:white</span>)
<span class="pl-c1">plot!</span>(hdl, smpl<span class="pl-k">.</span>Age, smpl<span class="pl-k">.</span>Height, xerror<span class="pl-k">=</span>(smpl<span class="pl-k">.</span>Age<span class="pl-k">-</span>smpl<span class="pl-k">.</span>Age_025CI,smpl<span class="pl-k">.</span>Age_975CI<span class="pl-k">-</span>smpl<span class="pl-k">.</span>Age),label<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>data<span class="pl-pds">"</span></span>,seriestype<span class="pl-k">=</span><span class="pl-c1">:scatter</span>,color<span class="pl-k">=</span><span class="pl-c1">:black</span>)
<span class="pl-c1">plot!</span>(hdl, xlabel<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Age (<span class="pl-v">$AgeUnit</span>)<span class="pl-pds">"</span></span>, ylabel<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Height (<span class="pl-v">$HeightUnit</span>)<span class="pl-pds">"</span></span>)
<span class="pl-c1">savefig</span>(hdl,<span class="pl-s"><span class="pl-pds">"</span>AgeDepthModel.pdf<span class="pl-pds">"</span></span>);
<span class="pl-c1">display</span>(hdl)</pre></div>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="readme_figures/output_14_0.png"><img src="readme_figures/output_14_0.png" alt="png" style="max-width: 100%;"></a></p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# Interpolate results at KTB (height = 0)
height = 0
KTB = linterp1s(mdl.Height,mdl.Age,height)
KTB_min = linterp1s(mdl.Height,mdl.Age_025CI,height)
KTB_max = linterp1s(mdl.Height,mdl.Age_975CI,height)
print(&quot;Interpolated age: $KTB +$(KTB_max-KTB)/-$(KTB-KTB_min) Ma&quot;)

# We can also interpolate the full distribution:
interpolated_distribution = Array{Float64}(undef,size(agedist,2))
for i=1:size(agedist,2)
    interpolated_distribution[i] = linterp1s(mdl.Height,agedist[:,i],height)
end
histogram(interpolated_distribution, xlabel=&quot;Age (Ma)&quot;, ylabel=&quot;N&quot;, label=&quot;&quot;, fill=(0.85,:darkblue), linecolor=:darkblue)"><pre><span class="pl-c"><span class="pl-c">#</span> Interpolate results at KTB (height = 0)</span>
height <span class="pl-k">=</span> <span class="pl-c1">0</span>
KTB <span class="pl-k">=</span> <span class="pl-c1">linterp1s</span>(mdl<span class="pl-k">.</span>Height,mdl<span class="pl-k">.</span>Age,height)
KTB_min <span class="pl-k">=</span> <span class="pl-c1">linterp1s</span>(mdl<span class="pl-k">.</span>Height,mdl<span class="pl-k">.</span>Age_025CI,height)
KTB_max <span class="pl-k">=</span> <span class="pl-c1">linterp1s</span>(mdl<span class="pl-k">.</span>Height,mdl<span class="pl-k">.</span>Age_975CI,height)
<span class="pl-c1">print</span>(<span class="pl-s"><span class="pl-pds">"</span>Interpolated age: <span class="pl-v">$KTB</span> +<span class="pl-v">$(KTB_max<span class="pl-k">-</span>KTB)</span>/-<span class="pl-v">$(KTB<span class="pl-k">-</span>KTB_min)</span> Ma<span class="pl-pds">"</span></span>)

<span class="pl-c"><span class="pl-c">#</span> We can also interpolate the full distribution:</span>
interpolated_distribution <span class="pl-k">=</span> <span class="pl-c1">Array</span><span class="pl-c1">{Float64}</span>(undef,<span class="pl-c1">size</span>(agedist,<span class="pl-c1">2</span>))
<span class="pl-k">for</span> i<span class="pl-k">=</span><span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">size</span>(agedist,<span class="pl-c1">2</span>)
    interpolated_distribution[i] <span class="pl-k">=</span> <span class="pl-c1">linterp1s</span>(mdl<span class="pl-k">.</span>Height,agedist[:,i],height)
<span class="pl-k">end</span>
<span class="pl-c1">histogram</span>(interpolated_distribution, xlabel<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Age (Ma)<span class="pl-pds">"</span></span>, ylabel<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>N<span class="pl-pds">"</span></span>, label<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>, fill<span class="pl-k">=</span>(<span class="pl-c1">0.85</span>,<span class="pl-c1">:darkblue</span>), linecolor<span class="pl-k">=</span><span class="pl-c1">:darkblue</span>)</pre></div>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="readme_figures/output_15_0.png"><img src="readme_figures/output_15_0.png" alt="png" style="max-width: 100%;"></a></p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="Interpolated age: 66.01580546918152 +0.04924877964148777/-0.049571492234548487 Ma"><pre class="notranslate"><code>Interpolated age: 66.01580546918152 +0.04924877964148777/-0.049571492234548487 Ma
</code></pre></div>
<p dir="auto">There are other things we can plot as well, such as deposition rate:</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# Set bin width and spacing
binwidth = 0.01 # Myr
binoverlap = 10
ages = collect(minimum(mdl.Age):binwidth/binoverlap:maximum(mdl.Age))
bincenters = ages[1+Int(binoverlap/2):end-Int(binoverlap/2)]
spacing = binoverlap

# Calculate rates for the stratigraphy of each markov chain step
dhdt_dist = Array{Float64}(undef, length(ages)-binoverlap, config.nsteps)
@time for i=1:config.nsteps
    heights = linterp1(reverse(agedist[:,i]), reverse(mdl.Height), ages)
    dhdt_dist[:,i] = abs.(heights[1:end-spacing] - heights[spacing+1:end]) ./ binwidth
end

# Find mean and 1-sigma (68%) CI
dhdt = nanmean(dhdt_dist,dim=2)
dhdt_50p = nanmedian(dhdt_dist,dim=2)
dhdt_16p = nanpctile(dhdt_dist,15.865,dim=2) # Minus 1-sigma (15.865th percentile)
dhdt_84p = nanpctile(dhdt_dist,84.135,dim=2) # Plus 1-sigma (84.135th percentile)
# Other confidence intervals (10:10:50)
dhdt_20p = nanpctile(dhdt_dist,20,dim=2)
dhdt_80p = nanpctile(dhdt_dist,80,dim=2)
dhdt_25p = nanpctile(dhdt_dist,25,dim=2)
dhdt_75p = nanpctile(dhdt_dist,75,dim=2)
dhdt_30p = nanpctile(dhdt_dist,30,dim=2)
dhdt_70p = nanpctile(dhdt_dist,70,dim=2)
dhdt_35p = nanpctile(dhdt_dist,35,dim=2)
dhdt_65p = nanpctile(dhdt_dist,65,dim=2)
dhdt_40p = nanpctile(dhdt_dist,40,dim=2)
dhdt_60p = nanpctile(dhdt_dist,60,dim=2)
dhdt_45p = nanpctile(dhdt_dist,45,dim=2)
dhdt_55p = nanpctile(dhdt_dist,55,dim=2)

# Plot results
hdl = plot(bincenters,dhdt, label=&quot;Mean&quot;, color=:black, linewidth=2)
plot!(hdl,[bincenters; reverse(bincenters)],[dhdt_16p; reverse(dhdt_84p)], fill=(minimum(mdl.Height),0.2,:darkblue), linealpha=0, label=&quot;68% CI&quot;)
plot!(hdl,[bincenters; reverse(bincenters)],[dhdt_20p; reverse(dhdt_80p)], fill=(minimum(mdl.Height),0.2,:darkblue), linealpha=0, label=&quot;&quot;)
plot!(hdl,[bincenters; reverse(bincenters)],[dhdt_25p; reverse(dhdt_75p)], fill=(minimum(mdl.Height),0.2,:darkblue), linealpha=0, label=&quot;&quot;)
plot!(hdl,[bincenters; reverse(bincenters)],[dhdt_30p; reverse(dhdt_70p)], fill=(minimum(mdl.Height),0.2,:darkblue), linealpha=0, label=&quot;&quot;)
plot!(hdl,[bincenters; reverse(bincenters)],[dhdt_35p; reverse(dhdt_65p)], fill=(minimum(mdl.Height),0.2,:darkblue), linealpha=0, label=&quot;&quot;)
plot!(hdl,[bincenters; reverse(bincenters)],[dhdt_40p; reverse(dhdt_60p)], fill=(minimum(mdl.Height),0.2,:darkblue), linealpha=0, label=&quot;&quot;)
plot!(hdl,[bincenters; reverse(bincenters)],[dhdt_45p; reverse(dhdt_55p)], fill=(minimum(mdl.Height),0.2,:darkblue), linealpha=0, label=&quot;&quot;)
plot!(hdl,bincenters,dhdt_50p, label=&quot;Median&quot;, color=:grey, linewidth=1)
plot!(hdl, xlabel=&quot;Age ($AgeUnit)&quot;, ylabel=&quot;Depositional Rate ($HeightUnit / $AgeUnit over $binwidth $AgeUnit)&quot;, fg_color_legend=:white)
# savefig(hdl,&quot;DepositionRateModelCI.pdf&quot;)
display(hdl)"><pre><span class="pl-c"><span class="pl-c">#</span> Set bin width and spacing</span>
binwidth <span class="pl-k">=</span> <span class="pl-c1">0.01</span> <span class="pl-c"><span class="pl-c">#</span> Myr</span>
binoverlap <span class="pl-k">=</span> <span class="pl-c1">10</span>
ages <span class="pl-k">=</span> <span class="pl-c1">collect</span>(<span class="pl-c1">minimum</span>(mdl<span class="pl-k">.</span>Age)<span class="pl-k">:</span>binwidth<span class="pl-k">/</span>binoverlap<span class="pl-k">:</span><span class="pl-c1">maximum</span>(mdl<span class="pl-k">.</span>Age))
bincenters <span class="pl-k">=</span> ages[<span class="pl-c1">1</span><span class="pl-k">+</span><span class="pl-c1">Int</span>(binoverlap<span class="pl-k">/</span><span class="pl-c1">2</span>)<span class="pl-k">:</span><span class="pl-c1">end</span><span class="pl-k">-</span><span class="pl-c1">Int</span>(binoverlap<span class="pl-k">/</span><span class="pl-c1">2</span>)]
spacing <span class="pl-k">=</span> binoverlap

<span class="pl-c"><span class="pl-c">#</span> Calculate rates for the stratigraphy of each markov chain step</span>
dhdt_dist <span class="pl-k">=</span> <span class="pl-c1">Array</span><span class="pl-c1">{Float64}</span>(undef, <span class="pl-c1">length</span>(ages)<span class="pl-k">-</span>binoverlap, config<span class="pl-k">.</span>nsteps)
<span class="pl-c1">@time</span> <span class="pl-k">for</span> i<span class="pl-k">=</span><span class="pl-c1">1</span><span class="pl-k">:</span>config<span class="pl-k">.</span>nsteps
    heights <span class="pl-k">=</span> <span class="pl-c1">linterp1</span>(<span class="pl-c1">reverse</span>(agedist[:,i]), <span class="pl-c1">reverse</span>(mdl<span class="pl-k">.</span>Height), ages)
    dhdt_dist[:,i] <span class="pl-k">=</span> <span class="pl-c1">abs</span>.(heights[<span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">end</span><span class="pl-k">-</span>spacing] <span class="pl-k">-</span> heights[spacing<span class="pl-k">+</span><span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">end</span>]) <span class="pl-k">./</span> binwidth
<span class="pl-k">end</span>

<span class="pl-c"><span class="pl-c">#</span> Find mean and 1-sigma (68%) CI</span>
dhdt <span class="pl-k">=</span> <span class="pl-c1">nanmean</span>(dhdt_dist,dim<span class="pl-k">=</span><span class="pl-c1">2</span>)
dhdt_50p <span class="pl-k">=</span> <span class="pl-c1">nanmedian</span>(dhdt_dist,dim<span class="pl-k">=</span><span class="pl-c1">2</span>)
dhdt_16p <span class="pl-k">=</span> <span class="pl-c1">nanpctile</span>(dhdt_dist,<span class="pl-c1">15.865</span>,dim<span class="pl-k">=</span><span class="pl-c1">2</span>) <span class="pl-c"><span class="pl-c">#</span> Minus 1-sigma (15.865th percentile)</span>
dhdt_84p <span class="pl-k">=</span> <span class="pl-c1">nanpctile</span>(dhdt_dist,<span class="pl-c1">84.135</span>,dim<span class="pl-k">=</span><span class="pl-c1">2</span>) <span class="pl-c"><span class="pl-c">#</span> Plus 1-sigma (84.135th percentile)</span>
<span class="pl-c"><span class="pl-c">#</span> Other confidence intervals (10:10:50)</span>
dhdt_20p <span class="pl-k">=</span> <span class="pl-c1">nanpctile</span>(dhdt_dist,<span class="pl-c1">20</span>,dim<span class="pl-k">=</span><span class="pl-c1">2</span>)
dhdt_80p <span class="pl-k">=</span> <span class="pl-c1">nanpctile</span>(dhdt_dist,<span class="pl-c1">80</span>,dim<span class="pl-k">=</span><span class="pl-c1">2</span>)
dhdt_25p <span class="pl-k">=</span> <span class="pl-c1">nanpctile</span>(dhdt_dist,<span class="pl-c1">25</span>,dim<span class="pl-k">=</span><span class="pl-c1">2</span>)
dhdt_75p <span class="pl-k">=</span> <span class="pl-c1">nanpctile</span>(dhdt_dist,<span class="pl-c1">75</span>,dim<span class="pl-k">=</span><span class="pl-c1">2</span>)
dhdt_30p <span class="pl-k">=</span> <span class="pl-c1">nanpctile</span>(dhdt_dist,<span class="pl-c1">30</span>,dim<span class="pl-k">=</span><span class="pl-c1">2</span>)
dhdt_70p <span class="pl-k">=</span> <span class="pl-c1">nanpctile</span>(dhdt_dist,<span class="pl-c1">70</span>,dim<span class="pl-k">=</span><span class="pl-c1">2</span>)
dhdt_35p <span class="pl-k">=</span> <span class="pl-c1">nanpctile</span>(dhdt_dist,<span class="pl-c1">35</span>,dim<span class="pl-k">=</span><span class="pl-c1">2</span>)
dhdt_65p <span class="pl-k">=</span> <span class="pl-c1">nanpctile</span>(dhdt_dist,<span class="pl-c1">65</span>,dim<span class="pl-k">=</span><span class="pl-c1">2</span>)
dhdt_40p <span class="pl-k">=</span> <span class="pl-c1">nanpctile</span>(dhdt_dist,<span class="pl-c1">40</span>,dim<span class="pl-k">=</span><span class="pl-c1">2</span>)
dhdt_60p <span class="pl-k">=</span> <span class="pl-c1">nanpctile</span>(dhdt_dist,<span class="pl-c1">60</span>,dim<span class="pl-k">=</span><span class="pl-c1">2</span>)
dhdt_45p <span class="pl-k">=</span> <span class="pl-c1">nanpctile</span>(dhdt_dist,<span class="pl-c1">45</span>,dim<span class="pl-k">=</span><span class="pl-c1">2</span>)
dhdt_55p <span class="pl-k">=</span> <span class="pl-c1">nanpctile</span>(dhdt_dist,<span class="pl-c1">55</span>,dim<span class="pl-k">=</span><span class="pl-c1">2</span>)

<span class="pl-c"><span class="pl-c">#</span> Plot results</span>
hdl <span class="pl-k">=</span> <span class="pl-c1">plot</span>(bincenters,dhdt, label<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Mean<span class="pl-pds">"</span></span>, color<span class="pl-k">=</span><span class="pl-c1">:black</span>, linewidth<span class="pl-k">=</span><span class="pl-c1">2</span>)
<span class="pl-c1">plot!</span>(hdl,[bincenters; <span class="pl-c1">reverse</span>(bincenters)],[dhdt_16p; <span class="pl-c1">reverse</span>(dhdt_84p)], fill<span class="pl-k">=</span>(<span class="pl-c1">minimum</span>(mdl<span class="pl-k">.</span>Height),<span class="pl-c1">0.2</span>,<span class="pl-c1">:darkblue</span>), linealpha<span class="pl-k">=</span><span class="pl-c1">0</span>, label<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>68% CI<span class="pl-pds">"</span></span>)
<span class="pl-c1">plot!</span>(hdl,[bincenters; <span class="pl-c1">reverse</span>(bincenters)],[dhdt_20p; <span class="pl-c1">reverse</span>(dhdt_80p)], fill<span class="pl-k">=</span>(<span class="pl-c1">minimum</span>(mdl<span class="pl-k">.</span>Height),<span class="pl-c1">0.2</span>,<span class="pl-c1">:darkblue</span>), linealpha<span class="pl-k">=</span><span class="pl-c1">0</span>, label<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>)
<span class="pl-c1">plot!</span>(hdl,[bincenters; <span class="pl-c1">reverse</span>(bincenters)],[dhdt_25p; <span class="pl-c1">reverse</span>(dhdt_75p)], fill<span class="pl-k">=</span>(<span class="pl-c1">minimum</span>(mdl<span class="pl-k">.</span>Height),<span class="pl-c1">0.2</span>,<span class="pl-c1">:darkblue</span>), linealpha<span class="pl-k">=</span><span class="pl-c1">0</span>, label<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>)
<span class="pl-c1">plot!</span>(hdl,[bincenters; <span class="pl-c1">reverse</span>(bincenters)],[dhdt_30p; <span class="pl-c1">reverse</span>(dhdt_70p)], fill<span class="pl-k">=</span>(<span class="pl-c1">minimum</span>(mdl<span class="pl-k">.</span>Height),<span class="pl-c1">0.2</span>,<span class="pl-c1">:darkblue</span>), linealpha<span class="pl-k">=</span><span class="pl-c1">0</span>, label<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>)
<span class="pl-c1">plot!</span>(hdl,[bincenters; <span class="pl-c1">reverse</span>(bincenters)],[dhdt_35p; <span class="pl-c1">reverse</span>(dhdt_65p)], fill<span class="pl-k">=</span>(<span class="pl-c1">minimum</span>(mdl<span class="pl-k">.</span>Height),<span class="pl-c1">0.2</span>,<span class="pl-c1">:darkblue</span>), linealpha<span class="pl-k">=</span><span class="pl-c1">0</span>, label<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>)
<span class="pl-c1">plot!</span>(hdl,[bincenters; <span class="pl-c1">reverse</span>(bincenters)],[dhdt_40p; <span class="pl-c1">reverse</span>(dhdt_60p)], fill<span class="pl-k">=</span>(<span class="pl-c1">minimum</span>(mdl<span class="pl-k">.</span>Height),<span class="pl-c1">0.2</span>,<span class="pl-c1">:darkblue</span>), linealpha<span class="pl-k">=</span><span class="pl-c1">0</span>, label<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>)
<span class="pl-c1">plot!</span>(hdl,[bincenters; <span class="pl-c1">reverse</span>(bincenters)],[dhdt_45p; <span class="pl-c1">reverse</span>(dhdt_55p)], fill<span class="pl-k">=</span>(<span class="pl-c1">minimum</span>(mdl<span class="pl-k">.</span>Height),<span class="pl-c1">0.2</span>,<span class="pl-c1">:darkblue</span>), linealpha<span class="pl-k">=</span><span class="pl-c1">0</span>, label<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>)
<span class="pl-c1">plot!</span>(hdl,bincenters,dhdt_50p, label<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Median<span class="pl-pds">"</span></span>, color<span class="pl-k">=</span><span class="pl-c1">:grey</span>, linewidth<span class="pl-k">=</span><span class="pl-c1">1</span>)
<span class="pl-c1">plot!</span>(hdl, xlabel<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Age (<span class="pl-v">$AgeUnit</span>)<span class="pl-pds">"</span></span>, ylabel<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Depositional Rate (<span class="pl-v">$HeightUnit</span> / <span class="pl-v">$AgeUnit</span> over <span class="pl-v">$binwidth</span> <span class="pl-v">$AgeUnit</span>)<span class="pl-pds">"</span></span>, fg_color_legend<span class="pl-k">=</span><span class="pl-c1">:white</span>)
<span class="pl-c"><span class="pl-c">#</span> savefig(hdl,"DepositionRateModelCI.pdf")</span>
<span class="pl-c1">display</span>(hdl)</pre></div>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="readme_figures/output_17_0.png"><img src="readme_figures/output_17_0.png" alt="png" style="max-width: 100%;"></a></p>
<h3 dir="auto">
<a id="user-content-stratigraphic-model-including-hiatuses" class="anchor" aria-hidden="true" href="#stratigraphic-model-including-hiatuses"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Stratigraphic model including hiatuses</h3>
<p dir="auto">We can also deal with discrete hiatuses in the stratigraphic section if we know where they are and about how long they lasted. We need some different models and methods though. In particular, in addition to the <code>StratAgeData</code> struct, we also need a <code>HiatusData</code> struct now, and we're going to want to pass these to <code>StratMetropolisDistHiatus</code> instead of <code>StratMetropolisDist</code> like before.</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# Data about hiatuses
nHiatuses = 2 # The number of hiatuses you have data for
hiatus = HiatusData(nHiatuses) # Struct to hold data
hiatus.Height         = [20.0, 35.0 ]
hiatus.Height_sigma   = [ 0.0,  0.0 ]
hiatus.Duration       = [ 0.2,  0.43]
hiatus.Duration_sigma = [ 0.05, 0.07]

# Run the model. Note: we're using `StratMetropolisDistHiatus` now, instead of just `StratMetropolisDistHiatus`
(mdl, agedist, hiatusdist, lldist) = StratMetropolisDistHiatus(smpl, hiatus, config); sleep(0.5)

# Plot results (mean and 95% confidence interval for both model and data)
hdl = plot([mdl.Age_025CI; reverse(mdl.Age_975CI)],[mdl.Height; reverse(mdl.Height)], fill=(minimum(mdl.Height),0.5,:blue), label=&quot;model&quot;)
plot!(hdl, mdl.Age, mdl.Height, linecolor=:blue, label=&quot;&quot;, fg_color_legend=:white)
plot!(hdl, smpl.Age, smpl.Height, xerror=(smpl.Age-smpl.Age_025CI,smpl.Age_975CI-smpl.Age),label=&quot;data&quot;,seriestype=:scatter,color=:black)
plot!(hdl, xlabel=&quot;Age (Ma)&quot;, ylabel=&quot;Height (cm)&quot;)"><pre><span class="pl-c"><span class="pl-c">#</span> Data about hiatuses</span>
nHiatuses <span class="pl-k">=</span> <span class="pl-c1">2</span> <span class="pl-c"><span class="pl-c">#</span> The number of hiatuses you have data for</span>
hiatus <span class="pl-k">=</span> <span class="pl-c1">HiatusData</span>(nHiatuses) <span class="pl-c"><span class="pl-c">#</span> Struct to hold data</span>
hiatus<span class="pl-k">.</span>Height         <span class="pl-k">=</span> [<span class="pl-c1">20.0</span>, <span class="pl-c1">35.0</span> ]
hiatus<span class="pl-k">.</span>Height_sigma   <span class="pl-k">=</span> [ <span class="pl-c1">0.0</span>,  <span class="pl-c1">0.0</span> ]
hiatus<span class="pl-k">.</span>Duration       <span class="pl-k">=</span> [ <span class="pl-c1">0.2</span>,  <span class="pl-c1">0.43</span>]
hiatus<span class="pl-k">.</span>Duration_sigma <span class="pl-k">=</span> [ <span class="pl-c1">0.05</span>, <span class="pl-c1">0.07</span>]

<span class="pl-c"><span class="pl-c">#</span> Run the model. Note: we're using `StratMetropolisDistHiatus` now, instead of just `StratMetropolisDistHiatus`</span>
(mdl, agedist, hiatusdist, lldist) <span class="pl-k">=</span> <span class="pl-c1">StratMetropolisDistHiatus</span>(smpl, hiatus, config); <span class="pl-c1">sleep</span>(<span class="pl-c1">0.5</span>)

<span class="pl-c"><span class="pl-c">#</span> Plot results (mean and 95% confidence interval for both model and data)</span>
hdl <span class="pl-k">=</span> <span class="pl-c1">plot</span>([mdl<span class="pl-k">.</span>Age_025CI; <span class="pl-c1">reverse</span>(mdl<span class="pl-k">.</span>Age_975CI)],[mdl<span class="pl-k">.</span>Height; <span class="pl-c1">reverse</span>(mdl<span class="pl-k">.</span>Height)], fill<span class="pl-k">=</span>(<span class="pl-c1">minimum</span>(mdl<span class="pl-k">.</span>Height),<span class="pl-c1">0.5</span>,<span class="pl-c1">:blue</span>), label<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>model<span class="pl-pds">"</span></span>)
<span class="pl-c1">plot!</span>(hdl, mdl<span class="pl-k">.</span>Age, mdl<span class="pl-k">.</span>Height, linecolor<span class="pl-k">=</span><span class="pl-c1">:blue</span>, label<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>, fg_color_legend<span class="pl-k">=</span><span class="pl-c1">:white</span>)
<span class="pl-c1">plot!</span>(hdl, smpl<span class="pl-k">.</span>Age, smpl<span class="pl-k">.</span>Height, xerror<span class="pl-k">=</span>(smpl<span class="pl-k">.</span>Age<span class="pl-k">-</span>smpl<span class="pl-k">.</span>Age_025CI,smpl<span class="pl-k">.</span>Age_975CI<span class="pl-k">-</span>smpl<span class="pl-k">.</span>Age),label<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>data<span class="pl-pds">"</span></span>,seriestype<span class="pl-k">=</span><span class="pl-c1">:scatter</span>,color<span class="pl-k">=</span><span class="pl-c1">:black</span>)
<span class="pl-c1">plot!</span>(hdl, xlabel<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Age (Ma)<span class="pl-pds">"</span></span>, ylabel<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Height (cm)<span class="pl-pds">"</span></span>)</pre></div>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="Generating stratigraphic age-depth model...
Burn-in: 1750000 steps
Collecting sieved stationary distribution: 2625000 steps"><pre class="notranslate"><code>Generating stratigraphic age-depth model...
Burn-in: 1750000 steps
Collecting sieved stationary distribution: 2625000 steps
</code></pre></div>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="readme_figures/output_19_4.png"><img src="readme_figures/output_19_4.png" alt="png" style="max-width: 100%;"></a></p>
</article></div>