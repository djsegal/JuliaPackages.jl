<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><h1><a id="user-content-whippet" class="anchor" aria-hidden="true" href="#whippet"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Whippet</h1>
<p><a href="https://github.com/timbitz/Whippet.jl/releases/latest"><img src="https://camo.githubusercontent.com/44b35b7c03eafd451462bcfe2894237118e1e4e2/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f72656c656173652f74696d6269747a2f576869707065742e6a6c2e737667" alt="Latest Release" data-canonical-src="https://img.shields.io/github/release/timbitz/Whippet.jl.svg" style="max-width:100%;"></a>
<a href="https://travis-ci.com/timbitz/Whippet.jl" rel="nofollow"><img src="https://camo.githubusercontent.com/70ab758c8db67389dc4d73f59d450a6bcdf0577d/68747470733a2f2f696d672e736869656c64732e696f2f7472617669732f74696d6269747a2f576869707065742e6a6c2f6d61737465722e7376673f6c6162656c3d4c696e75782b2f2b6d61634f53" alt="Build Status" data-canonical-src="https://img.shields.io/travis/timbitz/Whippet.jl/master.svg?label=Linux+/+macOS" style="max-width:100%;"></a>
<a href="https://codecov.io/gh/timbitz/Whippet.jl" rel="nofollow"><img src="https://camo.githubusercontent.com/153a917c2f67ab237391fd9b92dfad0830f50a17/68747470733a2f2f636f6465636f762e696f2f67682f74696d6269747a2f576869707065742e6a6c2f6272616e63682f6d61737465722f67726170682f62616467652e7376673f746f6b656e3d524b4537425372343776" alt="codecov" data-canonical-src="https://codecov.io/gh/timbitz/Whippet.jl/branch/master/graph/badge.svg?token=RKE7BSr47v" style="max-width:100%;"></a>
<a href="https://opensource.org/licenses/MIT" rel="nofollow"><img src="https://camo.githubusercontent.com/76f0e887c183ccc31c1cb63c33d2dbf48cb2df51/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4c6963656e73652d4d49542d677265656e2e737667" alt="License: MIT" data-canonical-src="https://img.shields.io/badge/License-MIT-green.svg" style="max-width:100%;"></a>
<a href="https://gitter.im/Whippet-jl/Lobby" rel="nofollow"><img src="https://camo.githubusercontent.com/fed5b5512498193ce4bba599fd94cd12b9f56491/68747470733a2f2f696d672e736869656c64732e696f2f6769747465722f726f6f6d2f6e776a732f6e772e6a732e737667" alt="Gitter Chat" data-canonical-src="https://img.shields.io/gitter/room/nwjs/nw.js.svg" style="max-width:100%;"></a></p>
<h2><a id="user-content-graphical-overview" class="anchor" aria-hidden="true" href="#graphical-overview"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Graphical Overview</h2>
<p><a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/a5c2def3e052ab5b5fcdebe643c76f80a2a41ade/68747470733a2f2f74696d6269747a2e6769746875622e696f2f696d616765732f576869707065742d466967312e676966"><img src="https://camo.githubusercontent.com/a5c2def3e052ab5b5fcdebe643c76f80a2a41ade/68747470733a2f2f74696d6269747a2e6769746875622e696f2f696d616765732f576869707065742d466967312e676966" alt="Whippet Schematic" data-canonical-src="https://timbitz.github.io/images/Whippet-Fig1.gif" style="max-width:100%;"></a></p>
<h2><a id="user-content-features" class="anchor" aria-hidden="true" href="#features"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Features</h2>
<ul>
<li>Splice graph representations of transcriptome structure
<ul>
<li>Build an index for any species with a genome and annotation file</li>
<li>Supplement the index with splice-sites/exons from independently aligned RNA-seq (BAM file).</li>
<li><em>de novo</em> AS event discovery (between indexed donor/acceptor splice sites)</li>
</ul>
</li>
<li>High speed PolyA+ Spliced Read Alignment (Read lengths &lt;= 255)
<ul>
<li>Repetitive read assignment for gene families</li>
<li>Bias correction methods for 5' sequence and GC-content</li>
<li>On-the-fly alignment/re-analysis of SRR accession ids using ebi.ac.uk</li>
</ul>
</li>
<li>Fast and robust quantification of transcriptome structure and expression using EM
<ul>
<li>Dynamic building and entropic measurements of splicing events of any complexity</li>
<li>Percent-spliced-in (PSI) from event-level EM</li>
<li>Gene expression (TPM) from transcript-level EM</li>
</ul>
</li>
<li>Differential splicing comparisons
<ul>
<li>Probabilistic calculations of delta PSI leveraging multi-sample biological replicates</li>
</ul>
</li>
</ul>
<p>Paper: <a href="https://doi.org/10.1016/j.molcel.2018.08.018" rel="nofollow">https://doi.org/10.1016/j.molcel.2018.08.018</a></p>
<h2><a id="user-content-get-started" class="anchor" aria-hidden="true" href="#get-started"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Get started</h2>
<h3><a id="user-content-1-install" class="anchor" aria-hidden="true" href="#1-install"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>1) Install</h3>
<p>Whippet v0.11 works on the <strong>v0.6.4</strong> version of Julia which is still available here (<a href="https://julialang.org/downloads/oldreleases.html" rel="nofollow">https://julialang.org/downloads/oldreleases.html</a>).  If you are new to julia, there is a <a href="https://en.wikibooks.org/wiki/Introducing_Julia/Getting_started" rel="nofollow">helpful guide on how to get it up and running here</a></p>
<p><strong>Note: Julia v1.0 is now released, but it has breaking changes that are not yet supported (in progress).</strong></p>
<p>Open the Julia <strong>v0.6.4</strong> REPL and install the Whippet package (to update the packages list try <code>Pkg.update()</code> first):</p>
<div class="highlight highlight-source-julia"><pre>julia<span class="pl-k">&gt;</span> Pkg<span class="pl-k">.</span><span class="pl-c1">add</span>(<span class="pl-s"><span class="pl-pds">"</span>Whippet<span class="pl-pds">"</span></span>)
julia<span class="pl-k">&gt;</span> <span class="pl-k">using</span> Whippet</pre></div>
<p>The Whippet package directory can now be found in the default location:</p>
<div class="highlight highlight-source-shell"><pre>$ <span class="pl-c1">cd</span> <span class="pl-k">~</span>/.julia/v0.6/Whippet</pre></div>
<p><em>Notes</em>:</p>
<ul>
<li><strong>Update to the most recent version</strong> of Whippet at any time in the Julia REPL: <code>julia&gt; Pkg.update()</code></li>
<li>If you are having trouble finding the Whippet directory, you can ask the Julia REPL: <code>julia&gt; Pkg.dir("Whippet")</code></li>
<li>For all executables in <code>Whippet/bin</code>, you can use the <code>-h</code> flag to get a list of the available command line options, their usage and defaults.</li>
<li>You should install Julia and its packages locally, if you absolutely have to install system-wide, there is some help <a href="https://groups.google.com/forum/#!topic/julia-users/9lQZJlLs99M" rel="nofollow">here</a></li>
<li>It might be convenient to add a link (<code>ln -s ~/.julia/v0.6/Whippet</code>) to this directory for easy access, or export <code>Whippet/bin</code> to your path.</li>
</ul>
<h3><a id="user-content-2-build-an-index" class="anchor" aria-hidden="true" href="#2-build-an-index"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>2) Build an index.</h3>
<h4><a id="user-content-a-annotation-gtf-only-index" class="anchor" aria-hidden="true" href="#a-annotation-gtf-only-index"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>a) Annotation (GTF) only index.</h4>
<p>You need your genome sequence in fasta, and a gene annotation file in Ensembl-style GTF format. Default GENCODE annotation supplied for hg19 and mm10 in <code>Whippet/anno</code>. You can also obtain Ensembl GTF files from these direct links for Human: <a href="http://ftp.ensembl.org/pub/release-92/gtf/homo_sapiens/Homo_sapiens.GRCh38.92.gtf.gz" rel="nofollow">Ensembl_hg38_release_92</a> and Mouse: <a href="http://ftp.ensembl.org/pub/release-92/gtf/mus_musculus/Mus_musculus.GRCm38.92.gtf.gz" rel="nofollow">Ensembl_mm10_release_92</a>. Other Ensembl GTF files can be downloaded <a href="https://uswest.ensembl.org/info/data/ftp/index.html" rel="nofollow">here</a>,</p>
<div class="highlight highlight-source-shell"><pre>$ julia bin/whippet-index.jl --fasta hg19.fa.gz --gtf anno/gencode_hg19.v25.tsl1.gtf.gz</pre></div>
<p><em>Notes</em>:</p>
<ul>
<li>Whippet only uses GTF <code>exon</code> lines (others are ignored). These must contain both <code>gene_id</code> and <code>transcript_id</code> attributes (which should not be the same as one another!).  This GTF file should be consistent with the <a href="http://mblab.wustl.edu/GTF22.html" rel="nofollow">GTF2.2</a> specification, and should have all entries for a transcript in a continuous block. Warning: The UCSC table browser will not produce valid GTF2.2 files. Similarly, GTF files obtained from iGenomes or the Refseq websites do not satisfy these specifications.</li>
<li>You can specify the output name and location of the index to build using the <code>-x / --index</code> parameter. The default (for both whippet-index.jl and whippet-quant.jl) is a generic index named <code>graph</code> located at <code>~/.julia/v0.6/Whippet/index/graph.jls</code>, so you must have write-access to this location to use the default.</li>
</ul>
<h4><a id="user-content-b-annotation-gtf--alignment-bam-supplemented-index" class="anchor" aria-hidden="true" href="#b-annotation-gtf--alignment-bam-supplemented-index"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>b) Annotation (GTF) + Alignment (BAM) supplemented index.</h4>
<p>Whippet v0.11+ allows you to build an index that includes unannotated splice-sites and exons found in a spliced RNA-seq alignment file.  In order to build a BAM supplemented index, you need your BAM file sorted and indexed (using samtools):</p>
<div class="highlight highlight-source-shell"><pre><span class="pl-c"><span class="pl-c">#</span> If using multiple BAM files (tissue1, ..., tissue3 etc), merge them first:</span>
$ samtools merge filename.bam tissue1.bam tissue2.bam tissue3.bam
<span class="pl-c"><span class="pl-c">#</span> If using a single BAM file start here:</span>
$ samtools sort filename.bam filename.sort
$ samtools rmdup -S filename.sort.bam filename.sort.rmdup.bam
$ samtools index filename.sort.rmdup.bam
$ ls filename.sort.rmdup.bam<span class="pl-k">*</span>
filename.sort.rmdup.bam        filename.sort.rmdup.bam.bai</pre></div>
<p>Then build an index but with the additional <code>--bam</code> parameter:</p>
<div class="highlight highlight-source-shell"><pre>$ julia bin/whippet-index.jl --fasta hg19.fa.gz --bam filename.sort.rmdup.bam --gtf anno/gencode_hg19.v25.tsl1.gtf.gz</pre></div>
<p><em>Notes</em>:</p>
<ul>
<li>The <code>--bam</code> option is sensitive to alignment strand, therefore using strand-specific alignments is recommended.</li>
<li>By default only spliced alignments where <em>one</em> of the splice-sites match a known splice-site in the annotation are used, to reduce false positives due to overlapping gene regions (i.e. falsely adding splice sites that belong to a different, but overlapping gene, which is common in many species).  Use the <code>--bam-both-novel</code> flag to override this requirement for greater Recall of unannotated splice-sites.</li>
<li>Control the minimum number of reads required to consider a novel splice site from BAM using the <code>--bam-min-reads</code> parameter (default is 1).  Increase this parameter with large bam files to reduce artifacts and one-off cryptic splice junctions.</li>
</ul>
<h3><a id="user-content-3-quantify-fastq-files" class="anchor" aria-hidden="true" href="#3-quantify-fastq-files"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>3) Quantify FASTQ files.</h3>
<h4><a id="user-content-a-single-end-reads" class="anchor" aria-hidden="true" href="#a-single-end-reads"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>a) Single-end reads</h4>
<div class="highlight highlight-source-shell"><pre>$ julia bin/whippet-quant.jl file.fastq.gz</pre></div>
<p>Or you can provide a link/s to the fastq file/s on the web using <code>--url</code>, or just the experiment accession id (SRR id) using <code>--ebi</code>!  These will align on the fly as the reads are downloaded from the web directly into alignment. For example:</p>
<div class="highlight highlight-source-shell"><pre>$ julia bin/whippet-quant.jl --ebi SRR1199010</pre></div>
<p>is equivalent to</p>
<div class="highlight highlight-source-shell"><pre>$ julia bin/whippet-quant.jl --url http://ftp.sra.ebi.ac.uk/vol1/fastq/SRR119/000/SRR1199010/SRR1199010.fastq.gz</pre></div>
<h4><a id="user-content-b-paired-end-reads" class="anchor" aria-hidden="true" href="#b-paired-end-reads"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>b) Paired-end reads</h4>
<div class="highlight highlight-source-shell"><pre>$ julia bin/whippet-quant.jl fwd_file.fastq.gz rev_file.fastq.gz</pre></div>
<p>To stream reads from ebi.ac.uk, just provide a paired-end SRR id to to the <code>--ebi</code> flag:</p>
<div class="highlight highlight-source-shell"><pre>$ julia bin/whippet-quant.jl --ebi ERR1994736</pre></div>
<p>is equivalent to</p>
<div class="highlight highlight-source-shell"><pre>$ julia bin/whippet-quant.jl --url http://ftp.sra.ebi.ac.uk/vol1/fastq/ERR199/006/ERR1994736/ERR1994736_1.fastq.gz http://ftp.sra.ebi.ac.uk/vol1/fastq/ERR199/006/ERR1994736/ERR1994736_2.fastq.gz</pre></div>
<h4><a id="user-content-c-non-default-inputoutput" class="anchor" aria-hidden="true" href="#c-non-default-inputoutput"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>c) Non-default input/output</h4>
<p>To specify output location or a specific index:</p>
<div class="highlight highlight-source-shell"><pre>$ julia bin/whippet-quant.jl fwd_file.fastq.gz -o outputname -x customindex.jls</pre></div>
<p>You can also output the alignments in SAM format with the <code>--sam</code> flag and convert to bam with samtools:</p>
<div class="highlight highlight-source-shell"><pre>$ julia bin/whippet-quant.jl fwd_file.fastq.gz --sam <span class="pl-k">&gt;</span> fwd_file.sam
$ samtools view -bS fwd_file.sam <span class="pl-k">&gt;</span> fwd_file.bam</pre></div>
<p>For greater stability of quantifications across multiple RNA-seq protocols, try the <code>--biascorrect</code> flag, which will apply GC-content and 5' sequence bias correction methods:</p>
<div class="highlight highlight-source-shell"><pre>$ julia bin/whippet-quant.jl fwd_file.fastq.gz --biascorrect</pre></div>
<p>It is also possible to pool fastq files at runtime using shell commands, and the optional (<code>--force-gz</code>) for pooled gz files (files without .gz suffix)</p>
<div class="highlight highlight-source-shell"><pre>$ julia bin/whippet-quant.jl <span class="pl-s"><span class="pl-pds">&lt;(</span> cat time-series_{1,2,3,4,5}.fastq.gz <span class="pl-pds">)</span></span> --force-gz -o interval_1-5</pre></div>
<h3><a id="user-content-4-compare-multiple-psi-files" class="anchor" aria-hidden="true" href="#4-compare-multiple-psi-files"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>4) Compare multiple psi files</h3>
<p>Compare <code>.psi.gz</code> files from from two samples <code>-a</code> and <code>-b</code> with any number of replicates (comma delimited list of files or common pattern matching) per sample.</p>
<div class="highlight highlight-source-shell"><pre>$ ls <span class="pl-k">*</span>.psi.gz
sample1-r1.psi.gz sample1-r2.psi.gz sample2-r1.psi.gz sample2-r2.psi.gz
$ julia bin/whippet-delta.jl -a sample1 -b sample2
OR
$ julia bin/whippet-delta.jl -a sample1-r1.psi.gz,sample1-r2.psi.gz -b sample2-r1.psi.gz,sample2-r2.psi.gz</pre></div>
<p>Note: comparisons of single files still need a comma: <code>-a singlefile_a.psi.gz, -b singlefile_b.psi.gz,</code></p>
<hr>
<h2><a id="user-content-output-formats" class="anchor" aria-hidden="true" href="#output-formats"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Output Formats</h2>
<p>The output format for <code>whippet-quant.jl</code> is saved into two core quant filetypes, <code>.psi.gz</code> and <code>.tpm.gz</code> files.</p>
<p>Each <code>.tpm.gz</code> file contains a simple format compatible with many downstream tools (one for the TPM of each annotated transcript, and another at the gene-level):</p>
<table>
<thead>
<tr>
<th>Gene/Isoform</th>
<th>TpM</th>
<th>Read Counts</th>
</tr>
</thead>
<tbody>
<tr>
<td>NFIA</td>
<td>2897.11</td>
<td>24657.0</td>
</tr>
</tbody>
</table>
<hr>
<p>Meanwhile the <code>.psi.gz</code> file is a bit more complex and requires more explanation. Quantified nodes can fall into a number of "node-type" categories:</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Interpretation</th>
</tr>
</thead>
<tbody>
<tr>
<td>CE</td>
<td>Core exon, which may be bounded by one or more alternative AA/AD nodes</td>
</tr>
<tr>
<td>AA</td>
<td>Alternative Acceptor splice site</td>
</tr>
<tr>
<td>AD</td>
<td>Alternative Donor splice site</td>
</tr>
<tr>
<td>RI</td>
<td>Retained intron</td>
</tr>
<tr>
<td>TS</td>
<td>Tandem transcription start site</td>
</tr>
<tr>
<td>TE</td>
<td>Tandem alternative polyadenylation site</td>
</tr>
<tr>
<td>AF</td>
<td>Alternative First exon</td>
</tr>
<tr>
<td>AL</td>
<td>Alternative Last exon</td>
</tr>
<tr>
<td>BS</td>
<td>Circular back-splicing (output only when <code>--circ</code> flag is given)</td>
</tr>
</tbody>
</table>
<p>Each node is defined by a type (above) and has a corresponding value for <code>Psi</code> or the Percent-Spliced-In, see below:</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/ee616d3ca9800755bc6f2c7ac6190816d4ea5c43/68747470733a2f2f74696d6269747a2e6769746875622e696f2f696d616765732f576869707065742d4576656e742d54797065732e676966"><img src="https://camo.githubusercontent.com/ee616d3ca9800755bc6f2c7ac6190816d4ea5c43/68747470733a2f2f74696d6269747a2e6769746875622e696f2f696d616765732f576869707065742d4576656e742d54797065732e676966" alt="Whippet AS Events" data-canonical-src="https://timbitz.github.io/images/Whippet-Event-Types.gif" style="max-width:100%;"></a></p>
<p>The <code>.psi.gz</code> file itself is outputted in the form:</p>
<table>
<thead>
<tr>
<th>Gene</th>
<th>Node</th>
<th>Coord</th>
<th>Strand</th>
<th>Type</th>
<th>Psi</th>
<th>CI Width</th>
<th>CI Lo,Hi</th>
<th>Total Reads</th>
<th>Complexity</th>
<th>Entropy</th>
<th>Inc Paths</th>
<th>Exc Paths</th>
</tr>
</thead>
<tbody>
<tr>
<td>NFIA</td>
<td>2</td>
<td>chr1:61547534-61547719</td>
<td>+</td>
<td>AF</td>
<td>0.782</td>
<td>0.191</td>
<td>0.669,0.86</td>
<td>49.0</td>
<td>K1</td>
<td>0.756</td>
<td>2-4-5:0.782</td>
<td>1-5:0.218</td>
</tr>
<tr>
<td>NFIA</td>
<td>4</td>
<td>chr1:61548433-61548490</td>
<td>+</td>
<td>CE</td>
<td>0.8329</td>
<td>0.069</td>
<td>0.795,0.864</td>
<td>318.0</td>
<td>K2</td>
<td>1.25</td>
<td>2-4-5:0.3342,3-4-5:0.4987</td>
<td>1-5:0.1671</td>
</tr>
<tr>
<td>NFIA</td>
<td>5</td>
<td>chr1:61553821-61554352</td>
<td>+</td>
<td>CE</td>
<td>0.99</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
</tr>
<tr>
<td>NFIA</td>
<td>6</td>
<td>chr1:61743192-61743257</td>
<td>+</td>
<td>CE</td>
<td>0.99</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
</tr>
</tbody>
</table>
<p>Whippet outputs quantification at the node-level (one PSI value for each node, not exon). For example, Whippet CE ('core exon') nodes may be bounded by one or more AA or AD nodes. So when those AA or AD nodes are spliced in, the full exon consists of the nodes combined (AA+CE).</p>
<p>We believe that this is (and should be) the correct generalization of event-level splicing quantification for the following reasons:</p>
<ol>
<li>Whippet allows for dynamic quantification of observed splicing patterns. Therefore, in order to maintain consistent output from different Whippet runs on various samples, the basic unit of quantification needs to be a <code>node</code>.</li>
<li>Whippet can handle highly complex events, in contrast to many other splicing quantification tools which only report binary event types. Since, for example, it is possible for both (CE+AA) and CE exons to be excluded from the mature message, complex events may involve a number of overlapping full exons. If Whippet output was enumerated for all such combinations, the output for complex events would grow exponentially and approach uselessness.</li>
<li>The general definition of Percent-spliced-in for an exon (or node) is the percentage of transcripts that 'have that exon spliced in', irrespective of the upstream or downstream splice sites that connect to it (those merely alter another node's PSI). Therefore, we feel that the output of PSI values should not change based on upstream or downstream splice-sites as they might with some other programs.</li>
</ol>
<p>This must be taken into account when intersecting <code>.psi.gz</code> coordinate output with other formats that only represent full exons (which can be one or more adjacent nodes combined).  To ease this process, <code>whippet-index.jl</code> outputs an <em>index</em><code>.exons.gz</code> file that contains all theoretical full exon coordinates mapped to Whippet nodes for each gene, and whether or not the exon is found in annotation.</p>
<p>Note:</p>
<ul>
<li><strong>Complexity</strong> refers to the discrete categories based-on the ceiling(log2(number of paths)) through each AS event.</li>
<li><strong>Entropy</strong> refers to the shannon-entropy of the relative expression of the paths through the AS event.</li>
<li><strong>Inc_Paths/Exc_Paths</strong> contain the paths quantified through the AS event (supporting inclusion or exclusion respectively), each path (eg. 1-2-3) gives the set of nodes in the path, followed by a <code>:</code> and the relative expression, such that the sum of all these paths is 1.0.</li>
</ul>
<hr>
<p>The raw junctions are output in the format of <code>.jnc.gz</code> files, which look like:</p>
<table>
<thead>
<tr>
<th>Chrom</th>
<th>Donor_Coord</th>
<th>Acceptor_Coord</th>
<th>GeneID:Nodes:Type</th>
<th>ReadCount</th>
<th>Strand</th>
</tr>
</thead>
<tbody>
<tr>
<td>chr1</td>
<td>150600068</td>
<td>150601890</td>
<td>ENSG00000143420.17_1:2-3:CON_ANNO</td>
<td>113.04</td>
<td>-</td>
</tr>
<tr>
<td>chr1</td>
<td>150598284</td>
<td>150599943</td>
<td>ENSG00000143420.17_1:3-6:ALT_ANNO</td>
<td>110.12</td>
<td>-</td>
</tr>
<tr>
<td>chr1</td>
<td>150595335</td>
<td>150598118</td>
<td>ENSG00000143420.17_1:6-9:CON_ANNO</td>
<td>35.74</td>
<td>-</td>
</tr>
<tr>
<td>chr1</td>
<td>161185160</td>
<td>161187776</td>
<td>ENSG00000158869.10_1:1-2:CON_ANNO</td>
<td>20.47</td>
<td>+</td>
</tr>
<tr>
<td>chr1</td>
<td>161185160</td>
<td>161188031</td>
<td>ENSG00000158869.10_1:1-3:ALT_UNIQ</td>
<td>3.11</td>
<td>+</td>
</tr>
</tbody>
</table>
<p>The <code>Type</code> can be one of three:</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>CON_ANNO</td>
<td>Annotated constitutive junction</td>
</tr>
<tr>
<td>ALT_ANNO</td>
<td>Annotated alternative junction</td>
</tr>
<tr>
<td>ALT_UNIQ</td>
<td>Unannotated alternative junction</td>
</tr>
</tbody>
</table>
<hr>
<p>The output format of <code>.diff.gz</code> files from <code>whippet-delta.jl</code> is:</p>
<table>
<thead>
<tr>
<th>Gene</th>
<th>Node</th>
<th>Coord</th>
<th>Strand</th>
<th>Type</th>
<th>Psi_A</th>
<th>Psi_B</th>
<th>DeltaPsi</th>
<th>Probability</th>
<th>Complexity</th>
<th>Entropy</th>
</tr>
</thead>
<tbody>
<tr>
<td>ENSG00000117448.13_2</td>
<td>9</td>
<td>chr1:46033654-46033849</td>
<td>+</td>
<td>CE</td>
<td>0.95971</td>
<td>0.97876</td>
<td>-0.019047</td>
<td>0.643</td>
<td>K0</td>
<td>0.0</td>
</tr>
<tr>
<td>ENSG00000117448.13_2</td>
<td>10</td>
<td>chr1:46034157-46034356</td>
<td>+</td>
<td>CE</td>
<td>0.9115</td>
<td>0.69021</td>
<td>0.22129</td>
<td>0.966</td>
<td>K1</td>
<td>0.874</td>
</tr>
</tbody>
</table>
<p>Between the set of replicates from -a and -b <code>whippet-delta.jl</code> outputs a mean Psi_A (from emperical sampling of the joint posterior distribution) and mean Psi_B.  It also outputs the mean deltaPsi (Psi_A - Psi_B) and the probability that there is some change in deltaPsi given the read depth of the AS event, such that P(|deltaPsi| &gt; 0.0). To determine the significance of output in <code>.diff.gz</code> files, two heuristic filters are encouraged, however please note that the exact values for these filters have not yet been systematically optimized. These should be adjusted by the user according to the desired stringency, read depth, and experiment set-up: (1) In general, significant nodes should have a higher probability (e.g. &gt;=0.90) suggesting there is likely to be a difference between the samples, and (2) significant nodes should have an absolute magnitude of change (|DeltaPsi| &gt; x) where x is some value you consider to be a biologically relevant magnitude of change (we suggest |DeltaPsi| &gt; 0.1).</p>
<hr>
<h2><a id="user-content-visualization" class="anchor" aria-hidden="true" href="#visualization"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Visualization</h2>
<p>Currently, Whippet supports the output of RNA-seq alignments in SAM/BAM format when the (<code>--sam</code>) flag is used.  These alignment files can be displayed using a number of different downstream visualization software tools, such as the IGV browser, which also supports display in the popular “sashimi-plot” format (e.g. instructions on making sashimi-plots with IGV can be found <a href="https://miso.readthedocs.io/en/fastmiso/sashimi.html#making-sashimi-plots-from-igv" rel="nofollow">here</a>).</p>
<hr>
<h2><a id="user-content-index-building-strategies" class="anchor" aria-hidden="true" href="#index-building-strategies"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Index Building Strategies</h2>
<p>If you are building an index for another organism, there are some general guidelines that can help to ensure that the index you build is as effective as it can be. In general you should seek to:</p>
<ul>
<li>Use only the highest quality annotations you can find.</li>
<li>Use strand-specific RNA-seq alignments to avoid false positives from overlapping gene regions (eg. head-to-head and tail-to-tail)</li>
<li>If a high-quality annotation set like GENCODE, contains both high and low quality transcripts, filter it! For human, we only use TSL-1/2 annotations.</li>
<li>Avoid giving annotations with 'indels' such as ESTs or mRNAs without filtering out invalid splice sites first.</li>
<li>If you plan to align very short reads (~36nt), consider decreasing the Kmer size (we have used 6nt before, though this is quite low and it is not recommended to go below this), otherwise the default Kmer size (9nt) should be used. However, reads of lower length should still be of high-quality to expect performant spliced-read alignment.</li>
</ul>
<hr>
<h2><a id="user-content-troubleshooting" class="anchor" aria-hidden="true" href="#troubleshooting"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Troubleshooting</h2>
<p>With all of the executables in <code>Whippet/bin</code>, you can use the <code>-h</code> flag to get a list of the available command line options and their usage.  If you are having trouble using or interpreting the output of <code>Whippet</code> then please ask a question in our <a href="https://gitter.im/Whippet-jl/Lobby" rel="nofollow">gitter chat</a>!.  If you are having trouble running a Whippet executable in /bin, try running <code>Pkg.test("Whippet")</code> from the Julia REPL, Whippet should run cleanly if your environment is working correctly (although it is mostly untested on Windows, it should still work-- or at least it did the one time we tried it ;-).  If you <em>still</em> think you have found a bug feel free to open an issue in github or make a pull request!</p>
</article></div>