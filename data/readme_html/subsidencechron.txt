<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><h1 dir="auto"><a id="user-content-subsidencechronjl" class="anchor" aria-hidden="true" href="#subsidencechronjl"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>SubsidenceChron.jl</h1>
<p dir="auto"><a href="https://doi.org/10.17605/OSF.IO/ZW5GA" rel="nofollow"><img src="docs/osf_io_ZW5GA.svg" alt="DOI" style="max-width: 100%;"></a>
<a href="https://JuliaGeochronology.github.io/SubsidenceChron.jl/dev/" rel="nofollow"><img src="https://camo.githubusercontent.com/7fcec4b2d3ab291529fce8ef6a4fcd4129a0683b2f5d5fe2f5c648f02db8b616/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f646f63732d6465762d626c75652e737667" alt="Docs" data-canonical-src="https://img.shields.io/badge/docs-dev-blue.svg" style="max-width: 100%;"></a>
<a href="https://github.com/JuliaGeochronology/SubsidenceChron.jl/actions/workflows/CI.yml"><img src="https://github.com/JuliaGeochronology/SubsidenceChron.jl/workflows/CI/badge.svg" alt="CI" style="max-width: 100%;"></a>
<a href="https://github.com/JuliaGeochronology/SubsidenceChron.jl/actions/workflows/CI-julia-nightly.yml"><img src="https://github.com/JuliaGeochronology/SubsidenceChron.jl/workflows/CI%20(Julia%20nightly)/badge.svg" alt="CI (julia nightly)" style="max-width: 100%;"></a>
<a href="http://app.codecov.io/github/JuliaGeochronology/SubsidenceChron.jl?branch=main" rel="nofollow"><img src="https://camo.githubusercontent.com/b97cb6328886f4be99611e6df2dbb5f358d282c832b956bf79af254f45b58bf3/687474703a2f2f636f6465636f762e696f2f6769746875622f4a756c696147656f6368726f6e6f6c6f67792f537562736964656e63654368726f6e2e6a6c2f636f7665726167652e7376673f6272616e63683d6d61696e" alt="codecov.io" data-canonical-src="http://codecov.io/github/JuliaGeochronology/SubsidenceChron.jl/coverage.svg?branch=main" style="max-width: 100%;"></a></p>
<p dir="auto">A two-part package that incorporates and propagates uncertainties in the calculations of(1) decompaction and backstripping, and (2) thermal subsidence age-depth modeling in post-rift sedimentary basins. The first step uses Monte Carlo (MC) methods, and the second step uses Markov chain Monte Carlo (MCMC) methods.</p>
<p dir="auto">The decompaction and backstripping MC model (part 1) is based on the workflow demonstrated in <a href="https://www.wiley.com/en-ie/Basin+Analysis:+Principles+and+Application+to+Petroleum+Play+Assessment,+3rd+Edition-p-9780470673768" rel="nofollow">Allen and Allen (2005)</a>. Users first input stratigraphic information (lithologies and thicknesses of measured section) and, optionally, water depth estimations (as distributions). Then the users need to define the resolution (that decompaction and backstripping calculations perform at) and the number of MC simulations. For each MC simulation, lithology-dependent parameters and water depth estimations are drawn from their respective distributions. The output of this first MC model describes how tectonic subsidence (with uncertainties) changes throughout deposition of the target sedimentary succession.</p>
<p dir="auto">The second part of this package is an MCMC model that probes the age-depth relationship for strata deposited in a post-rift thermally subsiding basin. It builds upon the stratigraphic MCMC model of <a href="https://github.com/brenhinkeller/Chron.jl">Chron.jl</a>, which only uses stratigraphic superposition as the underlying principle (i.e. without making any assumptions about how sedimentation rate changes). Because this package is specifically developed for the thermal subsidence phase of the <a href="https://doi.org/10.1016/0012-821X(78)90071-7" rel="nofollow">Mckenzie</a>-type basins, our MCMC model adds two extra log-likelihood terms to examine 1) the shape of the proposed tectonic subsidence-age curve, and 2) the rifting conditions (stretching factor β and onset time for thermal subsidence t<sub>0</sub>). Inputs for this MCMC model include: 1) results propagated from the first MC model (i.e. tectonic subsidence through time), 2) existing age constraints, 3) prior distributions of β and t<sub>0</sub>, and 4) user-defined MCMC model configurations. The outputs of this second MCMC model include both age estimations at all model horizons throughout the section, and updated distributions for β and t<sub>0</sub>.</p>
<h2 dir="auto"><a id="user-content-installation" class="anchor" aria-hidden="true" href="#installation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Installation</h2>
<p dir="auto">SubsidenceChron.jl is written in the Julia programming language and registered on the General registry. To use this package, first download and install <a href="https://julialang.org/downloads/" rel="nofollow">Julia</a>. Then, SubsidenceChron.jl can be installed by typing ] in the REPL to enter the Julia package manager and typing:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="pkg&gt; add SubsidenceChron"><pre class="notranslate"><code>pkg&gt; add SubsidenceChron
</code></pre></div>
<h2 dir="auto"><a id="user-content-standard-usage" class="anchor" aria-hidden="true" href="#standard-usage"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Standard Usage</h2>
<p dir="auto">To see the standard useage of this program, run <a href="">example/SubsidenceChron1.0Synthetic.jl</a>, which should follow the following steps:</p>
<h3 dir="auto"><a id="user-content-load-necessary-packages" class="anchor" aria-hidden="true" href="#load-necessary-packages"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Load necessary packages</h3>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="using SubsidenceChron

using StatGeochem, Distributions, Plots, Statistics, StatsBase"><pre><span class="pl-k">using</span> SubsidenceChron

<span class="pl-k">using</span> StatGeochem, Distributions, Plots, Statistics, StatsBase</pre></div>
<h3 dir="auto"><a id="user-content-enter-stratigraphic-information" class="anchor" aria-hidden="true" href="#enter-stratigraphic-information"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Enter stratigraphic information</h3>
<p dir="auto">Here we use a synthetic stratigraphic succession as an example. This synthetic succession consists of, from the youngest to the oldest:</p>
<table>
<thead>
<tr>
<th align="center">Thickness (km)</th>
<th align="center">Lithology</th>
<th align="center">Water depth</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">1</td>
<td align="center">Shale</td>
<td align="center">Between storm wave base and fair weather wave base</td>
</tr>
<tr>
<td align="center">0.6</td>
<td align="center">Sandstone</td>
<td align="center">Above fair weather wave base</td>
</tr>
<tr>
<td align="center">0.4</td>
<td align="center">Limestone</td>
<td align="center">Above fair weather wave base</td>
</tr>
</tbody>
</table>
<p dir="auto">Stratigraphic information and (optional) water depth information should be stored in <code>.csv</code> files following the same format as those provided in the <a href="examples/">examples/</a> folder. For example, the stratigraphic information <code>.csv</code> file should look like <a href="examples/Test_DB_PerfectSubsidence.csv">examples/Test_DB_PerfectSubsidence.csv</a>:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="layer,Thickness,Lithology
3,1,Shale
2,0.6,Sandstone
1,0.4,Limestone"><pre class="notranslate"><code>layer,Thickness,Lithology
3,1,Shale
2,0.6,Sandstone
1,0.4,Limestone
</code></pre></div>
<p dir="auto">while the water depth information <code>.csv</code> file should look like <a href="examples/PerfectSubsidence_SequenceStrat.csv">examples/PerfectSubsidence_SequenceStrat.csv</a>:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="layer,Thickness,Type,Notes
3,1,SWB,
2,0.6,FWWB,
1,0.4,FWWB,"><pre class="notranslate"><code>layer,Thickness,Type,Notes
3,1,SWB,
2,0.6,FWWB,
1,0.4,FWWB,
</code></pre></div>
<p dir="auto">Below is a list of currently acceptable lithology and water depth identifiers:</p>
<table>
<tbody><tr><th>Lithology </th><th>Water depth </th></tr>
<tr><td>
<table>
<thead>
<tr>
<th align="center"></th>
<th align="center">Identifiers</th>
<th align="center"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">Shale</td>
<td align="center">Siltstone</td>
<td align="center">Sandstone</td>
</tr>
<tr>
<td align="center">Chalk</td>
<td align="center">Limestone</td>
<td align="center">Dolostone</td>
</tr>
<tr>
<td align="center">Anhydrite</td>
<td align="center">Quartzite</td>
<td align="center">Diabase</td>
</tr>
<tr>
<td align="center">Rhyolite</td>
<td align="center">Diamictite</td>
<td align="center">Conglomerate</td>
</tr>
<tr>
<td align="center">Breccia</td>
<td align="center">Basalt</td>
<td align="center">Andesite</td>
</tr>
</tbody>
</table>
</td><td>
<table>
<thead>
<tr>
<th align="center">Identifier</th>
<th align="center">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">Exposure</td>
<td align="center">Subaerial exposure surface</td>
</tr>
<tr>
<td align="center">FWWB</td>
<td align="center">Above fair weather wave base</td>
</tr>
<tr>
<td align="center">SWB</td>
<td align="center">Between storm wave base and fair weather wave base</td>
</tr>
<tr>
<td align="center">BWB</td>
<td align="center">Below storm wave base</td>
</tr>
</tbody>
</table>
</td></tr> </tbody></table>
<p dir="auto">Once the <code>.csv</code> files is in the correct format, the user can import them into the model:</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# # # # # # # # # # # Enter stratigraphic information here! # # # # # # # # # # # #
# Import the data file (.csv)
data_csv = importdataset(&quot;examples/Test_DB_PerfectSubsidence.csv&quot;,',')
# Obtain stratigraphic info from the data file
nLayers = length(data_csv[&quot;Thickness&quot;])
strat = NewStratData(nLayers)
strat.Lithology          = data_csv[&quot;Lithology&quot;]
strat.Thickness         .= data_csv[&quot;Thickness&quot;]
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #

# # # # # # # # OPTIONAL - Enter paleo water depth information here! # # # # # # # # 
# Import the data file (.csv)
wd_csv = importdataset(&quot;examples/PerfectSubsidence_SequenceStrat.csv&quot;, ',')
# Obtain paleo water depth info from the data file
wd_nLayers = length(wd_csv[&quot;Thickness&quot;])
wd = NewWaterDepth(wd_nLayers)
wd.DepthID    = wd_csv[&quot;Type&quot;]
wd.Thickness .= wd_csv[&quot;Thickness&quot;] 
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #"><pre><span class="pl-c"><span class="pl-c">#</span> # # # # # # # # # # Enter stratigraphic information here! # # # # # # # # # # # #</span>
<span class="pl-c"><span class="pl-c">#</span> Import the data file (.csv)</span>
data_csv <span class="pl-k">=</span> <span class="pl-c1">importdataset</span>(<span class="pl-s"><span class="pl-pds">"</span>examples/Test_DB_PerfectSubsidence.csv<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">'</span>,<span class="pl-pds">'</span></span>)
<span class="pl-c"><span class="pl-c">#</span> Obtain stratigraphic info from the data file</span>
nLayers <span class="pl-k">=</span> <span class="pl-c1">length</span>(data_csv[<span class="pl-s"><span class="pl-pds">"</span>Thickness<span class="pl-pds">"</span></span>])
strat <span class="pl-k">=</span> <span class="pl-c1">NewStratData</span>(nLayers)
strat<span class="pl-k">.</span>Lithology          <span class="pl-k">=</span> data_csv[<span class="pl-s"><span class="pl-pds">"</span>Lithology<span class="pl-pds">"</span></span>]
strat<span class="pl-k">.</span>Thickness         <span class="pl-k">.=</span> data_csv[<span class="pl-s"><span class="pl-pds">"</span>Thickness<span class="pl-pds">"</span></span>]
<span class="pl-c"><span class="pl-c">#</span> # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span>

<span class="pl-c"><span class="pl-c">#</span> # # # # # # # OPTIONAL - Enter paleo water depth information here! # # # # # # # # </span>
<span class="pl-c"><span class="pl-c">#</span> Import the data file (.csv)</span>
wd_csv <span class="pl-k">=</span> <span class="pl-c1">importdataset</span>(<span class="pl-s"><span class="pl-pds">"</span>examples/PerfectSubsidence_SequenceStrat.csv<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">'</span>,<span class="pl-pds">'</span></span>)
<span class="pl-c"><span class="pl-c">#</span> Obtain paleo water depth info from the data file</span>
wd_nLayers <span class="pl-k">=</span> <span class="pl-c1">length</span>(wd_csv[<span class="pl-s"><span class="pl-pds">"</span>Thickness<span class="pl-pds">"</span></span>])
wd <span class="pl-k">=</span> <span class="pl-c1">NewWaterDepth</span>(wd_nLayers)
wd<span class="pl-k">.</span>DepthID    <span class="pl-k">=</span> wd_csv[<span class="pl-s"><span class="pl-pds">"</span>Type<span class="pl-pds">"</span></span>]
wd<span class="pl-k">.</span>Thickness <span class="pl-k">.=</span> wd_csv[<span class="pl-s"><span class="pl-pds">"</span>Thickness<span class="pl-pds">"</span></span>] 
<span class="pl-c"><span class="pl-c">#</span> # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span></pre></div>
<p dir="auto">If water depth information is not applicable/does not exist for the user's case study, the code block for entering water depth information should be commented out.</p>
<h4 dir="auto"><a id="user-content-configure-and-run-the-decompaction-and-backstripping-mc-model" class="anchor" aria-hidden="true" href="#configure-and-run-the-decompaction-and-backstripping-mc-model"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Configure and run the decompaction and backstripping MC model</h4>
<p dir="auto">After importing data, the user need to configure the MC model (i.e. specify the number of MC simulations and the resolution):</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# # # # # # # # # # Configure MC model here! # # # # # # # # # #
# Number of MC simulations
nsims = 1000 
# Resolution for model horizons (in km)
res = 0.02
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # 

# Run the decompaction and backstripping MC model
# (wd input is optional)
@time (Sₜ, Sμ, Sσ, model_strat_heights) = DecompactBackstrip(strat, wd, nsims, res)"><pre><span class="pl-c"><span class="pl-c">#</span> # # # # # # # # # Configure MC model here! # # # # # # # # # #</span>
<span class="pl-c"><span class="pl-c">#</span> Number of MC simulations</span>
nsims <span class="pl-k">=</span> <span class="pl-c1">1000</span> 
<span class="pl-c"><span class="pl-c">#</span> Resolution for model horizons (in km)</span>
res <span class="pl-k">=</span> <span class="pl-c1">0.02</span>
<span class="pl-c"><span class="pl-c">#</span> # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # </span>

<span class="pl-c"><span class="pl-c">#</span> Run the decompaction and backstripping MC model</span>
<span class="pl-c"><span class="pl-c">#</span> (wd input is optional)</span>
<span class="pl-c1">@time</span> (Sₜ, Sμ, Sσ, model_strat_heights) <span class="pl-k">=</span> <span class="pl-c1">DecompactBackstrip</span>(strat, wd, nsims, res)</pre></div>
<p dir="auto">If water depth information is not applicable/does not exist for the user's case study, the user should exclude the input <code>wd</code> when calling the <code>DecompactBackstrip</code> function:</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="    @time (Sₜ, Sμ, Sσ, model_strat_heights) = DecompactBackstrip(strat, nsims, res)"><pre>    <span class="pl-c1">@time</span> (Sₜ, Sμ, Sσ, model_strat_heights) <span class="pl-k">=</span> <span class="pl-c1">DecompactBackstrip</span>(strat, nsims, res)</pre></div>
<p dir="auto">The outputs of this first MC model are</p>
<ol dir="auto">
<li>tectonic subsidence (throughout the deposition of the target succession) from all MC simulations (<code>Sₜ</code>);</li>
<li>tectonic subsidence mean, averaging across all MC simulations (<code>Sμ</code>);</li>
<li>tectonic subsidence standard deviation (<code>Sσ</code>);</li>
<li>model stratigraphic heights (spacing = <code>res</code>) (<code>model_strat_heights</code>).</li>
</ol>
<h3 dir="auto"><a id="user-content-enter-age-constraints-and-priors-for-thermal-subsidence-parameters" class="anchor" aria-hidden="true" href="#enter-age-constraints-and-priors-for-thermal-subsidence-parameters"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Enter age constraints and priors for thermal subsidence parameters</h3>
<p dir="auto">For the synthetic test case, we used the "real" ages for four randomly-picked horizons as age constraints. The "real" ages are calculated using β = 1.85 and t<sub>0</sub> = 400 Ma, and assuming that this succession was deposited in a perfect McKenzie-type thermally subsiding basin.</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# # # # # # # # # # # Enter age constraint (sample) information here! # # # # # # # # # # # #
# Input the number of samples we wish to model (must match below)
nSamples = 4
# Make an instance of a Chron Section object for nSamples
smpl = NewChronAgeData(nSamples)
smpl.Name          = (&quot;Sample 1&quot;, &quot;Sample 2&quot;, &quot;Sample 3&quot;, &quot;Sample 4&quot;) # Et cetera
smpl.Age          .= [   388.67,   362.63,    328.16,   220.08] # Measured ages
smpl.Age_sigma    .= [        2,        2,         2,        2] # Measured 1-σ uncertainties
smpl.Height       .= [    -1700,    -1100,      -700,     -100] # Depths below surface should be negative
smpl.Height_sigma .= [     0.01,     0.01,      0.01,     0.01] # Usually assume little or no sample height uncertainty
smpl.Age_Sidedness .= [       0,        0,         0,        0] # Sidedness (zeros by default: geochron constraints are two-sided). Use -1 for a maximum age and +1 for a minimum age, 0 for two-sided
smpl.Age_Unit = &quot;Ma&quot; # Unit of measurement for ages
smpl.Height_Unit = &quot;m&quot; # Unit of measurement for Height and Height_sigma

# # # # # # # # # # Enter thermal subsidence parameter priors here! # # # # # # # # # #
# Enter initial guesses for the beta factor and thermal subsidence onset age and their uncertainties
Beta = 1.8
Beta_sigma = 0.2
T0 = 410
T0_sigma = 50

therm = NewThermalSubsidenceParameters()
therm.Param = [Beta, T0]
therm.Sigma = [Beta_sigma, T0_sigma]"><pre><span class="pl-c"><span class="pl-c">#</span> # # # # # # # # # # Enter age constraint (sample) information here! # # # # # # # # # # # #</span>
<span class="pl-c"><span class="pl-c">#</span> Input the number of samples we wish to model (must match below)</span>
nSamples <span class="pl-k">=</span> <span class="pl-c1">4</span>
<span class="pl-c"><span class="pl-c">#</span> Make an instance of a Chron Section object for nSamples</span>
smpl <span class="pl-k">=</span> <span class="pl-c1">NewChronAgeData</span>(nSamples)
smpl<span class="pl-k">.</span>Name          <span class="pl-k">=</span> (<span class="pl-s"><span class="pl-pds">"</span>Sample 1<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Sample 2<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Sample 3<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Sample 4<span class="pl-pds">"</span></span>) <span class="pl-c"><span class="pl-c">#</span> Et cetera</span>
smpl<span class="pl-k">.</span>Age          <span class="pl-k">.=</span> [   <span class="pl-c1">388.67</span>,   <span class="pl-c1">362.63</span>,    <span class="pl-c1">328.16</span>,   <span class="pl-c1">220.08</span>] <span class="pl-c"><span class="pl-c">#</span> Measured ages</span>
smpl<span class="pl-k">.</span>Age_sigma    <span class="pl-k">.=</span> [        <span class="pl-c1">2</span>,        <span class="pl-c1">2</span>,         <span class="pl-c1">2</span>,        <span class="pl-c1">2</span>] <span class="pl-c"><span class="pl-c">#</span> Measured 1-σ uncertainties</span>
smpl<span class="pl-k">.</span>Height       <span class="pl-k">.=</span> [    <span class="pl-k">-</span><span class="pl-c1">1700</span>,    <span class="pl-k">-</span><span class="pl-c1">1100</span>,      <span class="pl-k">-</span><span class="pl-c1">700</span>,     <span class="pl-k">-</span><span class="pl-c1">100</span>] <span class="pl-c"><span class="pl-c">#</span> Depths below surface should be negative</span>
smpl<span class="pl-k">.</span>Height_sigma <span class="pl-k">.=</span> [     <span class="pl-c1">0.01</span>,     <span class="pl-c1">0.01</span>,      <span class="pl-c1">0.01</span>,     <span class="pl-c1">0.01</span>] <span class="pl-c"><span class="pl-c">#</span> Usually assume little or no sample height uncertainty</span>
smpl<span class="pl-k">.</span>Age_Sidedness <span class="pl-k">.=</span> [       <span class="pl-c1">0</span>,        <span class="pl-c1">0</span>,         <span class="pl-c1">0</span>,        <span class="pl-c1">0</span>] <span class="pl-c"><span class="pl-c">#</span> Sidedness (zeros by default: geochron constraints are two-sided). Use -1 for a maximum age and +1 for a minimum age, 0 for two-sided</span>
smpl<span class="pl-k">.</span>Age_Unit <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Ma<span class="pl-pds">"</span></span> <span class="pl-c"><span class="pl-c">#</span> Unit of measurement for ages</span>
smpl<span class="pl-k">.</span>Height_Unit <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>m<span class="pl-pds">"</span></span> <span class="pl-c"><span class="pl-c">#</span> Unit of measurement for Height and Height_sigma</span>

<span class="pl-c"><span class="pl-c">#</span> # # # # # # # # # Enter thermal subsidence parameter priors here! # # # # # # # # # #</span>
<span class="pl-c"><span class="pl-c">#</span> Enter initial guesses for the beta factor and thermal subsidence onset age and their uncertainties</span>
Beta <span class="pl-k">=</span> <span class="pl-c1">1.8</span>
Beta_sigma <span class="pl-k">=</span> <span class="pl-c1">0.2</span>
T0 <span class="pl-k">=</span> <span class="pl-c1">410</span>
T0_sigma <span class="pl-k">=</span> <span class="pl-c1">50</span>

therm <span class="pl-k">=</span> <span class="pl-c1">NewThermalSubsidenceParameters</span>()
therm<span class="pl-k">.</span>Param <span class="pl-k">=</span> [Beta, T0]
therm<span class="pl-k">.</span>Sigma <span class="pl-k">=</span> [Beta_sigma, T0_sigma]</pre></div>
<p dir="auto">Note that when entering the age constraints, <code>smpl.Height</code> must increase with increasing stratigraphic height.</p>
<h4 dir="auto"><a id="user-content-configure-and-run-the-thermal-subsidence-mcmc-model" class="anchor" aria-hidden="true" href="#configure-and-run-the-thermal-subsidence-mcmc-model"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Configure and run the thermal subsidence MCMC model</h4>
<p dir="auto">To run the MCMC model, the user should first configure the model by setting appropiate values for <code>config.bounding</code>, <code>config.nsteps</code>, and <code>config.burnin</code>.</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content=" # # # # # # # # # # Configure MCMC model here! # # # # # # # # # #
# Configure the stratigraphic MCMC model
config = NewStratAgeModelConfiguration()
# If you in doubt, you can probably leave these parameters as-is
config.resolution = res*1000 # Same units as sample height. Smaller is slower!
config.bounding = 1.0 # how far away do we place runaway bounds, as a fraction of total section height. Larger is slower.
(bottom, top) = extrema(smpl.Height)
npoints_approx = round(Int,length(bottom:config.resolution:top) * (1 + 2*config.bounding))
config.nsteps = 5000 # Number of steps to run in distribution MCMC 
config.burnin = 10000*npoints_approx # Number to discard 
config.sieve = round(Int,npoints_approx) # Record one out of every nsieve steps
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #"><pre> <span class="pl-c"><span class="pl-c">#</span> # # # # # # # # # Configure MCMC model here! # # # # # # # # # #</span>
<span class="pl-c"><span class="pl-c">#</span> Configure the stratigraphic MCMC model</span>
config <span class="pl-k">=</span> <span class="pl-c1">NewStratAgeModelConfiguration</span>()
<span class="pl-c"><span class="pl-c">#</span> If you in doubt, you can probably leave these parameters as-is</span>
config<span class="pl-k">.</span>resolution <span class="pl-k">=</span> res<span class="pl-k">*</span><span class="pl-c1">1000</span> <span class="pl-c"><span class="pl-c">#</span> Same units as sample height. Smaller is slower!</span>
config<span class="pl-k">.</span>bounding <span class="pl-k">=</span> <span class="pl-c1">1.0</span> <span class="pl-c"><span class="pl-c">#</span> how far away do we place runaway bounds, as a fraction of total section height. Larger is slower.</span>
(bottom, top) <span class="pl-k">=</span> <span class="pl-c1">extrema</span>(smpl<span class="pl-k">.</span>Height)
npoints_approx <span class="pl-k">=</span> <span class="pl-c1">round</span>(Int,<span class="pl-c1">length</span>(bottom<span class="pl-k">:</span>config<span class="pl-k">.</span>resolution<span class="pl-k">:</span>top) <span class="pl-k">*</span> (<span class="pl-c1">1</span> <span class="pl-k">+</span> <span class="pl-c1">2</span><span class="pl-k">*</span>config<span class="pl-k">.</span>bounding))
config<span class="pl-k">.</span>nsteps <span class="pl-k">=</span> <span class="pl-c1">5000</span> <span class="pl-c"><span class="pl-c">#</span> Number of steps to run in distribution MCMC </span>
config<span class="pl-k">.</span>burnin <span class="pl-k">=</span> <span class="pl-c1">10000</span><span class="pl-k">*</span>npoints_approx <span class="pl-c"><span class="pl-c">#</span> Number to discard </span>
config<span class="pl-k">.</span>sieve <span class="pl-k">=</span> <span class="pl-c1">round</span>(Int,npoints_approx) <span class="pl-c"><span class="pl-c">#</span> Record one out of every nsieve steps</span>
<span class="pl-c"><span class="pl-c">#</span> # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #</span></pre></div>
<p dir="auto">Then we call the <code>SubsidenceStratMetropolis</code> function. The user is welcomed to change the last two inputs of this function, which represents the perturbation to β and t<sub>0</sub> for the initial proposal - changing these two values shouldn't affect the posterior distribution.</p>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="#Run the model
(subsmdl, agedist, lldist, beta_t0dist, lldist_burnin) = SubsidenceStratMetropolis(smpl, config, therm, model_strat_heights, Sμ, Sσ, 0.05, 10)"><pre><span class="pl-c"><span class="pl-c">#</span>Run the model</span>
(subsmdl, agedist, lldist, beta_t0dist, lldist_burnin) <span class="pl-k">=</span> <span class="pl-c1">SubsidenceStratMetropolis</span>(smpl, config, therm, model_strat_heights, Sμ, Sσ, <span class="pl-c1">0.05</span>, <span class="pl-c1">10</span>)</pre></div>
<p dir="auto">The outputs of this second MCMC model are</p>
<ol dir="auto">
<li>summary statistics for the age predictions of all model horizons and for the thermal subsidence parameters (<code>subsmdl</code>);</li>
<li>age predictions of all model horizons from all recorded MCMC runs (<code>agedist</code>);</li>
<li>log likelihood from all recorded MCMC runs (<code>lldist</code>);</li>
<li>subsidence parameters from all recorded MCMC runs (<code>beta_t0dist</code>);</li>
<li>log likelihood from all runs during the burn-in stage (<code>lldist_burnin</code>).</li>
</ol>
<h3 dir="auto"><a id="user-content-plot-results" class="anchor" aria-hidden="true" href="#plot-results"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Plot results</h3>
<ol dir="auto">
<li>Plot the age-depth model;</li>
</ol>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# Plot 1: Age-depth model (mean and 95% confidence interval for both model and data)
hdl = plot([subsmdl.Age_025CI; reverse(subsmdl.Age_975CI)],[subsmdl.Height; reverse(subsmdl.Height)], fill=(round(Int,minimum(subsmdl.Height)),0.5,:blue), label=&quot;model&quot;)
plot!(hdl, subsmdl.Age, subsmdl.Height, linecolor=:blue, label=&quot;&quot;, fg_color_legend=:white) # Center line
t = smpl.Age_Sidedness .== 0 # Two-sided constraints (plot in black)
any(t) &amp;&amp; plot!(hdl, smpl.Age[t], smpl.Height[t], xerror=(smpl.Age[t]-smpl.Age_025CI[t],smpl.Age_975CI[t]-smpl.Age[t]),yerror=(2*smpl.Height_sigma[t]),label=&quot;data&quot;,seriestype=:scatter,color=:black)
t = smpl.Age_Sidedness .== 1 # Minimum ages (plot in cyan)
any(t) &amp;&amp; plot!(hdl, smpl.Age[t], smpl.Height[t], xerror=(smpl.Age[t]-smpl.Age_025CI[t],zeros(count(t))),label=&quot;&quot;,seriestype=:scatter,color=:cyan,msc=:cyan)
any(t) &amp;&amp; zip(smpl.Age[t], smpl.Age[t].+nanmean(smpl.Age_sigma[t])*4, smpl.Height[t]) .|&gt; x-&gt; plot!([x[1],x[2]],[x[3],x[3]], arrow=true, label=&quot;&quot;, color=:cyan)
t = smpl.Age_Sidedness .== -1 # Maximum ages (plot in orange)
any(t) &amp;&amp; plot!(hdl, smpl.Age[t], smpl.Height[t], xerror=(zeros(count(t)),smpl.Age_975CI[t]-smpl.Age[t]),label=&quot;&quot;,seriestype=:scatter,color=:orange,msc=:orange)
any(t) &amp;&amp; zip(smpl.Age[t], smpl.Age[t].-nanmean(smpl.Age_sigma[t])*4, smpl.Height[t]) .|&gt; x-&gt; plot!([x[1],x[2]],[x[3],x[3]], arrow=true, label=&quot;&quot;, color=:orange)
plot!(hdl, xlabel=&quot;Age ($(smpl.Age_Unit))&quot;, ylabel=&quot;Height ($(smpl.Height_Unit))&quot;)
#plot!(hdl, [smpl.Age[1], smpl.Height[1]],[smpl.Age[3], smpl.Height[3]])
savefig(hdl,&quot;Test_AgeModel.pdf&quot;)
#display(hdl)"><pre><span class="pl-c"><span class="pl-c">#</span> Plot 1: Age-depth model (mean and 95% confidence interval for both model and data)</span>
hdl <span class="pl-k">=</span> <span class="pl-c1">plot</span>([subsmdl<span class="pl-k">.</span>Age_025CI; <span class="pl-c1">reverse</span>(subsmdl<span class="pl-k">.</span>Age_975CI)],[subsmdl<span class="pl-k">.</span>Height; <span class="pl-c1">reverse</span>(subsmdl<span class="pl-k">.</span>Height)], fill<span class="pl-k">=</span>(<span class="pl-c1">round</span>(Int,<span class="pl-c1">minimum</span>(subsmdl<span class="pl-k">.</span>Height)),<span class="pl-c1">0.5</span>,<span class="pl-c1">:blue</span>), label<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>model<span class="pl-pds">"</span></span>)
<span class="pl-c1">plot!</span>(hdl, subsmdl<span class="pl-k">.</span>Age, subsmdl<span class="pl-k">.</span>Height, linecolor<span class="pl-k">=</span><span class="pl-c1">:blue</span>, label<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>, fg_color_legend<span class="pl-k">=</span><span class="pl-c1">:white</span>) <span class="pl-c"><span class="pl-c">#</span> Center line</span>
t <span class="pl-k">=</span> smpl<span class="pl-k">.</span>Age_Sidedness <span class="pl-k">.==</span> <span class="pl-c1">0</span> <span class="pl-c"><span class="pl-c">#</span> Two-sided constraints (plot in black)</span>
<span class="pl-c1">any</span>(t) <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">plot!</span>(hdl, smpl<span class="pl-k">.</span>Age[t], smpl<span class="pl-k">.</span>Height[t], xerror<span class="pl-k">=</span>(smpl<span class="pl-k">.</span>Age[t]<span class="pl-k">-</span>smpl<span class="pl-k">.</span>Age_025CI[t],smpl<span class="pl-k">.</span>Age_975CI[t]<span class="pl-k">-</span>smpl<span class="pl-k">.</span>Age[t]),yerror<span class="pl-k">=</span>(<span class="pl-c1">2</span><span class="pl-k">*</span>smpl<span class="pl-k">.</span>Height_sigma[t]),label<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>data<span class="pl-pds">"</span></span>,seriestype<span class="pl-k">=</span><span class="pl-c1">:scatter</span>,color<span class="pl-k">=</span><span class="pl-c1">:black</span>)
t <span class="pl-k">=</span> smpl<span class="pl-k">.</span>Age_Sidedness <span class="pl-k">.==</span> <span class="pl-c1">1</span> <span class="pl-c"><span class="pl-c">#</span> Minimum ages (plot in cyan)</span>
<span class="pl-c1">any</span>(t) <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">plot!</span>(hdl, smpl<span class="pl-k">.</span>Age[t], smpl<span class="pl-k">.</span>Height[t], xerror<span class="pl-k">=</span>(smpl<span class="pl-k">.</span>Age[t]<span class="pl-k">-</span>smpl<span class="pl-k">.</span>Age_025CI[t],<span class="pl-c1">zeros</span>(<span class="pl-c1">count</span>(t))),label<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>,seriestype<span class="pl-k">=</span><span class="pl-c1">:scatter</span>,color<span class="pl-k">=</span><span class="pl-c1">:cyan</span>,msc<span class="pl-k">=</span><span class="pl-c1">:cyan</span>)
<span class="pl-c1">any</span>(t) <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">zip</span>(smpl<span class="pl-k">.</span>Age[t], smpl<span class="pl-k">.</span>Age[t]<span class="pl-k">.</span><span class="pl-k">+</span><span class="pl-c1">nanmean</span>(smpl<span class="pl-k">.</span>Age_sigma[t])<span class="pl-k">*</span><span class="pl-c1">4</span>, smpl<span class="pl-k">.</span>Height[t]) <span class="pl-k">.|</span><span class="pl-k">&gt;</span> x<span class="pl-k">-&gt;</span> <span class="pl-c1">plot!</span>([x[<span class="pl-c1">1</span>],x[<span class="pl-c1">2</span>]],[x[<span class="pl-c1">3</span>],x[<span class="pl-c1">3</span>]], arrow<span class="pl-k">=</span><span class="pl-c1">true</span>, label<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>, color<span class="pl-k">=</span><span class="pl-c1">:cyan</span>)
t <span class="pl-k">=</span> smpl<span class="pl-k">.</span>Age_Sidedness <span class="pl-k">.==</span> <span class="pl-k">-</span><span class="pl-c1">1</span> <span class="pl-c"><span class="pl-c">#</span> Maximum ages (plot in orange)</span>
<span class="pl-c1">any</span>(t) <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">plot!</span>(hdl, smpl<span class="pl-k">.</span>Age[t], smpl<span class="pl-k">.</span>Height[t], xerror<span class="pl-k">=</span>(<span class="pl-c1">zeros</span>(<span class="pl-c1">count</span>(t)),smpl<span class="pl-k">.</span>Age_975CI[t]<span class="pl-k">-</span>smpl<span class="pl-k">.</span>Age[t]),label<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>,seriestype<span class="pl-k">=</span><span class="pl-c1">:scatter</span>,color<span class="pl-k">=</span><span class="pl-c1">:orange</span>,msc<span class="pl-k">=</span><span class="pl-c1">:orange</span>)
<span class="pl-c1">any</span>(t) <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">zip</span>(smpl<span class="pl-k">.</span>Age[t], smpl<span class="pl-k">.</span>Age[t]<span class="pl-k">.</span><span class="pl-k">-</span><span class="pl-c1">nanmean</span>(smpl<span class="pl-k">.</span>Age_sigma[t])<span class="pl-k">*</span><span class="pl-c1">4</span>, smpl<span class="pl-k">.</span>Height[t]) <span class="pl-k">.|</span><span class="pl-k">&gt;</span> x<span class="pl-k">-&gt;</span> <span class="pl-c1">plot!</span>([x[<span class="pl-c1">1</span>],x[<span class="pl-c1">2</span>]],[x[<span class="pl-c1">3</span>],x[<span class="pl-c1">3</span>]], arrow<span class="pl-k">=</span><span class="pl-c1">true</span>, label<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>, color<span class="pl-k">=</span><span class="pl-c1">:orange</span>)
<span class="pl-c1">plot!</span>(hdl, xlabel<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Age (<span class="pl-v">$(smpl<span class="pl-k">.</span>Age_Unit)</span>)<span class="pl-pds">"</span></span>, ylabel<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Height (<span class="pl-v">$(smpl<span class="pl-k">.</span>Height_Unit)</span>)<span class="pl-pds">"</span></span>)
<span class="pl-c"><span class="pl-c">#</span>plot!(hdl, [smpl.Age[1], smpl.Height[1]],[smpl.Age[3], smpl.Height[3]])</span>
<span class="pl-c1">savefig</span>(hdl,<span class="pl-s"><span class="pl-pds">"</span>Test_AgeModel.pdf<span class="pl-pds">"</span></span>)
<span class="pl-c"><span class="pl-c">#</span>display(hdl)</span></pre></div>
<ol start="2" dir="auto">
<li>Plot the posterior distribution of β;</li>
</ol>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# Plot 2: Posterior distributions of beta
post_beta = histogram(beta_t0dist[1,:], color=&quot;black&quot;, linecolor=nothing, alpha = 0.5, nbins=50)
vline!([subsmdl.Beta_Median], linecolor = &quot;black&quot;, linestyle=:dot, linewidth = 3)
savefig(post_beta, &quot;Test_PosteriorBeta.pdf&quot;)"><pre><span class="pl-c"><span class="pl-c">#</span> Plot 2: Posterior distributions of beta</span>
post_beta <span class="pl-k">=</span> <span class="pl-c1">histogram</span>(beta_t0dist[<span class="pl-c1">1</span>,:], color<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>black<span class="pl-pds">"</span></span>, linecolor<span class="pl-k">=</span><span class="pl-c1">nothing</span>, alpha <span class="pl-k">=</span> <span class="pl-c1">0.5</span>, nbins<span class="pl-k">=</span><span class="pl-c1">50</span>)
<span class="pl-c1">vline!</span>([subsmdl<span class="pl-k">.</span>Beta_Median], linecolor <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>black<span class="pl-pds">"</span></span>, linestyle<span class="pl-k">=</span><span class="pl-c1">:dot</span>, linewidth <span class="pl-k">=</span> <span class="pl-c1">3</span>)
<span class="pl-c1">savefig</span>(post_beta, <span class="pl-s"><span class="pl-pds">"</span>Test_PosteriorBeta.pdf<span class="pl-pds">"</span></span>)</pre></div>
<ol start="3" dir="auto">
<li>Plot the posterior distribution of t<sub>0</sub>;</li>
</ol>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# Plot 3: Posterior distributions of t₀
post_t0 = histogram(beta_t0dist[2,:], color=&quot;black&quot;, linecolor=nothing, alpha = 0.5, nbins=50)
vline!([subsmdl.T0_Median], linecolor = &quot;black&quot;, linestyle=:dot, linewidth = 3)
savefig(post_t0, &quot;Test_PosteriorT0.pdf&quot;)"><pre><span class="pl-c"><span class="pl-c">#</span> Plot 3: Posterior distributions of t₀</span>
post_t0 <span class="pl-k">=</span> <span class="pl-c1">histogram</span>(beta_t0dist[<span class="pl-c1">2</span>,:], color<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>black<span class="pl-pds">"</span></span>, linecolor<span class="pl-k">=</span><span class="pl-c1">nothing</span>, alpha <span class="pl-k">=</span> <span class="pl-c1">0.5</span>, nbins<span class="pl-k">=</span><span class="pl-c1">50</span>)
<span class="pl-c1">vline!</span>([subsmdl<span class="pl-k">.</span>T0_Median], linecolor <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>black<span class="pl-pds">"</span></span>, linestyle<span class="pl-k">=</span><span class="pl-c1">:dot</span>, linewidth <span class="pl-k">=</span> <span class="pl-c1">3</span>)
<span class="pl-c1">savefig</span>(post_t0, <span class="pl-s"><span class="pl-pds">"</span>Test_PosteriorT0.pdf<span class="pl-pds">"</span></span>)</pre></div>
<ol start="4" dir="auto">
<li>Calculate and plot the age predictions (as distributions) for undated horizons of interest.</li>
</ol>
<div class="highlight highlight-source-julia notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# Plot 4: Interpolate results for target horizons
target_height = [-1840, -1320, -980, -360]
interpolated_distribution = Array{Float64}(undef, length(target_height), size(agedist,2))
# Interpolate between model horizons
for i=1:size(agedist,2)
    interpolated_distribution[:,i] = linterp1s(subsmdl.Height,agedist[:,i],target_height)
end
# Calculate summary statistics
predicted_medians = nanmedian(interpolated_distribution, dims=1)
predicted_025CI = nanpctile(interpolated_distribution, 2.5, dims=1)
predicted_975CI = nanpctile(interpolated_distribution, 97.5, dims=1)
# Plotting (full distribution with mean as a dashed line)
age_interp = histogram(interpolated_distribution[:,2], nbins=50, label=&quot;&quot;)
vline!([predicted_medians[2]], linecolor = &quot;black&quot;, linestyle=:dot, linewidth = 3)
plot!(age_interp, xlabel=&quot;Age ($(smpl.Age_Unit))&quot;)
savefig(age_interp, &quot;Test_InterpolatedAge.pdf&quot;)
#display(age_interp)"><pre><span class="pl-c"><span class="pl-c">#</span> Plot 4: Interpolate results for target horizons</span>
target_height <span class="pl-k">=</span> [<span class="pl-k">-</span><span class="pl-c1">1840</span>, <span class="pl-k">-</span><span class="pl-c1">1320</span>, <span class="pl-k">-</span><span class="pl-c1">980</span>, <span class="pl-k">-</span><span class="pl-c1">360</span>]
interpolated_distribution <span class="pl-k">=</span> <span class="pl-c1">Array</span><span class="pl-c1">{Float64}</span>(undef, <span class="pl-c1">length</span>(target_height), <span class="pl-c1">size</span>(agedist,<span class="pl-c1">2</span>))
<span class="pl-c"><span class="pl-c">#</span> Interpolate between model horizons</span>
<span class="pl-k">for</span> i<span class="pl-k">=</span><span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">size</span>(agedist,<span class="pl-c1">2</span>)
    interpolated_distribution[:,i] <span class="pl-k">=</span> <span class="pl-c1">linterp1s</span>(subsmdl<span class="pl-k">.</span>Height,agedist[:,i],target_height)
<span class="pl-k">end</span>
<span class="pl-c"><span class="pl-c">#</span> Calculate summary statistics</span>
predicted_medians <span class="pl-k">=</span> <span class="pl-c1">nanmedian</span>(interpolated_distribution, dims<span class="pl-k">=</span><span class="pl-c1">1</span>)
predicted_025CI <span class="pl-k">=</span> <span class="pl-c1">nanpctile</span>(interpolated_distribution, <span class="pl-c1">2.5</span>, dims<span class="pl-k">=</span><span class="pl-c1">1</span>)
predicted_975CI <span class="pl-k">=</span> <span class="pl-c1">nanpctile</span>(interpolated_distribution, <span class="pl-c1">97.5</span>, dims<span class="pl-k">=</span><span class="pl-c1">1</span>)
<span class="pl-c"><span class="pl-c">#</span> Plotting (full distribution with mean as a dashed line)</span>
age_interp <span class="pl-k">=</span> <span class="pl-c1">histogram</span>(interpolated_distribution[:,<span class="pl-c1">2</span>], nbins<span class="pl-k">=</span><span class="pl-c1">50</span>, label<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>)
<span class="pl-c1">vline!</span>([predicted_medians[<span class="pl-c1">2</span>]], linecolor <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>black<span class="pl-pds">"</span></span>, linestyle<span class="pl-k">=</span><span class="pl-c1">:dot</span>, linewidth <span class="pl-k">=</span> <span class="pl-c1">3</span>)
<span class="pl-c1">plot!</span>(age_interp, xlabel<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Age (<span class="pl-v">$(smpl<span class="pl-k">.</span>Age_Unit)</span>)<span class="pl-pds">"</span></span>)
<span class="pl-c1">savefig</span>(age_interp, <span class="pl-s"><span class="pl-pds">"</span>Test_InterpolatedAge.pdf<span class="pl-pds">"</span></span>)
<span class="pl-c"><span class="pl-c">#</span>display(age_interp)</span></pre></div>
</article></div>