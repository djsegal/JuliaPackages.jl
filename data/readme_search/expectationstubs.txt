expectationstubs package exists help testing stubs patch mocks code mocking created using suitable patching ideal dependency injection functions set consider purpose stub simplified function returns fixed value input expectation arrange act assert style unit setup expectations stubbed called return call tested hit methods test tiggered expected validating belief key check docstrings repl foo declares expect integer sets exact real checks type usecount except times declared bool example usage status pipe pressure takes response normally calling email bad callback phil com darn gonna blow false true don emails replace mock write little closure variable pretty bit adhock enter base testset begin fakeemail abstractstring happens