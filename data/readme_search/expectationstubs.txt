expectationstubs package exists help testing stubs patch mocks code mocking theory created using ideal patching alpha hasn tested raise issue stub dependency injection functions set purposes mock key check docstrings repl foo declares called expect integer sets expectation exact value return real checks type usecount except returns times expectations declared bool example usage function status pipe pressure takes response normally calling email bad callback phil com darn gonna blow false true don emails replace write little closure variable pretty bit adhock enter base test testset begin fakeemail abstractstring happens